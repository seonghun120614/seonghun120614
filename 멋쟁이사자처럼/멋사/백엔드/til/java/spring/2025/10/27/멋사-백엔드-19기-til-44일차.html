<!DOCTYPE html>
<html lang="kor">

    <head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="icon" href="/seonghun120614/assets/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/seonghun120614/assets/css/style.css">
<title>[멋사 백엔드 19기] TIL 44일차 JUnit</title>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[멋사 백엔드 19기] TIL 44일차 JUnit | Seonghun’s Blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="[멋사 백엔드 19기] TIL 44일차 JUnit" />
<meta name="author" content="Seonghun Park" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/27/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-44%EC%9D%BC%EC%B0%A8.html" />
<meta property="og:url" content="https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/27/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-44%EC%9D%BC%EC%B0%A8.html" />
<meta property="og:site_name" content="Seonghun’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-10-27T00:03:55+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="[멋사 백엔드 19기] TIL 44일차 JUnit" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Seonghun Park"},"dateModified":"2025-10-27T00:03:55+00:00","datePublished":"2025-10-27T00:03:55+00:00","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"[멋사 백엔드 19기] TIL 44일차 JUnit","mainEntityOfPage":{"@type":"WebPage","@id":"https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/27/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-44%EC%9D%BC%EC%B0%A8.html"},"url":"https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/27/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-44%EC%9D%BC%EC%B0%A8.html"}</script>
<!-- End Jekyll SEO tag -->


<script type="text/javascript" src="/seonghun120614/assets/js/darkmode.js"></script>

<!-- Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RQTWJRLWGD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RQTWJRLWGD');
</script></head><script>
        document.addEventListener("DOMContentLoaded", function () {
            const toggle = document.getElementById("dark-toggle");
        
            // 이미 실행한 적 있는지 확인
            const hasToggled = localStorage.getItem("darkModeInitialized");
        
            if (!hasToggled && toggle && toggle.checked) {
                toggleDarkMode();
                localStorage.setItem("darkModeInitialized", "true"); // 최초 실행 기록
            }
        });
    </script>

    <body>
        <div id="scroll-progress"></div>
        <main class="container">
            <section class="about">
                <div class="about-header condensed">
                    <div class="about-title">
                        <a href="/seonghun120614/">
                            
                            <img class="light"
                                src="/seonghun120614/assets/portfolio.png"
                                alt="Seonghun Park" />
                            <img class="dark"
                                src="/seonghun120614/assets/portfolio.png"
                                alt="Seonghun Park" />
                            
                        </a>
                        <h2 id="title">
                            <a href="/seonghun120614/">Seonghun Park</a>
                        </h2>
                    </div><p class="tagline">Developer.</p></div>
                
                <ul class="social about-footer condensed"><li>
                        <a
                            href="https://github.com/seonghun120614"
                            target="_blank"
                            rel="noopener"
                            aria-label="github">
                            <i class="icon-github-circled"></i>
                        </a>
                    </li><li>
                        <a
                            href="mailto:seonghun120614@gmail.com"
                            target="_blank" rel="noopener" aria-label="email">
                            <i class="icon-mail-alt"></i>
                        </a>
                    </li></ul><nav class="navigation about-footer condensed">
                    <ul>
                        
                        <li>
                            <a href="/seonghun120614/about">About Me</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/computerscience">Computer Science</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/math">Math</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/softwareengineering">Software Engineering</a>
                        </li>
                        
                    </ul>
                </nav><p class="about-footer condensed">&copy;
                    2025</p><div class="about-footer condensed">
                    <p>Dark Mode
                        <i class="icon-moon"></i>
                        <label class="switch" for="dark-toggle">
                            <input id="dark-toggle" type="checkbox"
                                class="dark-mode-toggle"
                                aria-label="Toggle dark mode">
                            <span class="slider round"
                                onclick="toggleDarkMode()"></span>
                        </label>
                    </p>
                </div>
            </section>
            <section class="content">
                <script>
window.MathJax = {
    tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
    renderActions: {
        addMenu: []
    }
    }
};
</script>

<script type="text/javascript"
    id="MathJax-script"
    async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script><div class="post-container">
    <a class="post-link" href="/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/27/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-44%EC%9D%BC%EC%B0%A8.html">
        <h2 class="post-title">[멋사 백엔드 19기] TIL 44일차 JUnit</h2>
    </a>
    
    <div class="post-meta">
        <div class="post-date"><i class="icon-calendar"></i>Oct 27, 2025</div><ul class="post-categories"><li>멋쟁이사자처럼</li><li>멋사</li><li>백엔드</li><li>TIL</li><li>Java</li><li>Spring</li></ul></div>

    <div class="post">
        <!--more-->

<h2 id="-목차">📂 목차</h2>
<ul>
  <li><a href="#tdd">TDD</a>
    <ul>
      <li><a href="#red-green-refactor">Red-Green-Refactor</a></li>
      <li><a href="#단위-테스트">단위 테스트</a>
        <ul>
          <li><a href="#test-coverage">Test Coverage</a></li>
        </ul>
      </li>
      <li><a href="#통합-테스트">통합 테스트</a></li>
      <li><a href="#시스템-테스트">시스템 테스트</a></li>
    </ul>
  </li>
  <li><a href="#springboottest">SpringBootTest</a>
    <ul>
      <li><a href="#springboot-web-test">SpringBoot Web Test</a></li>
      <li><a href="#junit-5">JUnit 5</a></li>
      <li><a href="#주요-어노테이션">주요 어노테이션</a>
        <ul>
          <li><a href="#repeatedtest">@RepeatedTest</a></li>
          <li><a href="#parameterizedtest">@ParameterizedTest</a></li>
          <li><a href="#testfactory">@TestFactory</a></li>
        </ul>
      </li>
      <li><a href="#라이프사이클-관련">라이프사이클 관련</a></li>
      <li><a href="#assertions">Assertions</a></li>
    </ul>
  </li>
  <li><a href="#mockito">Mockito</a>
    <ul>
      <li><a href="#mock">@Mock</a></li>
      <li><a href="#injectmocks">@InjectMocks</a></li>
      <li><a href="#spy">@Spy</a></li>
      <li><a href="#captor">@Captor</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="-본문">📚 본문</h2>

<h3 id="tdd">TDD</h3>

<p>테스트를 먼저 작성하고 테스트를 통과하는 코드를 구현하는 개발 방법론이다.</p>

<ul>
  <li>코드 품질 향상</li>
  <li>버그 조기 발견</li>
  <li>설계 단순화 및 유지보수 용이</li>
  <li>코딩 목표의 명확성</li>
</ul>

<h4 id="red-green-refactor">Red-Green-Refactor</h4>

<p>테스팅의 상태는 다음과 같이 흘러가게 된다.</p>

<ol>
  <li>Red: 실패하는 테스트 작성
    <ul>
      <li>아직 기능이 구현되지 않았으므로 테스트 실패</li>
    </ul>
  </li>
  <li>Green: 최소한의 코드 작성으로 테스트 통과
    <ul>
      <li>기능 구현</li>
    </ul>
  </li>
  <li>Refactor: 코드 리팩토링
    <ul>
      <li>테스트가 통과하므로 안전하게 구조 개선 가능</li>
    </ul>
  </li>
</ol>

<h4 id="단위-테스트">단위 테스트</h4>

<p>프로그램의 가장 작은 단위(주로 메서드) 를 독립적으로 테스트, 즉 Bottom-Up 방법이며, 다음 특징이 있다.</p>

<ul>
  <li>독립적이어야 함</li>
  <li>빠르게 실행 가능</li>
  <li>작은 단위에 집중하여 가장 비용이 적음</li>
</ul>

<p>따라서 보통 개발 단계에서 채택할 수 있는 테스트이다.</p>

<h5 id="test-coverage">Test Coverage</h5>

<p>최소 수준 부터 100% 의 테스트 범위 까지 매 수준마다 단위 테스트를 실시해야 한다.</p>

<p>가장 최소 수준의 Coverage 는 메서드/클래스 단위일 것이다.</p>

<h4 id="통합-테스트">통합 테스트</h4>

<p>여러 모듈/컴포넌트가 함께 동작하는지를 테스트 한다.</p>

<ul>
  <li>모듈 혹은 클래스 간 상호작용 확인</li>
  <li>실제 서비스 환경과 유사하게 검증해야 한다</li>
</ul>

<h4 id="시스템-테스트">시스템 테스트</h4>

<p>전체 시스템을 테스트하며, 어플리케이션 전체가 coverage 가 된다. 이때는 실제 사용 시나리오를 기반으로 하여 테스트를 하기 때문에 시나리오 명세서를 통해 하나하나 테스트가 진행되는 듯하다.</p>

<blockquote>
  <p>이 외에도 다양한 테스트들이 있기 때문에 찾아보기를 바란다.</p>
</blockquote>

<h3 id="springboottest">SpringBootTest</h3>

<p>스프링 프레임워크를 사용하면, 스프링 자체의 어플리케이션 컨텍스트가 생성되게 되는데, 이는 어플리케이션 전반에서 사용되게 된다.</p>

<p>이를 테스트 환경에서도 작성하기 위해 또 테스트 코드와 실제 개발 코드를 분리시키기 위해 Spring Initializer 에서 생성된 프로젝트에는 <code class="language-plaintext highlighter-rouge">src/test</code> 도 있었다. 여기서는 java 쪽 폴더와 데칼코마니처럼 클래스들을 생성하여 테스트 코드를 작성할 수 있도록 해놨다.</p>

<p>하지만 이렇게 테스트할 때 우리는 컨텍스트를 들고와야 한다. 테스트 쪽에서는 스프링 어플리케이션을 실행하는 코드가 어디에도 없지만, 어노테이션 하나만으로 우리가 java 폴더에 개발한 해당 <code class="language-plaintext highlighter-rouge">Spring Bean</code> 들을 다 들고 온다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">UserServiceIntegrationTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">createUserTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">createUser</span><span class="o">(</span><span class="s">"hong"</span><span class="o">,</span> <span class="s">"hong@email.com"</span><span class="o">);</span>
        <span class="n">assertNotNull</span><span class="o">(</span><span class="n">userRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><strong>특징</strong></p>
<ul>
  <li>모든 Spring Bean 을 로드 -&gt; 의존성 주입이 가능</li>
  <li>실제 DB, JPA Repository, Service 등등 을 포함한 통합 테스트도 가능</li>
  <li>일반적인 단위 테스트(<code class="language-plaintext highlighter-rouge">@Test</code>) 보다 느릴 수 있음</li>
</ul>

<blockquote>
  <p>단순히 단위 테스트만 하고 싶다면 굳이 사용할 필요는 없고, Bean 의 범위를 줄여주는 <code class="language-plaintext highlighter-rouge">@WebMvcTest</code>, <code class="language-plaintext highlighter-rouge">@DataJpaTest</code> 등으로 범위를 좁힌다.</p>
</blockquote>

<p>따라서 <code class="language-plaintext highlighter-rouge">@SpringBootTest</code> 는 클래스 수준의 어노테이션으로 작성되며, <code class="language-plaintext highlighter-rouge">webEnvironment</code> 속성을 지원한다. 이 webEnvironment 는 다음 4가지 옵션이 있다:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">MOCK</code> &lt;- 기본값</li>
  <li><code class="language-plaintext highlighter-rouge">RANDOM_PORT</code></li>
  <li><code class="language-plaintext highlighter-rouge">DEFINED_PORT</code></li>
  <li><code class="language-plaintext highlighter-rouge">NONE</code></li>
</ul>

<p>MOCK 기능은 예를 들어 웹 환경이 어플리케이션의 <strong>클래스 경로에 있는 경우에만 내장 서버를 시작하는 대신 mock 웹 환경을 활용</strong>하게 된다. 하지만 웹 기능이 없다면 일반 <code class="language-plaintext highlighter-rouge">ApplicationContext</code> 를 로딩하게 된다.</p>

<p>이 외에도 다른 옵션에는 <code class="language-plaintext highlighter-rouge">RANDOM_PORT</code> 는 웹 어플리케이션 컨텍스트를 로딩하고 내<strong>장서버를 시작하여 사용 가능한 임의의 포트에 노출된 실제 웹 환경</strong>을 제공, <code class="language-plaintext highlighter-rouge">DEFINED_PORT</code> 는 프로퍼티에 정의된 포트를 사용하게 된다.</p>

<p>보통은 <code class="language-plaintext highlighter-rouge">NONE</code> 을 더 많이 사용했을텐데, 이 값이 바로 모의 웹 환경 이나 웹 환경이 전혀 없는 <code class="language-plaintext highlighter-rouge">ApplicationContext</code> 가 생성되는 것이고 내장 서버도 시작되지 않는다.</p>

<h4 id="springboot-web-test">SpringBoot Web Test</h4>

<p>위에서 <code class="language-plaintext highlighter-rouge">SpringBootTest.WebEnvironment.MOCK</code> 을 사용하여 모의 웹 환경을 토대로 실행할 수 있게 됨을 보았다. 보통 이는 다음과 같은 클래스 수준 어노테이션과 같이 쓴다.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@AutoConfigureMockMVC</code>: Spring MVC 웹 계층을 Mock 환경에서 테스트할 때 사용
    <ul>
      <li>이걸 붙이면 실제 서버를 띄우지 않고 DispatcherServlet, 컨트롤러, 필터, 인터셉터 등 MVC 구성을 테스트 할 수 있음</li>
      <li>리엑티브는 지원하지 않으며, <strong>Spring MVC</strong> 에서만 사용</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">@AutoConfigureWebTestClient</code>:
    <ul>
      <li><strong>Spring WebFlux</strong> 환경에서 비동기 웹 계층을 테스트</li>
      <li>실제 서버 또는 WebFlux 컨텍스트를 띄워서 WebTestClient 로 요청/응답 검증을 한다고 한다(자세한건 모른다).</li>
      <li>MVC 기반에서는 사용하지 않으며, <strong>Spring WebFlux</strong> 에서만 사용</li>
    </ul>
  </li>
</ul>

<p>즉 두 어노테이션의 사용은 각자 리액티브냐, MVC 냐에 달려있다. 아래는 예시이다.</p>

<p><strong>Spring MVC Test</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SpringBootTest</span>
<span class="nd">@AutoConfigureMockMvc</span>
<span class="kd">class</span> <span class="nc">UserControllerTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">getUserTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/users/1"</span><span class="o">))</span>
               <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
               <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.name"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"hong"</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><strong>Spring WebFlux Test</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SpringBootTest</span><span class="o">(</span><span class="n">webEnvironment</span> <span class="o">=</span> <span class="nc">SpringBootTest</span><span class="o">.</span><span class="na">WebEnvironment</span><span class="o">.</span><span class="na">RANDOM_PORT</span><span class="o">)</span>
<span class="nd">@AutoConfigureWebTestClient</span>
<span class="kd">class</span> <span class="nc">UserControllerWebFluxTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">WebTestClient</span> <span class="n">webTestClient</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">getUserTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">assert</span> <span class="n">webTestClient</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">uri</span><span class="o">(</span><span class="s">"/users/1"</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">exchange</span><span class="o">()</span>
                            <span class="o">.</span><span class="na">expectStatus</span><span class="o">().</span><span class="na">isOk</span><span class="o">()</span>
                            <span class="o">.</span><span class="na">expectBody</span><span class="o">()</span>
                            <span class="o">.</span><span class="na">jsonPath</span><span class="o">(</span><span class="s">"$.name"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"hong"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nd">@Autowired</span> <span class="nc">WebTestClient</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">assert</span> <span class="n">client</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="c1">// GET 요청 보내겠다.</span>
                     <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="s">"/aircraft"</span><span class="o">)</span> <span class="c1">// 해당 URI 로 엔드포인트 설정</span>
                     <span class="o">.</span><span class="na">exchange</span><span class="o">()</span> <span class="c1">// request / response 의 교환이 일어났다면,</span>
                     <span class="o">.</span><span class="na">expectStatus</span><span class="o">().</span><span class="na">isOk</span><span class="o">()</span> <span class="c1">// HTTP 200 의 응답을 확인 후 Response Body 반환</span>
                     <span class="o">.</span><span class="na">expectBody</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// 바디에 Iterable 이 포함됐는지 확인</span>
                     <span class="o">.</span><span class="na">returnResult</span><span class="o">()</span> <span class="c1">// Iterable 에 해당하는 response 회수</span>
                     <span class="o">.</span><span class="na">getResponseBody</span><span class="o">()</span> <span class="c1">// response 의 응답 바디 반환</span>
                     <span class="o">.</span><span class="na">iterator</span><span class="o">()</span> <span class="c1">// iterator 로 형 변환</span>
                     <span class="o">.</span><span class="na">hasNext</span><span class="o">();</span> <span class="c1">// 값이 하나라도 있다면 true</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Flux 까지는 보지 않고, 우선 JUnit 5 을 사용하는 것을 익히자.</p>

<h3 id="junit-5">JUnit 5</h3>

<p>테스트 코드를 작성하기 위한 패키지이다. 검증하는 코드는 주피터 엔진이 포함된 <strong>JUnit 5</strong>를 통해 테스트 코드를 작성할 수 있으며, 다음 기능들을 제공한다:</p>

<ul>
  <li>이전 버전에 비해 개선된 코틀린 코드 테스트</li>
  <li><code class="language-plaintext highlighter-rouge">@BeforeAll</code>, <code class="language-plaintext highlighter-rouge">@AfterAll</code> 사용하여 인스턴스화/설정 을 한꺼번에 가능</li>
  <li>JUnit 4 코드도 테스트에 지원</li>
</ul>

<p>JUnit 은 3가지 모듈로 구성되는데 <code class="language-plaintext highlighter-rouge">JUnit Platform</code>, <code class="language-plaintext highlighter-rouge">JUnit Jupiter</code>, <code class="language-plaintext highlighter-rouge">JUnit Vintage</code> 로 JUnit 5 는 <code class="language-plaintext highlighter-rouge">Jupiter + Platform</code> 이 되겠다(Vintage 는 JUnit 3, 4 테스트 호환 모듈이라고 보면 된다).</p>

<h4 id="주요-어노테이션">주요 어노테이션</h4>

<p>기본적으로 <code class="language-plaintext highlighter-rouge">@SpringBootTest</code> 를 통해 해당 클래스를 실행할때 테스트 클래스 임을 설정하고, 컨텍스트를 불러올 수 있다. 내부의 메서드들은 전부 <code class="language-plaintext highlighter-rouge">@Test</code> 를 사용하여 메서드 수준의 테스트를 작성할 수 있다. 여기서는 그 외의 다양한 어노테이션을 본다.</p>

<h5 id="repeatedtest">@RepeatedTest</h5>

<p>동일한 기능을 데이터만 바꿔가면서 실행하고 싶을 수 있다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">RepeatedTestExample</span> <span class="o">{</span>
    <span class="nd">@RepeatedTest</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"반복 테스트 기본 예시"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">repeatFiveTimes</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"테스트 실행 중..."</span><span class="o">);</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// 단순 검증</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h5 id="parameterizedtest">@ParameterizedTest</h5>

<p>위와 반복 실행은 똑같지만, 다양한 테스트 케이스를 넣도록 할 수 있다.</p>

<p><strong>@ValueSource 로 테스트 케이스들 넣기</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@ParameterizedTest</span>
<span class="nd">@ValueSource</span><span class="o">(</span><span class="n">ints</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">})</span>
<span class="kt">void</span> <span class="nf">testPositiveNumbers</span><span class="o">(</span><span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<blockquote>
  <p>지원 타입: <code class="language-plaintext highlighter-rouge">ints</code>, <code class="language-plaintext highlighter-rouge">longs</code>, <code class="language-plaintext highlighter-rouge">doubles</code>, <code class="language-plaintext highlighter-rouge">strings</code>, <code class="language-plaintext highlighter-rouge">classes</code>, 모르면 내부 보자</p>
</blockquote>

<p><strong>@EnumSource 로 테스트 케이스들 넣기</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">enum</span> <span class="nc">Color</span> <span class="o">{</span> <span class="no">RED</span><span class="o">,</span> <span class="no">GREEN</span><span class="o">,</span> <span class="no">BLUE</span> <span class="o">}</span>

<span class="nd">@ParameterizedTest</span>
<span class="nd">@EnumSource</span><span class="o">(</span><span class="nc">Color</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">testEnum</span><span class="o">(</span><span class="nc">Color</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assertNotNull</span><span class="o">(</span><span class="n">color</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p><strong>@CsvSource 로 테스트 케이스들 넣기</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@ParameterizedTest</span>
<span class="nd">@CsvSource</span><span class="o">({</span>
    <span class="s">"apple, 1"</span><span class="o">,</span>
    <span class="s">"banana, 2"</span><span class="o">,</span>
    <span class="s">"orange, 3"</span>
<span class="o">})</span>
<span class="kt">void</span> <span class="nf">testFruit</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assertNotNull</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p><strong>@CsvFileSource 로 테스트 케이스들 넣기</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@ParameterizedTest</span>
<span class="nd">@CsvSource</span><span class="o">({</span>
    <span class="s">"apple, 1"</span><span class="o">,</span>
    <span class="s">"banana, 2"</span><span class="o">,</span>
    <span class="s">"orange, 3"</span>
<span class="o">})</span>
<span class="kt">void</span> <span class="nf">testFruit</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assertNotNull</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p><strong>@MethodSource 로 테스트 케이스들 넣기</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Arguments</span><span class="o">&gt;</span> <span class="nf">provideNumbers</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span>
        <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
    <span class="o">);</span>
<span class="o">}</span>

<span class="nd">@ParameterizedTest</span>
<span class="nd">@MethodSource</span><span class="o">(</span><span class="s">"provideNumbers"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">testAddition</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">,</span> <span class="kt">int</span> <span class="n">expected</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="n">expected</span><span class="o">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<blockquote>
  <p>장점: 동적, 복잡한 객체 제공 가능</p>
</blockquote>

<p><strong>@ArgumentsSource 로 테스트 케이스들 넣기</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">MyArgumentsProvider</span> <span class="kd">implements</span> <span class="nc">ArgumentsProvider</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Stream</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Arguments</span><span class="o">&gt;</span> <span class="nf">provideArguments</span><span class="o">(</span><span class="nc">ExtensionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@ParameterizedTest</span>
<span class="nd">@ArgumentsSource</span><span class="o">(</span><span class="nc">MyArgumentsProvider</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">testCustomProvider</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<blockquote>
  <p>장점: 매우 유연, 외부 API 연동 가능</p>
</blockquote>

<p><strong>장점을 이용하기 위해서 ArgumentsSource, MethodSource 를 사용하여 넣어주자.</strong> 나머지는 다양하게 넣는거 뿐이다.</p>

<h5 id="testfactory">@TestFactory</h5>

<p>실행 시점에 테스트 케이스를 동적으로 생성하는 메서드에 붙이는 어노테이션이며, 여러 개의 테스트 데이터들을 넣어 결과로 <code class="language-plaintext highlighter-rouge">Collection</code> 혹은 <code class="language-plaintext highlighter-rouge">Stream</code> 의 형태로 반환되게 된다. 예시를 보자.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">DynamicTestExample</span> <span class="o">{</span>
    <span class="nd">@TestFactory</span>
    <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">DynamicTest</span><span class="o">&gt;</span> <span class="nf">dynamicTestsFromStream</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">n</span> <span class="o">-&gt;</span> <span class="n">dynamicTest</span><span class="o">(</span><span class="s">"test for "</span> <span class="o">+</span> <span class="n">n</span><span class="o">,</span>
                        <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">assertTrue</span><span class="o">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)));</span>
    <span class="o">}</span>

    <span class="nd">@TestFactory</span>
    <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">DynamicTest</span><span class="o">&gt;</span> <span class="nf">dynamicStringTests</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">words</span> <span class="o">=</span> <span class="o">{</span><span class="s">"apple"</span><span class="o">,</span> <span class="s">"banana"</span><span class="o">,</span> <span class="s">"cherry"</span><span class="o">};</span>

        <span class="k">return</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">words</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">word</span> <span class="o">-&gt;</span> <span class="n">dynamicTest</span><span class="o">(</span><span class="s">"Length &gt; 0 for "</span> <span class="o">+</span> <span class="n">word</span><span class="o">,</span>
                        <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">assertTrue</span><span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)));</span>
    <span class="o">}</span>

    <span class="nd">@TestFactory</span>
    <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">DynamicTest</span><span class="o">&gt;</span> <span class="nf">dynamicTestsFromRandom</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">generate</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="mi">100</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">n</span> <span class="o">-&gt;</span> <span class="n">dynamicTest</span><span class="o">(</span><span class="s">"test for "</span> <span class="o">+</span> <span class="n">n</span><span class="o">,</span>
                                            <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">assertTrue</span><span class="o">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)));</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">dynamicTest("이름", Executable)</code> 을 통해 테스트 이름과 로직을 지정하며, 이를 통해 테스트 이름을 런타임에 동적으로 지정할 수 있게 되며, 랜덤과 함께 사용한다면 더 강력한 테스트 범위까지 확장시킬 수 있고 데이터가 동적이게 된다.</p>

<h4 id="라이프사이클-관련">라이프사이클 관련</h4>

<p>모든 것은 함수 수준이다.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@BeforeEach</code>: non-static 으로 각 테스트 전에 실행</li>
  <li><code class="language-plaintext highlighter-rouge">@AfterEach</code>: non-static 으로 각 테스트 후에 실행</li>
  <li><code class="language-plaintext highlighter-rouge">@BeforeAll</code>: static 메서드로 클래스 전체 테스트 전 한 번 실행</li>
  <li><code class="language-plaintext highlighter-rouge">@AfterAll</code>: static 메서드로 클래스 전체 테스트 후 한 번 실행</li>
</ul>

<p><strong>조건부 실행</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">@EnabledOnOs</code>, <code class="language-plaintext highlighter-rouge">@DisabledOnOs</code>: 특정 OS 에서만 활성화 / 비활성화</li>
  <li><code class="language-plaintext highlighter-rouge">@EnabledOnJre</code>, <code class="language-plaintext highlighter-rouge">@DisabledOnJre</code>: 특정 JRE 에서만 실행</li>
  <li><code class="language-plaintext highlighter-rouge">@EnabledIf</code>, <code class="language-plaintext highlighter-rouge">@DisabledIf</code>: 커스텀 조건<code class="language-plaintext highlighter-rouge">SpEL</code> 에 따라 실행/비활성화</li>
</ul>

<p><strong>예외 및 시간 지정</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">@Timeout</code>: <code class="language-plaintext highlighter-rouge">@Timeout(500, unit = TimeUnit.MILLISECONDS)</code></li>
  <li><code class="language-plaintext highlighter-rouge">assertThrows</code></li>
</ul>

<p><strong>테스트 그룹화</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">@Tag("fast")</code>: 테스트 그룹을 지정하며, 특정 지정 태그만 실행이 가능하도록 할 수 있다.</li>
</ul>

<h4 id="assertions">Assertions</h4>

<p><code class="language-plaintext highlighter-rouge">Assertions</code> 클래스는 다양한 검증을 수행할 수 있는 기능을 제공하는 클래스이다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">assertEquals</span><span class="o">(</span><span class="n">expected</span><span class="o">,</span> <span class="n">actual</span><span class="o">);</span>
<span class="n">assertNotEquals</span><span class="o">(</span><span class="n">expected</span><span class="o">,</span> <span class="n">actual</span><span class="o">);</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">condition</span><span class="o">);</span>
<span class="n">assertFalse</span><span class="o">(</span><span class="n">condition</span><span class="o">);</span>
<span class="n">assertNull</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
<span class="n">assertNotNull</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
<span class="n">assertThrows</span><span class="o">(</span><span class="nc">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{...});</span>
<span class="n">assertAll</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{...},</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{...});</span> <span class="c1">// 여러 검증 동시에</span>
<span class="n">assertArrayEquals</span><span class="o">(</span><span class="n">expected</span><span class="o">,</span> <span class="n">actual</span><span class="o">);</span>
<span class="n">assertIterableEquals</span><span class="o">(</span><span class="n">expected</span><span class="o">,</span> <span class="n">actual</span><span class="o">);</span>
<span class="n">assertLinesMatch</span><span class="o">(</span><span class="n">expectedLines</span><span class="o">,</span> <span class="n">actualLines</span><span class="o">);</span> <span class="c1">// 문자열 라인 단위 비교</span></code></pre></figure>

<p>여기서 주의할 점은 expected 가 우리가 기대할 값이 들어가야 하지 실제 값이 들어가면 안된다. 둘은 자리가 정해져 있다. 이런 메서드들을 <code class="language-plaintext highlighter-rouge">@Test</code> 의 단위에 맞게 넣어주어 사용하면 된다.</p>

<h3 id="mockito">Mockito</h3>

<p>Spring 테스트에서 자주 쓰이는 가짜 객체 기능을 제공하는 패키지이다. 테스트를 할 대상 객체가 의존하는 다른 외부 객체를 필요로 할 때 우리는 테스트를 섣불리 못하게 되지만, <code class="language-plaintext highlighter-rouge">Mockito</code> 를 활용하면 가짜 객체를 부여하여 테스트를 독립적으로 할 수 있다.</p>

<h4 id="mock">@Mock</h4>

<p>가짜 객체를 생성하는 어노테이션이며, 필드에 붙여주게 된다. 클래스에 <code class="language-plaintext highlighter-rouge">@ExtendWith(MockitoExtension.class)</code> 어노테이션을 붙여주면 <code class="language-plaintext highlighter-rouge">Mockito</code> 를 사용할 수 있게 된다.</p>

<p>Mock 은 말 그대로 가짜이기 때문에 특징으로는 다음과 같다:</p>

<ul>
  <li>Mock 객체는 실제 구현체를 호출하지 않고 테스트에서 지정한 동작만 수행</li>
  <li>Mock 객체는<code class="language-plaintext highlighter-rouge"> when(...).thenReturn(...)</code> 또는 <code class="language-plaintext highlighter-rouge">doReturn(...).when(...)</code> 같은 구문을 사용하여 호출 시 반환값과 동작을 정의 가능</li>
  <li>Mock 객체의 메서드 호출 여부, 호출 횟수 등을 <code class="language-plaintext highlighter-rouge">verify(...)</code> 메서드로 검증 가능</li>
</ul>

<h4 id="injectmocks">@InjectMocks</h4>

<p>Mock 객체를 주입할 대상 클래스를 지정해야 한다. 즉 위의 <code class="language-plaintext highlighter-rouge">@Mock</code> 만 사용해서는 안되며, 이를 어디에 주입시켜줄지를 지정해줘야 하는데 이를 <code class="language-plaintext highlighter-rouge">@InjectMocks</code> 로 한다. 그래서 보통 클래스에 하나만 이 어노테이션을 사용하는게 일반적이며, 여기에 <code class="language-plaintext highlighter-rouge">@Mock</code>, <code class="language-plaintext highlighter-rouge">@Spy</code> 가 자동 주입이 되게 된다.</p>

<p><strong>예시</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">MockitoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">UserServiceTest</span> <span class="o">{</span>

    <span class="nd">@Mock</span>
    <span class="kd">private</span> <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span> <span class="c1">// Mock 객체 생성</span>

    <span class="nd">@InjectMocks</span>
    <span class="kd">private</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span> <span class="c1">// Mock 주입</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">createUserTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">mockUser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"hong"</span><span class="o">);</span>
        <span class="n">when</span><span class="o">(</span><span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">any</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">mockUser</span><span class="o">);</span>

        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">createUser</span><span class="o">(</span><span class="s">"hong"</span><span class="o">);</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="s">"hong"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

        <span class="n">verify</span><span class="o">(</span><span class="n">userRepository</span><span class="o">).</span><span class="na">save</span><span class="o">(</span><span class="n">any</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">));</span> <span class="c1">// 호출 여부 검증</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4 id="spy">@Spy</h4>

<p>실제 객체를 사용하면서 일부 메서드만 Mock 처리를 한다. 가짜로 처리하고 싶은 메서드는 <code class="language-plaintext highlighter-rouge">when(...).thenReturn(...)</code> 으로 가짜 동작을 덮어씌울 수 있다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Spy</span>
<span class="kd">private</span> <span class="nc">UserService</span> <span class="n">userService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserService</span><span class="o">();</span>

<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">testSpy</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">when</span><span class="o">(</span><span class="n">userService</span><span class="o">.</span><span class="na">getUserName</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="s">"mocked name"</span><span class="o">);</span>

    <span class="c1">// getUserName 은 Mock 동작, 다른 메서드는 실제로 실행됨</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"mocked name"</span><span class="o">,</span> <span class="n">userService</span><span class="o">.</span><span class="na">getUserName</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure>

<blockquote>
  <p>Stub: 호출되면 정해진 값을 돌려주는 가짜 객체</p>
</blockquote>

<h4 id="captor">@Captor</h4>

<p><code class="language-plaintext highlighter-rouge">ArgumentCaptor</code> 를 생성하는 어노테이션이다. 테스트에서 <strong>메서드 호출 시 전달된 인자(argument)</strong> 를 캡처(capture)하여 검증하고 싶을 때 사용한다.</p>

<ul>
  <li>메서드가 호출될 때 전달된 실제 인자 값을 꺼내서 확인할 수 있음</li>
  <li><code class="language-plaintext highlighter-rouge">verify()</code> 와 함께 사용</li>
  <li>여러 인자를 순서대로 검증할 수 있음</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Mock</span>
<span class="kd">private</span> <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>

<span class="nd">@InjectMocks</span>
<span class="kd">private</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>

<span class="nd">@Captor</span>
<span class="kd">private</span> <span class="nc">ArgumentCaptor</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">userCaptor</span><span class="o">;</span> <span class="c1">// 인자 캡쳐용</span>

<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">createUser_capturesArgument</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">userService</span><span class="o">.</span><span class="na">createUser</span><span class="o">(</span><span class="s">"hong"</span><span class="o">);</span>

    <span class="n">verify</span><span class="o">(</span><span class="n">userRepository</span><span class="o">).</span><span class="na">save</span><span class="o">(</span><span class="n">userCaptor</span><span class="o">.</span><span class="na">capture</span><span class="o">());</span> <span class="c1">// save()에 전달된 User 객체 캡처</span>

    <span class="nc">User</span> <span class="n">capturedUser</span> <span class="o">=</span> <span class="n">userCaptor</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>

    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"hong"</span><span class="o">,</span> <span class="n">capturedUser</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span> <span class="c1">// 전달된 객체의 값 검증</span>
<span class="o">}</span></code></pre></figure>


    </div><div id="disqus_thread" style="margin-top:25px"></div>
    <script>
    var disqus_config = function () {
        this.page.url = 'https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/27/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-44%EC%9D%BC%EC%B0%A8.html';
        this.page.identifier = 'https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/27/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-44%EC%9D%BC%EC%B0%A8.html';
    };
    (function () {
        var d = document, s = d.createElement('script');
        s.src = 'https://seonghun.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
  </script>
    <noscript>Please enable JavaScript to view the <a
            href="https://disqus.com/?ref_noscript" rel="nofollow">comments
            powered by Disqus.</a></noscript></div>
<script>
    mermaid.initialize({startOnLoad:true});
    window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
</script>
            </section>
            <footer class="condensed">
                <ul class="social about-footer condensed"><li>
                        <a
                            href="https://github.com/seonghun120614"
                            target="_blank"
                            rel="noopener"
                            aria-label="github">
                            <i class="icon-github-circled"></i>
                        </a>
                    </li><li>
                        <a
                            href="mailto:seonghun120614@gmail.com"
                            target="_blank" rel="noopener" aria-label="email">
                            <i class="icon-mail-alt"></i>
                        </a>
                    </li></ul><nav class="navigation about-footer condensed">
                    <ul>
                        
                        <li>
                            <a href="/seonghun120614/about">About Me</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/computerscience">Computer Science</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/math">Math</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/softwareengineering">Software Engineering</a>
                        </li>
                        
                    </ul>
                </nav><p class="about-footer condensed">&copy;
                    2025</p><div class="about-footer condensed">
                    <p>Dark Mode
                        <i class="icon-moon"></i>
                        <label class="switch" for="dark-toggle">
                            <input id="dark-toggle" type="checkbox"
                                class="dark-mode-toggle"
                                aria-label="Toggle dark mode">
                            <span class="slider round"
                                onclick="toggleDarkMode()"></span>
                        </label>
                    </p>
                </div>
            </footer>
        </main>
        
        <script type="text/javascript" src="/seonghun120614/assets/js/darkmode.js"></script>
        
        <script src="/seonghun120614/assets/js/simple-jekyll-search.min.js"></script>
        <script src="/seonghun120614/assets/js/search.js"></script>
        
        <script>
            window.addEventListener('scroll', () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                document.getElementById('scroll-progress').style.width = scrollPercent + '%';
            });
        </script>
    </body>
</html>