<!DOCTYPE html>
<html lang="kor">

    <head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="icon" href="/seonghun120614/assets/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/seonghun120614/assets/css/style.css">
<title>[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 47ì¼ì°¨ Reactive Programming</title>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 47ì¼ì°¨ Reactive Programming | Seonghunâ€™s Blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 47ì¼ì°¨ Reactive Programming" />
<meta name="author" content="Seonghun Park" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/30/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-47%EC%9D%BC%EC%B0%A8-reactive-programming.html" />
<meta property="og:url" content="https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/30/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-47%EC%9D%BC%EC%B0%A8-reactive-programming.html" />
<meta property="og:site_name" content="Seonghunâ€™s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-10-30T00:07:23+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 47ì¼ì°¨ Reactive Programming" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Seonghun Park"},"dateModified":"2025-10-30T00:07:23+00:00","datePublished":"2025-10-30T00:07:23+00:00","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 47ì¼ì°¨ Reactive Programming","mainEntityOfPage":{"@type":"WebPage","@id":"https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/30/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-47%EC%9D%BC%EC%B0%A8-reactive-programming.html"},"url":"https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/30/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-47%EC%9D%BC%EC%B0%A8-reactive-programming.html"}</script>
<!-- End Jekyll SEO tag -->


<script type="text/javascript" src="/seonghun120614/assets/js/darkmode.js"></script>

<!-- Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RQTWJRLWGD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RQTWJRLWGD');
</script></head><script>
        document.addEventListener("DOMContentLoaded", function () {
            const toggle = document.getElementById("dark-toggle");
        
            // ì´ë¯¸ ì‹¤í–‰í•œ ì  ìˆëŠ”ì§€ í™•ì¸
            const hasToggled = localStorage.getItem("darkModeInitialized");
        
            if (!hasToggled && toggle && toggle.checked) {
                toggleDarkMode();
                localStorage.setItem("darkModeInitialized", "true"); // ìµœì´ˆ ì‹¤í–‰ ê¸°ë¡
            }
        });
    </script>

    <body>
        <div id="scroll-progress"></div>
        <main class="container">
            <section class="about">
                <div class="about-header condensed">
                    <div class="about-title">
                        <a href="/seonghun120614/">
                            
                            <img class="light"
                                src="/seonghun120614/assets/portfolio.png"
                                alt="Seonghun Park" />
                            <img class="dark"
                                src="/seonghun120614/assets/portfolio.png"
                                alt="Seonghun Park" />
                            
                        </a>
                        <h2 id="title">
                            <a href="/seonghun120614/">Seonghun Park</a>
                        </h2>
                    </div><p class="tagline">Developer.</p></div>
                
                <ul class="social about-footer condensed"><li>
                        <a
                            href="https://github.com/seonghun120614"
                            target="_blank"
                            rel="noopener"
                            aria-label="github">
                            <i class="icon-github-circled"></i>
                        </a>
                    </li><li>
                        <a
                            href="mailto:seonghun120614@gmail.com"
                            target="_blank" rel="noopener" aria-label="email">
                            <i class="icon-mail-alt"></i>
                        </a>
                    </li></ul><nav class="navigation about-footer condensed">
                    <ul>
                        
                        <li>
                            <a href="/seonghun120614/about">About Me</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/computerscience">Computer Science</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/math">Math</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/softwareengineering">Software Engineering</a>
                        </li>
                        
                    </ul>
                </nav><p class="about-footer condensed">&copy;
                    2025</p><div class="about-footer condensed">
                    <p>Dark Mode
                        <i class="icon-moon"></i>
                        <label class="switch" for="dark-toggle">
                            <input id="dark-toggle" type="checkbox"
                                class="dark-mode-toggle"
                                aria-label="Toggle dark mode">
                            <span class="slider round"
                                onclick="toggleDarkMode()"></span>
                        </label>
                    </p>
                </div>
            </section>
            <section class="content">
                <script>
window.MathJax = {
    tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
    renderActions: {
        addMenu: []
    }
    }
};
</script>

<script type="text/javascript"
    id="MathJax-script"
    async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script><div class="post-container">
    <a class="post-link" href="/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/30/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-47%EC%9D%BC%EC%B0%A8-reactive-programming.html">
        <h2 class="post-title">[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 47ì¼ì°¨ Reactive Programming</h2>
    </a>
    
    <div class="post-meta">
        <div class="post-date"><i class="icon-calendar"></i>Oct 30, 2025</div><ul class="post-categories"><li>ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼</li><li>ë©‹ì‚¬</li><li>ë°±ì—”ë“œ</li><li>TIL</li><li>Java</li><li>Spring</li></ul></div>

    <div class="post">
        <!--more-->

<h2 id="-ëª©ì°¨">ğŸ“‚ ëª©ì°¨</h2>

<ul>
  <li><a href="#reactor">Reactor</a>
    <ul>
      <li><a href="#publisher-subscriber">Publisher-Subscriber</a></li>
      <li><a href="#mono-flux">Mono, Flux</a>
        <ul>
          <li><a href="#creation-operator">Creation Operator</a></li>
          <li><a href="#transformation-operator">Transformation Operator</a></li>
          <li><a href="#filtering-operator">Filtering Operator</a></li>
          <li><a href="#combination-operator">Combination Operator</a></li>
          <li><a href="#error-handling-operator">Error Handling Operator</a></li>
        </ul>
      </li>
      <li><a href="#ë³‘ë ¬-ì²˜ë¦¬">ë³‘ë ¬ ì²˜ë¦¬</a>
        <ul>
          <li><a href="#scheduler">Scheduler</a></li>
          <li><a href="#parallel-operator">Parallel Operator</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="">Reactive Programming</a>
    <ul>
      <li><a href="#r2dbc">R2DBC</a>
        <ul>
          <li><a href="#ìˆœìˆ˜-r2dbc-ì˜ì¡´ì„±-ì¶”ê°€">ìˆœìˆ˜ R2DBC ì˜ì¡´ì„± ì¶”ê°€</a></li>
          <li><a href="#connectionfactory-ì„¤ì •">ConnectionFactory ì„¤ì •</a></li>
          <li><a href="#connectionfactory-ì¸í„°í˜ì´ìŠ¤">ConnectionFactory ì¸í„°í˜ì´ìŠ¤</a></li>
          <li><a href="#connection">Connection</a></li>
          <li><a href=""></a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="-ë³¸ë¬¸">ğŸ“š ë³¸ë¬¸</h2>

<h3 id="reactor">Reactor</h3>

<p><code class="language-plaintext highlighter-rouge">Spring WebFlux</code> ì˜ í•µì‹¬ ë¶€ë¶„ì´ ë°”ë¡œ ë¦¬ì•¡í„°ê°€ ìˆë‹¤. ë¦¬ì•¡í„°ëŠ” <strong>Reactive Streams</strong> í‘œì¤€(<strong>Publisher-Subscriber ëª¨ë¸</strong>) ì„ êµ¬í˜„í•œ Java ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë©° ê·¸ ì¤‘ <strong>Reactor Core</strong> ëŠ” í•µì‹¬ ëª¨ë“ˆë¡œ, ë¹„ë™ê¸°/ë…¼ë¸”ë¡œí‚¹ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ API ë¥¼ì œê³µí•´ì¤€ë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">Spring WebFlux</code> ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ <strong>Reactor Core</strong> ë¥¼ ì‚¬ìš©í•˜ì—¬ HTTP ìš”ì²­/ì‘ë‹µ, DB, íŒŒì¼, ì™¸ë¶€ API í˜¸ì¶œ ë“±ì„ Reactive ë°©ì‹ìœ¼ë¡œ ì—°ê²°í•œë‹¤.</p>

<h4 id="publisher-subscriber">Publisher-Subscriber</h4>

<p><code class="language-plaintext highlighter-rouge">Publisher</code> ëŠ” ë¬´ì–¸ê°€ë¥¼ ìƒì„±í•˜ëŠ” ì±…ì„ì„ ë§¡ì€ ê°ì²´ì´ë‹¤. <code class="language-plaintext highlighter-rouge">Reactor</code> ì—ì„œ <code class="language-plaintext highlighter-rouge">Flux</code> ì™€ <code class="language-plaintext highlighter-rouge">Mono</code> ê°€ ë°”ë¡œ ì´ ì—­í• ì„ í•œë‹¤. Subscriber ëŠ” ë°˜ëŒ€ë¡œ ë¬´ì–¸ê°€ë¥¼ ì†Œë¹„í•˜ëŠ” ì—­í• ì„ í•˜ëŠ” ê°ì²´ì´ë©°, ë°ì´í„°ë¥¼ <code class="language-plaintext highlighter-rouge">request</code> ë³´ë‚´ê³  <code class="language-plaintext highlighter-rouge">subscribe</code> í•˜ì—¬ ì†Œë¹„í•˜ê²Œ ëœë‹¤.</p>

<p>ì´ëŸ° Subscription ê´€ê³„ê°€ ì„±ë¦½ë˜ë©´, ë°ì´í„° íë¦„ì´ ì œì–´ê°€ ë˜ë©°, <code class="language-plaintext highlighter-rouge">backpressure</code> ê°€ ì§€ì›ì´ ëœë‹¤.</p>

<blockquote>
  <p><strong>Backpressure(ë°°ì••)</strong>: <code class="language-plaintext highlighter-rouge">Subscriber</code> ê°€ ë„ˆë¬´ ë§ì€ ë°ì´í„°ë¥¼ í•œë²ˆì— ëª»ë°›ì•„ì„œ íŠ¹ì • ì‹ í˜¸ë¥¼ ë³´ë‚´ë©´ ì•Œì•„ì„œ <code class="language-plaintext highlighter-rouge">Publisher</code> ê°€ ì „ì†¡ ì†ë„ë¥¼ ì¡°ì ˆí•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.</p>
</blockquote>

<p>ì´ì œ <code class="language-plaintext highlighter-rouge">Publisher</code> ë¥¼ ìƒì„±í•´ë³´ì.</p>

<h4 id="mono-flux">Mono, Flux</h4>

<p>ì´ ë‘ í´ë˜ìŠ¤ëŠ” <code class="language-plaintext highlighter-rouge">Publisher</code> ì´ë©°, <code class="language-plaintext highlighter-rouge">Mono</code> ëŠ” ë§ ê·¸ëŒ€ë¡œ 0 ë˜ëŠ” 1ê°œì˜ ë°ì´í„°ë¥¼ ë¹„ë™ê¸°ë¡œ ìƒì‚°í•˜ê³ , <code class="language-plaintext highlighter-rouge">Flux</code> ëŠ” 0-N ê°œì˜ ë°ì´í„°ë¥¼ ë¹„ë™ê¸°ë¡œ ìƒì‚°í•  ìˆ˜ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">mono</span> <span class="o">=</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="s">"Hello Reactor"</span><span class="o">);</span>
<span class="n">mono</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">String:</span><span class="o">:</span><span class="n">toUpperCase</span><span class="o">)</span>
    <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>  <span class="c1">// HELLO REACTOR</span>

<span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">flux</span> <span class="o">=</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
<span class="n">flux</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)</span>
    <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>  <span class="c1">// 2 4 6 8 10</span></code></pre></figure>

<h5 id="creation-operator">Creation Operator</h5>

<p><code class="language-plaintext highlighter-rouge">Mono</code>, <code class="language-plaintext highlighter-rouge">Flux</code> ë©”ì„œë“œì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë©”ì„œë“œë“¤ì´ ìˆë‹¤.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">just(T value)</code>: ë‹¨ì¼ ê°’ ë˜ëŠ” ì—¬ëŸ¬ê°’ ë°œí–‰</li>
  <li><code class="language-plaintext highlighter-rouge">empty()</code>: ì•„ë¬´ ê°’ë„ ë°œí–‰í•˜ì§€ ì•ŠìŒ</li>
  <li><code class="language-plaintext highlighter-rouge">error(Throwable e)</code>: ì—ëŸ¬ ì‹ í˜¸ ë°œí–‰</li>
  <li><code class="language-plaintext highlighter-rouge">fromCallable(Supplier&lt;T&gt;)</code>: <code class="language-plaintext highlighter-rouge">Iterable</code> ì„ <code class="language-plaintext highlighter-rouge">Flux</code> ë¡œ ë³€í™˜</li>
  <li><code class="language-plaintext highlighter-rouge">fromIterator(Iterable&lt;T&gt;)</code>: <code class="language-plaintext highlighter-rouge">Callable</code> ì˜ ê²°ê³¼ë¥¼ ë°œí–‰</li>
  <li><code class="language-plaintext highlighter-rouge">range(int start, int count)</code>: íŠ¹ì • ë²”ìœ„ì˜ ì •ìˆ˜ <code class="language-plaintext highlighter-rouge">Flux</code></li>
  <li><code class="language-plaintext highlighter-rouge">interval(Duration)</code>: ì¼ì • ì£¼ê¸°ë¡œ <code class="language-plaintext highlighter-rouge">Long</code> ê°’ ë°œí–‰, <code class="language-plaintext highlighter-rouge">Flux.interval()</code></li>
</ul>

<p><strong>íƒ€ì´ë¨¸</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/timer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">timer</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">interval</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="s">"ì´ˆ í›„ ì…ë‹ˆë‹¤.\n"</span><span class="o">);</span>
<span class="o">}</span>
<span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/time"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">time</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">interval</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure>

<h5 id="transformation-operator">Transformation Operator</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">map(Function&lt;T, R&gt;)</code>: ê° ìš”ì†Œë¥¼ ë³€í™˜í•œë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">flatMap(Function&lt;T, Publisher&lt;R&gt;&gt;)</code>: ë‚´ë¶€ Publisher ë¥¼ ë³‘í•©í•œë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">concatMap()</code>: ìˆœì„œë¥¼ ë³´ì¥í•˜ë©´ì„œ flatMap ì„ í•¨</li>
  <li><code class="language-plaintext highlighter-rouge">switchMap()</code>: ê°€ì¥ ìµœê·¼ êµ¬ë…ë§Œ ìœ ì§€</li>
  <li><code class="language-plaintext highlighter-rouge">defaultIfEmpty(T)</code>: ë¹„ì–´ ìˆì„ ë•Œ ê¸°ë³¸ê°’ ëŒ€ì²´</li>
  <li><code class="language-plaintext highlighter-rouge">switchIfEmpty(Publisher&lt;T&gt;)</code>: ë¹„ì–´ìˆì„ ë•Œ ë‹¤ë¥¸ Publisher ë¡œ ëŒ€ì²´</li>
  <li><code class="language-plaintext highlighter-rouge">collectList()</code>: <code class="language-plaintext highlighter-rouge">Flux</code> -&gt; <code class="language-plaintext highlighter-rouge">Mono&lt;List&gt;</code></li>
</ul>

<p><strong>collectList()</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/odds"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="nf">odds</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">10</span><span class="o">))</span>
                <span class="o">.</span><span class="na">collectList</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<h5 id="filtering-operator">Filtering Operator</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">filter(Predicate&lt;T&gt;)</code>: ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë°ì´í„°ë§Œ ë°œí–‰</li>
  <li><code class="language-plaintext highlighter-rouge">take(long n)</code>: n ê°œì˜ ë°ì´í„°ë§Œ ë°œí–‰</li>
  <li><code class="language-plaintext highlighter-rouge">skip(long n)</code>: n ê°œì˜ ë°ì´í„° ê±´ë„ˆë›´ í›„ ë°œí–‰</li>
  <li><code class="language-plaintext highlighter-rouge">distinct()</code>: ì¤‘ë³µ ì œê±°, ì¤‘ë³µ ê¸°ì¤€ì€ <code class="language-plaintext highlighter-rouge">equals()</code></li>
  <li><code class="language-plaintext highlighter-rouge">takeWhile(Predicate&lt;T&gt;)</code>: ì¡°ê±´ì´ ì°¸ì¼ ë™ì•ˆ ë°œí–‰</li>
  <li><code class="language-plaintext highlighter-rouge">skipWhile(Predicate&lt;T&gt;)</code>: ì¡°ê±´ì´ ì°¸ì¸ ë™ì•ˆ ê±´ë„ˆëœ€</li>
</ul>

<h5 id="combination-operator">Combination Operator</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">merge(Publisher...)</code>: ì—¬ëŸ¬ <code class="language-plaintext highlighter-rouge">Flux</code> ë¥¼ ë³‘í•©, ìˆœì„œ ë³´ì¥ X</li>
  <li><code class="language-plaintext highlighter-rouge">concat(Publisher...)</code>: ìˆœì„œë¥¼ ë³´ì¥í•˜ë©° ì—°ê²°</li>
</ul>

<p><strong>merge, concat ì°¨ì´</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/merge"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">merge</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">f1</span> <span class="o">=</span> <span class="nc">Flux</span>
            <span class="o">.</span><span class="na">interval</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMillis</span><span class="o">(</span><span class="mi">300</span><span class="o">))</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="s">"A"</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
    <span class="kt">var</span> <span class="n">f2</span> <span class="o">=</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">interval</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMillis</span><span class="o">(</span><span class="mi">700</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="s">"B"</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
    <span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">f1</span><span class="o">,</span> <span class="n">f2</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/concat"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">concat</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">f1</span> <span class="o">=</span> <span class="nc">Flux</span>
            <span class="o">.</span><span class="na">interval</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMillis</span><span class="o">(</span><span class="mi">300</span><span class="o">))</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="s">"A"</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
    <span class="kt">var</span> <span class="n">f2</span> <span class="o">=</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">interval</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMillis</span><span class="o">(</span><span class="mi">700</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="s">"B"</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
    <span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">f1</span><span class="o">,</span> <span class="n">f2</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<ul>
  <li><code class="language-plaintext highlighter-rouge">zip(Publisher..., BiFunction)</code>: ì—¬ëŸ¬ <code class="language-plaintext highlighter-rouge">Publisher</code> ì˜ ë°ì´í„°ë¥¼ ì¡°í•©</li>
</ul>

<p><strong>zip ì˜ˆì‹œ</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// ë‘ Flux ë¥¼ ë¬¶ì–´ì„œ ìƒˆë¡œìš´ ë¬¸ìì—´ Flux ìƒì„±</span>
<span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">zip</span><span class="o">(</span><span class="n">names</span><span class="o">,</span> <span class="n">ages</span><span class="o">,</span> <span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">name</span> <span class="o">+</span> <span class="s">" is "</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span> <span class="s">" years old"</span><span class="o">);</span></code></pre></figure>

<ul>
  <li><code class="language-plaintext highlighter-rouge">combineLatest(Publisher..., Function)</code>: ê°€ì¥ ìµœê·¼ ê°’ë“¤ë¡œ ì¡°í•©</li>
</ul>

<p><strong>combineLatest ì˜ˆì‹œ</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// ë‘ Flux ë¥¼ ë¬¶ì–´ì„œ ìƒˆë¡œìš´ ë¬¸ìì—´ Flux ìƒì„±</span>
<span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">zip</span><span class="o">(</span><span class="n">names</span><span class="o">,</span> <span class="n">ages</span><span class="o">,</span> <span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">name</span> <span class="o">+</span> <span class="s">" is "</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span> <span class="s">" years old"</span><span class="o">);</span></code></pre></figure>

<h5 id="error-handling-operator">Error Handling Operator</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">onErrorReturn(T)</code>: ì—ëŸ¬ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜</li>
  <li><code class="language-plaintext highlighter-rouge">onErrorResume(Function&lt;Throwable, Publisher&lt;T&gt;&gt;)</code>: ëŒ€ì²´ Publisher ë¡œ ì „í™˜</li>
  <li><code class="language-plaintext highlighter-rouge">retry(long n)</code>: ì—ëŸ¬ ì‹œ n ë²ˆ ì¬ì‹œë„</li>
</ul>

<p><strong>ì—ëŸ¬ ì²˜ë¦¬</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/error"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">error</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="mi">10</span> <span class="o">/</span> <span class="n">i</span><span class="o">)</span>
            <span class="o">.</span><span class="na">onErrorReturn</span><span class="o">(-</span><span class="mi">1</span><span class="o">)</span>
<span class="c1">//			.onErrorResume(e -&gt; Flux.just(100, 200));</span>
<span class="o">}</span>

<span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/error2"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">error2</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="mi">10</span> <span class="o">/</span> <span class="o">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="o">))</span>
            <span class="o">.</span><span class="na">retry</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<h4 id="ë³‘ë ¬-ì²˜ë¦¬">ë³‘ë ¬ ì²˜ë¦¬</h4>

<p><code class="language-plaintext highlighter-rouge">Reactor</code> ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìŠ¤ë ˆë“œë¥¼ ì§ì ‘ ë§Œë“¤ì§€ ì•Šìœ¼ë©°, ìŠ¤ë ˆë“œ ìƒì„±/ê´€ë¦¬ë¼ëŠ” ê°œë…ì„ <code class="language-plaintext highlighter-rouge">Scheduler</code> ë¼ëŠ” ê°œë…ì„ í†µí•´ ìŠ¤ë ˆë“œ í’€ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.</p>

<h5 id="scheduler">Scheduler</h5>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">reactor.core.scheduler.Schedulers</span><span class="o">;</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">Reactor</code> ì˜ ìŠ¤ë ˆë“œ í’€ì„ ì¶”ìƒí™” í•œê²Œ <code class="language-plaintext highlighter-rouge">Scheduler</code> ì´ë‹¤. ìŠ¤í”„ë§ì—ì„œëŠ” ìš”ì²­ ì²˜ë¦¬ë‚˜ I/O ì‘ì—…ì— ë§ê²Œ ì ì ˆí•œ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì„ íƒí•´ì£¼ëŠ”ê²Œ í•µì‹¬ì´ë©°, ê° ì‘ì—… ìœ í˜•ë“¤ì„ í† ëŒ€ë¡œ ìŠ¤ë ˆë“œ í’€ì„ ë‹¤ìŒê³¼ ê°™ì´ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Schedulers.parallel()</code>: CPU ë°”ìš´ë“œ ì‘ì—…ìš©, ì½”ì–´ ìˆ˜ë§Œí¼ì˜ ê³ ì • ìŠ¤ë ˆë“œê°€ í• ë‹¹ë˜ì–´ì§</li>
  <li><code class="language-plaintext highlighter-rouge">Schedulers.boundedElastic()</code>: I/O ë°”ìš´ë“œ ì‘ì—…ìš©, ìŠ¤ë ˆë“œ ìˆ˜ ìë™ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥í•¨</li>
  <li><code class="language-plaintext highlighter-rouge">Schedulers.single()</code>: ë‹¨ì¼ ìŠ¤ë ˆë“œë¡œ ìˆœì°¨ ì‹¤í–‰</li>
  <li><code class="language-plaintext highlighter-rouge">Schedulers.immediate()</code>: í˜„ì¬ ìŠ¤ë ˆë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš©</li>
  <li><code class="language-plaintext highlighter-rouge">Schedulers.fromExecutorService()</code>: ì‚¬ìš©ì ì •ì˜ <code class="language-plaintext highlighter-rouge">Executor</code> ì‚¬ìš©</li>
</ul>

<p>ì´ë¥¼ ì´ì œ <code class="language-plaintext highlighter-rouge">Flux</code> ì˜ ë°ì´í„° íë¦„ ì‚¬ì´ì— ì ì ˆíˆ ì¶”ê°€í•˜ì—¬ ë³‘ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë„ë¡ í•œë‹¤.</p>

<h5 id="parallel-operator">Parallel Operator</h5>

<p><code class="language-plaintext highlighter-rouge">Flux</code> ì—ëŠ” ë‹¤ìŒì„ ì ìš©í•  ìˆ˜ ìˆë‹¤.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">publishOn(Scheduler)</code>: ì´ ì´í›„ ë‹¨ê³„ì˜ ì‹¤í–‰ ìŠ¤ë ˆë“œë¥¼ ë³€ê²½</li>
  <li><code class="language-plaintext highlighter-rouge">subscribeOn(Scheduler)</code>: ì „ì²´ ì²´ì¸ì˜ ì‹¤í–‰ ìŠ¤ë ˆë“œë¥¼ ì§€ì •</li>
</ul>

<p><strong>ë³‘ë ¬ ì²˜ë¦¬</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/async"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">async</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
            <span class="o">.</span><span class="na">publishOn</span><span class="o">(</span><span class="nc">Schedulers</span><span class="o">.</span><span class="na">parallel</span><span class="o">())</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" processed on "</span> <span class="o">+</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure>

<p><strong>pubishOn, subscribeOn ì°¨ì´</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Flux</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">log</span><span class="o">(</span><span class="s">"map1"</span><span class="o">,</span> <span class="n">i</span><span class="o">))</span>
    <span class="o">.</span><span class="na">publishOn</span><span class="o">(</span><span class="nc">Schedulers</span><span class="o">.</span><span class="na">parallel</span><span class="o">())</span>     <span class="c1">// ì—¬ê¸°ì„œë¶€í„° ë³‘ë ¬ ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ì „í™˜</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">log</span><span class="o">(</span><span class="s">"map2"</span><span class="o">,</span> <span class="n">i</span><span class="o">))</span>
    <span class="o">.</span><span class="na">subscribeOn</span><span class="o">(</span><span class="nc">Schedulers</span><span class="o">.</span><span class="na">boundedElastic</span><span class="o">());</span> <span class="c1">// êµ¬ë… ë° ì „ì²´ ì²´ì¸ ì‹¤í–‰ì€ elastic ìŠ¤ë ˆë“œì—ì„œ</span></code></pre></figure>

<p>ì¶œë ¥ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nl">map1:</span> <span class="n">elastic</span><span class="o">-</span><span class="mi">1</span>
<span class="nl">map2:</span> <span class="n">parallel</span><span class="o">-</span><span class="mi">2</span></code></pre></figure>

<p>ì—¬ê¸°ê¹Œì§€ê°€ ë°ì´í„°ì˜ ê¸°ë³¸ì ì¸ ì²˜ë¦¬ë¥¼ ë³´ì•˜ë‹¤. ë‹¤ìŒì€ ì´ë¥¼ ì‹œìŠ¤í…œì— ì ìš©í•  ì°¨ë¡€ë‹¤.</p>

<h3 id="reactive-programming">Reactive Programming</h3>

<p>ë¦¬ì•¡í‹°ë¸Œ í”„ë¡œê·¸ë˜ë°(reactive programming) ì€ <strong>ë¹„ë™ê¸° ë°ì´í„° íë¦„(asynchronous data stream)</strong> ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë³€í™”ì— ìë™ìœ¼ë¡œ ë°˜ì‘í•˜ë„ë¡ êµ¬ì„±í•˜ëŠ” í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„ì´ë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">2</span><span class="o">;</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">b</span><span class="o">);</span></code></pre></figure>

<p>ìœ„ì˜ ì½”ë“œì—ì„œëŠ” a ê°€ ë°”ë€Œì–´ë„ b ëŠ” ë°”ë€Œì§€ ì•Šê³ , ë‹¤ì‹œ ê³„ì‚°ì„ í•´ì•¼ b ê°€ ë°”ë€Œê²Œ ëœë‹¤. a ê°€ ë°”ë€”ë•Œ ìë™ì ìœ¼ë¡œ bê°€ ë°”ë€” ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬í•´ì£¼ëŠ” í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹¤ì„ì´ ë°”ë¡œ ë¦¬ì•¡í‹°ë¸Œ í”„ë¡œê·¸ë˜ë°ì´ë‹¤.</p>

<p><strong>ë¦¬ì•¡í‹°ë¸Œ í”„ë¡œê·¸ë˜ë° íŠ¹ì§•</strong></p>
<ul>
  <li><strong>ë¹„ë™ê¸°(Asynchronous)</strong>: ìš”ì²­ í›„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³ , ì‘ë‹µì´ ì˜¤ë©´ ë°˜ì‘í•˜ëŠ” ë°©ì‹</li>
  <li><strong>ë…¼ë¸”ë¡œí‚¹(Non-blocking)</strong>: ìŠ¤ë ˆë“œê°€ ëŒ€ê¸°í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰ ê°€ëŠ¥</li>
  <li><strong>ë°ì´í„° ìŠ¤íŠ¸ë¦¼(Stream)</strong>: ì´ë²¤íŠ¸, ë°ì´í„°, ì‹ í˜¸ë¥¼ â€œíë¦„â€ìœ¼ë¡œ ì²˜ë¦¬</li>
  <li><strong>ì´ë²¤íŠ¸ ê¸°ë°˜(Event-driven)</strong>: ë°ì´í„° ë³€í™”(ì´ë²¤íŠ¸)ê°€ ë°œìƒí•˜ë©´ ìë™ ë°˜ì‘</li>
  <li><strong>Backpressure(ë°°ì••)</strong>: ì†Œë¹„ìê°€ ì²˜ë¦¬ ê°€ëŠ¥í•œ ë§Œí¼ë§Œ ìš”ì²­ (ê³¼ë¶€í•˜ ë°©ì§€)</li>
</ul>

<p>ì‹œìŠ¤í…œ ì „ë°˜ì ìœ¼ë¡œ reactive í•´ì•¼ ìœ„ì˜ íŠ¹ì§•ë“¤ì„ ì „ë¶€ ê°€ì ¸ê°ˆ ìˆ˜ ìˆê²Œ ëœë‹¤. <code class="language-plaintext highlighter-rouge">Controller</code> ë‹¨ì—ì„œë§Œ ë¹„ë™ê¸°ë¥¼ ì“°ê±°ë‚˜, <code class="language-plaintext highlighter-rouge">Controller</code> + <code class="language-plaintext highlighter-rouge">Service</code> ì— ë¹„ë™ê¸° + ë…¼ë¸”ë¡œí‚¹ ì„ ì¨ì„œ ì´ì ì„ ì¶©ë¶„íˆ ê°€ì ¸ê°ˆ ìˆ˜ ìˆì§€ë§Œ, <code class="language-plaintext highlighter-rouge">Repository</code> ê¹Œì§€ ê·¸ ìˆ˜ì¤€ì„ ë†’ì¸ë‹¤ë©´ êµ‰ì¥íˆ íš¨ìœ¨ì ì´ê²Œ ë  ê²ƒì´ë‹¤.</p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">Controller</code> ë§Œ Reactive í•´ì„œëŠ” ì•„ë¬´ëŸ° ì˜ë¯¸ê°€ ì—†ë‹¤. ì €ìˆ˜ì¤€ ë¶€í„° ì­‰ Reactive í•´ì•¼ ê·¸ ì¥ì ì„ ê·¹ëŒ€í™” í•  ìˆ˜ ìˆë‹¤.</p>
</blockquote>

<p>ë”°ë¼ì„œ ì´ëŸ° <code class="language-plaintext highlighter-rouge">Reactive</code> í•œ <code class="language-plaintext highlighter-rouge">Repository</code> ì˜ <code class="language-plaintext highlighter-rouge">Connection</code> ì„ ìœ„í•´ <code class="language-plaintext highlighter-rouge">R2DBC</code> ë¼ëŠ” ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤.</p>

<h4 id="r2dbc">R2DBC</h4>

<p>ê¸°ì¡´ ìˆœìˆ˜ <code class="language-plaintext highlighter-rouge">JDBC</code> ëŠ” ìŠ¤ë ˆë“œ ë‹¹ í•˜ë‚˜ì˜ ë™ê¸° I/O, DB í˜¸ì¶œ ë™ì•ˆ í˜¸ì¶œí•œ ìŠ¤ë ˆë“œë¥¼ ëŒ€ê¸°(block) ì‹œí‚¤ëŠ”ê²Œ ê·œì¹™ì´ì—ˆë‹¤. ëŒ€ì‹  <code class="language-plaintext highlighter-rouge">R2DBC</code> ëŠ” ë…¼ë¸”ë¡œí‚¹ ë¦¬ì•¡í‹°ë¸Œ API ì´ë‹¤. I/O ê°€ ë…¼ë¸”ë¡œí‚¹ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë˜ê¸° ë•Œë¬¸ì— ìŠ¤ë ˆë“œê°€ ëŒ€ê¸°í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ ë§ì€ I/O ë°”ìš´ë“œ ì‘ì—… ì‹œ í•´ë‹¹ ìŠ¤ë ˆë“œê°€ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ë˜ ë‹¤ë¥¸ ì‘ì—…(CPU ë°”ìš´ë“œ ì‘ì—…)ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ ëœë‹¤ëŠ” ê²ƒì´ë‹¤. ë” ì ì€ ìŠ¤ë ˆë“œë¡œ ë” ë§ì€ ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.</p>

<p><strong>JDBC ë°©ì‹ (ë™ê¸°, ë¸”ë¡œí‚¹)</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcUserRepository</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span> <span class="c1">// HikariDataSource</span>

    <span class="kd">public</span> <span class="nf">JdbcUserRepository</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findActiveUsers</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT id, name FROM users WHERE active = ?"</span><span class="o">;</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
             <span class="nc">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">))</span> <span class="o">{</span>

            <span class="n">ps</span><span class="o">.</span><span class="na">setBoolean</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">(</span><span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
                    <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>
                    <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">);</span>
                    <span class="n">users</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">));</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="c1">// try-with-resources ê°€ Connection ë°˜í™˜(í’€ì— ëŒë ¤ì¤Œ)</span>
        <span class="k">return</span> <span class="n">users</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">getConnection()</code> í˜¸ì¶œ -&gt; ìŠ¤ë ˆë“œëŠ” DB I/O ê°€ ëë‚  ë•Œê¹Œì§€ ë¸”ë¡œí‚¹<br />
ë™ì‹œ ìš”ì²­ì´ ë§ì•„ì§€ë©´ ìŠ¤ë ˆë“œ ë¶€ì¡± ë¬¸ì œê°€ ë°œìƒ</p>
</blockquote>

<p><strong>R2DBC - ì €ìˆ˜ì¤€ ì˜ˆì‹œ (ë…¼ë¸”ë¡œí‚¹)</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LowLevelR2dbcUserRepository</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ConnectionFactory</span> <span class="n">connectionFactory</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">LowLevelR2dbcUserRepository</span><span class="o">(</span><span class="nc">ConnectionFactory</span> <span class="n">cf</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">connectionFactory</span> <span class="o">=</span> <span class="n">cf</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findActiveUsers</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT id, name FROM users WHERE active = ?1"</span><span class="o">;</span>
        <span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">connectionFactory</span><span class="o">.</span><span class="na">create</span><span class="o">())</span>
            <span class="o">.</span><span class="na">flatMapMany</span><span class="o">(</span><span class="n">conn</span> <span class="o">-&gt;</span>
                <span class="nc">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">conn</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">)</span>
                              <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
                              <span class="o">.</span><span class="na">execute</span><span class="o">())</span>
                    <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">result</span> <span class="o">-&gt;</span> <span class="n">result</span><span class="o">.</span><span class="na">map</span><span class="o">((</span><span class="n">row</span><span class="o">,</span> <span class="n">meta</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">mapRow</span><span class="o">(</span><span class="n">row</span><span class="o">)))</span>
                    <span class="o">.</span><span class="na">doFinally</span><span class="o">(</span><span class="n">sig</span> <span class="o">-&gt;</span> <span class="n">closeQuietly</span><span class="o">(</span><span class="n">conn</span><span class="o">))</span>
            <span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">User</span> <span class="nf">mapRow</span><span class="o">(</span><span class="nc">Row</span> <span class="n">row</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">closeQuietly</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">conn</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">().</span><span class="na">subscribe</span><span class="o">();</span> <span class="c1">// ë…¼ë¸”ë¡œí‚¹ìœ¼ë¡œ ë‹«ìŒ (ì—ëŸ¬/ì™„ë£Œ ì²˜ë¦¬ ìƒëµ)</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">R2DBC SPI</code> ë¼ëŠ” í‘œì¤€ ì¸í„°í˜ì´ìŠ¤(<code class="language-plaintext highlighter-rouge">io.r2dbc.spi.*</code>) ê°€ ìˆì–´ì„œ, ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°€ì§€ê³  <code class="language-plaintext highlighter-rouge">Spring R2DBC</code> ë¥¼ ë³´ê¸° ì „ì— í•µì‹¬ì¸ <code class="language-plaintext highlighter-rouge">Reactor core</code> ë¥¼ ì˜ì¡´ì„±ê³¼ DB ì—°ê²°ì„ ìœ„í•´ <code class="language-plaintext highlighter-rouge">R2DBC SPI</code> ë¼ëŠ” <code class="language-plaintext highlighter-rouge">R2DBC</code> í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ DB ì— ì ‘ì†í•˜ë©´ì„œ <code class="language-plaintext highlighter-rouge">Repository-Controller</code> ì— ì´ë¥´ê¸°ê¹Œì§€ ì „ë¶€ ë¹„ë™ê¸°ë¡œ ê°€ì ¸ê°€ë³´ì.</p>

<h5 id="ìˆœìˆ˜-r2dbc-ì˜ì¡´ì„±-ì¶”ê°€">ìˆœìˆ˜ R2DBC ì˜ì¡´ì„± ì¶”ê°€</h5>

<figure class="highlight"><pre><code class="language-gradle" data-lang="gradle"><span class="n">implementation</span> <span class="s1">'io.r2dbc:r2dbc-spi'</span>             <span class="c1">// MySQL ìš© ë“œë¼ì´ë²„</span>
<span class="n">implementation</span> <span class="s1">'io.projectreactor:reactor-core'</span> <span class="c1">// Flux, Mono</span>
<span class="n">runtimeOnly</span> <span class="s1">'io.asyncer:r2dbc-mysql'</span>            <span class="c1">// R2DBC í‘œì¤€ ì¸í„°í˜ì´ìŠ¤</span></code></pre></figure>

<h5 id="connectionfactory-ì„¤ì •">ConnectionFactory ì„¤ì •</h5>

<p>R2DBC ì—ì„œ DB ì—°ê²°ì„ ë§Œë“¤ì–´ì£¼ëŠ” íŒ©í† ë¦¬ ê°ì²´ì´ë‹¤. ì´ì „ì—ëŠ” <code class="language-plaintext highlighter-rouge">DataSource</code> êµ¬í˜„ì²´(HikariCP)ë¡œë¶€í„° <code class="language-plaintext highlighter-rouge">Connection</code> ì„ ì–»ì—ˆìŒì„ ìƒê¸°í•˜ì—¬, ì´ <strong>ConnectionFactory</strong> ë˜í•œ <code class="language-plaintext highlighter-rouge">DataSource</code> ì—­í• ì„ í•˜ê³  ìˆë‹¤ê³  ë³´ë©´ ë˜ê² ë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">DataSource</code> ì¦‰, <code class="language-plaintext highlighter-rouge">ConnectionFactory</code> ë¥¼ ê°€ì ¸ì˜¤ê¸° ì „ì— í•  ê²ƒì€ ë°”ë¡œ ì„¸íŒ…ì´ë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ì„¸íŒ…í•  ìˆ˜ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">R2dbcMysqlConfig</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">ConnectionFactoryOptions</span> <span class="n">config</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">R2dbcMysqlConfig</span><span class="o">(</span><span class="nc">String</span> <span class="n">user</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">config</span> <span class="o">=</span> <span class="nc">ConnectionFactoryOptions</span>
				<span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">option</span><span class="o">(</span><span class="nc">ConnectionFactoryOptions</span><span class="o">.</span><span class="na">DRIVER</span><span class="o">,</span> <span class="s">"mysql"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">option</span><span class="o">(</span><span class="nc">ConnectionFactoryOptions</span><span class="o">.</span><span class="na">HOST</span><span class="o">,</span> <span class="s">"localhost"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">option</span><span class="o">(</span><span class="nc">ConnectionFactoryOptions</span><span class="o">.</span><span class="na">PORT</span><span class="o">,</span> <span class="mi">3306</span><span class="o">)</span>
				<span class="o">.</span><span class="na">option</span><span class="o">(</span><span class="nc">ConnectionFactoryOptions</span><span class="o">.</span><span class="na">USER</span><span class="o">,</span> <span class="n">user</span><span class="o">)</span>
				<span class="o">.</span><span class="na">option</span><span class="o">(</span><span class="nc">ConnectionFactoryOptions</span><span class="o">.</span><span class="na">PASSWORD</span><span class="o">,</span> <span class="n">password</span><span class="o">)</span>
				<span class="o">.</span><span class="na">option</span><span class="o">(</span><span class="nc">ConnectionFactoryOptions</span><span class="o">.</span><span class="na">DATABASE</span><span class="o">,</span> <span class="s">"librarydb"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">build</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">ConnectionFactoryOptions</span> <span class="nf">getConfig</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">config</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ì œ ìœ„ë¥¼ ì‚¬ìš©í•˜ì—¬ <code class="language-plaintext highlighter-rouge">ConnectionFactory</code> ì„¸íŒ…ì„ í•´ì£¼ì.</p>

<p><img src="/seonghun120614/assets/img/connection-factories-get.png" alt="assets/img/connection-factories-get.png" /></p>

<p>ìœ„ì™€ ê°™ì´ ë‘ ê°œê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë° í•„ìëŠ” ì•„ë˜ ê²ƒì„ ì„ íƒí–ˆë‹¤.</p>

<blockquote>
  <p>ì²« ë²ˆì§¸ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„ ì–¸í•˜ë©´ ëœë‹¤.<br />
<code class="language-plaintext highlighter-rouge">r2dbc:driver[:protocol]}://[user:password@]host[:port][/path][?option=value]</code></p>
</blockquote>

<h5 id="connectionfactory-ì¸í„°í˜ì´ìŠ¤">ConnectionFactory ì¸í„°í˜ì´ìŠ¤</h5>

<p>ì•„ë˜ëŠ” <code class="language-plaintext highlighter-rouge">ConnectionFactory</code> ì˜ ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ConnectionFactory</span> <span class="o">{</span>
    <span class="nc">Publisher</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Connection</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">();</span>
    <span class="nc">ConnectionFactoryMetadata</span> <span class="nf">getMetadata</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>ì‹¤ì œë¡œ <code class="language-plaintext highlighter-rouge">create()</code> ëŠ” <code class="language-plaintext highlighter-rouge">Publisher</code> í˜•íƒœë¡œ ë°˜í™˜í•¨ì„ ë³¼ ìˆ˜ ìˆë‹¤. <code class="language-plaintext highlighter-rouge">Publisher</code> ëŠ” <code class="language-plaintext highlighter-rouge">Mono</code> ë‚˜ <code class="language-plaintext highlighter-rouge">Flux</code> ì˜ êµ¬í˜„ì„ ë”°ë¼ê°€ë‹¤ ë³´ë©´ ìµœìƒìœ„ ë¶€ëª¨ì— <code class="language-plaintext highlighter-rouge">Publisher</code> ê°€ ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Publisher</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">subscribe</span><span class="o">(</span><span class="nc">Subscriber</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">T</span><span class="o">&gt;</span> <span class="n">s</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>ì¦‰, <code class="language-plaintext highlighter-rouge">create()</code> ë©”ì„œë“œëŠ” ì¦‰ì‹œ <code class="language-plaintext highlighter-rouge">Connection</code> ì„ ë°˜í™˜í•˜ì§€ ì•Šê³ , ë¹„ë™ê¸° ë°ì´í„° íë¦„ ê¸°ëŠ¥ì„ ì£¼ëŠ” <code class="language-plaintext highlighter-rouge">Publisher</code> í˜•íƒœë¡œ ë¹„ë™ê¸°ë¡œ ì»¤ë„¥ì…˜ì„ ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ì‹¤ì œ ì»¤ë„¥ì…˜ì€ <code class="language-plaintext highlighter-rouge">subscribe()</code> ê°€ ì¼ì–´ë‚  ë•Œ ë§Œë“¤ì–´ì§€ê²Œ ëœë‹¤.</p>

<p>ë‹¤ìŒê³¼ ê°™ì´ <code class="language-plaintext highlighter-rouge">ConnectionFactory</code> ì˜ <code class="language-plaintext highlighter-rouge">create()</code> ë¥¼ ì‚¬ìš©í•´ <code class="language-plaintext highlighter-rouge">Mono&lt;Connection&gt;</code> ì„ ë°›ë„ë¡ í•˜ì:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">R2dbcConnectionFactory</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nf">R2dbcConnectionFactory</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Connection</span><span class="o">&gt;</span> <span class="nf">getConnection</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="nc">Holder</span><span class="o">.</span><span class="na">instance</span><span class="o">.</span><span class="na">create</span><span class="o">());</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Holder</span> <span class="o">{</span>
		<span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">R2dbcMysqlConfig</span> <span class="no">CONFIG</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">R2dbcMysqlConfig</span><span class="o">(</span><span class="s">"likelion"</span><span class="o">,</span> <span class="s">"1234"</span><span class="o">);</span>
		<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ConnectionFactory</span> <span class="n">instance</span> <span class="o">=</span> <span class="nc">ConnectionFactories</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">CONFIG</span><span class="o">.</span><span class="na">getConfig</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>í•„ìëŠ” ê·¸ëƒ¥ <code class="language-plaintext highlighter-rouge">Singleton</code> íŒ¨í„´ì„ ì‚¬ìš©í•˜ì˜€ì§€ë§Œ, ë‹¤ë¥¸ ë” ë‚˜ì€ ì½”ë“œê°€ ìˆë‹¤ë©´ ê·¸ê²ƒì„ ì“°ê¸¸ ë°”ë€ë‹¤.</p>

<h5 id="connection">Connection</h5>

<p>ì´ì œ <code class="language-plaintext highlighter-rouge">UserRepository</code> ì— <code class="language-plaintext highlighter-rouge">create</code> ë¥¼ ê°„ë‹¨íˆ êµ¬í˜„í•´ë³´ì.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">createUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">getConnection</span><span class="o">().</span><span class="na">flatMap</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">getConnection()</code> ìœ¼ë¡œ ê°„ë‹¨íˆ <code class="language-plaintext highlighter-rouge">Connection</code> ì„ ë“¤ê³  ì˜¬ ìˆ˜ ìˆë‹¤. ì´ë•Œ ì»¤ë„¥ì…˜ì„ í•˜ë‚˜ ìƒì„±í–ˆë‹¤ëŠ” ê²ƒì€ ìš°ë¦¬ê°€ ìŠ¤ë ˆë“œ ìì› í•˜ë‚˜ë¥¼ ì–»ì€ ê²ƒê³¼ ê°™ë‹¤. ë”°ë¼ì„œ ì‘ì—…ì´ ëë‚˜ë©´ ì´ë¥¼ ë‹«ì•„ì¤˜ì•¼ í•˜ëŠ”ë°, <code class="language-plaintext highlighter-rouge">Mono</code>, <code class="language-plaintext highlighter-rouge">Flux</code> ì—ëŠ” method chaining ì„ í•˜ë©´ì„œ ë‚´ë¶€ T ë¼ëŠ” íƒ€ì…ì— ì ‘ê·¼í•˜ì—¬ <code class="language-plaintext highlighter-rouge">close()</code> ë¥¼ <code class="language-plaintext highlighter-rouge">map</code> ìœ¼ë¡œ í•  ìˆ˜ ìˆê¸´ í•œë°,</p>

<p>ê·¸ê±° ë³´ë‹¨ ë‹¤ìŒ ë” ì•ˆì „í•œ <code class="language-plaintext highlighter-rouge">usingWhen</code> í˜¹ì€ <code class="language-plaintext highlighter-rouge">using</code>, <code class="language-plaintext highlighter-rouge">when</code> ë“±ë“± ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤.</p>

<p><strong>usingWhen</strong></p>

<p>Reactive Streams í™˜ê²½ì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ì•ˆì „í•˜ê²Œ ì—´ê³ , ì‚¬ìš©í•˜ê³ , ë‹«ëŠ” ê²ƒì„ ë³´ì¥í•˜ëŠ” ë©”ì„œë“œì´ë‹¤. <code class="language-plaintext highlighter-rouge">Mono.usingWhen()</code> ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” <code class="language-plaintext highlighter-rouge">try-with-resources</code> ì˜ Reactive ë²„ì „ì´ë‹¤. ë¦¬ì†ŒìŠ¤ë¥¼ <code class="language-plaintext highlighter-rouge">Publisher</code>(<code class="language-plaintext highlighter-rouge">Mono&lt;Connection&gt;</code>) ë¡œë¶€í„° ì‚¬ìš©í•œ ë’¤, ì„±ê³µ/ì‹¤íŒ¨/ì·¨ì†Œ ì•¼ë¶€ì— ìƒê´€ì—†ì´ ìë™ìœ¼ë¡œ ì •ë¦¬í•˜ê²Œ ëœë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">D</span><span class="o">&gt;</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">usingWhen</span><span class="o">(</span><span class="nc">Publisher</span><span class="o">&lt;</span><span class="no">D</span><span class="o">&gt;</span> <span class="n">resourceSupplier</span><span class="o">,</span>
        <span class="nc">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">D</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="nc">Mono</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;&gt;</span> <span class="n">resourceClosure</span><span class="o">,</span>
        <span class="nc">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">D</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="nc">Publisher</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">asyncComplete</span><span class="o">,</span>
        <span class="nc">BiFunction</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">D</span><span class="o">,</span> <span class="o">?</span> <span class="kd">super</span> <span class="nc">Throwable</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="nc">Publisher</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">asyncError</span><span class="o">,</span>
        <span class="c1">//the operator itself accepts null for asyncCancel, but we won't in the public API</span>
        <span class="nc">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">D</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="nc">Publisher</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">asyncCancel</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">onAssembly</span><span class="o">(</span><span class="k">new</span> <span class="nc">MonoUsingWhen</span><span class="o">&lt;&gt;(</span><span class="n">resourceSupplier</span><span class="o">,</span> <span class="n">resourceClosure</span><span class="o">,</span>
            <span class="n">asyncComplete</span><span class="o">,</span> <span class="n">asyncError</span><span class="o">,</span> <span class="n">asyncCancel</span><span class="o">));</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ë¥¼ ê°„ë‹¨í•˜ê²Œ ë§í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Mono</span><span class="o">.</span><span class="na">usingWhen</span><span class="o">(</span>
    <span class="n">getConnection</span><span class="o">(),</span>
    <span class="n">conn</span> <span class="o">-&gt;</span> <span class="n">doQuery</span><span class="o">(</span><span class="n">conn</span><span class="o">),</span>
    <span class="n">conn</span> <span class="o">-&gt;</span> <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">(),</span>                <span class="c1">// ì •ìƒ ì¢…ë£Œ ì‹œ</span>
    <span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="n">err</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">(),</span>         <span class="c1">// ì—ëŸ¬ ë°œìƒ ì‹œ</span>
    <span class="n">conn</span> <span class="o">-&gt;</span> <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>                 <span class="c1">// ì·¨ì†Œ ì‹œ</span>
<span class="o">);</span></code></pre></figure>

<p>í•˜ì§€ë§Œ ìœ„ì™€ ê°™ì´ ì¸ìë“¤ì„ í†µí•´ ì„¸ë¶€ì ìœ¼ë¡œ ë™ì‘ì„ ì œì–´í•  ìˆ˜ ìˆì§€ë§Œ, ì´ëŠ” ë„ˆë¬´ í•´ì•¼í• ê²Œ ë§ë‹¤. ë‹¤ìŒì„ ë³´ì.</p>

<p><strong>usingWhen</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">D</span><span class="o">&gt;</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">usingWhen</span><span class="o">(</span>
        <span class="nc">Publisher</span><span class="o">&lt;</span><span class="no">D</span><span class="o">&gt;</span> <span class="n">resourceSupplier</span><span class="o">,</span>
        <span class="nc">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">D</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="nc">Mono</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;&gt;</span> <span class="n">resourceClosure</span><span class="o">,</span>
        <span class="nc">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">D</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="nc">Publisher</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">asyncCleanup</span>
<span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">usingWhen</span><span class="o">(</span>
        <span class="n">resourceSupplier</span><span class="o">,</span>
        <span class="n">resourceClosure</span><span class="o">,</span>
        <span class="n">asyncCleanup</span><span class="o">,</span>
        <span class="o">(</span><span class="n">res</span><span class="o">,</span> <span class="n">error</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">asyncCleanup</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">res</span><span class="o">),</span>
        <span class="n">asyncCleanup</span>
    <span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>ë­ë“  ê°„ì— <strong>ì •ìƒ, ì—ëŸ¬, ì·¨ì†Œ</strong>ì—ì„œ <code class="language-plaintext highlighter-rouge">asyncCleanup</code> ì„ í•  ìˆ˜ ìˆëŠ” ë²„ì „ì´ë©°, 3ê°€ì§€ ì¸ìë§Œ ë„˜ê²¨ì£¼ë©´ ëœë‹¤. ì´ë•Œ <code class="language-plaintext highlighter-rouge">resourceClosure</code>ëŠ” <code class="language-plaintext highlighter-rouge">Closable</code> ì„ êµ¬í˜„í•˜ë©´ ì¢‹ì„ ê²ƒì´ë‹¤.</p>

<p>ì´ì œ ë‹¤ìŒê³¼ ê°™ì´ ì“¸ ìˆ˜ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserRepository</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">createUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">usingWhen</span><span class="o">(</span>
				<span class="n">getConnection</span><span class="o">(),</span>
				<span class="n">conn</span> <span class="o">-&gt;</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">from</span><span class="o">(</span>
						            <span class="n">conn</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(</span><span class="s">"INSERT INTO USERS(name, active) VALUES (?, ?)"</span><span class="o">)</span>
						                <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
						                <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
						                <span class="o">.</span><span class="na">returnGeneratedValues</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
						                <span class="o">.</span><span class="na">execute</span><span class="o">()),</span>
				<span class="nl">Connection:</span><span class="o">:</span><span class="n">close</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ë•Œ <code class="language-plaintext highlighter-rouge">Connection</code> ì—ì„œ create í•˜ëŠ” <code class="language-plaintext highlighter-rouge">Statement</code> ëŠ” JDBC ì˜ <code class="language-plaintext highlighter-rouge">Statement</code> ì™€ëŠ” ë‹¤ë¥¸ ì•„ì´ë‹¤(<code class="language-plaintext highlighter-rouge">io.r2dbc.spi</code>).</p>

<h5 id="statement">Statement</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">add()</code>: í˜„ì¬ ë°”ì¸ë”© ìƒíƒœë¥¼ ì €ì¥í•˜ê³ , ìƒˆ ë°”ì¸ë”©ì„ ì‹œì‘</li>
  <li><code class="language-plaintext highlighter-rouge">bind(int index, Object value)</code>: ì¸ë±ìŠ¤ë¡œ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©(<code class="language-plaintext highlighter-rouge">?</code>), 0 ë¶€í„° ì‹œì‘í•˜ë©°, <code class="language-plaintext highlighter-rouge">value</code> ëŠ” <code class="language-plaintext highlighter-rouge">null</code> ì´ ë˜ë©´ ì•ˆë¨</li>
  <li><code class="language-plaintext highlighter-rouge">bind(String name, Object value)</code>: ì´ë¦„ ê¸°ë°˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì´ë©°, <code class="language-plaintext highlighter-rouge">:name</code> ê³¼ ê°™ì€ <code class="language-plaintext highlighter-rouge">JPQL</code> ê³¼ ìœ ì‚¬í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥</li>
  <li><code class="language-plaintext highlighter-rouge">bindNull(int index, Class&lt;?&gt; type)</code>: ì¸ë±ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">null</code> ê°’ ë°”ì¸ë”©. <code class="language-plaintext highlighter-rouge">type</code> ìœ¼ë¡œ íƒ€ì… ëª…ì‹œ</li>
  <li><code class="language-plaintext highlighter-rouge">bindNull(String name, Class&lt;?&gt; type)</code>: ë™ì¼</li>
  <li><code class="language-plaintext highlighter-rouge">execute()</code>: ì‹¤ì œ SQL ì‹¤í–‰ í›„, <code class="language-plaintext highlighter-rouge">Publisher&lt;Result&gt;</code> ë¥¼ ë°˜í™˜í•œë‹¤, reactive ë°©ì‹ì´ë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">returnGeneratedValues(String... columns)</code>: <code class="language-plaintext highlighter-rouge">INSERT</code> ì‹œì— ìƒì„±ëœ í‚¤(<code class="language-plaintext highlighter-rouge">AUTO_INCREMENT</code>) ë¥¼ ê²°ê³¼ì— í¬í•¨í•˜ë„ë¡ ì„¤ì •í•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œëŠ” <code class="language-plaintext highlighter-rouge">no-op</code> ì´ì§€ë§Œ, ì•„ë¬´ëŸ° ì¸ì ì—†ì´(columns ì—†ì´) ëª…ì‹œì ìœ¼ë¡œ ì´ ì²´ì´ë‹ë§Œ ë„£ì–´ë„ ìë™ ë™ì‘í•˜ì—¬ í‚¤ë¥¼ ë“¤ê³  ì˜¨ë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">fetchSize(int rows)</code>: í•œ ë²ˆì— ê°€ì ¸ì˜¬ row ìˆ˜ë¥¼ ì„¤ì •í•œë‹¤.</li>
</ul>

<p>ì´ë¥¼ í†µí•´ ë‹¤ìŒì²˜ëŸ¼ ì…ë ¥ ê°€ëŠ¥í•˜ë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">usingWhen</span><span class="o">(</span>
            <span class="n">getConnection</span><span class="o">(),</span> <span class="n">conn</span> <span class="o">-&gt;</span>
                    <span class="nc">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">conn</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(</span><span class="s">"INSERT INTO USERS(NAME, ACTIVE) VALUES (?, ?)"</span><span class="o">)</span>
                                    <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
                                    <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span>
                                    <span class="o">.</span><span class="na">returnGeneratedValues</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
                                    <span class="o">.</span><span class="na">execute</span><span class="o">())</span>
                        <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">result</span> <span class="o">-&gt;</span> <span class="o">{</span>
                            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="o">{</span>
                                <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
                                <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
                            <span class="o">});</span>
                        <span class="o">})</span>
                        <span class="o">.</span><span class="na">next</span><span class="o">(),</span>
            <span class="nl">Connection:</span><span class="o">:</span><span class="n">close</span>
    <span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>ë§ˆì§€ë§‰ ë°˜í™˜ê°’ì´ <code class="language-plaintext highlighter-rouge">Mono&lt;Publisher&lt;? extends Result&gt;&gt;</code> ì´ë©° ì´ë¥¼ í‰íƒ„í™” í•˜ê¸° ìœ„í•´ <code class="language-plaintext highlighter-rouge">flatMap</code> ì„ í†µí•´ í•  ìˆ˜ ìˆë‹¤(<code class="language-plaintext highlighter-rouge">Publisher</code> í‰íƒ„í™”). ê·¸ ì´í›„ëŠ” <code class="language-plaintext highlighter-rouge">Mono&lt;User&gt;</code> ë¡œ ë°˜í™˜ì´ ë˜ê²Œ ëœë‹¤.</p>

<h5 id="row">Row</h5>

<p>DB ì˜ í•œ í–‰ì„ í‘œí˜„í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë©°, ë‚´ë¶€ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">row.get("name")</code> ë˜ëŠ” <code class="language-plaintext highlighter-rouge">row.get(0)</code> ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Row</span> <span class="kd">extends</span> <span class="nc">Readable</span> <span class="o">{</span>
    <span class="nc">RowMetadata</span> <span class="nf">getMetadata</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>ì‚¬ì‹¤ì€ ì´ëŸ° get ì€ <code class="language-plaintext highlighter-rouge">Readable</code> ì— ì •ì˜ë˜ì–´ ìˆë‹¤. ë˜í•œ, <code class="language-plaintext highlighter-rouge">get(String name, Class&lt;?&gt; type)</code> ìœ¼ë¡œë„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. íŠ¹ì§•ìœ¼ë¡œëŠ” í•œ ë²ˆ <code class="language-plaintext highlighter-rouge">map()</code> ì•ˆì—ì„œ ì†Œë¹„ë˜ë©´ ë‹¤ì‹œ ì ‘ê·¼ì´ ë¶ˆê°€í•˜ë‹¤.</p>

<p>ì´ì œ row ë¥¼ í†µí•´ ìœ„ì™€ ê°™ì´ ë°˜í™˜í•´ì£¼ë©´ ëë‚˜ê³ , <code class="language-plaintext highlighter-rouge">Main</code> ì—ì„œ ì‹¤ì œ í˜¸ì¶œì„ í•´ë³´ì.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="nc">UserRepository</span> <span class="n">userRepository</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserRepository</span><span class="o">();</span>
		<span class="n">userRepository</span><span class="o">.</span><span class="na">createUser</span><span class="o">(</span><span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"test"</span><span class="o">,</span> <span class="kc">true</span><span class="o">))</span>
		              <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
		<span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>ë°˜ë“œì‹œ <code class="language-plaintext highlighter-rouge">subscribe</code> ë¥¼ í•˜ì—¬ì•¼ì§€ ì‹¤í–‰ì´ ë˜ê²Œ ë˜ê³ , <code class="language-plaintext highlighter-rouge">Thread.sleep(1000)</code> ì„ ë„£ëŠ” ì´ìœ ëŠ” <strong>ìœ ì‚¬</strong> <code class="language-plaintext highlighter-rouge">graceful shutdown</code> ì„ ì‚¬ìš©í•˜ë„ë¡ í•´ì•¼í•œë‹¤. ì•ˆê·¸ëŸ¬ë©´ ì²˜ë¦¬ë˜ëŠ” ì™€ì¤‘ì— ì¢…ë£Œê°€ ë˜ì–´ ê°’ì´ ë°˜ì˜ì´ ì•ˆë˜ê²Œ ëœë‹¤. <code class="language-plaintext highlighter-rouge">createUser</code> ë§Œ í•˜ë©´ ë¹„ë™ê¸°ì´ê¸° ë•Œë¬¸ì— ì‹¤í–‰ì´ ì•ˆëœë‹¤.</p>

<p><img src="/seonghun120614/assets/img/r2dbc-users-table.png" alt="assets/img/r2dbc-users-table.png" /></p>

<h5 id="crud-ì‹¤ìŠµ">CRUD ì‹¤ìŠµ</h5>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserRepository</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">usingWhen</span><span class="o">(</span>
				<span class="n">getConnection</span><span class="o">(),</span> <span class="n">conn</span> <span class="o">-&gt;</span>
						<span class="nc">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">conn</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(</span><span class="s">"INSERT INTO USERS(NAME, ACTIVE) VALUES (?, ?)"</span><span class="o">)</span>
						              <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
						              <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span>
						              <span class="o">.</span><span class="na">returnGeneratedValues</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
						              <span class="o">.</span><span class="na">execute</span><span class="o">())</span>
						    <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">result</span> <span class="o">-&gt;</span> <span class="o">{</span>
							    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="o">{</span>
								    <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
								    <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
							    <span class="o">});</span>
						    <span class="o">})</span>
						    <span class="o">.</span><span class="na">next</span><span class="o">(),</span>
				<span class="nl">Connection:</span><span class="o">:</span><span class="n">close</span>
		<span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">get</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">usingWhen</span><span class="o">(</span>
				<span class="n">getConnection</span><span class="o">(),</span>
				<span class="n">conn</span> <span class="o">-&gt;</span>
						<span class="nc">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">conn</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(</span><span class="s">"SELECT * FROM USERS WHERE id = ?"</span><span class="o">)</span>
						              <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
						              <span class="o">.</span><span class="na">execute</span><span class="o">()</span>
						    <span class="o">).</span><span class="na">flatMap</span><span class="o">(</span><span class="n">result</span> <span class="o">-&gt;</span> <span class="o">{</span>
							    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="o">{</span>
								    <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
								                         <span class="n">row</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"active"</span><span class="o">,</span> <span class="nc">Boolean</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
								    <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
								    <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
							    <span class="o">});</span>
						    <span class="o">})</span>
						    <span class="o">.</span><span class="na">next</span><span class="o">(),</span>
				<span class="nl">Connection:</span><span class="o">:</span><span class="n">close</span>
		<span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">update</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">,</span>
	                         <span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">usingWhen</span><span class="o">(</span>
				<span class="n">getConnection</span><span class="o">(),</span>
				<span class="n">conn</span> <span class="o">-&gt;</span>
						<span class="nc">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">conn</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(</span><span class="s">"UPDATE USERS SET name = ?, active = ? WHERE id = ?"</span><span class="o">)</span>
						              <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
						              <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">isActive</span><span class="o">())</span>
						              <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
						              <span class="o">.</span><span class="na">execute</span><span class="o">()</span>
						    <span class="o">)</span>
						    <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="nl">Result:</span><span class="o">:</span><span class="n">getRowsUpdated</span><span class="o">)</span>
						    <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">rowsUpdated</span> <span class="o">-&gt;</span> <span class="o">{</span>
							    <span class="k">if</span> <span class="o">(</span><span class="n">rowsUpdated</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
							    <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
							    <span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
						    <span class="o">}).</span><span class="na">next</span><span class="o">(),</span>
				<span class="nl">Connection:</span><span class="o">:</span><span class="n">close</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">delete</span><span class="o">(</span><span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">usingWhen</span><span class="o">(</span>
				           <span class="n">getConnection</span><span class="o">(),</span>
				           <span class="n">conn</span> <span class="o">-&gt;</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">conn</span>
						                             <span class="o">.</span><span class="na">createStatement</span><span class="o">(</span><span class="s">"DELETE FROM USERS WHERE ID = ?"</span><span class="o">)</span>
						                             <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
						                             <span class="o">.</span><span class="na">execute</span><span class="o">()),</span>
				           <span class="nl">Connection:</span><span class="o">:</span><span class="n">close</span><span class="o">)</span>
		           <span class="o">.</span><span class="na">then</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="nc">UserRepository</span> <span class="n">userRepository</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserRepository</span><span class="o">();</span>

		<span class="nc">User</span> <span class="n">newUser</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"test"</span><span class="o">,</span> <span class="kc">true</span><span class="o">))</span>
		              <span class="o">.</span><span class="na">block</span><span class="o">();</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"new user: "</span> <span class="o">+</span> <span class="n">newUser</span><span class="o">);</span>

		<span class="n">userRepository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">4L</span><span class="o">)</span>
		              <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"get user: "</span> <span class="o">+</span> <span class="n">user</span><span class="o">));</span>
		<span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>

		<span class="nc">User</span> <span class="n">updatedUser</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="mi">4L</span><span class="o">,</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"test2"</span><span class="o">,</span> <span class="kc">false</span><span class="o">))</span>
		                                 <span class="o">.</span><span class="na">block</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"updated user: "</span> <span class="o">+</span> <span class="n">updatedUser</span><span class="o">);</span>

		<span class="n">userRepository</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="mi">4L</span><span class="o">).</span><span class="na">subscribe</span><span class="o">();</span>
		<span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ë•Œ ì €ì¥ë˜ëŠ”ê²Œ <code class="language-plaintext highlighter-rouge">4L</code> ì¼ ë•Œ ë°”ë¡œ ì¡°íšŒí•˜ë©´ ëœ¨ì§€ ì•ŠëŠ”ë‹¤(ë¹„ë™ê¸° ì²˜ë¦¬ì´ê¸° ë•Œë¬¸ì— ë°”ë¡œ ì¡°íšŒë¥¼ í•˜ë©´ ì•ˆëœ¸). ë”°ë¼ì„œ <code class="language-plaintext highlighter-rouge">Thread.sleep</code> ì„ ì‚¬ìš©í•˜ì—¬ ê°€ì ¸ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤˜ì•¼ í•œë‹¤.</p>


    </div><div id="disqus_thread" style="margin-top:25px"></div>
    <script>
    var disqus_config = function () {
        this.page.url = 'https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/30/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-47%EC%9D%BC%EC%B0%A8-reactive-programming.html';
        this.page.identifier = 'https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/10/30/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-47%EC%9D%BC%EC%B0%A8-reactive-programming.html';
    };
    (function () {
        var d = document, s = d.createElement('script');
        s.src = 'https://seonghun.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
  </script>
    <noscript>Please enable JavaScript to view the <a
            href="https://disqus.com/?ref_noscript" rel="nofollow">comments
            powered by Disqus.</a></noscript></div>
<script>
    mermaid.initialize({startOnLoad:true});
    window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
</script>
            </section>
            <footer class="condensed">
                <ul class="social about-footer condensed"><li>
                        <a
                            href="https://github.com/seonghun120614"
                            target="_blank"
                            rel="noopener"
                            aria-label="github">
                            <i class="icon-github-circled"></i>
                        </a>
                    </li><li>
                        <a
                            href="mailto:seonghun120614@gmail.com"
                            target="_blank" rel="noopener" aria-label="email">
                            <i class="icon-mail-alt"></i>
                        </a>
                    </li></ul><nav class="navigation about-footer condensed">
                    <ul>
                        
                        <li>
                            <a href="/seonghun120614/about">About Me</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/computerscience">Computer Science</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/math">Math</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/softwareengineering">Software Engineering</a>
                        </li>
                        
                    </ul>
                </nav><p class="about-footer condensed">&copy;
                    2025</p><div class="about-footer condensed">
                    <p>Dark Mode
                        <i class="icon-moon"></i>
                        <label class="switch" for="dark-toggle">
                            <input id="dark-toggle" type="checkbox"
                                class="dark-mode-toggle"
                                aria-label="Toggle dark mode">
                            <span class="slider round"
                                onclick="toggleDarkMode()"></span>
                        </label>
                    </p>
                </div>
            </footer>
        </main>
        
        <script type="text/javascript" src="/seonghun120614/assets/js/darkmode.js"></script>
        
        <script src="/seonghun120614/assets/js/simple-jekyll-search.min.js"></script>
        <script src="/seonghun120614/assets/js/search.js"></script>
        
        <script>
            window.addEventListener('scroll', () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                document.getElementById('scroll-progress').style.width = scrollPercent + '%';
            });
        </script>
    </body>
</html>