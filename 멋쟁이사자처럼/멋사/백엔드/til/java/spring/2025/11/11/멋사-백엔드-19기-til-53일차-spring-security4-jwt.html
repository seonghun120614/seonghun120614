<!DOCTYPE html>
<html lang="kor">

    <head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="icon" href="/seonghun120614/assets/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/seonghun120614/assets/css/style.css">
<title>[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 53ì¼ì°¨ Spring Security4 JWT</title>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 53ì¼ì°¨ Spring Security4 JWT | Seonghunâ€™s Blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 53ì¼ì°¨ Spring Security4 JWT" />
<meta name="author" content="Seonghun Park" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/11/11/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-53%EC%9D%BC%EC%B0%A8-spring-security4-jwt.html" />
<meta property="og:url" content="https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/11/11/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-53%EC%9D%BC%EC%B0%A8-spring-security4-jwt.html" />
<meta property="og:site_name" content="Seonghunâ€™s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-11-11T04:41:12+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 53ì¼ì°¨ Spring Security4 JWT" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Seonghun Park"},"dateModified":"2025-11-11T04:41:12+00:00","datePublished":"2025-11-11T04:41:12+00:00","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 53ì¼ì°¨ Spring Security4 JWT","mainEntityOfPage":{"@type":"WebPage","@id":"https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/11/11/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-53%EC%9D%BC%EC%B0%A8-spring-security4-jwt.html"},"url":"https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/11/11/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-53%EC%9D%BC%EC%B0%A8-spring-security4-jwt.html"}</script>
<!-- End Jekyll SEO tag -->


<script type="text/javascript" src="/seonghun120614/assets/js/darkmode.js"></script>

<!-- Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RQTWJRLWGD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RQTWJRLWGD');
</script></head><script>
        document.addEventListener("DOMContentLoaded", function () {
            const toggle = document.getElementById("dark-toggle");
        
            // ì´ë¯¸ ì‹¤í–‰í•œ ì  ìˆëŠ”ì§€ í™•ì¸
            const hasToggled = localStorage.getItem("darkModeInitialized");
        
            if (!hasToggled && toggle && toggle.checked) {
                toggleDarkMode();
                localStorage.setItem("darkModeInitialized", "true"); // ìµœì´ˆ ì‹¤í–‰ ê¸°ë¡
            }
        });
    </script>

    <body>
        <div id="scroll-progress"></div>
        <main class="container">
            <section class="about">
                <div class="about-header condensed">
                    <div class="about-title">
                        <a href="/seonghun120614/">
                            
                            <img class="light"
                                src="/seonghun120614/assets/portfolio.png"
                                alt="Seonghun Park" />
                            <img class="dark"
                                src="/seonghun120614/assets/portfolio.png"
                                alt="Seonghun Park" />
                            
                        </a>
                        <h2 id="title">
                            <a href="/seonghun120614/">Seonghun Park</a>
                        </h2>
                    </div><p class="tagline">Developer.</p></div>
                
                <ul class="social about-footer condensed"><li>
                        <a
                            href="https://github.com/seonghun120614"
                            target="_blank"
                            rel="noopener"
                            aria-label="github">
                            <i class="icon-github-circled"></i>
                        </a>
                    </li><li>
                        <a
                            href="mailto:seonghun120614@gmail.com"
                            target="_blank" rel="noopener" aria-label="email">
                            <i class="icon-mail-alt"></i>
                        </a>
                    </li></ul><nav class="navigation about-footer condensed">
                    <ul>
                        
                        <li>
                            <a href="/seonghun120614/about">About Me</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/computerscience">Computer Science</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/math">Math</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/softwareengineering">Software Engineering</a>
                        </li>
                        
                    </ul>
                </nav><p class="about-footer condensed">&copy;
                    2025</p><div class="about-footer condensed">
                    <p>Dark Mode
                        <i class="icon-moon"></i>
                        <label class="switch" for="dark-toggle">
                            <input id="dark-toggle" type="checkbox"
                                class="dark-mode-toggle"
                                aria-label="Toggle dark mode">
                            <span class="slider round"
                                onclick="toggleDarkMode()"></span>
                        </label>
                    </p>
                </div>
            </section>
            <section class="content">
                <script>
window.MathJax = {
    tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
    renderActions: {
        addMenu: []
    }
    }
};
</script>

<script type="text/javascript"
    id="MathJax-script"
    async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script><div class="post-container">
    <a class="post-link" href="/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/11/11/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-53%EC%9D%BC%EC%B0%A8-spring-security4-jwt.html">
        <h2 class="post-title">[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 53ì¼ì°¨ Spring Security4 JWT</h2>
    </a>
    
    <div class="post-meta">
        <div class="post-date"><i class="icon-calendar"></i>Nov 11, 2025</div><ul class="post-categories"><li>ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼</li><li>ë©‹ì‚¬</li><li>ë°±ì—”ë“œ</li><li>TIL</li><li>Java</li><li>Spring</li></ul></div>

    <div class="post">
        <!--more-->

<h2 id="-ëª©ì°¨">ğŸ“‚ ëª©ì°¨</h2>

<ul>
  <li><a href="#jwt">JWT</a>
    <ul>
      <li><a href="#jwt-êµ¬ì¡°">JWT êµ¬ì¡°</a></li>
      <li><a href="#jwt-ì¸ì¦-íë¦„">JWT ì¸ì¦ íë¦„</a></li>
      <li><a href="#spring-security-ì—ì„œì˜-jwt-êµ¬í˜„-ì‹œ-ê´€ë ¨ëœ-í•„í„°">Spring Security ì—ì„œì˜ JWT êµ¬í˜„ ì‹œ ê´€ë ¨ëœ í•„í„°</a></li>
    </ul>
  </li>
  <li><a href="#jwt-êµ¬í˜„">JWT êµ¬í˜„</a>
    <ul>
      <li><a href="#onceperrequestfilter">OncePerRequestFilter</a></li>
      <li><a href="#jwtproperties">JwtProperties</a></li>
      <li><a href="#jwttokenizer">JwtTokenizer</a></li>
      <li><a href="#dofilterinternal">doFilterInternal</a></li>
      <li><a href="#jwtauthenticationtoken">JwtAuthenticationToken</a>
        <ul>
          <li><a href="#í…ŒìŠ¤íŠ¸-authorization-ì˜-í—¤ë”ëŠ”-ì—†ì§€ë§Œ-ì•„ì´ë””ì™€-ë¹„ë°€ë²ˆí˜¸ëŠ”-ì „ë¶€-ë§ì„ë•Œ-refresh-token-ê³¼-access-token-ì„-ë°˜í™˜">í…ŒìŠ¤íŠ¸: íšŒì›ê°€ì…</a></li>
          <li><a href="#í…ŒìŠ¤íŠ¸-ë°›ì€-í—¤ë”ë¥¼-í† ëŒ€ë¡œ-login-ì„-ë‹¤ì‹œ-ì§„í–‰">í…ŒìŠ¤íŠ¸: ë°›ì€ í—¤ë”ë¥¼ í† ëŒ€ë¡œ login ì„ ë‹¤ì‹œ ì§„í–‰</a></li>
          <li><a href="#í…ŒìŠ¤íŠ¸-ë°›ì€-í—¤ë”ë¥¼-í† ëŒ€ë¡œ-welcom-ìš”ì²­">í…ŒìŠ¤íŠ¸: ë°›ì€ í—¤ë”ë¥¼ í† ëŒ€ë¡œ welcom ìš”ì²­</a></li>
          <li><a href="#í…ŒìŠ¤íŠ¸-í† í°ì´-ì—†ë‹¤ë©´-403">í…ŒìŠ¤íŠ¸: í† í°ì´ ì—†ë‹¤ë©´ 403</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="-ë³¸ë¬¸">ğŸ“š ë³¸ë¬¸</h2>

<h3 id="jwt">JWT</h3>

<p>JWT ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì— ì¸ì¦ ì •ë³´ë¥¼ ì£¼ê³ ë°›ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” í† í° ê¸°ë°˜ ì¸ì¦ë°©ì‹ì´ë©°, ì„œëª…ì—ëŠ” ë‹¨ë°©í–¥ ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.</p>

<h4 id="jwt-êµ¬ì¡°">JWT êµ¬ì¡°</h4>

<p>JWT ëŠ” .ìœ¼ë¡œ êµ¬ë¶„ë˜ì–´ì ¸ ìˆëŠ” 3ê°œì˜ íŒŒíŠ¸ë¡œ êµ¬ë¶„í•œë‹¤.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">Header</code>
    <ul>
      <li>ì•Œê³ ë¦¬ì¦˜ ë° í† í° íƒ€ì… ì§€ì •</li>
    </ul>
  </li>
</ol>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"alg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HS256"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"typ"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JWT"</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<ol>
  <li><code class="language-plaintext highlighter-rouge">Payload</code></li>
</ol>

<p>ì‹¤ì œë¡œ ë‹´ì„ ë°ì´í„°ê°€ ë“¤ì–´ê°€ê²Œ ë˜ë©°, í´ë ˆì„ì´ë¼ëŠ” êµ¬ì¡°ì ì¸ ë°ì´í„°ê°€ ë³´í†µ ë“¤ì–´ê°€ë©°, ì´ëŠ” ë‹¨ìˆœíˆ <code class="language-plaintext highlighter-rouge">Base64URL</code> ì¸ì½”ë”©ì´ ë“¤ì–´ê°„ë‹¤. ì´ëŠ” ëˆ„êµ¬ë‚˜ ì—´ì–´ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p><strong>Claim</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sub</code>: ìœ ì € ì‹ë³„ì(ID)</li>
  <li><code class="language-plaintext highlighter-rouge">iat</code>: ë°œí–‰ ì‹œê°„</li>
  <li><code class="language-plaintext highlighter-rouge">exp</code>: ë§Œë£Œ ì‹œê°„</li>
  <li><code class="language-plaintext highlighter-rouge">roles</code>: ê¶Œí•œ ì •ë³´</li>
</ul>

<ol>
  <li><code class="language-plaintext highlighter-rouge">Signature</code></li>
</ol>

<p>ì„œë²„ê°€ <strong>Secret Key</strong>ë¡œ ì„œëª…í•œ ê°’ì´ ë“¤ì–´ê°€ë©°, í† í° ìœ„ë³€ì¡° ë°©ì§€ë¥¼ ìœ„í•´ ë„£ê²Œ ëœë‹¤. ì´ëŠ” ìœ„ Header ì—ì„œ ì“°ì´ëŠ” ì•Œê³ ë¦¬ì¦˜ì— ë”°ë¼ ì•”í˜¸í™”ë˜ì–´ ë“¤ì–´ê°€ê²Œ ëœë‹¤.</p>

<blockquote>
  <p>ì‹œí¬ë¦¿ í‚¤ëŠ” ì„œëª…ì„ ë§Œë“¤ ë•Œ ì‚¬ìš©í•˜ëŠ” ë¹„ë°€ê°’ì¸ë°, ì´ëŠ” í™˜ê²½ë³€ìˆ˜ì— ì €ì¥ë˜ê±°ë‚˜ ê°œë°œ í™˜ê²½ì¼ ë•ŒëŠ” ë³´í†µ <code class="language-plaintext highlighter-rouge">application.yml</code> ì— ì €ì¥ë˜ì–´ì„œ ì£¼ì…ë°›ê²Œ ëœë‹¤.</p>
</blockquote>

<h4 id="jwt-ì¸ì¦-íë¦„">JWT ì¸ì¦ íë¦„</h4>

<ol>
  <li>ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ìš”ì²­</li>
  <li>ì„œë²„ê°€ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ JWT ìƒì„±í•˜ì—¬ ë°˜í™˜</li>
  <li>í´ë¼ì´ì–¸íŠ¸ëŠ” JWT ë¥¼ ì €ì¥</li>
  <li>API ìš”ì²­ ì‹œ <code class="language-plaintext highlighter-rouge">Authorization</code> í—¤ë”ì— JWT í¬í•¨ì‹œì¼œ ë³´ë‚´ì–´ ì¸ê°€ ìˆ˜í–‰</li>
</ol>

<h4 id="spring-security-ì—ì„œì˜-jwt-êµ¬í˜„-ì‹œ-ê´€ë ¨ëœ-í•„í„°">Spring Security ì—ì„œì˜ JWT êµ¬í˜„ ì‹œ ê´€ë ¨ëœ í•„í„°</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">AuthenticationFilter</code>: ë¡œê·¸ì¸ ìš”ì²­ì„ ê°€ë¡œì±„ì–´ ID/PW ê²€ì¦ í›„ JWT ë¥¼ ë°œê¸‰í•˜ë„ë¡ ë§Œë“¤ì–´ì•¼ í•¨</li>
  <li><code class="language-plaintext highlighter-rouge">JwtAuthenticationFilter</code>: ëª¨ë“œ ìš”ì²­ë§ˆë‹¤ <code class="language-plaintext highlighter-rouge">Authorization</code> í—¤ë”ì˜ <code class="language-plaintext highlighter-rouge">JWT</code> ìœ íš¨ì„± ê²€ì¦ì„ í•´ì•¼ í•¨, ë§Œì•½ ìœ íš¨í•˜ë‹¤ë©´ <code class="language-plaintext highlighter-rouge">SecurityContextHolder</code> ì— <code class="language-plaintext highlighter-rouge">Authentication</code> ìƒì„±</li>
  <li><code class="language-plaintext highlighter-rouge">AuthenticationEntryPoint</code>: ì¸ì¦ ì‹¤íŒ¨ ì‹œ <code class="language-plaintext highlighter-rouge">401 Unauthorized</code> ì‘ë‹µìœ¼ë¡œ ì²˜ë¦¬</li>
  <li><code class="language-plaintext highlighter-rouge">AccessDeniedHandler</code>: ì¸ê°€ ì‹¤íŒ¨ ì‹œ <code class="language-plaintext highlighter-rouge">403 Forbidden</code> ì‘ë‹µìœ¼ë¡œ ì²˜ë¦¬</li>
  <li><code class="language-plaintext highlighter-rouge">TokenProvider</code>: JWT ìƒì„±/ê²€ì¦ ê¸°ëŠ¥ì„ ë‹´ë‹¹</li>
</ul>

<p>ì´ì œ êµ¬í˜„ì„ í•´ë³´ì.</p>

<h3 id="jwt-êµ¬í˜„">JWT êµ¬í˜„</h3>

<p>JWT ë¥¼ í•˜ê¸° ì „ì— ë³´í†µ JWT ëŠ” ì¤‘ê°„ì— íƒˆì·¨í•˜ë©´ ìœ„í—˜í•´ì§„ë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ì°¨ì„ ì±…ìœ¼ë¡œ ë³´í†µ JWT í† í°ì˜ ìœ íš¨ ì‹œê°„ì„ ë¶€ì—¬í•˜ê²Œ ë˜ë©°, <code class="language-plaintext highlighter-rouge">Access Token</code> ì´ë¼ê³  ë¶ˆë¦¬ëŠ” í† í°ì—ëŠ” ë§Œë£Œ ì‹œê°„ì„ ë³´í†µ 5-30ë¶„ìœ¼ë¡œ í•˜ê²Œ ëœë‹¤.</p>

<p>í•˜ì§€ë§Œ, ìœ ì €ê°€ ê³„ì† ì´ë¥¼ ì¬ë°œê¸‰í•´ì•¼ í•˜ëŠ” ì‚¬ìš©ì ê²½í—˜ ë•Œë¬¸ì— <code class="language-plaintext highlighter-rouge">Refresh Token</code> ì´ë¼ëŠ” ê²ƒì„ ë”°ë¡œ ë§Œë“¤ì–´ ì´ë¥¼ í† ëŒ€ë¡œ <code class="language-plaintext highlighter-rouge">Access Token</code> ì˜ ê°±ì‹ ì„ ì‹ ê²½ ì•ˆì¨ë„ ì„œë¹„ìŠ¤ë¥¼ ì›í• íˆ ì´ìš©í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤. ë³´í†µ ê°±ì‹  í† í°ë„ ë§Œë£Œ ì‹œê°„ì´ ìˆëŠ”ë°, 7ì¼ ì´ìƒ 30ì¼ê¹Œì§€ë„ ê°€ëŠ” ê²½ìš°ê°€ ìˆë‹¤.</p>

<p>ì´ <code class="language-plaintext highlighter-rouge">Access Token</code> ì€ ë³´í†µ ìœ ì €ê°€ ê°€ì§€ë©°, <code class="language-plaintext highlighter-rouge">Refresh Token</code> ì€ ì„œë²„ê°€ ê°€ì§€ê²Œ ëœë‹¤(<code class="language-plaintext highlighter-rouge">Refresh Token</code> ì„ ìœ ì €ê°€ ê°€ì§ˆ ë•Œë„ ìˆë‹¤).</p>

<p>ì—¬ê¸°ì„œëŠ” <code class="language-plaintext highlighter-rouge">Access Token</code> ë¥¼ ìœ ì €ë§Œ ê°€ì§ˆ ë•Œë¥¼ ë³¼ ê²ƒì´ë‹¤.</p>

<h4 id="onceperrequestfilter">OncePerRequestFilter</h4>

<p>ë³´í†µ ì¼ë°˜ì ì¸ í•„í„°ëŠ” <code class="language-plaintext highlighter-rouge">GenericFilterBean</code> ë¥¼ ìƒì†ë°›ì•„ êµ¬í˜„í•˜ë©´ ëœë‹¤. ë‚´ë¶€ ì½”ë“œëŠ” ì•Œì•„ì„œ íŒŒë³´ê¸¸ ë°”ë€ë‹¤. ì—¬ê¸°ì„œëŠ” ë‹¤ ë‹¤ë£° ìˆ˜ê°€ ì—†ë‹¤. í•„í„°ì˜ <code class="language-plaintext highlighter-rouge">doFilterInternal</code> ì„ êµ¬í˜„í•´ì£¼ì–´ì•¼ í•œë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtFilter</span> <span class="kd">extends</span> <span class="nc">OncePerRequestFilter</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
	                                <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
	                                <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>

	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ë•Œ, í•  ë™ì‘ìœ¼ë¡œëŠ” request ì˜ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ëŠ” ê²ƒì¼ê±°ë‹¤. í—¤ë”ìª½ì— <code class="language-plaintext highlighter-rouge">Authorization</code> ì— ë³´í†µ <code class="language-plaintext highlighter-rouge">Bearer</code> ë¡œ í† í°ì´ ë“¤ì–´ê°€ê²Œ ëœë‹¤.</p>

<p>ì´ëŠ” HTTP í‘œì¤€(RPC)ê³¼ OAuth 2.0 ê·œê²©ì—ì„œ ì •í•œ ê´€ìŠµì¸ë°, í—¤ë” ìª½ì— ë“¤ì–´ê°ˆ ë°ì´í„°ì˜ ìŠ¤í‚´ì„ ì–´ë–»ê²Œ ì“¸ì§€ë¥¼ ê·œì •í•´ë†¨ë‹¤. ë³´í†µ <code class="language-plaintext highlighter-rouge">Basic (ìœ ì €ì´ë¦„ ë° íŒ¨ìŠ¤ì›Œë“œ)</code> ì€ <code class="language-plaintext highlighter-rouge">Basic</code> ê¸°ë³¸ ì¸ì¦ ë°©ì‹ì„ ì“°ë„ë¡ í•˜ë©°, í† í° ê¸°ë°˜ ì¸ì¦ ë°©ì‹ì€ <code class="language-plaintext highlighter-rouge">Bearer (í† í°)</code> ìœ¼ë¡œ ëª…ì‹œí•˜ë„ë¡ scheme ê°€ ì§œì—¬ì ¸ ìˆë‹¤.</p>

<p>ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ì§œì.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="nc">String</span> <span class="nf">getRawToken</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JwtException</span> <span class="o">{</span>
  <span class="nc">String</span> <span class="n">authHeader</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">authHeader</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">authHeader</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"Bearer "</span><span class="o">))</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="k">return</span> <span class="n">authHeader</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="s">"Bearer "</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">doFilterInternal</code> ì€ ë‹¤ìŒì„ ì¶”ê°€í•œë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">String</span> <span class="n">rawToken</span> <span class="o">=</span> <span class="n">getRawToken</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>

<span class="k">if</span> <span class="o">(</span><span class="n">rawToken</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">rawToken</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
  <span class="k">return</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ì œ ì´ <code class="language-plaintext highlighter-rouge">rawToken</code> ìœ¼ë¡œ í† í°í™” ë˜ì–´ìˆëŠ” JWT ë¥¼ ë³µí˜¸í™” í•´ì¤˜ì•¼ í•œë‹¤. ì´ë•Œ <code class="language-plaintext highlighter-rouge">JwtTokenizer</code> í´ë˜ìŠ¤ê°€ í•„ìš”í•  ìˆ˜ ìˆë‹¤. tokenizer ê°€ ì•Œì•„ì•¼ í•  ê°’ì€ ì‹œí¬ë¦¿ í‚¤ì´ë‹¤. ì„ì˜ë¡œ ë°œê¸‰ë˜ì–´ ì €ì¥ëœ Access Secret Key ì™€ Refresh Secret Key ë‘ ê°œì˜ ë¹„ë°€ í‚¤ê°€ í•„ìš”í•  ê²ƒì´ë‹¤. ë³´í†µ ì´ëŠ” í™˜ê²½ë³€ìˆ˜ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê³ , ì•„ë‹ˆë©´ ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">application.yml</code> ì—ì„œ ë“¤ê³ ì™€ë„ ëœë‹¤.</p>

<h4 id="jwtproperties">JwtProperties</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtProperties</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">issuer</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">accessKey</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">refreshKey</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">long</span> <span class="n">accessExpirationMs</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kt">long</span> <span class="n">refreshExpirationMs</span><span class="o">;</span>

	<span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getAccessKeyBytes</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">accessKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getRefreshKeyBytes</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">refreshKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>ì—¬ê¸°ì„œ ë³´í†µ Mac ê³¼ Linux ëŠ” ëŒ€ë¶€ë¶„ <code class="language-plaintext highlighter-rouge">UTF-8</code> ì˜ ì¸ì½”ë”© ë°©ì‹ì„ ì‚¬ìš©í•˜ë‹ˆ ê°€ì ¸ì˜¬ ë•Œ charset ì„ ê·¸ë ‡ê²Œ ì§€ì •í•´ì£¼ì. ì´ ë¿ ì•„ë‹ˆë¼ ë§Œë£Œ ê¸°ê°„ë„ í•„ìš”í•  ìˆ˜ ìˆìœ¼ë‹ˆ ì´ ë˜í•œ ì„¤ì • íŒŒì¼ì„ í† ëŒ€ë¡œ ìˆ˜ì •ë˜ë„ë¡ <code class="language-plaintext highlighter-rouge">Value</code> ë¥¼ ì¨ì„œ ì£¼ì…ì‹œì¼œì£¼ì. ì´ì œ ì´ë¥¼ ì£¼ì…ë°›ëŠ” <code class="language-plaintext highlighter-rouge">JwtTokenizer</code> ë¥¼ ì„ ì–¸í•œë‹¤.</p>

<h4 id="jwttokenizer">JwtTokenizer</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtTokenizer</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">JwtProperties</span> <span class="n">jwtProperties</span><span class="o">;</span>

  <span class="c1">// ...</span>
<span class="o">}</span></code></pre></figure>
<p>ã„´</p>

<p>í† í¬ë‚˜ì´ì €ëŠ” ì¼ë‹¨ í† í°ì„ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆì–´ì•¼ í•œë‹¤. ìƒì„±í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°ì´í„°ê°€ ì „ë¶€ í•„ìˆ˜ê°€ ì•„ë‹ˆì§€ë§Œ ìˆì–´ì•¼ í•œë‹¤.</p>

<ul>
  <li>Header
    <ul>
      <li><code class="language-plaintext highlighter-rouge">alg</code></li>
      <li><code class="language-plaintext highlighter-rouge">type</code></li>
    </ul>
  </li>
  <li>Payload
    <ul>
      <li><code class="language-plaintext highlighter-rouge">sub</code>: ìœ ì € ì‹ë³„ì(ID)</li>
      <li><code class="language-plaintext highlighter-rouge">iat</code>: ë°œí–‰ ì‹œê°„</li>
      <li><code class="language-plaintext highlighter-rouge">exp</code>: ë§Œë£Œ ì‹œê°„</li>
      <li><code class="language-plaintext highlighter-rouge">roles</code>: ê¶Œí•œ ì •ë³´</li>
      <li>ì¶”ê°€ ìœ ì € ì •ë³´</li>
    </ul>
  </li>
  <li>Signature
    <ul>
      <li>ì‹œí¬ë¦¿ í‚¤</li>
    </ul>
  </li>
</ul>

<p>ë”°ë¼ì„œ ìœ„ë¥¼ ì¸ìë¡œ ë°›ì•„ì£¼ëŠ” í† í°ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì£¼ì. ë§Œë“¤ê¸° ì „ì— ì´ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” jwt ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì¤€ë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">implementation</span> <span class="err">'</span><span class="n">io</span><span class="o">.</span><span class="na">jsonwebtoken</span><span class="o">:</span><span class="n">jjwt</span><span class="o">-</span><span class="nl">api:</span><span class="mf">0.12</span><span class="o">.</span><span class="mi">6</span><span class="err">'</span>  <span class="c1">// JWT í‘œì¤€ API ì¸í„°í˜ì´ìŠ¤</span>
<span class="n">runtimeOnly</span> <span class="err">'</span><span class="n">io</span><span class="o">.</span><span class="na">jsonwebtoken</span><span class="o">:</span><span class="n">jjwt</span><span class="o">-</span><span class="nl">impl:</span><span class="mf">0.12</span><span class="o">.</span><span class="mi">6</span><span class="err">'</span>  <span class="c1">// JWT ìƒì„±/ê²€ì¦ ë¡œì§ êµ¬í˜„ì²´</span>
<span class="n">runtimeOnly</span> <span class="err">'</span><span class="n">io</span><span class="o">.</span><span class="na">jsonwebtoken</span><span class="o">:</span><span class="n">jjwt</span><span class="o">-</span><span class="nl">jackson:</span><span class="mf">0.12</span><span class="o">.</span><span class="mi">6</span><span class="err">'</span> <span class="c1">// JSON ì§ë ¬í™”/ì—­ì§ë ¬í™”ë¥¼ ìœ„í•œ Jackson ê¸°ë°˜ ëª¨ë“ˆ</span></code></pre></figure>

<p>ì´ì œ í† í°ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ì. í† í°ì€ . ì„ ê¸°ì¤€ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">header</code>, <code class="language-plaintext highlighter-rouge">payload</code>, <code class="language-plaintext highlighter-rouge">signature</code> ì˜ String ìœ¼ë¡œ ë˜ì–´ìˆê¸° ë•Œë¬¸ì— ë°˜í™˜ì€ String ìœ¼ë¡œ í•´ì¤€ë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="nc">String</span> <span class="nf">tokenize</span><span class="o">(</span>
    <span class="kt">long</span> <span class="n">expiration</span><span class="o">,</span>
    <span class="nc">String</span> <span class="n">loginId</span><span class="o">,</span>
    <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">roles</span><span class="o">,</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">secretKey</span>
<span class="o">)</span> <span class="o">{</span>
  <span class="c1">// ...</span>
<span class="o">}</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">Jwts</code> ì—ëŠ” ê°ì¢… ìœ í‹¸ í•¨ìˆ˜ë“¤ì´ ë“¤ì–´ê°€ ìˆë‹¤. builder ë¡œ JWT ë¥¼ ìƒì„±í•˜ë„ë¡ í•  ìˆ˜ ìˆìœ¼ë©°, ë‹¤ì–‘í•œ ì˜µì…˜ë“¤ì„ ë„£ì„ ìˆ˜ ìˆë‹¤(í—¤ë”ë„ ë„£ì„ ìˆ˜ ìˆëŠ” ê²ƒìœ¼ë¡œ ì•Œê³  ìˆë‹¤).</p>

<p>ì—¬ê¸°ì„œ <code class="language-plaintext highlighter-rouge">signWith</code> ì„ í•  ë•ŒëŠ” <code class="language-plaintext highlighter-rouge">signature</code> ê°€ ë“¤ì–´ê°€ì•¼í•˜ë©° <code class="language-plaintext highlighter-rouge">byte[] key</code> ê°€ ë“¤ì–´ê°€ë©´ ì•ˆë˜ê³ , SecretKey ê°€ ë“¤ì–´ê°€ì•¼ í•œë‹¤. <code class="language-plaintext highlighter-rouge">Keys</code> ìœ í‹¸ì„± í•¨ìˆ˜ë¥¼ í†µí•´ ë‹¨ë°©í–¥ ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•´ ìƒì„±í•´ì£¼ì.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="nc">SecretKey</span> <span class="nf">createSecretKey</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nc">Keys</span><span class="o">.</span><span class="na">hmacShaKeyFor</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="nc">String</span> <span class="nf">tokenize</span><span class="o">(</span>
    <span class="kt">long</span> <span class="n">expiration</span><span class="o">,</span>
    <span class="nc">String</span> <span class="n">loginId</span><span class="o">,</span>
    <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">roles</span><span class="o">,</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">secretKey</span>
<span class="o">)</span> <span class="o">{</span>
  <span class="nc">Date</span> <span class="n">expiry</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="n">expiration</span><span class="o">);</span>
  <span class="k">return</span> <span class="nc">Jwts</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">issuer</span><span class="o">(</span><span class="n">jwtProperties</span><span class="o">.</span><span class="na">getIssuer</span><span class="o">())</span>
              <span class="o">.</span><span class="na">expiration</span><span class="o">(</span><span class="n">expiry</span><span class="o">)</span>
              <span class="o">.</span><span class="na">claim</span><span class="o">(</span><span class="s">"loginId"</span><span class="o">,</span> <span class="n">loginId</span><span class="o">)</span>
              <span class="o">.</span><span class="na">claim</span><span class="o">(</span><span class="s">"roles"</span><span class="o">,</span> <span class="n">roles</span><span class="o">)</span>
              <span class="o">.</span><span class="na">signWith</span><span class="o">(</span><span class="n">createSecretKey</span><span class="o">(</span><span class="n">secretKey</span><span class="o">))</span>
              <span class="o">.</span><span class="na">compact</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ì œ í† í° ìƒì„±ì´ ëë‚¬ë‹¤. access, refresh ë³„ë¡œ ë‚˜ëˆ ì£¼ì.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nc">String</span> <span class="nf">accessTokenize</span><span class="o">(</span>
    <span class="nc">String</span> <span class="n">loginId</span><span class="o">,</span>
    <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">roles</span>
<span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nf">tokenize</span><span class="o">(</span><span class="n">jwtProperties</span><span class="o">.</span><span class="na">getAccessExpirationMs</span><span class="o">(),</span>
                  <span class="n">loginId</span><span class="o">,</span>
                  <span class="n">roles</span><span class="o">,</span>
                  <span class="n">jwtProperties</span><span class="o">.</span><span class="na">getAccessKeyBytes</span><span class="o">());</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="nc">String</span> <span class="nf">refreshTokenize</span><span class="o">(</span>
    <span class="nc">String</span> <span class="n">loginId</span><span class="o">,</span>
    <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">roles</span>
<span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nf">tokenize</span><span class="o">(</span><span class="n">jwtProperties</span><span class="o">.</span><span class="na">getRefreshExpirationMs</span><span class="o">(),</span>
                  <span class="n">loginId</span><span class="o">,</span>
                  <span class="n">roles</span><span class="o">,</span>
                  <span class="n">jwtProperties</span><span class="o">.</span><span class="na">getRefreshKeyBytes</span><span class="o">());</span>
<span class="o">}</span></code></pre></figure>

<p>í† í°í™” í•˜ëŠ”ê²Œ ëë‚¬ë‹¤ë©´ í† í°ì„ ë‹¤ì‹œ íŒŒì‹±í•˜ì—¬ plain í˜•íƒœë¡œ ë˜ëŒë¦¬ëŠ” ê²ƒë„ í•„ìš”í•˜ë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nc">Claims</span> <span class="nf">parse</span><span class="o">(</span><span class="nc">String</span> <span class="n">token</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JwtException</span> <span class="o">{</span>
  <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"ğŸ‘¾ token({}) ìœ íš¨ ê²€ì¦ ì¤‘..."</span><span class="o">,</span> <span class="n">token</span><span class="o">);</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Jwts</span><span class="o">.</span><span class="na">parser</span><span class="o">()</span>
                <span class="o">.</span><span class="na">verifyWith</span><span class="o">(</span><span class="n">createSecretKey</span><span class="o">(</span><span class="n">jwtProperties</span><span class="o">.</span><span class="na">getAccessKeyBytes</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">requireIssuer</span><span class="o">(</span><span class="n">jwtProperties</span><span class="o">.</span><span class="na">getIssuer</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
                <span class="o">.</span><span class="na">parseSignedClaims</span><span class="o">(</span><span class="n">token</span><span class="o">)</span>
                <span class="o">.</span><span class="na">getPayload</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">MissingClaimException</span> <span class="o">|</span> <span class="nc">IncorrectClaimException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">BadCredentialsException</span><span class="o">(</span><span class="s">".requiredIssuer ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">UnsupportedJwtException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">BadCredentialsException</span><span class="o">(</span><span class="s">"the jwt argument does not represent a signed Claims JWT"</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalArgumentException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">BadCredentialsException</span><span class="o">(</span><span class="s">"the jwt string is null or empty or only whitespace"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ì œ ì´ê±¸ filter ì—ì„œ ì“°ê³ , authentication ì„ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒì„ ì„ ì–¸í•˜ì.</p>

<h4 id="dofilterinternal">doFilterInternal</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtAuthenticationFilter</span> <span class="kd">extends</span> <span class="nc">OncePerRequestFilter</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="no">DEFAULT_ROLES</span>
			<span class="o">=</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleGrantedAuthority</span><span class="o">(</span><span class="s">"ROLE_USER"</span><span class="o">));</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">;</span>
  
  <span class="o">...</span>

  	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
	                                <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
	                                <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
    
    <span class="nc">String</span> <span class="n">loginId</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="kt">boolean</span> <span class="n">isAuthenticated</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">rawToken</span> <span class="o">=</span> <span class="n">getRawToken</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    
    <span class="c1">// ...</span>

		<span class="k">try</span> <span class="o">{</span>
			<span class="kt">var</span> <span class="n">claims</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">rawToken</span><span class="o">);</span>
			<span class="n">loginId</span> <span class="o">=</span> <span class="n">claims</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"loginId"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			<span class="n">isAuthenticated</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

		<span class="o">}</span></code></pre></figure>

<p>ì—¬ê¸°ì„œ í† í°ì„ íŒŒì‹±í•  ë•Œ ë§Œë£Œëœ í† í°ì´ë¼ë©´ ì—¬ê¸°ì„œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ê²Œ ëœë‹¤. ë”°ë¼ì„œ ì´ë¥¼ try ë¬¸ìœ¼ë¡œ ê°ì‹¸ì£¼ê³  catch ì ˆì„ ì¶”ê°€í•´ì¤€ë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ExpiredJwtException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">loginId</span> <span class="o">=</span> <span class="n">getLoginIdWithoutAuth</span><span class="o">(</span><span class="n">rawToken</span><span class="o">);</span>
  <span class="n">refreshTokenRepository</span>
      <span class="o">.</span><span class="na">findByLoginId</span><span class="o">(</span><span class="n">loginId</span><span class="o">)</span>
      <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">BadCredentialsException</span><span class="o">(</span><span class="s">"ì—†ëŠ” ì‚¬ìš©ì"</span><span class="o">));</span>
  <span class="c1">// refreshToken ê²€ì¦ì„ ìœ„í•œ ì¶”ê°€ ì²˜ë¦¬</span>
  <span class="nc">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">accessTokenize</span><span class="o">(</span><span class="n">loginId</span><span class="o">,</span> <span class="no">DEFAULT_ROLES</span><span class="o">);</span>
  <span class="n">response</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">.</span><span class="na">SC_OK</span><span class="o">);</span>
  <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span> <span class="s">"Bearer "</span> <span class="o">+</span> <span class="n">accessToken</span><span class="o">);</span>
  <span class="n">isAuthenticated</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span></code></pre></figure>

<p>ì´ë•Œ ì—¬ê¸°ì„œëŠ” ê·¸ëƒ¥ ë‹¨ìˆœíˆ <code class="language-plaintext highlighter-rouge">refreshToken</code> ì´ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ë§Œì„ í™•ì¸í•˜ê³  ë„˜ì–´ê°€ë©°, ë‚˜ì¤‘ì— ì´ì— ëŒ€í•œ ì¶”ê°€ì ì¸ ì¸ì¦ ì²˜ë¦¬ê°€ ì €ê¸°ì— í•„ìš”í•  ê²ƒì´ë‹¤. ë˜í•œ ì €ê¸°ì„œ rawToken ì— ëŒ€í•œ ì¸ì¦ì´ ì—†ì„ ë•Œ, <code class="language-plaintext highlighter-rouge">loginId</code> ë§Œì„ ë¹¼ì˜¤ê²Œ í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” ë”°ë¡œ í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì„œ í•œë‹¤(<code class="language-plaintext highlighter-rouge">ObjectMapper</code> ê°€ í•„ìš”í•  ê²ƒì´ë‹¤). ì´ì œ auth ë¥¼ ë§Œë“¤ì–´ ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•´ì£¼ê³  ë„˜ê²¨ì£¼ì.</p>

<h4 id="jwtauthenticationtoken">JwtAuthenticationToken</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Getter</span>
<span class="nd">@Builder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtAuthenticationToken</span> <span class="kd">implements</span> <span class="nc">Authentication</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="nc">Object</span> <span class="n">principal</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">Object</span> <span class="n">credentials</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">Object</span> <span class="n">details</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span><span class="o">;</span>
	<span class="nd">@Setter</span>
	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isAuthenticated</span><span class="o">;</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">principal</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>ìœ„ì™€ ê°™ì´ ë§Œë“¤ì–´ì¤€ë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="nc">Authentication</span> <span class="n">auth</span> <span class="o">=</span> <span class="nc">JwtAuthenticationToken</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                                              <span class="o">.</span><span class="na">principal</span><span class="o">(</span><span class="n">loginId</span><span class="o">)</span>
                                              <span class="o">.</span><span class="na">credentials</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>
                                              <span class="o">.</span><span class="na">authorities</span><span class="o">(</span><span class="no">DEFAULT_ROLES</span><span class="o">)</span>
                                              <span class="o">.</span><span class="na">isAuthenticated</span><span class="o">(</span><span class="n">isAuthenticated</span><span class="o">)</span>
                                              <span class="o">.</span><span class="na">build</span><span class="o">();</span>
  <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">auth</span><span class="o">);</span>
  <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ì œ í•„í„°ëŠ” ë‹¤ ë§Œë“¤ì—ˆìœ¼ë¯€ë¡œ ì´ë¥¼ ì¶”ê°€í•´ì£¼ì.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">				<span class="o">.</span><span class="na">addFilterAfter</span><span class="o">(</span><span class="n">jwtAuthenticationFilter</span><span class="o">,</span> <span class="nc">LogoutFilter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span></code></pre></figure>

<p>ì´ ì´í›„ì—ëŠ” json ì˜ loginId, password ë¥¼ ì²˜ë¦¬í•˜ë„ë¡ í•´ì£¼ëŠ” security3 í¬ìŠ¤íŒ…ì„ ë³´ê³  ì´ë¥¼ <strong>â€œì˜â€</strong> ë“¤ê³ ì˜¨ë‹¤. ì´ì œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì.</p>

<h5 id="í…ŒìŠ¤íŠ¸-íšŒì›ê°€ì…">í…ŒìŠ¤íŠ¸: íšŒì›ê°€ì…</h5>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">curl <span class="nt">-L</span> <span class="nt">-i</span> <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
<span class="nt">-d</span> <span class="s1">'{"loginId":"test","password":"1234"}'</span> <span class="se">\</span>
http://localhost:8080/login</code></pre></figure>

<p>ë³¸ì¸ì€ ê·¸ëƒ¥ application ì— repoë¥¼ ë“¤ê³ ì™€ì„œ ì„ì˜ë¡œ ê°’ì„ ë„£ì—ˆë‹¤.</p>

<h5 id="í…ŒìŠ¤íŠ¸-ë°›ì€-í—¤ë”ë¥¼-í† ëŒ€ë¡œ-welcom-ìš”ì²­">í…ŒìŠ¤íŠ¸: ë°›ì€ í—¤ë”ë¥¼ í† ëŒ€ë¡œ welcom ìš”ì²­</h5>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">curl</span> <span class="o">-</span><span class="no">L</span> <span class="o">-</span><span class="n">i</span> <span class="err">\</span>
     <span class="o">-</span><span class="no">H</span> <span class="s">"Content-Type: application/json"</span> <span class="err">\</span>
     <span class="o">-</span><span class="no">H</span> <span class="s">"Authorization: Bearer (Bearer token)"</span> <span class="err">\</span>
     <span class="nl">http:</span><span class="c1">//localhost:8080/welcome</span></code></pre></figure>

<h5 id="í…ŒìŠ¤íŠ¸-í† í°ì´-ì—†ë‹¤ë©´-403">í…ŒìŠ¤íŠ¸: í† í°ì´ ì—†ë‹¤ë©´ 403</h5>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">curl</span> <span class="o">-</span><span class="no">L</span> <span class="o">-</span><span class="n">i</span> <span class="err">\</span>
     <span class="o">-</span><span class="no">H</span> <span class="s">"Content-Type: application/json"</span> <span class="err">\</span>
     <span class="nl">http:</span><span class="c1">//localhost:8080/welcome</span></code></pre></figure>

<p>ì‹¤íŒ¨ ìš”ì²­ì€ ì•Œì•„ì„œ í•´ë³´ê¸¸ ë°”ë€ë‹¤.</p>

    </div><div id="disqus_thread" style="margin-top:25px"></div>
    <script>
    var disqus_config = function () {
        this.page.url = 'https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/11/11/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-53%EC%9D%BC%EC%B0%A8-spring-security4-jwt.html';
        this.page.identifier = 'https://seonghun120614.github.io/seonghun120614/%EB%A9%8B%EC%9F%81%EC%9D%B4%EC%82%AC%EC%9E%90%EC%B2%98%EB%9F%BC/%EB%A9%8B%EC%82%AC/%EB%B0%B1%EC%97%94%EB%93%9C/til/java/spring/2025/11/11/%EB%A9%8B%EC%82%AC-%EB%B0%B1%EC%97%94%EB%93%9C-19%EA%B8%B0-til-53%EC%9D%BC%EC%B0%A8-spring-security4-jwt.html';
    };
    (function () {
        var d = document, s = d.createElement('script');
        s.src = 'https://seonghun.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
  </script>
    <noscript>Please enable JavaScript to view the <a
            href="https://disqus.com/?ref_noscript" rel="nofollow">comments
            powered by Disqus.</a></noscript></div>
<script>
    mermaid.initialize({startOnLoad:true});
    window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
</script>
            </section>
            <footer class="condensed">
                <ul class="social about-footer condensed"><li>
                        <a
                            href="https://github.com/seonghun120614"
                            target="_blank"
                            rel="noopener"
                            aria-label="github">
                            <i class="icon-github-circled"></i>
                        </a>
                    </li><li>
                        <a
                            href="mailto:seonghun120614@gmail.com"
                            target="_blank" rel="noopener" aria-label="email">
                            <i class="icon-mail-alt"></i>
                        </a>
                    </li></ul><nav class="navigation about-footer condensed">
                    <ul>
                        
                        <li>
                            <a href="/seonghun120614/about">About Me</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/computerscience">Computer Science</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/math">Math</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/softwareengineering">Software Engineering</a>
                        </li>
                        
                    </ul>
                </nav><p class="about-footer condensed">&copy;
                    2025</p><div class="about-footer condensed">
                    <p>Dark Mode
                        <i class="icon-moon"></i>
                        <label class="switch" for="dark-toggle">
                            <input id="dark-toggle" type="checkbox"
                                class="dark-mode-toggle"
                                aria-label="Toggle dark mode">
                            <span class="slider round"
                                onclick="toggleDarkMode()"></span>
                        </label>
                    </p>
                </div>
            </footer>
        </main>
        
        <script type="text/javascript" src="/seonghun120614/assets/js/darkmode.js"></script>
        
        <script src="/seonghun120614/assets/js/simple-jekyll-search.min.js"></script>
        <script src="/seonghun120614/assets/js/search.js"></script>
        
        <script>
            window.addEventListener('scroll', () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                document.getElementById('scroll-progress').style.width = scrollPercent + '%';
            });
        </script>
    </body>
</html>