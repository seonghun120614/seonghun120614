---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 21ì¼ì°¨ SQL ì‹¬í™”"
date:   2025-09-16 09:59:03 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Database
---

<!--more-->

## ğŸ“‚ ëª©ì°¨
- [SQL ëª…ë ¹ ì •ë¦¬](#sql-ëª…ë ¹-ì •ë¦¬)
- [INDEX ê¹Šì´ ìˆê²Œ ë‹¤ë£¨ê¸°](#index-ê¹Šì´-ìˆê²Œ-ë‹¤ë£¨ê¸°)
    - [EXPLAIN](#explain)
    - [FULLTEXT INDEX](#fulltext-index)
        - [MATCH ... AGAINST êµ¬ë¬¸](#match--against-êµ¬ë¬¸)
        - [ì œì•½ì‚¬í•­](#ì œì•½ì‚¬í•­)
- [Data Types ì‹¬í™”](#data-types-ì‹¬í™”)
    - [Date and Time Types in SQL](#date-and-time-types-in-sql)
    - [Default Values](#default-values)
    - [Large-Object Types](#large-object-types)
    - [User-Defined Types](#user-defined-types)
        - [Domain](#domain)
        - [Generating Unique Key Values](#generating-unique-key-values)
- [JDBC](#jdbc)
    - [Connecting to the DB](#connecting-to-the-db)
    - [Statement](#statement)
    - [Exception](#exception)
    - [PreparedStatement](#preparedstatement)
    - [Callable Statements](#callable-statements)
        - [ìë™ ìƒì„±ëœ í‚¤ ê°€ì ¸ì˜¤ê¸°](#ìë™-ìƒì„±ëœ-í‚¤-ê°€ì ¸ì˜¤ê¸°)

---

## ğŸ“š ë³¸ë¬¸

### SQL ëª…ë ¹ ì •ë¦¬

- CREATE TABLE: í…Œì´ë¸” ìƒì„±
- ALTER TABLE: í…Œì´ë¸” êµ¬ì¡° ë³€ê²½
- DROP TABLE: í…Œì´ë¸” ì‚­ì œ
- RENAME: ì´ë¦„ ë³€ê²½
- TRUNCATE: í…Œì´ë¸”ì˜ ëª¨ë“  ë°ì´í„° ì‚­ì œ
- COMMENT: í…Œì´ë¸”ì— ì„¤ëª… ì¶”ê°€

### INDEX ê¹Šì´ ìˆê²Œ ë‹¤ë£¨ê¸°

ì¸ë±ìŠ¤ëŠ” í…Œì´ë¸”ì˜ ê²€ìƒ‰ ì†ë„ë¥¼ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ íŠ¹ì • ì»¬ëŸ¼ì— ëŒ€í•´ ìƒì„±í•˜ëŠ” ìë£Œêµ¬ì¡°ì´ë‹¤.

{% highlight sql %}
-- ë³µí•© ì¸ë±ìŠ¤ ìƒì„±
create index emp_name_sal_idx
on employees(name, salary);

-- ì¸ë±ìŠ¤ í™•ì¸
show index from employees;

-- ì¸ë±ìŠ¤ ì‚­ì œ
alter table employees
drop index emp_name_sal_idx;
{% endhighlight %}

> ìœ ë‹ˆí¬ ê°’ì´ ë§ì€ ì»¬ëŸ¼ì´ íš¨ìœ¨ì ì´ë‹¤.

ì´ì œ ì¸ë±ìŠ¤ ì‹¤í–‰ ê³„íšì„ ë³´ì.

#### EXPLAIN

ì¿¼ë¦¬ì˜ ì„±ëŠ¥ì„ ë¶„ì„í•˜ê³  ë³‘ëª© êµ¬ê°„ì„ ì°¾ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” êµ¬ë¬¸ì´ë‹¤. db ê°€ í…Œì´ë¸” ìŠ¤ìº” ë°©ì‹ì´ë‚˜ ì¸ë±ìŠ¤ ì‚¬ìš© ì—¬ë¶€, ì¡°ì¸ ìˆœì„œ ë“±ì„ ì–´ë–»ê²Œ ê²°ì •í–ˆëŠ”ì§€ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.

{% highlight sql %}
-- ì¸ë±ìŠ¤ ì‚¬ìš© ì „
EXPLAIN SELECT * FROM employees 
WHERE hire_date = '2005-01-01';

-- ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX emp_hire_idx ON employees(hire_date);

-- ì¸ë±ìŠ¤ ì‚¬ìš© í›„
EXPLAIN SELECT * FROM employees 
WHERE hire_date = '2005-01-01';
{% endhighlight %}

> ì—¬ê¸°ì„œ index ë¡œ ì„¤ì •ëœ ì—´ì˜ ê°’ì„ where ì ˆì—ì„œ ë³€ì§ˆì‹œí‚¤ë©´ ì•ˆëœë‹¤. ì˜ˆë¥¼ë“¤ì–´ì„œ index ê°€ ìˆëŠ” name ì´ë¼ëŠ” ì†ì„±ì„ where ì ˆì— ì¼ë‹¤ê³  í•´ë³´ì. ê·¸ëŸ¬ë©´ substring(name, 1, 1) ë“±ìœ¼ë¡œ ì´ë¥¼ ë³€ì§ˆì‹œí‚¤ë©´ index ë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ê²Œ ëœë‹¤. LIKE ë¥¼ ì¨ì„œ ì´ë¥¼ ë³€ì§ˆì‹œí‚¤ì§€ ë§ê³  í•´ì•¼í•œë‹¤.

#### FULLTEXT INDEX

ë¬¸ìì—´ ì»¬ëŸ¼(CHAR, VARCHAR, TEXT)ë¥¼ ëŒ€ìƒìœ¼ë¡œ ë¹ ë¥¸ í‚¤ì›Œë“œ ê²€ìƒ‰ì„ ì§€ì›í•˜ëŠ” ì¸ë±ìŠ¤ì´ë‹¤. `LIKE '%keyword%'` ë³´ë‹¤ í›¨ì”¬ íš¨ìœ¨ì ì´ê³ , ìì—°ì–´ ì²˜ë¦¬ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ë©°, ë‹¨ì–´ ë‹¨ìœ„ë¡œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.

> MySQL 5.6 ì´ìƒì—ì„œ InnoDB ì—”ì§„ì—ì„œë„ FULLTEXT ì§€ì›

{% highlight sql %}
-- í…Œì´ë¸” ìƒì„±í•  ë•Œ ìƒì„±
create table t1 (
    varchar(36) id primary key,
    varchar(20) username not null,
    varchar(255) password not null,
    text introduction not null,
    fulltext idx_intro (introduction)
);

-- í…Œì´ë¸” ìƒì„± í›„ ì¸ë±ìŠ¤ ìƒì„±
create fulltext index idx_intro
on t1(introduction)
{% endhighlight %}

##### MATCH ... AGAINST êµ¬ë¬¸

fulltext ë¡œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í–ˆë‹¤ë©´ í•´ë‹¹ ì»¬ëŸ¼ì— ëŒ€í•œ ê²€ìƒ‰ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

{% highlight sql %}
-- ìì—°ì–´ ëª¨ë“œ
select * from t1
where match(introduction)
against('hello, ');

-- boolean ëª¨ë“œ
select * from t1
where match(introduction)
against('+hello -name' in boolean mode);

-- query expansion ëª¨ë“œ
select * from article
where match(introduction)
against('database' with query expansion);
{% endhighlight %}

- **Natural Language Mode**: ë‹¨ì–´ì˜ ë“±ì¥ ë¹ˆë„(TF-IDF) ê¸°ë°˜ìœ¼ë¡œ ì ìˆ˜ ê³„ì‚° -> ì—°ê´€ë„ ë†’ì€ ìˆœìœ¼ë¡œ ê²°ê³¼ë¥¼ ë°˜í™˜
- **Boolean Mode**: +(í•„ìˆ˜ í¬í•¨), -(ì œì™¸), *(ì™€ì¼ë“œì¹´ë“œ), "(ì •í™•íˆ ì¼ì¹˜)
- **Query Expansion**: ì²« ê²€ìƒ‰ ê²°ê³¼ì˜ ì—°ê´€ ë‹¨ì–´ë“¤ì„ ë‹¤ì‹œ í™•ì¥í•˜ì—¬ ê²€ìƒ‰(ì¶”ì²œ ê²€ìƒ‰ê³¼ ìœ ì‚¬)

##### ì œì•½ì‚¬í•­

ì´ëŸ¬í•œ FULLTEXT ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì œì•½ì‚¬í•­ì„ ë”°ë¥¸ë‹¤.

- **ft_min_word_len** ë³´ë‹¤ ì§§ìœ¼ë©´ ì¸ë±ì‹±ì´ ì•ˆë¨
    - ìµœì†Œ ë‹¨ì–´ ê¸¸ì´ ë³€ìˆ˜ëŠ” MySQL ì„œë²„ ì‹œìŠ¤í…œ ë³€ìˆ˜ë¥¼ ë”°ë¼ê°€ë©° ê¸°ë³¸ê°’ì€ 4ë¡œ ë˜ì–´ ìˆë‹¤.
    - DB ì„œë²„ ì¬ì‹œì‘ í›„ ë‹¤ì‹œ ì ìš©í•´ì•¼ í•œë‹¤(rebuilding í•„ìš”)
- ê¸°ë³¸ì ìœ¼ë¡œ ë¶ˆìš©ì–´(a, an, the, ...)ë“±ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë¬´ì‹œí•œë‹¤
- collation ì˜ ë¬¸ì ì •ë ¬ ê·œì¹™ì— ë”°ë¼ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—¬ë¶€ë¥¼ ì •í•  ìˆ˜ ìˆë‹¤.
    - **utf8_general_ci**: ëŒ€ì†Œë¬¸ìëŠ” êµ¬ë¶„í•˜ì§€ ì•ŠìŒ
    - **utf8_bin** ê³„ì—´: ëŒ€ì†Œë¬¸ì êµ¬ë¶„
- ì˜ì–´/ë¼í‹´ ë¬¸ì ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ê³„ê°€ ë˜ì–´ì„œ í•œêµ­ì–´/ì¼ë³¸ì–´/ì¤‘êµ­ì–´ ë“±ë“±ì˜ ì–¸ì–´ë“¤ì€ n-gram íŒŒì„œë¥¼ í™œì„±í™”í•´ì•¼ í•œë‹¤.

**collation**
{% highlight sql %}
-- Collations í™•ì¸
show full columns from t1;

-- ë³€ê²½
alter table t1
modify introduction varchar(255)
collate utf8_bin;
{% endhighlight %}

**n-gram ì‚¬ìš©**
{% highlight sql %}
-- MySQL 5.7 ë¶€í„° ì§€ì›
create fulltext index idx_test
on t1(introduction)
with parser ngram;
{% endhighlight %}

### Data Types ì‹¬í™”

#### Date and Time Types in SQL

- **date**: ì—°ë„, ì›”, ì¼
- **time**: ì‹œ, ë¶„, ì´ˆ, time(p) ì‚¬ìš© ì‹œ ì´ˆì˜ ì†Œìˆ˜ ìë¦¿ìˆ˜ë¥¼ ì§€ì • ê°€ëŠ¥ ë˜í•œ time with timezone ì„ ì‚¬ìš©ì‹œ ì‹œê°„ëŒ€ ì •ë³´ë„ í•¨ê»˜ ì €ì¥ ê°€ëŠ¥
- **timestamp**: ë‚ ì§œì™€ ì‹œê°„ì„ ê²°í•©, timestamp(p) ë„ ì‚¬ìš©ê°€ëŠ¥(ê¸°ë³¸ê°’ 6), timestamp with timezone ì„ ì§€ì • ì‹œ ì‹œê°„ëŒ€ ì •ë³´ë„ í•¨ê»˜ ì €ì¥

**ì¤‘ìš”**
> MySQL ì€ **datetime** íƒ€ì…ì„ ì œê³µí•´ì €ì„œ **timestamp with timezone** ê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.

#### Default Values

default ëŠ” ì†ì„±ì— ê¸°ë³¸ê°’ì„ ì§€ì •í•˜ë„ë¡ í•˜ëŠ” ì œì•½ì¡°ê±´ì´ë‹¤. create ë¬¸ì—ì„œ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì´ ì„ ì–¸í•œë‹¤.

{% highlight sql %}
create table student
(
  ID varchar(5),
  name varchar(20) not null,
  dept_name varchar(20),
  tot_cred numeric(3,0) default 0,
  primary key (ID)
);
{% endhighlight %}

tot_cred ì†ì„±ì˜ ê¸°ë³¸ê°’ì€ 0ì´ê¸°ì— ë ˆì½”ë“œë¥¼ ì‚½ì…í•  ë•Œ, ê°’ì„ ì œê³µí•˜ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ 0ìœ¼ë¡œ ì„¤ì •ëœë‹¤.

#### Large-Object Types

ì‚¬ì§„, ê³ í•´ìƒë„ ì˜ë£Œ ì´ë¯¸ì§€, ë™ì˜ìƒ ë“±ê³¼ ê°™ì€ í° ë°ì´í„° í•­ëª©ì„ ë„ë©”ì¸ìœ¼ë¡œ ê°–ëŠ” ì†ì„±ì„ ì €ì¥í•˜ê³  ì‹¶ì„ ë•ŒëŠ” ë‹¤ìŒì„ ì‚¬ìš©í•œë‹¤:

- **CLOB**: ë¬¸ì ë°ì´í„°ìš© ëŒ€í˜• ê°ì²´
- **BLOB**: ì´ì§„ ë°ì´í„°ìš© ëŒ€í˜• ê°ì²´

{% highlight sql %}
book_review CLOB(10KB)
image BLOB(10MB)
movie BLOB(2GB)
{% endhighlight %}

ì—¬ê¸°ì„œ ì´ë“¤ì„ ê²°ê³¼ë¡œ ë‚´ë³´ë‚¼ë•Œ ëŒ€í˜• ê°ì²´ë¥¼ ë©”ëª¨ë¦¬ ìƒì— ì˜¬ë¦¬ëŠ” ê²ƒì€ í˜„ì‹¤ì ìœ¼ë¡œ ë¶ˆê°€ëŠ¥í•˜ê¸°ì— ì´ ëŒ€ì‹  **Locator** ë¼ëŠ” ê²ƒì„ ì£¼ê³  ë¡œì¼€ì´í„°ë¥¼ í†µí•´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì‘ì„±ëœ í˜¸ìŠ¤íŠ¸ ì–¸ì–´ì—ì„œ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” í˜•íƒœë¡œ ì¡°ì‘í•˜ê²Œ ëœë‹¤.

> ìš´ì˜ì²´ì œì˜ read ì™€ ìœ ì‚¬í•˜ë‹¤.

#### User-Defined Types

SQL ì€ ë‘ ê°€ì§€ í˜•íƒœì˜ ì‚¬ìš©ì ì •ì˜ ë°ì´í„° íƒ€ì…ì„ ì§€ì›í•œë‹¤.

- **distinct type**
- **structured data type**: ì¤‘ì²©ëœ ë ˆì½”ë“œ êµ¬ì¡°, ë°°ì—´, ë©€í‹°ì…‹ ë“±

**distinct type**
{% highlight sql %}
create type Dollars as numeric(12,2) final;
create type Pounds as numeric(12,2) final;

create table department
(
  dept_name varchar(20),
  building varchar(15),
  budget Dollars
);
{% endhighlight %}

> ê°œë…ì ìœ¼ë¡œ ì„œë¡œ ë‹¬ë¼ì•¼ í•˜ì§€ë§Œ íƒ€ì…ì€ ìœ ì‚¬í•œ ê²ƒë“¤ì€ distinct type ì„ ì“°ì.

ë‹¨ì ìœ¼ë¡œëŠ” ìœ„ ì˜ˆì‹œì—ì„œëŠ” (department.budget + 20) ì´ë¼ëŠ” í‘œí˜„ì‹ì´ **strong type checking** ë•Œë¬¸ì— í—ˆìš©ë˜ì§€ ì•ŠëŠ” í‘œí˜„ì‹ì´ë‹¤. ë”°ë¼ì„œ ë‹¤ìŒ ì‹ì„ í†µí•´ ë°”ê¾¸ëŠ” ê²ƒì„ ìˆ˜í–‰í•´ì¤˜ì•¼ í•œë‹¤.

{% highlight sql %}
cast(department.budget as numeric(12,2))
{% endhighlight %}

ì´ë ‡ê²Œ í•˜ë©´ ìˆ«ìë¡œ ë°”ê¿”ì„œ ê²°ê³¼ë¥¼ ë‚¼ ìˆ˜ ìˆì§€ë§Œ ì´ë¥¼ ë‹¤ì‹œ ì €ì¥í•  ë•ŒëŠ” ë˜ ë°”ê¿”ì¤˜ì•¼ í•œë‹¤.

##### Domain

ì´ ëŒ€ì•ˆìœ¼ë¡œ domain ì„ ë§Œë“¤ ìˆ˜ ìˆëŠ”ë°,

{% highlight sql %}
create domain DDollars as numeric(12,2) not null;
{% endhighlight %}

DDollars ëŠ” ë‹¤ìŒ ì°¨ì´ì ì´ ìˆë‹¤.

**Domain íŠ¹ì§•**
- Dollars ì™€ëŠ” ë‹¬ë¦¬ not null ì œì•½ì¡°ê±´ì„ ì¶”ê°€ê°€ëŠ¥, primary key ë¡œ ì •ì˜ ê°€ëŠ¥
- ê°•ë ¥í•œ íƒ€ì…ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ê¸°ë³¸ íƒ€ì…ì´ í˜¸í™˜ë˜ëŠ” í•œ í•œ ë„ë©”ì¸ íƒ€ì…ì˜ ê°’ì„ ë‹¤ë¥¸ ë„ë©”ì¸ íƒ€ì…ì— í• ë‹¹í•  ìˆ˜ ìˆìŒ

**ì˜ˆì‹œ**
{% highlight sql %}
-- ë²”ìœ„ ì œí•œ
create domain YearlySalary numeric(8,2)
constraint salary_value_test check(value >= 29000.00);

-- íŠ¹ì • ê°’ìœ¼ë¡œì˜ ì œí•œ
create domain degree_level varchar(10)
constraint degree_level_test
check (value in ('Bachelors', 'Masters', 'Doctorate'));
{% endhighlight %}

#### Generating Unique Key Values

í‘œì¤€ SQL ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê°’ì„ unique í•˜ê²Œ ìƒì„±í•˜ì—¬ ì €ì¥í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì˜µì…˜ì´ ìˆë‹¤.

{% highlight sql %}
ID number(5) generated always as identity
{% endhighlight %}

ì—¬ê¸°ì„œ ì£¼ì˜í•  ì ì€ ì´ëŠ” ìˆ«ìí˜• í‚¤ ê°’ì— ëŒ€í•´ì„œë§Œ ì‘ë™í•œë‹¤.

**generated as identity**
- PostgreSQL: `SERIAL` ì„ ì“´ë‹¤.
- MySQL: `AUTO_INCREMENT` ë¥¼ ì“´ë‹¤.

### JDBC

ì´ì œ ì´ sql ì„œë²„ë¥¼ êµ¬ë™ì¤‘ì´ê³  ì´ë¥¼ ë‹¤ë£¨ëŠ” ë‹¤ì–‘í•œ ê¸°ìˆ ë“¤ ì¤‘ JDBCë¥¼ ë³¸ë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ sql ë§Œìœ¼ë¡œëŠ” í‘œí˜„í•  ìˆ˜ ìˆëŠ” ê²ƒì— í•œê³„ê°€ ìˆê¸° ë•Œë¬¸ì— ì´ëŸ¬í•œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ë ¤ê³  í•˜ë©´ embedded í•˜ì—¬ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ë˜í•œ, ë¹„ì„ ì–¸ì  ì‘ì—…ì€ SQL ë§Œìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ ë³´ê³ ì„œë¥¼ ì¶œë ¥í•˜ê±°ë‚˜, ì‚¬ìš©ìì™€ ìƒí˜¸ì‘ìš©í•˜ê±°ë‚˜, ì¿¼ë¦¬ë¥¼ GUI ì— ì „ë‹¬í•˜ëŠ” ë“±ì˜ ì‘ì—…ì´ë‹¤. ë‚˜ë¨¸ì§€ êµ¬ì„± ìš”ì†ŒëŠ” ë²”ìš© í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¡œ ì‘ì„±ë˜ë¯€ë¡œ í†µí•©ëœ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“œë ¤ë©´ SQL ê³¼ ë²”ìš© í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ê²°í•©í•  ìˆ˜ë‹¨ì´ í•„ìš”í•˜ë‹¤.

ì´ë•Œ JDBCë¥¼ í™œìš©í•˜ì—¬ SQL ê³¼ ì†Œí†µì„ í•  ìˆ˜ ìˆë‹¤.

#### Connecting to the DB

{% highlight java %}
// https://mvnrepository.com/artifact/mysql/mysql-connector-java
implementation 'mysql:mysql-connector-java:8.0.33'
{% endhighlight %}

ìš°ì„  ìœ„ë¥¼ gradle.build ì— ë„£ì–´ mysql driver ë¥¼ ì¶”ê°€í•˜ì.

Java ì—ì„œ `java.sql` íŒ¨í‚¤ì§€ì—ì„œëŠ” db ì™€ ì—°ê²°í•  ìˆ˜ ìˆëŠ” ì»¤ë„¥ì…˜ì´ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤. ì—¬ê¸°ì„œ ì»¤ë„¥ì…˜ì˜ ì„¤ì •ì„ DriverManager ë¡œ ì„¤ì •í•˜ê³  ì„¤ì •ëœ Connection ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

{% highlight java %}
Connection = DriverManager.getConnection(
    "jdbc:mysql://localhost:3306/hr", // url
    userid, // user
    passwd // password
);
{% endhighlight %}

- url ë§¤ê°œë³€ìˆ˜: ì„œë²„ê°€ ì‹¤í–‰ì¤‘ì¸ url, í¬íŠ¸ ë²ˆí˜¸, db ì´ë¦„ ì„ ì°¨ë¡€ëŒ€ë¡œ ì…ë ¥í•´ì£¼ë©´ í•´ë‹¹ DBë¡œ ë„˜ì–´ê°€ê²Œ ëœë‹¤. db ëŠ” ìƒëµë˜ë„ ëœë‹¤.
- user ë§¤ê°œë³€ìˆ˜: ë¬¸ìì—´ì„ ë„£ê³  db ì‚¬ìš©ì id ë¥¼ ì…ë ¥
- password ë§¤ê°œë³€ìˆ˜: ìœ ì €ì— ëŒ€í•œ ë¹„ë°€ë²ˆí˜¸ì´ë‹¤. ë³´í†µì€ Java ì— ì§ì ‘ì¹˜ì§€ ì•Šê³  ë”°ë¡œ ì €ì¥í•˜ì—¬ ìš´ìš©í•œë‹¤.

> ì˜¤ë¼í´ í”„ë¡œí† ì½œì€ jdbc:oracle:thin ì´ë‹¤.

#### Statement

DB ì—°ê²°ì´ ëë‹¤ë©´, ì´ì œ SQL ë¬¸ì„ ì‹¤í–‰í•  ì¤€ë¹„ê°€ ëœ ê²ƒì´ë‹¤.

java ì—ì„œëŠ” ì´ DBì—ê²Œ ëª…ë ¹ì„ ë‚´ë¦¬ê¸° ìœ„í•´ Statement í´ë˜ìŠ¤ê°€ ìˆëŠ”ë°, ì´ë¥¼ í†µí•´ì„œ ì „ì†¡í•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

{% highlight java %}
Statement stmt = conn.createStatement();
stmt.executeUpdate("insert into instructor values(â€™77987â€™,â€™Kimâ€™,â€™Physicsâ€™,98000)");
{% endhighlight %}

Statement ëŠ”
- executeQuery()
- executeUpdate()

ë©”ì„œë“œë¥¼ ê°€ì§€ê³  ìˆì–´ ì´ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ”ë° query ë¡œ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ë©´ ResultSet ì„ ë°˜í™˜í•˜ë©°, ì¿¼ë¦¬ë¬¸ì´ ì•„ë‹Œ ë¬¸ì¥ì€ ê²°ê³¼ ì§‘í•©ì„ ë°˜í™˜í•˜ì§€ ì•Šê³  int ë¥¼ ë°˜í™˜í•˜ê²Œ ëœë‹¤. ì´ë•ŒëŠ” ì‚½ì…, ê°±ì‹ , ì‚­ì œ ëœ íŠœí”Œ ìˆ˜ë¥¼ ë°˜í™˜í•˜ê²Œ ëœë‹¤.

> ì—…ë°ì´íŠ¸ ê°’ì´ ë„ˆë¬´ ë§ì•„ int ê°’ ë²”ìœ„ë¥¼ ë²—ì–´ë‚  ë•Œ, executeLargeUpdate() ë¥¼ ì“¸ ìˆ˜ ìˆë‹¤.

#### Exception

SQL ë©”ì„œë“œë¥¼ ì‹¤í–‰í•  ë•Œì—ëŠ” ë°˜ë“œì‹œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•´ì£¼ì–´ì•¼ í•˜ëŠ”ë°, `SQLException` ì˜ ì²˜ë¦¬ë¥¼ í†µí•´ try-catch ë¥¼ í•´ì£¼ë©´ ë˜ê² ë‹¤.

ë˜í•œ, Connection, Statement, ê¸°íƒ€ JDBCë¥¼ ì—¬ëŠ” ê°ì²´ëŠ” ì‹œìŠ¤í…œ ìì›ì„ ì†Œëª¨í•˜ê¸° ë•Œë¬¸ì— í”„ë¡œê·¸ë˜ë¨¸ëŠ” ë°˜ë“œì‹œ close() ë¥¼ í˜¸ì¶œí•´ì£¼ì–´ì•¼ í•œë‹¤. ì´ë•ŒëŠ” try-resource-with ê³¼ í•¨ê»˜ ì‚¬ìš©í•œë‹¤.

#### PreparedStatement

Statement ë§Œ ê³„ì† ì‚¬ìš©í•˜ë©´ íŠ¹ì • sql ë¬¸ì¥ì„ ì—¬ëŸ¬ê°œ ì‚¬ìš©í•˜ê³  ì‹¶ì„ë•Œ, ìˆ˜í–‰í•˜ê³  ì‹¶ì€ ë§Œí¼ì˜ ë¬¸ì¥ë“¤ì„ ì„ ì–¸í•´ì£¼ì–´ì•¼ í•œë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ java ì—ì„œëŠ” PreparedStatement ë¥¼ ì œê³µí•´ì¤€ë‹¤.

{% highlight sql %}
conn.prepareStatement("insert into instructor values(?,?,?,?)");
{% endhighlight %}

? ë¥¼ íŒŒì‹±í•˜ì—¬ ë‹¤ë¥¸ ê°’ë“¤ë¡œ ëŒ€ì²´í•˜ì—¬ ë„£ì„ ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

{% highlight sql %}
pStmt.setString(1, "88877");
pStmt.setString(2, "Perry");
pStmt.setString(3, "Finance");
pStmt.setInt(4, 125000);
pStmt.executeUpdate();
pStmt.setString(1, "88878");
pStmt.executeUpdate();
{% endhighlight %}

ë§ˆì§€ë§‰ì—ì„œëŠ” 1ë²ˆ íŒŒë¼ë¯¸í„°ë§Œ 88878 ë¡œ ë°”ê¾¸ê³  ë‚˜ë¨¸ì§€ëŠ” ë™ì¼í•˜ê²Œ í•œ í›„ ì‹¤í–‰í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

#### Callable Statements

DBMS ì¸¡ì— ì„ ì–¸ëœ í•¨ìˆ˜ì™€ í”„ë¡œì‹œì €ì— ëŒ€í•œ ìˆ˜í–‰ì„ í•˜ë¼ê³ ë„ í•  ìˆ˜ ìˆë‹¤.

{% highlight sql %}
CallableStatement cStmt1 = conn.prepareCall("{? = call some_function(?)}");
CallableStatement cStmt2 = conn.prepareCall("{call some_procedure(?,?)}");
{% endhighlight %}

##### ìë™ ìƒì„±ëœ í‚¤ ê°€ì ¸ì˜¤ê¸°

add, update, delete ì™€ ê°™ì€ ì²˜ë¦¬ëŠ” ë°˜í™˜ ê°’ì´ êµ³ì´ ì—†ì–´ë„ ë˜ì§€ë§Œ(boolean ìœ¼ë¡œ ì²˜ë¦¬ ì™„ë£Œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°’ì„ ë°˜í™˜í•˜ê¸°ë„ í•œë‹¤), ê°€ë” DB ìì²´ì—ì„œ ìƒì„±í•˜ëŠ” ê³ ìœ í•œ ID ë“¤ì€ í”„ë¡œê·¸ë˜ë° ë‹¨ì—ì„œëŠ” IDë¥¼ ìƒì„±í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ê°€ì ¸ì˜¬ ìˆ˜ ì—†ë‹¤. ì´ ê¸°ë³¸í‚¤ê°€ ê°€ì¥ ì¤‘ìš”í•œ ê°’ì¸ë°, ì´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•˜ë©´ ì €ì¥í•œ í–‰ì— ëŒ€í•´ í›„ì²˜ë¦¬ë¥¼ í•  ìˆ˜ê°€ ì—†ë‹¤. ì´ë¥¼ ìœ„í•´ì„œ  `Statement` ì—ì„œëŠ” `RETURN_GENERATED_KEYS` ë¥¼ ì œê³µí•˜ê³  ìˆë‹¤.

ì‚¬ìš©ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤:

{% highlight sql %}
public Long insertAndGetId(String email, String name, String password) {
    String sql = "INSERT INTO user (email, name, password) VALUES (?, ?, ?)";
    Long generatedId = null;

    try (Connection conn = getConnection();
         PreparedStatement ps = conn.prepareStatement(sql, 
                Statement.RETURN_GENERATED_KEYS)) {

        ps.setString(1, email);
        ps.setString(2, name);
        ps.setString(3, password);

        int updateCount = ps.executeUpdate();

        // ìƒì„±ëœ í‚¤ ê°€ì ¸ì˜¤ê¸°
        if (updateCount > 0) {
            try (ResultSet rs = ps.getGeneratedKeys()) {
                if (rs.next()) {
                    generatedId = rs.getLong(1);
                }
            }
        }
    } catch (SQLException e) {
        e.printStackTrace();
    }

    return generatedId;
}
{% endhighlight %}