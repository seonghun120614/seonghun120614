---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 5ì¼ì°¨"
date:   2025-08-21 11:09:00 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Java
---

<!--more-->

## ğŸ“‚ ëª©ì°¨

- [Parameter](#parameter)
    - [Pass-by-value](#pass-by-value)
    - [ê°€ë³€ ê¸¸ì´ ë§¤ê°œë³€ìˆ˜ ë°›ê¸°](#ê°€ë³€-ê¸¸ì´-ë§¤ê°œë³€ìˆ˜-ë°›ê¸°)
- [Static](#static)
    - [Static Field](#static-field)
    - [Static Method](#static-method)
    - [static ì´ˆê¸°í™” ë¸”ë¡](#static-ì´ˆê¸°í™”-ë¸”ë¡)
    - [Nested Class](#nested-class)
        - [Static Nested Class](#static-nested-class)
        - [Inner Class](#inner-class)
- [â­ï¸ JVM ì˜ ë©”ëª¨ë¦¬ ê³µê°„](#ï¸-jvm-ì˜-ë©”ëª¨ë¦¬-ê³µê°„)
    - [Method Area](#Method-Area)
        - [ì—­ì–´ì…ˆë¸”ëŸ¬ë¥¼ í†µí•œ class íŒŒì¼ ì‚´í´ë³´ê¸°](#ì—­ì–´ì…ˆë¸”ëŸ¬ë¥¼-í†µí•œ-class-íŒŒì¼-ì‚´í´ë³´ê¸°)
        - [í—¤ë” ë¶€ë¶„ í•´ì„](#í—¤ë”-ë¶€ë¶„-í•´ì„)
        - [Attributes êµ¬ì„±ìš”ì†Œ](#attributes-êµ¬ì„±ìš”ì†Œ)
        - [Constant Pool í•´ì„](#constant-pool-í•´ì„)
        - [í´ë˜ìŠ¤ì˜ í•„ë“œ ì •ì˜ í•´ì„](#í´ë˜ìŠ¤ì˜-í•„ë“œ-ì •ì˜-í•´ì„)
        - [ìƒì„±ì ë° ë©”ì„œë“œ ë°”ì´íŠ¸ì½”ë“œ ë¶€ë¶„ í•´ì„](#ìƒì„±ì-ë°-ë©”ì„œë“œ-ë°”ì´íŠ¸ì½”ë“œ-ë¶€ë¶„-í•´ì„)
        - [LineNumberTable í•´ì„](#linenumbertable-í•´ì„)
        - [ê²°ë¡ ](#ê²°ë¡ )
    - [Heap](#heap)
        - [Heap Area ì˜ Generational Collection Theory](#heap-area-ì˜-generational-collection-theory)
        - [Heap ì—ì„œì˜ GC](#heap-ì—ì„œì˜-gc)
    - [Thread](#thread)
        - [Stack](#stack)
        - [PC Register](#pc-register)
        - [Native Method Stack](#native-method-stack)
- [ClassLoader](#classloader)
    - [Loading](#loading)
        - [Bootstrap ClassLoader](#Bootstrap-ClassLoader)
        - [Platform ClassLoader](#Platform-ClassLoader)
        - [System ClassLoader](#System-ClassLoader)
        - [User-defined ClassLoader](#user-defined-classloader)
        - [í´ë˜ìŠ¤ ë¡œë”ì˜ ì›ì¹™](#í´ë˜ìŠ¤-ë¡œë”ì˜-ì›ì¹™)
    - [Linking](#linking)
    - [Initialize](#initialize)

---

## ğŸ“š ë³¸ë¬¸

ì°¸ê³ : [JVM ë°‘ë°”ë‹¥ê¹Œì§€ íŒŒí—¤ì¹˜ê¸°](https://jaeseo0519.tistory.com/467?category=1260842#2.%20Java%20Heap%20Overflow-1)
ì°¸ê³ : [Dev Uni ë¸”ë¡œê·¸](https://jae-yoon.tistory.com/17)

### Parameter

**parameter** ëŠ” ë©”ì„œë“œ ì„ ì–¸ë¶€ì— ì •ì˜ëœ ë³€ìˆ˜ì´ë©°, ê·¸ ë§¤ê°œ ë³€ìˆ˜ ë‚´ì˜ ê°’ì„ argument ë¼ê³  í•œë‹¤.

#### Pass-by-value

ëª¨ë“  ë§¤ê°œë³€ìˆ˜ ì „ë‹¬ ì‹œ ê°’ì— ì˜í•œ ì „ë‹¬ ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤. ë§¤ê°œì²´ì— ë”°ë¼ ë‘ ê°€ì§€ ì „ë‹¬ ìœ í˜•ì´ ìˆëŠ”ë°

1. **Primitive type** ì„ ì „ë‹¬í•  ë•Œì—ëŠ” ê°’ ìì²´ê°€ ë³µì‚¬ë˜ì–´ ë©”ì„œë“œë¡œ ì „ë‹¬í•˜ë©°, ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ ë³€ê²½í•´ë„ ì›ë³¸ì— ì˜í–¥ì´ ì—†ë‹¤.

2. **Reference type** ì„ ì „ë‹¬í•  ë•Œì—ëŠ” ì£¼ì†Œê°€ ë³µì‚¬ë˜ì–´ ì „ë‹¬ë˜ë¯€ë¡œ ê°ì²´ ë‚´ë¶€ ìƒíƒœëŠ” ìˆ˜ì • ê°€ëŠ¥í•˜ë©°, ì°¸ì¡° ìì²´ë¥¼ ë‹¤ë¥´ê²Œ ë°”ê¾¸ë©´ ì›ë³¸ì—ëŠ” ì˜í–¥ì´ ì—†ê²Œ ëœë‹¤.

#### ê°€ë³€ ê¸¸ì´ ë§¤ê°œë³€ìˆ˜ ë°›ê¸°

ìë°”ì—ì„œ ë©”ì„œë“œì˜ íŒŒë¼ë¯¸í„°ì—ëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ ê°€ë³€ê¸¸ì´ë¡œ ë°›ì„ ìˆ˜ ìˆë„ë¡ ... ê¸°ëŠ¥ì„ ë„£ì–´ì£¼ì…¨ëŠ”ë°, ë‹¤ìŒ ê·œì¹™ì„ ë”°ë¼ì•¼ í•œë‹¤:

- String... args í˜•íƒœë¡œ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ String Array ì™€ ë™ì¼í•˜ì—¬ ì»´íŒŒì¼ëŸ¬ê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤€ë‹¤.
- í•œ ë©”ì„œë“œì—ì„œ ê°€ë³€ ë§¤ê°œë³€ìˆ˜ëŠ” ë§¤ê°œë³€ìˆ˜ë“¤ ë§¨ ë’¤ì— ì„ ì–¸í•´ì£¼ì–´ì•¼ í•œë‹¤.
- í•œ ë©”ì„œë“œì—ì„œ ê°€ë³€ ë§¤ê°œë³€ìˆ˜ëŠ” ì˜¤ë¡œì§€ í•˜ë‚˜ë§Œ ê°€ëŠ¥í•˜ë‹¤.
- null ê°’ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ `NPE` ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•´ì£¼ì–´ì•¼ í•œë‹¤.
- ì„±ëŠ¥ì„ ê³ ë ¤í•˜ì—¬ ë¹ˆë²ˆí•œ í˜¸ì¶œ ì‹œ ì„±ëŠ¥ì— ë¶€ë‹´ì„ ì¤„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê°€ê¸‰ì  primitive ë³€ìˆ˜ë¥¼ ë„˜ê²¨ì£¼ëŠ”ê²Œ ì¢‹ë‹¤.
- ë§Œì•½ ê°™ì€ íƒ€ì…ì˜ ê°€ë³€ ê¸¸ì´ ë©”ì„œë“œì™€ ê·¸ëƒ¥ ì—¬ëŸ¬ ê°œ ë§¤ê°œë³€ìˆ˜ ë°›ëŠ” ë©”ì„œë“œê°€ ìˆë‹¤ë©´, ê°œìˆ˜ì— ë”°ë¼ ì—¬ëŸ¬ ê°œ ë§¤ê°œë³€ìˆ˜ë¥¼ ìš°ì„ ìœ¼ë¡œ í•œë‹¤.

> ì´ˆë³´ìëŠ” `ê°€ë³€ ê¸¸ì´ ë§¤ê°œë³€ìˆ˜`ë¥¼ ì“°ì§€ ë§ì. [] ë¡œë„ ì¶©ë¶„íˆ ì¸ìë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

### Static

`static` ì€ íŠ¹ë³„í•œ í‚¤ì›Œë“œì´ë‹¤. **ì •ì **ì˜ ì˜ë¯¸ë¥¼ ê°€ì§€ë©°, ì •ì  ì´ë¼ëŠ” ì†Œë¦¬ëŠ” ë™ì ê³¼ëŠ” ë°˜ëŒ€ë˜ëŠ” ì˜ë¯¸ì´ë‹¤. ë™ì ì´ë¼ëŠ” ê²ƒì€ ì›€ì§ì´ëŠ”, ë³€í•˜ëŠ”ì˜ ì˜ë¯¸ë¥¼ ê°€ì§„ë‹¤. ì •ì ì€ ê·¸ ë©”ëª¨ë¦¬ ê·¸ëŒ€ë¡œ ë³€í•˜ì§€ ì•ŠëŠ” ì´ë¼ëŠ” ì˜ë¯¸ë¥¼ ê°€ì§„ë‹¤ ë°”ë€” ìˆ˜ ìˆì§€ë§Œ ê°€ë¥´í‚¤ëŠ” ê³³ì€ ë³€í™”í•˜ì§€ ì•ŠëŠ”ë‹¤.

ë”°ë¼ì„œ ì •ì ì´ë¼ëŠ” ê²ƒì€ ë™ì ê³¼ëŠ” ë‹¤ë¥´ê²Œ ë³€í•˜ì§€ ì•Šì„ ê²ƒì´ë©°, í•­ìƒ ë©”ëª¨ë¦¬ì—ì„œ ìœ ì¼í•˜ê²Œ í•˜ë‚˜ë¡œ ì¡´ì¬í•  ê²ƒì´ë‹¤. ê·¸ê²ƒì´ **JVM ì´ loading ë  ë•Œì˜ ê·¸ ì„¸ìƒì— í•˜ë‚˜ ë©”ëª¨ë¦¬ì— í•˜ë‚˜ì˜ ì˜ë¯¸ë¥¼ ì§€ë‹ˆê²Œ** ë  ê²ƒì´ë‹¤.

> ë” ê¹Šì´ìˆê²Œ ë‚˜ì•„ê°€ìë©´, static ë³€ìˆ˜ ì •ì˜ ì •ë³´ê°€ Method Areaì— ì˜¬ë¼ê°€ë©°, JVM ì´ ì˜¬ë¼ê°€ê³  ë‚˜ì„œ Heap ì— ë¡œë”©ëœë‹¤.

#### Static Field

í•„ë“œëŠ” í´ë˜ìŠ¤ê°€ ê°€ì§€ëŠ” ë³€ìˆ˜ì´ë‹¤. ì´ ë³€ìˆ˜ê°€ ìœ ì¼í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤.

ì´ëŸ° ë³€ìˆ˜ë“¤ì€ `class` ê°€ `public` í•˜ê³  `field` ê°€ `public static` ì´ë©´ ë‹¤ë¥¸ ê°ì²´ê°€ ë³€ê²½ì„ í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

ì´ë¯¸ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ì™€ì ¸ ìˆëŠ” ì´ `static` í‚¤ì›Œë“œê°€ ë¶™ì€ field ê°’ì„ êµ³ì´ `instance initializing` ì„ í•˜ì§€ ì•Šì•„ë„ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.

```java
public class C { public static final int N = 42; }
// C.N ì ‘ê·¼ ê°€ëŠ¥
```

> ì£¼ì˜! ê³µìœ  ìƒíƒœì´ê¸° ë•Œë¬¸ì— `volatile` / `Atomic` / `Lock` ìœ¼ë¡œ ê°€ì‹œì„±, ì›ìì„± ë³´ì¥ì´ í•„ìš”í•˜ë‹¤.

#### Static Method

ì´ ë˜í•œ ë§ˆì°¬ê°€ì§€ì´ë‹¤. `static` ì´ ë¶™ì—ˆê¸°ì— ë©”ëª¨ë¦¬ì— ë¯¸ë¦¬ ì˜¬ë¼ì™€ ìˆìœ¼ë©°, êµ³ì´ instance ë¥¼ ì„ ì–¸í•´ì£¼ì§€ ì•Šì•„ë„ ìœ í‹¸ ê¸°ëŠ¥ì„ ê°€ì§€ëŠ” í•¨ìˆ˜ë“¤ì„ ì´ë ‡ê²Œ ì •ì˜í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

ë‹¤ë§Œ `extends` í•  ë•Œë¥¼ ë³´ì. ì´ë•ŒëŠ” ì˜¤ë²„ë¼ì´ë”©ì„ í•˜ë©´ ì„ ì–¸ëœ ë³€ìˆ˜ì˜ íƒ€ì…ì— ë§ì¶°ì„œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤. ì´í•´ê°€ ì•ˆë˜ë©´ ë°‘ì„ ë³´ì.

```java
class P { static void hi(){ System.out.println("P"); } }
class C extends P { static void hi(){ System.out.println("C"); } }

P p = new C();
p.hi();      // ì»´íŒŒì¼íƒ€ì„ íƒ€ì… P ê¸°ì¤€ìœ¼ë¡œ "P" ì¶œë ¥
C.hi();      // "C"
```

> ì¦‰, ì˜¤ë²„ë¼ì´ë”©ì´ ì•„ë‹Œ `ë©”ì„œë“œ ìˆ¨ê¹€(hiding)` ì´ ì¼ì–´ë‚˜ê²Œ ëœë‹¤. ì´ ë˜í•œ ê³µìœ ì´ê¸° ë•Œë¬¸ì— ë§Œì•½ í•´ë‹¹ ê°ì²´ì˜ ë°ì´í„°ë¥¼ ìˆ˜ì •í•œë‹¤, ì‚­ì œí•œë‹¤ ë“±ì˜ ë³€ê²½ ì‚¬í•­ì´ ì¼ì–´ë‚  ë•Œ `synchronized static` ì„ ë¶™ì—¬ì¤˜ì•¼ í•œë‹¤.


#### static ì´ˆê¸°í™” ë¸”ë¡

í´ë˜ìŠ¤ **ì´ˆê¸°í™” ì‹œì— ë”± í•œ ë²ˆ**ë§Œ ì‹œí–‰í•œë‹¤(JVM ì´ ì˜¬ë¼ê°ˆ ë•Œ ë§í•˜ëŠ” ê²ƒ).

í´ë˜ìŠ¤ì— ëŒ€í•´ ë”± í•œ ë²ˆ ì‹¤í–‰í•˜ê³  ì‹¶ì€ ì½”ë“œê°€ ìˆë‹¤ë©´ ì´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì´ ì½”ë“œ ìŠ¤ì½”í”„ì—ì„œ ë˜ì ¸ì§€ëŠ” ì˜ˆì™¸ëŠ” `ExceptionalInInitializerError` ë¡œ ë˜í•‘ë˜ì–´ ë˜ì ¸ì§€ë©°, ì´ ì´í›„ì— í´ë˜ìŠ¤ë¥¼ ë‹¤ì‹œ ì“°ë©´ `NoClassDefFoundError` ê°€ ì¼ì–´ë‚˜ê²Œ ëœë‹¤. ì´ ìƒí™©ì„ ë§Œë“¤ì–´ë³´ì.

```java
class Bed {
    static {
        if (true) {
            throw new RuntimeException("boom");
        }
    }
}
```

í´ë˜ìŠ¤ëŠ” ë¬´ì¡°ê±´ `Exception` ì„ ë„ìš´ë‹¤. ì´ë•Œ JVM ì´ `Bed` í´ë˜ìŠ¤ë¥¼ ì²˜ìŒ ë¡œë“œ & ì´ˆê¸°í™”ë¥¼ í•  ë•Œ `static` ë¸”ë¡ì´ ì‹¤í–‰ë˜ëŠ”ë°,

```java
public class Main{
    public static void main(String[] args) {
        Bed bed = new Bed(); // Exception ë°œìƒ
    }
}
```

ì—¬ê¸°ì„œ ì²˜ìŒ `ExceptionInIntializerError` ê°€ ë°œìƒë˜ë©° ì´ëŠ” ì´ˆê¸°í™”ê°€ ì œëŒ€ë¡œ ìˆ˜í–‰ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ì†Œë¦¬ê°€ ëœë‹¤. ë‹¹ì—°íˆ `Exception` ì´ ë°œìƒí•˜ì—¬ íŠ¸ë©ì„ ë°œìƒì‹œí‚¤ë©´ ì œì–´ê¶Œì„ OSê°€ ê°€ì ¸ê°€ê²Œ ë˜ê³ , ì´ëŠ” ëª…ë ¹ì„ ê·¸ë•Œë¶€í„° ë”ì´ìƒ ìˆ˜í–‰í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

ì´ì œ ì´ í´ë˜ìŠ¤ëŠ” ì´ˆê¸°í™” ì‹¤íŒ¨í•œ í´ë˜ìŠ¤ë¡œ JVMì— í‘œì‹œë˜ì–´ ìˆê³ , ì´ë¥¼ `new Bed()` ë¥¼ í•˜ê±°ë‚˜ `Bed.(static ë©”ì„œë“œ)()` ë¥¼ í•˜ë©´ `ExceptionInInitializerError` ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.

```java
public class Main{
    public static void main(String[] args) {
        Bed bed = new Bed(); // Exception ë°œìƒ
    }
}
```

#### Nested Class

`Nested(ì¤‘ë³µ)` í´ë˜ìŠ¤ëŠ” í´ë˜ìŠ¤ ì•ˆì— í´ë˜ìŠ¤ë¥¼ ë„£ëŠ” ì„¤ê³„ì´ë‹¤. ë³´í†µì€ ë‘ ì¢…ë¥˜ê°€ ìˆë‹¤(í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì„ ì–¸í•˜ëŠ” class ë„ ìˆìŒ):

- `static` í‚¤ì›Œë“œê°€ ë¶™ì€ `Static Nested Class`

- `Inner Class(static ì—†ìŒ)`

##### Static Nested Class

`static` í‚¤ì›Œë“œê°€ ë¶™ì€ ì¤‘ì²© í´ë˜ìŠ¤ì´ë©°, ë°”ê¹¥ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ ë©¤ë²„ì—ëŠ” ì ‘ê·¼ì´ ë¶ˆê°€í•œ í˜•íƒœì´ë‹¤. ë°”ê¹¥ í´ë˜ìŠ¤ì˜ `static` ë©¤ë²„ì—ëŠ” ëŒ€ì‹  ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.

ì´ê²ƒ ë˜í•œ JVM ì„ ì‹¬ë„ ìˆê²Œ ì•ˆë‹¤ë©´ ë°”ë¡œ ì•Œ ìˆ˜ ìˆëŠ” ë‚´ìš©ì¸ë° `static` ìì²´ëŠ” JVM ì´ ì˜¬ë¼ê°€ê³  ë‚˜ì„œ ì¸ìŠ¤í„´ìŠ¤ ë° ë³€ìˆ˜ê°€ `Heap` ì˜ì—­ì— ë¡œë“œ, ìœ„ì¹˜í•˜ê²Œ ëœë‹¤.

**ë”°ë¼ì„œ `Static Nested Class` ëŠ” ë°”ê¹¥ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì— ì¢…ì†ëœê²Œ ì•„ë‹ˆë‹¤.** static ìœ¼ë¡œ ë˜ì–´ì§„ ë³€ìˆ˜ë‚˜ í•¨ìˆ˜ê°€ ì–´ë–»ê²Œ ê°’ì´ ë“¤ì–´ê°€ê²Œ ë˜ëŠ”ì§€ëŠ” ë‚˜ì¤‘ì— ë‚˜ì˜¨ë‹¤.

ì–´ì¨‹ë“  ë°”ê¹¥ í´ë˜ìŠ¤ì˜ ê°ì²´ ìƒíƒœ(`this`)ì™€ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì—(initializing ì„ ì•ˆí•˜ì—¬ë„ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì—), ë°”ê¹¥ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ í•„ë“œì— ì ‘ê·¼í•  ìˆ˜ ì—†ê³  ì˜¤ì§ ì •ì  ë©¤ë²„ë§Œ ì°¸ì¡° ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤(ì•„ì§ ì´ˆê¸°í™”í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸). <- ì´ê±°ëŠ” `public static void main` ì—ì„œ `static` ì´ ì•„ë‹Œ method ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œë„ ë§ˆì°¬ê°€ì§€ë¡œ ì—ëŸ¬ê°€ ëœ¸ì„ ë³¼ ìˆ˜ ìˆëŠ” ê²ƒê³¼ ë™ì¼í•œ ì›ë¦¬ë‹¤.

ë§Œì•½ `Static Nested Class` ê°€ ì„¤ê³„ëœ `.class` íŒŒì¼ì„ `javac` ë¡œ ì»´íŒŒì¼ í•˜ê²Œ ë˜ë©´ `Outer$StaticNestedClass.class` ì™€ ê°™ì€ ë³„ë„ì˜ í´ë˜ìŠ¤ íŒŒì¼ì´ ìƒì„±ë¨ì„ ë³¼ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤(ì¤‘ìš”).

ë˜í•œ ì´ë•Œ `GC` ê°€ ì´ `Static Nested Class` ì— ëŒ€í•´ì„œë„ ì´ë¯¸ ì»´íŒŒì¼ëœ íŒŒì¼ ìì²´ê°€ ë…ë¦½ì ìœ¼ë¡œ ë˜ì—ˆê¸° ë•Œë¬¸ì— ì´ëŠ” ë°”ê¹¥ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì˜ ìƒëª…ì£¼ê¸°ì™€ ì–½íˆì§€ ì•Šê³  ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒìœ¼ë¡œ ìœ ì¶”í•´ë³¼ ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ë‹¤ìŒ íŠ¹ì§•ìœ¼ë¡œ ì •ë¦¬í•´ë³¼ ìˆ˜ ìˆê² ë‹¤:
- Memory Independence
- ì—­í• ê³¼ ì±…ì„ì˜ ë¶„ë¦¬

##### Inner Class

`static` í‚¤ì›Œë“œê°€ ì—†ë‹¤. ì´ëŠ” ë°”ê¹¥ í´ë˜ìŠ¤ì˜ ëª¨ë“  ë©¤ë²„ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ë©°, ëŒ€ì‹  ë°”ê¹¥ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë°˜ë“œì‹œ ì¡´ì¬í•  ë•Œ ì´ ë˜í•œ ë¹„ë¡œì†Œ ì ‘ê·¼ì„ í•  ìˆ˜ ìˆì„ í„°ì´ë‹¤.

> ìš°ì„  ì´ˆê¸°í™”ë¥¼ í•´ì•¼ ë©”ëª¨ë¦¬ì— ì ì¬ê°€ ë˜ê¸° ë•Œë¬¸

í•˜ì§€ë§Œ ì´ `Inner Class` ëŠ” ë§ì´ ì‚¬ìš©í•˜ì§€ëŠ” ì•ŠëŠ”ë°, ìˆ¨ì€ ì°¸ì¡°ê°€ ë°œìƒí•˜ì—¬ ë°”ê¹¥ í´ë˜ìŠ¤ë¥¼ ì•”ë¬µì ìœ¼ë¡œ ì°¸ì¡°í•˜ì—¬ `GC` ê°€ `Outer` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìˆ˜ê±°í•´ê°ˆ ìˆ˜ ì—†ëŠ” ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ì§„ì§œ ê·¸ í´ë˜ìŠ¤ì™€ ì˜ë¯¸ë¡ ì ìœ¼ë¡œ ê°•í•œ ì—°ê´€(`Node` ì™€ `List` ê°„ì˜ ê´€ê³„)ì´ ìˆëŠ”ê²Œ ì•„ë‹Œ ì´ìƒ êµ³ì´ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

##### ìµëª… Nested Class

ê·¸ë•Œ ë”± í•œ ë²ˆë§Œ ì‚¬ìš©í•  ê²½ìš° ìœ ìš©í•˜ë‹¤. ê·¸ê²ƒì„ ì œì™¸í•˜ê³ ëŠ” X

```java
// 4. ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ (anonymous inner class)
public void createAnonymousClass() {
    // ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” ìµëª… í´ë˜ìŠ¤
    Runnable runnable = new Runnable() {
        @Override
        public void run() {
            System.out.println("ìµëª… í´ë˜ìŠ¤ ì‹¤í–‰");
        }
    };

    // Java 8+ ëŒë‹¤ í‘œí˜„ì‹ìœ¼ë¡œ ëŒ€ì²´ ê°€ëŠ¥
    Runnable lambdaRunnable = () -> System.out.println("ëŒë‹¤ ì‹¤í–‰");
}
```

### â­ï¸ JVM ì˜ ë©”ëª¨ë¦¬ ê³µê°„

![JVM7-8-Memory]({{ site.baseurl }}/assets/img/JVM7-8-Memory.png)

ë” ê¹Šì´ ìˆê²Œ ë“¤ì–´ê°€ë³´ì. JVM ì€ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•  ë•Œ OS ìœ„ì—ì„œ ìë°” í”„ë¡œì„¸ìŠ¤ë§Œì˜ ë©”ëª¨ë¦¬ ê³µê°„ì„ ë”°ë¡œ í™•ë³´í•´ì„œ ìš´ì˜í•œë‹¤.

> ë§ˆí¬ ì„œë²„ë¥¼ ìš´ì˜í•´ë³´ë©´ ì•Œ ìˆ˜ ìˆë‹¤.

ì´ í• ë‹¹ëœ JVM ì˜ ë©”ëª¨ë¦¬ êµ¬ì¡°ëŠ” ë‹¤ìŒ ì˜ì—­ìœ¼ë¡œ ë‹¤ì‹œ êµ¬ë¶„ë˜ê²Œ ë˜ëŠ”ë°:

- Runtime ê°ì²´
    - JVM ë¨¸ì‹ 
        - ClassLoader
        - Runtime Data Areas(JVM Memory Areas)
            - Method Area(Static Area)
                - Runtime Constant Pool
            - Heap Area
            - Thread
                - PC Register
                - Stack Area
                - Native Method Stack

#### Method Area

í´ë˜ìŠ¤ ë¡œë”© ì •ë³´(`ClassLoader` ê°€ ì½ì–´ë“¤ì¸ ë°”ì´íŠ¸ ì½”ë“œ) ë“¤ì„ ì—¬ê¸° ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ê²Œ ëœë‹¤. ëª¨ë“  ìŠ¤ë ˆë“œê°€ ë‹¤ìŒì„ ê³µìœ í•˜ê²Œ ëœë‹¤.

**ì €ì¥ ìš”ì†Œ**

- **Runtime Constant Pool**: Java Compiler ì— ì˜í•´ ë§Œë“¤ì–´ì§€ëŠ” `Symbol Table` ì„ ì‚¬ìš©í•˜ì—¬ í´ë˜ìŠ¤ë‚˜ ì¸í„°í˜ì´ìŠ¤ ë³„ `Constant Pool` ì„ ë§Œë“¤ê³ , ë§Œë“¤ì–´ì§€ëŠ” ìƒìˆ˜í’€ì€ ì•„ë˜ ìš”ì†Œë“¤ì„ ê°€ì§„ë‹¤. ì´ëŸ° ìƒìˆ˜ í’€ì´ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ê°ˆ ë•Œ ë¹„ë¡œì†Œ `Runtime Constant Pool` ì´ë¼ê³  í•œë‹¤.
    - **Literal Constant**: String literal ì´ë‚˜ ìˆ«ì ë¦¬í„°ëŸ´ ë“±ë“±
    - **Type Field(Local Variable, Class Variable)**: í•„ë“œì— ì„ ì–¸ëœ ë³€ìˆ˜ íƒ€ì…ë“¤
    - Class ë° Method ë¡œì˜ ëª¨ë“  **Symbolic Reference**: ê°€ì ¸ì˜¨ í´ë˜ìŠ¤ë‚˜ ë©”ì„œë“œ ë“¤ì˜ ì°¸ì¡°ë¥¼ ë§í•œë‹¤.

> Java 7 ê¹Œì§€ëŠ” PermGen ì´ë¼ëŠ” ëª…ì¹­ì´ì—ˆë‹¤.

##### ì—­ì–´ì…ˆë¸”ëŸ¬ë¥¼ í†µí•œ class íŒŒì¼ ì‚´í´ë³´ê¸°

ìœ„ Constant Pool ì„ ë³´ê¸° ìœ„í•´ ì»´íŒŒì¼ ëœ `Main.class` ë¥¼ ë‹¤ì‹œ ì—­ì–´ì…ˆë¸”ëŸ¬(javap) ë¥¼ í†µí•´ ì‚´í´ë³¼ ìˆ˜ ìˆë‹¤.

```java
javap -v Main.class
```

í•„ìëŠ” ë‹¤ìŒì„ ì»´íŒŒì¼ í›„ ì—­ì–´ì…ˆë¸”ëŸ¬ë¥¼ í†µí•´ ì–»ì—ˆë‹¤.

```java

public class Main {
    static final int staticFinalInt = 100;
    static final String staticFinalString = "HELLO";

    int notStaticInt = 999;
    String notStaticString = "Bye";

    public static void main(String[] args) {
        String str = "new";
        int i = 100;

        System.out.println(staticFinalInt);

        System.out.println(staticFinalString);

        System.out.println("HELLO");

        System.out.println(i);

        System.out.println(str);
    }
}
```

##### í—¤ë” ë¶€ë¶„ í•´ì„
```
...
  Compiled from "Main.java"


public class Main
  minor version: 0
  major version: 65
  flags: (0x0021) ACC_PUBLIC, ACC_SUPER
  this_class: #8                          // Main
  super_class: #2                         // java/lang/Object
  interfaces: 0, fields: 4, methods: 2, attributes: 1
```

ë§¨ ìœ„ëŠ” ë¯¼ê°í•œ ì •ë³´ê°™ì•„ ê°€ë ¸ë‹¤. êµ¬ë¶„ì´ ì˜ë˜ë„ë¡ ì¤„ë°”ê¿ˆì„ ì¢€ í–ˆë‹¤.

ë§¨ ìœ„ì˜ `public class Main` ì´ í—¤ë” ë¶€ë¶„ì´ë‹¤. í•´ì„í•˜ìë©´ public ì ‘ê·¼ì œì–´ìë¥¼ ê°€ì§„ Main í´ë˜ìŠ¤ë¥¼ ëª…ì‹œí•˜ê³ , `major 65` ëŠ” JDK 21ì—ì„œ ì»´íŒŒì¼ ëœ class íŒŒì¼ì´ë¼ëŠ” ëœ»ì´ë‹¤. ì¦‰ ì»´íŒŒì¼ ì»´í¬ë„ŒíŠ¸ì˜ ë²„ì „ì„ ì•”ì‹œí•˜ëŠ” ë“¯í•˜ë‹¤. `flags` ëŠ” ì ‘ê·¼ì— ëŒ€í•œ í”Œë˜ê·¸ì´ë©°, `ACC_PUBLIC` ì„ í†µí•´ public í´ë˜ìŠ¤ì„ì„ ë‚˜íƒ€ë‚´ë©°, `ACC_SUPER` ë¥¼ í†µí•´ `invokespecial` ëª…ë ¹ì–´ ë™ì‘ì„ ìµœì‹  ë°©ì‹(ìƒìœ„ ë©”ì„œë“œ í˜¸ì¶œ ì‹œ ì˜¬ë°”ë¥¸ ë©”ì„œë“œ ì„ íƒ) ì„ ë”°ë¥´ê²Œ í•œë‹¤.

- `this_class: #8 // Main` : `Constant Pool` ì—ì„œì˜ #8 í•­ëª©ì´ í˜„ì¬ Main í´ë˜ìŠ¤ë¥¼ ê°€ë¥´í‚¤ëŠ” ê²ƒì„ ëª…ì‹œ
- `super_class: #2 // java/lang/Object` : ìƒìœ„ í´ë˜ìŠ¤ê°€ `java.lang.Object` ì„ì„ ì˜ë¯¸
- `interfaces: 0` : êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ ê°œìˆ˜ëŠ” 0ê°œ
- `field: 4`: í´ë˜ìŠ¤ì— ì„ ì–¸ëœ í•„ë“œ(ë³€ìˆ˜) ê°œìˆ˜ê°€ ì´ 4ê°œ, ì´ë¥¼ í†µí•´ static ë„ í¬í•¨ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
- `methods: 2`: í´ë˜ìŠ¤ì— ì„ ì–¸ëœ ë©”ì„œë“œ ê°œìˆ˜ì´ë©°, ìƒì„±ì + main ë©”ì„œë“œ ë¡œ ì´ 2ê°œì´ë‹¤.
- `attriubtes: 1`: ì´ê²Œ ì¤‘ìš”í•œ ìš”ì†Œì¸ë°, í´ë˜ìŠ¤ íŒŒì¼ ìˆ˜ì¤€ì—ì„œ ì¶”ê°€ëœ ì†ì„±(attribute)ì˜ ê°œìˆ˜ì´ë‹¤. `SourceFile` ì†ì„±ì´ ì¼ë°˜ì ìœ¼ë¡œ ë“¤ì–´ê°€ë©° ì–´ë–¤ ì†ŒìŠ¤ íŒŒì¼ì—ì„œ ì»´íŒŒì¼ ëœ ê²ƒì¸ì§€ ë“±ì„ ë‚˜íƒ€ë‚¸ë‹¤.


##### Attributes êµ¬ì„±ìš”ì†Œ

attribute ë¥¼ ë³´ì. í´ë˜ìŠ¤ íŒŒì¼ì€ ê¸°ë³¸ êµ¬ì¡°ê°€ ë‹¤ìŒê³¼ ê°™ë‹¤(ìˆœì„œëŠ” ì‹ ê²½ ì•ˆì¼ë‹¤).

- `magic number`
- `version`
- `constant pool`
- `access flags`
- `this_class` / `super_class`
- `interface`
- `fields`
- `methods`
- `attributes`

ì´ë•Œ `attributes` ëŠ” ì¶”ê°€ ì„¤ëª…ì„œ ì—­í• ì„ í•œë‹¤. í´ë˜ìŠ¤, í•„ë“œ, ë©”ì„œë“œ ëª¨ë‘ì— ë¶™ì„ ìˆ˜ ìˆê³ , JVM ì‚¬ì–‘ì— ê¸°ë³¸ì ìœ¼ë¡œ ì •ì˜ëœ ê²ƒë„ ìˆê³  ì»´íŒŒì¼ëŸ¬ê°€ ìë™ìœ¼ë¡œ ë¶™ì—¬ì£¼ëŠ” ê²ƒë„ ìˆë‹¤. JVM ì´ ì‹¤í–‰ì„ í•˜ëŠ”ë° ìˆì–´ì„œ ê¼­ í•„ìš”í•œ ê±°ëŠ” ì•„ë‹ˆì§€ë§Œ ë©”íƒ€ë°ì´í„°ë¡œì„œ ì¡´ì¬í•œë‹¤.

ì´ëŸ¬í•œ ë©”íƒ€ë°ì´í„°ëŠ”

1. JVM ëŸ°íƒ€ì„
2. ê°œë°œ ë„êµ¬(Compiler, Debugger, IDE, java.lang.reflect ë“±)

ì—ê²Œ ì œê³µë˜ê²Œ ëœë‹¤.

ìœ„ êµ¬ì„±ìš”ì†Œë“¤ì„ ë¶„ë¥˜í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

**í´ë˜ìŠ¤ ìˆ˜ì¤€ì—ì„œì˜ Attribute**

- `SourceFile`: ì–´ë–¤ .java ì†ŒìŠ¤ íŒŒì¼ì—ì„œ ì»´íŒŒì¼ë˜ì—ˆëŠ”ì§€
- `InnerClasses`: ë‚´ë¶€ í´ë˜ìŠ¤ ì •ë³´ë“¤
- `BootstrapMethods`: `Lambda`, `invokedynamic`

> ìœ„ ì˜ˆì œ ì½”ë“œì—ì„œëŠ” ì•ˆë³´ì´ì§€ë§Œ ì—­ì–´ì…ˆë¸”ëŸ¬ ëœ íŒŒì¼ì˜ ë§¨ ì•„ë˜ ì¤„ì— SourceFile: "Main.java" ë¼ëŠ” ì¤„ì´ ë“¤ì–´ê°€ ìˆê³ , ì´ëŠ” `SourceFile` í•œ ê°œ(`Main.java`) ê°€ ì»´íŒŒì¼ ëìœ¼ë¯€ë¡œ 1ì´ë¼ëŠ” ê°’ì´ ë“¤ì–´ê°€ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

**ë©”ì„œë“œ ìˆ˜ì¤€ì—ì„œì˜ Attribute**

- `Code`: ì‹¤ì œ ë°”ì´íŠ¸ ì½”ë“œ ëª…ë ¹ì–´
- `LineNumberTable`: ë°”ì´íŠ¸ ì½”ë“œ, ì†ŒìŠ¤ì½”ë“œ ì¤„ ë²ˆí˜¸ ë§¤í•‘(ë””ë²„ê¹… ìš©)
- `LocalVariableTable`: ì§€ì—­ ë³€ìˆ˜ ì´ë¦„ê³¼ ìŠ¬ë¡¯ ë§¤í•‘ ì •ë³´(ë””ë²„ê¹… ìš©)

**í•„ë“œ ìˆ˜ì¤€ì—ì„œì˜ Attribute**

- `ConstantValue`: ìƒìˆ˜ í’€ì— ê³ ì •ëœ ê°’ ì €ì¥

##### Constant Pool í•´ì„

```
Constant pool:
   #1 = Methodref          #2.#3          // java/lang/Object."<init>":()V
   #2 = Class              #4             // java/lang/Object
   #3 = NameAndType        #5:#6          // "<init>":()V
   #4 = Utf8               java/lang/Object
   #5 = Utf8               <init>
   #6 = Utf8               ()V
   #7 = Fieldref           #8.#9          // Main.notStaticInt:I
   #8 = Class              #10            // Main
   #9 = NameAndType        #11:#12        // notStaticInt:I
  #10 = Utf8               Main
  #11 = Utf8               notStaticInt
  #12 = Utf8               I
  #13 = String             #14            // Bye
  #14 = Utf8               Bye
  #15 = Fieldref           #8.#16         // Main.notStaticString:Ljava/lang/String;
  #16 = NameAndType        #17:#18        // notStaticString:Ljava/lang/String;
  #17 = Utf8               notStaticString
  #18 = Utf8               Ljava/lang/String;
  #19 = String             #20            // new
  #20 = Utf8               new
  #21 = Fieldref           #22.#23        // java/lang/System.out:Ljava/io/PrintStream;
  #22 = Class              #24            // java/lang/System
  #23 = NameAndType        #25:#26        // out:Ljava/io/PrintStream;
  #24 = Utf8               java/lang/System
  #25 = Utf8               out
  #26 = Utf8               Ljava/io/PrintStream;
  #27 = Methodref          #28.#29        // java/io/PrintStream.println:(I)V
  #28 = Class              #30            // java/io/PrintStream
  #29 = NameAndType        #31:#32        // println:(I)V
  #30 = Utf8               java/io/PrintStream
  #31 = Utf8               println
  #32 = Utf8               (I)V
  #33 = String             #34            // HELLO
  #34 = Utf8               HELLO
  #35 = Methodref          #28.#36        // java/io/PrintStream.println:(Ljava/lang/String;)V
  #36 = NameAndType        #31:#37        // println:(Ljava/lang/String;)V
  #37 = Utf8               (Ljava/lang/String;)V
  #38 = Utf8               staticFinalInt
  #39 = Utf8               ConstantValue
  #40 = Integer            100
  #41 = Utf8               staticFinalString
  #42 = Utf8               Code
  #43 = Utf8               LineNumberTable
  #44 = Utf8               main
  #45 = Utf8               ([Ljava/lang/String;)V
  #46 = Utf8               SourceFile
  #47 = Utf8               Main.java
```

**í•´ì„**

1. #1 = Methodref: ë©”ì„œë“œ ì°¸ì¡°ì´ë©° ì°¸ì¡° ëŒ€ìƒì€ #2.#3(#2 í´ë˜ìŠ¤ì˜ #3 ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜)

> java/lang/Object.<init>()V  
> Object í´ë˜ìŠ¤ì˜ ê¸°ë³¸ ìƒì„±ì í˜¸ì¶œ

2. #2 = Class: í´ë˜ìŠ¤ ì°¸ì¡°ì´ë©° #4 ë¥¼ ì°¸ì¡°í•˜ê³  ìˆìŒ. #4ëŠ” ë¬¸ìì—´ java/lang/Object ì„

> "java/lang/Object" ë¥¼ ê°€ë¥´í‚¤ëŠ” ì¤‘

3. #3 = NameAndType: ì´ë¦„ê³¼ íƒ€ì… ë¬¶ìŒì„ ë§í•˜ê³  #5:#6 ì„ ì°¸ì¡° ì¤‘ì´ë‹¤.

> "<init>":()V ë¥¼ í†µí•´ ë³´ë©´ ì´ë¦„ì€ <init>, íƒ€ì…ì€ ()V ì´ê³  ì´ íƒ€ì…ì˜ ì˜ë¯¸ëŠ” íŒŒë¼ë¯¸í„°ê°€ ì—†ê³ , void ë¥¼ ë°˜í™˜í•œë‹¤ëŠ” ëœ»ì´ë‹¤.

4. #4 = Utf8    java/lang/Object
5. #5 = Utf8    <init>
6. #6 = Utf8    ()V

Utf8 ë¬¸ìì—´ ìƒìˆ˜ë“¤ì„ ë§í•œë‹¤.

7. #7 = Fieldref    #8.#9   // Main.notStaticInt:I
8. #8 = Class       #10     // Main
9. #9 = NameAndType #11:#12 // notStaticInt:I

ìœ„ 7-9 ëŠ” ìš°ë¦¬ê°€ ì„ ì–¸í•œ `notStaticInt` ë¼ëŠ” ë³€ìˆ˜ëª…ì´ int ë¼ëŠ” íƒ€ì…ì„ ê°€ì§„ë‹¤ëŠ” ê²ƒì„ ë©”íƒ€ë°ì´í„°ë¡œ ì•Œë ¤ì£¼ê³  ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤.

ë‚˜ë¨¸ì§€ëŠ” ìœ ì‚¬í•˜ê¸°ì— ë„˜ì–´ê°„ë‹¤. ì´ì²˜ëŸ¼ ëª¨ë“  ë³€ìˆ˜ì™€ ë©”ì„œë“œ í˜¸ì¶œê³¼ í´ë˜ìŠ¤ ëª…ë“¤ì„ ì°¸ì¡° í˜¹ì€ String ìƒìˆ˜ë¥¼ ì €ì¥í•˜ê³  ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤.

##### í´ë˜ìŠ¤ì˜ í•„ë“œ ì •ì˜ í•´ì„

```java
{
  static final int staticFinalInt;
    descriptor: I
    flags: (0x0018) ACC_STATIC, ACC_FINAL
    ConstantValue: int 100

  static final java.lang.String staticFinalString;
    descriptor: Ljava/lang/String;
    flags: (0x0018) ACC_STATIC, ACC_FINAL
    ConstantValue: String HELLO

  int notStaticInt;
    descriptor: I
    flags: (0x0000)

  java.lang.String notStaticString;
    descriptor: Ljava/lang/String;
    flags: (0x0000)
```

í•˜ë‚˜ë§Œ ê°€ì§€ê³  ì™€ë³´ì.

**í´ë˜ìŠ¤ ë³€ìˆ˜**
```java
  static final int staticFinalInt;
    descriptor: I
    flags: (0x0018) ACC_STATIC, ACC_FINAL
    ConstantValue: int 100
```
ìœ„ëŠ” `static final int StaticFinalInt` ê°€ ì„ ì–¸í•œ ê²ƒì— ëŒ€í•œ ë©”íƒ€ë°ì´í„° ë“¤ì´ ì €ì¥ë˜ì–´ ìˆë‹¤.

- `descriptor: I` ëŠ” int íƒ€ì…ì„ ëœ»í•˜ë©°,
- `ACC_STATIC`, `ACC_FINAL` ì€ í”Œë˜ê·¸ë¡œ í•´ë‹¹ ë³€ìˆ˜ëŠ” `static` ê³¼ `final` ë ˆë²¨ì˜ access ê°€ ê°€ëŠ¥í•˜ë‹¤.
- `ConstantValue: int 100` ì»´íŒŒì¼ ì‹œì ì— ìƒìˆ˜ í’€ì— ë°•íŒ ê°’ì´ë‹¤.

**í´ë˜ìŠ¤**
```java
  static final java.lang.String staticFinalString;
    descriptor: Ljava/lang/String;
    flags: (0x0018) ACC_STATIC, ACC_FINAL
    ConstantValue: String HELLO
```

primitive ì™€ëŠ” ë‹¤ë¥´ê²Œ Lì´ ë¶™ì—¬ì ¸ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤.

**ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜**
```java
  int notStaticInt;
    descriptor: I
    flags: (0x0000)
```

ìƒëµ

##### ìƒì„±ì ë° ë©”ì„œë“œ ë°”ì´íŠ¸ì½”ë“œ ë¶€ë¶„ í•´ì„

```java
  public Main();
    descriptor: ()V
    flags: (0x0001) ACC_PUBLIC
    Code:
      stack=2, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: sipush        999
         8: putfield      #7                  // Field notStaticInt:I
        11: aload_0
        12: ldc           #13                 // String Bye
        14: putfield      #15                 // Field notStaticString:Ljava/lang/String;
        17: return
      LineNumberTable:
        line 2: 0
        line 6: 4
        line 7: 11
```

ì—¬ê¸°ì„œ

```java
  public Main();
    descriptor: ()V
    flags: (0x0001) ACC_PUBLIC
```

ì˜ ë¶€ë¶„ì€ í•„ë“œ ì •ì˜ì™€ ë˜‘ê°™ìŒì„ ì•Œ ìˆ˜ ìˆë‹¤. ì¦‰, í´ë˜ìŠ¤/ì¸ìŠ¤í„´ìŠ¤ ë©¤ë²„ ë³€ìˆ˜ë“¤ì€ ë™ì‘í•˜ëŠ” ê²ƒì´ ì—†ê¸°ì— ê·¸ë¦¬ ê¸¸ì§€ ì•Šë‹¤. í•˜ì§€ë§Œ í•¨ìˆ˜ì— ìˆì–´ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ Code ë¸”ëŸ­ì´ ìˆë‹¤.

```java
    Code:
      stack=2, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: sipush        999
         8: putfield      #7                  // Field notStaticInt:I
        11: aload_0
        12: ldc           #13                 // String Bye
        14: putfield      #15                 // Field notStaticString:Ljava/lang/String;
        17: return
```

- `stack=2`: ì´ ë©”ì„œë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” JVM ìŠ¤íƒì˜ ìµœëŒ€ ê¹Šì´ = 2
- `locals=1`: ë¡œì»¬ ë³€ìˆ˜ ìŠ¬ë¡¯ ê°œìˆ˜ = 1 (`this` ë§Œ ìˆìŒ)
- `args_size=1`: ì¸ì ê°œìˆ˜ = 1 (`this`)

ê·¸ ì´í›„ëŠ” í•¨ìˆ˜í˜• ì–¸ì–´ë¡œ ì–´ì…ˆë¸”ë¦¬ì–´ì™€ ìœ ì‚¬í•œ í˜•íƒœë¡œ í˜ëŸ¬ê°€ê²Œ ëœë‹¤. ì´ëŠ” JVM ì´ ì‹¤í–‰í•˜ëŠ” ê°€ìƒ ì–´ì…ˆë¸”ë¦¬ ê°™ì€ ê²ƒì´ë‹¤.

##### LineNumberTable í•´ì„

```java
      LineNumberTable:
        line 2: 0
        line 6: 4
        line 7: 11
}
```

ìë°” ë°”ì´íŠ¸ ì½”ë“œëŠ” ì¤„ ë²ˆí˜¸ë¼ëŠ” ê°œë…ì´ ì—†ê¸°ì— ì†ŒìŠ¤ì½”ë“œ ëª‡ ë²ˆì§¸ ì¤„ì´ í•„ìš”í•˜ë‹¤ ë¼ê³  ê°€ì •í•˜ë©´, ë²ˆí˜¸ê°€ í•„ìš”í•˜ê²Œ ëœë‹¤. ì´ë•Œ ì»´íŒŒì¼ëŸ¬ê°€ `LineNumberTable` `Attribute` ë¥¼ ë„£ì–´ì„œ ë°”ì´íŠ¸ì½”ë“œì™€ ì›ë˜ ìë°” ì†ŒìŠ¤ì½”ë“œì˜ ì¤„ ë²ˆí˜¸ë¥¼ ë§¤í•‘ì‹œì¼œì£¼ëŠ” ë©”íƒ€ë°ì´í„°ì´ë‹¤.

##### ê²°ë¡ 

Compile ìƒíƒœì—ì„œì˜ `Constant Pool` ì„ ë´¤ì„ ê²ƒì´ë‹¤. ì´ `Constant Pool` ì´ ì´ì œ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ê°€ê²Œ ëœë‹¤ë©´ `Method Area` ì— `Runtime Constant Pool` ê°œë…ìœ¼ë¡œ ë°”ë€Œê²Œ ëœë‹¤.

ì´ ë§ì€ í´ë˜ìŠ¤ íŒŒì¼ í•˜ë‚˜í•˜ë‚˜ ì¦‰ ì¸í„°í˜ì´ìŠ¤, í´ë˜ìŠ¤ ë“¤ ê°ê°ì´ `Constant Pool` ì„ ê°€ì§€ë©°,  
ìì‹ ì˜ í´ë˜ìŠ¤ ë‚´ë¶€ì— ì„ ì–¸ë˜ì–´ ìˆëŠ” ì†ŒìŠ¤ ì½”ë“œì— ê´€ì—¬í•˜ëŠ” ëª¨ë“  í´ë˜ìŠ¤, í•„ë“œì™€ ì‹¬ë³¼ë¦­ ë§í¬ ë“±ì´ ëª¨ë‘ ì €ì¥ë˜ì–´ ìˆë‹¤.  
ì—¬ê¸°ì„œëŠ” `Constant Pool` ë§Œì´ `Method Area` ë¡œ ì˜¬ë¼ê° ì„ ë³´ì•˜ë‹¤.

#### Heap

Heap ë„ Method Area ì™€ ê³µí†µëœ íŠ¹ì§•ìœ¼ë¡œ ëª¨ë“  ìŠ¤ë ˆë“œê°€ ê³µìœ í•˜ëŠ” ì˜ì—­ì´ë©°  
JVM ì´ ì‹¤í–‰ë˜ê³  ìƒì„±ë˜ëŠ” ê³µê°„ì´ë©° ì €ì¥ ìš”ì†ŒëŠ” Runtime ì— ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤, ê°ì²´(object)ë¥¼ ì €ì¥í•œë‹¤.

ì´ë•Œ Heap ì˜ì—­ì€ ê°ì²´ê°€ ìƒì„±ë˜ê³  ì‚­ì œë˜ëŠ” ê³µê°„ì´ë©° ì´ëŠ” GC ê°€ ì´ë¥¼ ê´€ë¦¬í•œë‹¤.

**ì €ì¥ ìš”ì†Œ**
- `static` object
- `String`
- `String Constant Pool`

![heap-string-pool]({{ site.baseurl }}/assets/img/heap-string-pool.png)

ìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ String ë“¤ì€ ì „ë¶€ `String Pool` ì— ì €ì¥ë¨ì„ ë³¼ ìˆ˜ ìˆë‹¤. "Cat", "Dog" ë“±ë“±ì´ ì €ì¥ë˜ê³ , s1, s2 ì˜ ë³€ìˆ˜ëŠ” ì°¸ì¡°ì— ëŒ€í•œ ì •ë³´ëŠ” `Meta Area` ì— ìˆê³ , ì°¸ì¡°ê°€ ê°€ë¥´í‚¤ëŠ” ê³³ì´ String ì´ ìˆëŠ” ê³³ì´ ëœë‹¤.

ì—¬ê¸°ì„œ Intern String ì´ë¼ëŠ” ê°œë…ì´ ë‚˜ì˜¤ëŠ”ë°, String Constant Pool ì— ë¦¬í„°ëŸ´ String ì´ ìˆë‹¤ë©´, ê·¸ ë¦¬í„°ëŸ´ String ì„ ë‹¤ì‹œ ë§Œë“¤ê¸° ë³´ë‹¤ String Constant Pool ì—ì„œ ì°¸ì¡°í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ë©”ëª¨ë¦¬ ì–‘ì„ ìµœì í™”í•˜ê³  ìˆë‹¤. ì´ë ‡ê²Œ Constant Pool ì— í•˜ë‚˜ë§Œ ì €ì¥í•˜ì—¬ì„œ í• ë‹¹í•˜ëŠ” ê²ƒì„ `intern` ì´ë¼ê³  í•˜ê³  interned ëœ String ì„ Interned String ì´ë¼ê³  í•œë‹¤(ì‹¤ì œë¡œ String ìª½ì— intern ë©”ì„œë“œê°€ ìˆë‹¤).

ë‹¤ì‹œ ì •ë¦¬í•˜ìë©´,

byte code ì—ì„œì˜ constant pool ì´ class loader ì— ì˜í•´ linking ì´ ë  ë•Œ ì—¬ê¸°ì„œ heap ì˜ì—­ì— string constant pool ì´ ìƒì„±ë˜ê³ , method area ì˜ì—­ì— runtime constant pool ì´ ìƒì„±ë˜ê²Œ ëœë‹¤.  
ë¦¬í„°ëŸ´ë¡œ ì„ ì–¸í•œ ì• ë“¤ì€ ì „ë¶€ string constant pool ì— ì˜í•´ ì €ì¥ë˜ì–´ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬ë˜ê²Œ ë˜ì§€ë§Œ new String() ìœ¼ë¡œ ìƒì„±í•œ ë¬¸ìì—´ì€ heap ìœ¼ë¡œ ë”°ë¡œ ì €ì¥ë˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ë©°, ì´ëŠ” new String() ìì²´ê°€ í•¨ìˆ˜ì´ê³  ìƒì„±ìì´ê¸° ë•Œë¬¸ì— ëª…ì‹œì ìœ¼ë¡œ ìƒì„±ìë¥¼ ì§€ì •í•´ì£¼ëŠ” ê²ƒì´ ìƒˆë¡œìš´ ì˜ì—­ì— ìƒˆë¡œìš´ ê°’ì„ í• ë‹¹í•˜ëŠ” ë™ì  í• ë‹¹ì˜ ê°œë…ê³¼ ê°™ìœ¼ë¯€ë¡œ string constant pool ë¡œì˜ ì •ì  í• ë‹¹ê³¼ëŠ” ë‹¤ë¥´ê²Œ string constant pool ì˜ì—­ì€ ì•„ë‹ˆì§€ë§Œ heap ì˜ì—­ì— ì €ì¥ë˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

```java
   /**
     * Returns a canonical representation for the string object.
     * <p>
     * A pool of strings, initially empty, is maintained privately by the
     * class {@code String}.
     * <p>
     * When the intern method is invoked, if the pool already contains a
     * string equal to this {@code String} object as determined by
     * the {@link #equals(Object)} method, then the string from the pool is
     * returned. Otherwise, this {@code String} object is added to the
     * pool and a reference to this {@code String} object is returned.
     * <p>
     * It follows that for any two strings {@code s} and {@code t},
     * {@code s.intern() == t.intern()} is {@code true}
     * if and only if {@code s.equals(t)} is {@code true}.
     * <p>
     * All literal strings and string-valued constant expressions are
     * interned. String literals are defined in section {@jls 3.10.5} of the
     * <cite>The Java Language Specification</cite>.
     *
     * @return  a string that has the same contents as this string, but is
     *          guaranteed to be from a pool of unique strings.
     */
    public native String intern();
```

JDK21 ì˜ ë¬¸ì„œë¥¼ ê°€ì ¸ì™”ë‹¤. ì´ë•Œ native ë¡œ ì„ ì–¸ë¨ì„ ë³¼ ìˆ˜ ìˆëŠ”ë° intern ë©”ì„œë“œëŠ” Native Stack Area ì— ìƒì„±ë¨ì„ ë³¼ ìˆ˜ ìˆë‹¤. ì¦‰ ì´ëŠ” ìš´ì˜ì²´ì œê°€ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê²Œ ë§Œë“ ë‹¤.

ì´ëŸ° íŠ¹ì§• ë•Œë¬¸ì— `String` ì€ + ì—°ì‚°ì´ ë©”ëª¨ë¦¬ ì ìœ¼ë¡œ ì•ˆì¢‹ë‹¤. `Heap` ì˜ì—­ì— ê³„ì†í•´ì„œ ìƒˆë¡œìš´ ê°ì²´ë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì— ì•ˆì¢‹ìœ¼ë©° GC ê°€ ê´€ë¦¬í•´ì•¼ í•  ëŒ€ìƒì´ ëŠ˜ì–´ë‚˜ê²Œ ëœë‹¤.

- `String`: ë¬¸ìì—´ ì—°ì‚° ìì²´ê°€ ì ê³  ë©€í‹°ìŠ¤ë ˆë“œì¼ ê²½ìš°
- `StringBuffer`: ë¬¸ìì—´ ì—°ì‚°ì´ ë§ê³  ë©€í‹°ìŠ¤ë ˆë“œì˜ ê²½ìš°
- `StringBuilder`: ë¬¸ìì—´ ì—°ì‚°ì´ ë§ê³  ë‹¨ì¼ìŠ¤ë ˆë“œì´ë©° ë™ê¸°í™”ë¥¼ ê³ ë ¤í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ê²½ìš°

ì™ ë§Œí•´ì„œëŠ” `StringBuffer` ë¥¼ ì“°ì.

> Uni Dev ì°¸ê³  : Intern String ê°ì²´ë“  Static ê°ì²´ë“  ë©”ì„œë“œ ì˜ì—­ì— ìˆë‚˜ í™ ì˜ì—­ì— ìˆë‚˜ëŠ” ê·¸ë ‡ê²Œ ì¤‘ìš”í•œ ì‚¬ì‹¤ì´ ì•„ë‹ˆë‹¤. ì–´ë””ì— ìˆë“  ìŠ¤ë ˆë“œê°€ ê³µìœ í•˜ëŠ” ìì›ì´ê³  ì—¬ëŸ¬ ê°œ ìƒì„±ë˜ì§€ ì•Šê³  í•˜ë‚˜ë§Œ ìƒì„±ë˜ê³  ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ì´ë¥¼ ì°¸ì¡°í•œë‹¤ëŠ” ì‚¬ì‹¤ì´ ì¤‘ìš”í•˜ë‹¤.

### Heap ì—ì„œì˜ GC

Heap ì—ì„œ GC ê°€ í™œë°œí•˜ê²Œ í™œë™í•˜ëŠ”ë° ê·¸ ë²”ìœ„ëŠ” java ëŠ” ì‹¤í–‰í•  ë•Œ í• ë‹¹í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ì˜ì—­ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©° ì´ ì˜ì—­ì€ Heap Area ë¥¼ ì§€ì •í•˜ëŠ” ì˜µì…˜ì´ë‹¤.

```java
-Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError
```

> -Xms, -Xmx ëŠ” JVM ê°€ìš© í™ í¬ê¸°  
-XX ëŠ” ì‹¤í—˜ì /ê³ ê¸‰ ì˜µì…˜ì„ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©(GC ë°©ì‹, JIT ì»´íŒŒì¼ëŸ¬, ë‚´ë¶€ ë™ì‘ ë“±)  
ë©”ëª¨ë¦¬ê°€ overflow ëì„ ë•Œ JVMì´ ì˜ˆì™¸ ë°œìƒ ì‹œì ì˜ í™ ë©”ëª¨ë¦¬ snapshot ì„ íŒŒì¼ëŸ¬ ì €ì¥(dump)í•´ì£¼ëŠ” ì˜µì…˜

```sh
-XX:+UseG1GC      # G1 GC ì‚¬ìš©
-XX:-UseG1GC      # G1 GC ì‚¬ìš© ì•ˆí•¨
-XX:MaxMetaspaceSize=256m   # Metaspace ìµœëŒ€ í¬ê¸°
-XX:NewRatio=2              # New/Old ë¹„ìœ¨
-XX:SurvivorRatio=8         # Survivor/Eden ë¹„ìœ¨
```

ë°˜ë“œì‹œ ì“°ì´ì§€ ì•ŠëŠ” ê²ƒì€ `null` ë¡œ ë°”ê¾¸ì–´ í•´ì œì‹œì¼œì£¼ì.

##### Heap Area ì˜ Generational Collection Theory

ì•„ì§ ì´ë¥¼ ê³µë¶€í•˜ê¸°ì—ëŠ” êµ³ì´ ì¸ ëŠë‚Œì´ ìˆì§€ë§Œ, ì ì–´ë†“ê³  ë‚˜ì¤‘ì— ë‹¤ì‹œ ë³´ë ¤ê³  í•œë‹¤. ì˜›ë‚  ì´ë¡ ì´ë¼ ì§€ê¸ˆì´ë‘ ë˜ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤.

í†µê³„í•™ì ìœ¼ë¡œ ë‹¤ìŒì´ ë°í˜€ì¡Œë‹¤:
- ëŒ€ë¶€ë¶„ ê°ì²´ëŠ” ì–¼ë§ˆ ì§€ë‚˜ì§€ ì•Šì•„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤
- ì˜¤ë˜ëœ ê°ì²´ì—ì„œ ì Šì€ ê°ì²´ë¡œì˜ ì°¸ì¡°ëŠ” ì•„ì£¼ ì ê²Œ ì¡´ì¬í•œë‹¤.

ë©”ëª¨ë¦¬ íšŒìˆ˜ ê´€ì ì—ì„œ GCë“¤ì´ ì´ê±¸ ì°¸ì¡°í•œë‹¤ê³  í•œë‹¤.

ì´ ì´ë¡ ì— ë”°ë¥´ë©´ heap ì„ ë‹¤ìŒê³¼ ê°™ì´ ë©”ëª¨ë¦¬ ì˜ì—­ì„ êµ¬ë¶„í•œë‹¤:

- ì‹ ì„¸ëŒ€(new generation)
    - ì—ë´ ì˜ì—­(Eden): ê°€ì¥ ì²˜ìŒ ê°ì²´ê°€ ë©”ëª¨ë¦¬ì— í• ë‹¹ë˜ëŠ” ê³µê°„, GC ê°€ 1íšŒ ìˆ˜í–‰ í›„ì—ëŠ” Survivor ì˜ì—­ ì¤‘ í•˜ë‚˜ë¡œ ì´ë™
    - ìƒì¡´ì ì˜ì—­: from, to ë‘ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ë‰˜ë©°, ë‘˜ ì¤‘ í•˜ë‚˜ëŠ” ë°˜ë“œì‹œ ë¹„ì–´ìˆë‹¤.  ì—¬ëŸ¬ ë²ˆ ìƒì¡´ì— ì„±ê³µ ì‹œ êµ¬ì„¸ëŒ€ë¡œ ìŠ¹ê²©í•œë‹¤.


- êµ¬ì„¸ëŒ€(old generation)
    - ì‹ ì„¸ëŒ€ì—ì„œ ì˜¤ë˜ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ì˜ ì •ë³´ê°€ ë³µì‚¬ë˜ì–´ ìˆëŠ” ê³µê°„ì„  
    GCëŠ” ì ê²Œ ë°œìƒí•˜ê³ , ì‹ ì„¸ëŒ€ì— ë¹„í•´ í° ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹ë°›ê²Œ ëœë‹¤.
    - `Card Table`: êµ¬ì„¸ëŒ€ì—ì„œ ì‹ ì„¸ëŒ€ ì˜ì—­ìœ¼ë¡œì˜ ì°¸ì¡° í…Œì´ë¸”ì„ ë§í•˜ë©°, 512 bytes chunk ë¡œ êµ¬ì„±ëœë‹¤ê³  í•œë‹¤(ì˜›ë‚  ì •ë³´)


- ì˜êµ¬ì„¸ëŒ€(permanent generation)
    - ê³ ì • ë©”ëª¨ë¦¬ í¬ê¸° ê³µê°„ì´ë©° -XX ì˜µì…˜ìœ¼ë¡œ ì§€ì •í•œë‹¤.
    - ìœ„ ì„¸ëŒ€ ì˜ì—­ë“¤ê³¼ ì•„ë¬´ëŸ° ê´€ë ¨ì´ ì—†ìœ¼ë©°, GC ê°€ ë°œìƒ ì—¬ë¶€ë„ ë…ë¦½ì ì´ë‹¤.

PermGen ì´ ì´ ì˜ì—­ì´ë©°, ì´ ì´ë¡ ì„ í† ëŒ€ë¡œ ì„¤ê³„ë¥¼ í–ˆì§€ë§Œ ì§€ê¸ˆì€ ì‚­ì œí•˜ê³  ì—†ìŒì„ ë³¼ ìˆ˜ ìˆë‹¤.

#### Thread

ìš°ë¦¬ê°€ ìš´ì˜ì²´ì œì—ì„œ ìƒê°í•˜ëŠ” ê·¸ ìŠ¤ë ˆë“œ ë§ë‹¤.

##### Stack

ê° ìŠ¤ë ˆë“œ ë§ˆë‹¤ ë…ë¦½ì ìœ¼ë¡œ ì¡´ì¬í•˜ëŠ” ë©”ëª¨ë¦¬ ì˜ì—­ì´ë©°, ê° ìŠ¤ë ˆë“œ ë§ˆë‹¤ í•˜ë‚˜ì”© ì¡´ì¬í•œë‹¤.

- ë©”ì„œë“œ í˜¸ì¶œ ì‹œë§ˆë‹¤ `Stack Frame`(ê°€ìƒ ë©”ëª¨ë¦¬ ê³µê°„ì—ì„œì˜ í”„ë¡œì„¸ìŠ¤ í•˜ë‚˜ ë‹¹ ê¸°ë³¸ ë‹¨ìœ„ì™€ ìœ ì‚¬í•œ ê°œë…) ì´ ìŒ“ì„
- {`Local Variable Array`, `Operand Stack`, í˜„ì¬ ë©”ì„œë“œì˜ `Constant Pool` ì°¸ì¡° ë“±ë“±}ìœ¼ë¡œ êµ¬ì„±
    - `Local Variable Array`: 0ë¶€í„° ì‹œì‘í•˜ëŠ” ì¸ë±ìŠ¤ë¥¼ ê°€ì§€ëŠ” ë°°ì—´  
    0: this, 1ë¶€í„°ëŠ” ì „ë‹¬ëœ íŒŒë¼ë¯¸í„°ë“¤, ê·¸ ì´í›„ ë©”ì„œë“œ ì§€ì—­ ë³€ìˆ˜ë“¤ ì €ì¥
    - `Operand Stack`: ë©”ì„œë“œ í•˜ë‚˜í•˜ë‚˜ ìˆ˜í–‰ë˜ëŠ” ê³µê°„
    - `Reference to Constant Pool`: í•„ìš”í•œ ë°ì´í„° ë° ê²°ê³¼ë¥¼ ì €ì¥í•¨
- ë©”ì„œë“œ ì¢…ë£Œ ì‹œ `Stack Frame` ì„ì´ ì œê±°ë¨
- ì°¸ì¡°ë¥¼ í•  ë•Œ ë™ì  `linking` ì„ í•¨

##### PC Register

ê° ìŠ¤ë ˆë“œ ë§ˆë‹¤ í•˜ë‚˜ì”© ì¡´ì¬(ì—¬ê¸°ì„œ ì£¼ì˜í•  ì ì€ ì‹¤ì œ í•˜ë“œì›¨ì–´ PCë¥¼ ë§í•˜ëŠ”ê²Œ ì•„ë‹ˆë‹¤... ê·¸ëƒ¥ SWì˜ ì¶”ìƒí™”ëœ í˜•íƒœë¡œ PCë¥¼ ì œê³µí•œë‹¤ Java ê°€ ë…ë¦½ì ì¸ ì´ìœ ì— í•œ ëª« í•˜ëŠ” ë³€ìˆ˜ì´ë‹¤)

- í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ JVM ëª…ë ¹ì–´ì˜ ì£¼ì†Œë¥¼ ì €ì¥
- ìŠ¤ë ˆë“œ ì „í™˜ ì‹œ, ë‹¤ì‹œ ëŒì•„ì™”ì„ ë•Œ ì‹¤í–‰ ìœ„ì¹˜ë¥¼ ìƒì§€ ì•Šë„ë¡ í•¨

##### Native Method Stack
Java ê°€ ì•„ë‹Œ ë„¤ì´í‹°ë¸Œ(C, C+) ì½”ë“œ ë“±ì˜ **JNI(Java Native Interface)** í˜¸ì¶œ ì„ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ìŠ¤íƒ

- ì¼ë°˜ ìë°” ìŠ¤íƒê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, ë„¤ì´í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìœ„í•œ ê³µê°„ì„
- ex. `System.arraycopy()`, `Object.hashCode()`, `Object.clone()` ë“±ë“± ë„¤ì´í‹°ë¸Œë¡œ êµ¬í˜„ë¨
- ì™œ ìˆëƒ? ëª¨ë“  ê¸°ëŠ¥ì„ ìë°”ë¡œ êµ¬í˜„í•˜ê¸°ëŠ” í˜ë“¦. OS/HWì˜ ë°€ì ‘í•˜ê²Œ ì˜ì¡´í•´ì•¼ í•  ë•ŒëŠ” ë” `low-level` ì˜ ì–¸ì–´ê°€ í•„ìš”í•¨. ì´ë•Œ C, C++ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ì–¸ì–´ ìì²´ê°€ ë‹¬ë¼ì„œ ì´ë¥¼ í˜¸í™˜ì‹œí‚¤ë„ë¡ í•˜ëŠ”ê²Œ **JNI**

> `JNI` ë¥¼ ì“¸ ë•ŒëŠ” ê·¸ë˜ì„œ ê·¸ëƒ¥ `Stack` ì´ ì•„ë‹Œ `Native Method Stack` ì´ ì‚¬ìš©ëœë‹¤. ì´ëŠ” C í•¨ìˆ˜ì˜ í˜¸ì¶œ ì²˜ëŸ¼ ë™ì‘í•˜ê²Œ ë¨. ë„¤ì´í‹°ë¸Œ ì½”ë“œ ì‹¤í–‰ì€ GC ì˜ ê´€ë¦¬ì˜ì—­ ë°–ì´ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì— ì£¼ì˜í•´ì•¼ í•˜ë©°, ë³´ì•ˆ ê²€ì‚¬ ë“±ë„ ìœ ì˜í•´ì•¼ í•œë‹¤... ê¼­ í•„ìš”í•œ ê²½ìš°ë§Œ ì‚¬ìš©í•˜ì.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Method Area        â”‚ â† í´ë˜ìŠ¤ ë¡œë”© ì •ë³´, Runtime Constant Pool
â”‚        (Metaspace)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Heap            â”‚ â† ê°ì²´ ì €ì¥, GC ëŒ€ìƒ, String Constant Pool, static objects
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      PC Register (T)      â”‚ â† ê° ìŠ¤ë ˆë“œë³„ í˜„ì¬ ì‹¤í–‰ ì£¼ì†Œ
â”‚        Java Stack (T)     â”‚ â† ê° ìŠ¤ë ˆë“œë³„ ë©”ì„œë“œ ì‹¤í–‰
â”‚  Native Method Stack (T)  â”‚ â† ê° ìŠ¤ë ˆë“œë³„ ë„¤ì´í‹°ë¸Œ ì½”ë“œ ì‹¤í–‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

![jvm-memory]({{ site.baseurl }}/assets/img/jvm-memory.png)

ë©”ëª¨ë¦¬ ê³µê°„ì˜ êµ¬ì¡° íŒŒì•…ì€ ëë‚¬ê³  í´ë˜ìŠ¤ê°€ ì–´ë–»ê²Œ ë¡œë”©ë˜ëŠ”ì§€ ë³´ì.

### ClassLoader

ì´ì œ JVM ì˜ ë©”ëª¨ë¦¬ ê°œë…ì„ ì´í•´í–ˆë‹¤ë©´ `ClassLoader` ë¥¼ ì´í•´í•  ìˆ˜ ìˆê²Œ ë˜ëŠ”ë°, ì´ë¦„ ê·¸ëŒ€ë¡œ ìë°”ì—ì„œ `.class` ë°”ì´íŠ¸ ì½”ë“œë¥¼ JVM ë©”ëª¨ë¦¬ì— ì ì¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

ì‹¤í–‰ ì‹œì ì—ì„œ **ë™ì ìœ¼ë¡œ í´ë˜ìŠ¤ ë¡œë”©**ì„ í•˜ê¸° ë•Œë¬¸ì— ìë°”ëŠ” í•œ ë²ˆ ì»´íŒŒì¼ì„ í•˜ë©´ ì–´ë””ì„œë“  ì‹¤í–‰ëœë‹¤ëŠ” íŠ¹ì§•ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

#### Loading

í´ë˜ìŠ¤ ë¡œë”©ì€ í´ë˜ìŠ¤ë¥¼ ë¡œë“œí•˜ë¼ëŠ” ìš”ì²­ì´ ì™”ì„ ë•Œ Loading ê³¼ì •ì´ ì‹¤í–‰ëœë‹¤. ì£¼ëœ ì‘ì—…ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- `.class` íŒŒì¼ë“¤ JVM ì— ì ì¬
- `ClassLoader` ê°€ íŒŒì¼ ì½ìŒ

í´ë˜ìŠ¤ ë¡œë” ì£¼ë¡œ 3ê°€ì§€ê°€ ìˆê³ , ê°ê°ì˜ ìˆ˜í–‰ ì²˜ë¦¬ ìˆœì„œëŠ” `Bootstrap ClassLoader` -> `Platform ClassLoader` -> `Application ClassLoader` ìˆœìœ¼ë¡œ ì§„í–‰ë˜ë©°

1. System
2. Platform
3. BootStrap

ìˆœìœ¼ë¡œ í´ë˜ìŠ¤ì˜ ë©”ëª¨ë¦¬ ì ì¬ë¥¼ ìš”ì²­í•˜ê²Œ ë˜ê³ (`getClassLoader()`), 

1. BootStrap
2. Platform
3. System

ìˆœìœ¼ë¡œ class ë¥¼ ë¡œë”©í•´ì£¼ê²Œ ëœë‹¤. JVM ì´ ByteCode ë¥¼ í† ëŒ€ë¡œ í´ë˜ìŠ¤, ì¸í„°í˜ì´ìŠ¤ë¥¼ ì°¾ê³  ì´ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì„ ì§„í–‰í•œë‹¤.

ìœ„ ìˆœì„œë¡œ ì§„í–‰ë˜ëŠ” ì´ìœ ëŠ” ì¶©ëŒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œì´ë‹¤.

##### Bootstrap ClassLoader

JVM ìì²´ì— ë‚´ì¥ë˜ì–´ ìˆê³ , `JAVA_HOME/lib` ì•ˆì˜ í•µì‹¬ í´ë˜ìŠ¤(`java.lang.*`, `java.util.*`) ë¡œë”©

ì œì¼ ë¨¼ì € ë™ì‘í•˜ê³ , í´ë˜ìŠ¤ë¡œë” ì¤‘ì— ìœ ì¼í•˜ê²Œ Native C ë¡œ êµ¬í˜„ë˜ì–´ ìˆë‹¤.

##### Platform ClassLoader

`Bootstrap` ì´ ì°¾ì§€ ëª»í•œ í´ë˜ìŠ¤ë“¤ì„ ë¡œë”©í•˜ë©°, JDK í™•ì¥ ë¼ì´ë¸ŒëŸ¬ë¦¬(`lib/ext` ë˜ëŠ” ëª¨ë“ˆ)ì„ ë¡œë“œí•œë‹¤. ì˜ˆë¥¼ë“¤ë©´ `javax.*` ê°€ ìˆê² ë‹¤(ì‚¬ì‹¤ ì˜ ëª¨ë¥¸ë‹¤ ê·¸ëŸ° ì¶”ì¸¡ì´ë‹¤. `javax` ëŠ” `java` ì—ì„œ extension ì´ ë¶™ì–´ì„œ ë‹¤ì–‘í•œ ê¸°ëŠ¥ìœ¼ë¡œ ì„œë“œ íŒŒí‹°ê°€ êµ¬í˜„í•œê²Œ ìì£¼ ì“°ì—¬ì„œ ì‹¤ì œë¡œ ê³µì‹ `java` ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ë„ ë“±ë¡ë˜ì–´ì„œ ì“°ê³  ìˆëŠ” ê²ƒìœ¼ë¡œ ì•ˆë‹¤).

> Java 8ê¹Œì§€ëŠ” Extension ClassLoader ì˜€ë‹¤.

##### System ClassLoader

`Platform ClassLoader` ê°€ ëª»ì°¾ì€ í´ë˜ìŠ¤ë§Œ ë¡œë”©í•œë‹¤. 

ìš°ë¦¬ê°€ ì„¤ê³„í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ `.class` íŒŒì¼ì´ ìµœì¢…ì ìœ¼ë¡œ ì ì¬ë˜ëŠ” ê²ƒ(ìš°ë¦¬ëŠ” êµ¬í˜„ë˜ì–´ ìˆëŠ”ê±¸ ê°€ì ¸ë‹¤ ì“°ê¸° ë•Œë¬¸ì— ê°€ì¥ ìµœí›„ì— ì„ ì–¸ë¨).

> Java 8 ê¹Œì§€ëŠ” Application ClassLoader ì˜€ë‹¤.

##### User-defined ClassLoader

ì‚¬ìš©ìê°€ ì§ì ‘ ì •ì˜í•´ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ ë¡œë”ë¡œ, `java.lang.ClassLoader` ë¡œ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

ì´ëŠ” `Spring` ì—ì„œ ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œë“¤ì„ ìì£¼ ë³¼ ìˆ˜ ìˆë‹¤.


##### í´ë˜ìŠ¤ ë¡œë”ì˜ ì›ì¹™

í´ë˜ìŠ¤ ë¡œë”ëŠ” ë‹¤ìŒì„ ë”°ë¥´ë„ë¡ ì„¤ê³„ë˜ì–´ì•¼ í•œë‹¤.

**ìœ„ì„-ìš°ì„  ëª¨ë¸**

- ìƒìœ„ í´ë˜ìŠ¤ì—ì„œ ì°¾ê³  ì‹¶ì€ í´ë˜ìŠ¤ë¥¼ ì°¾ê³ 
- ì—†ìœ¼ë©´ í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ ë‹¤ì‹œ ì°¾ëŠ” ë‹¤ì´ì–´ê·¸ë¨

> ê´€ë ¨ Exception ì€ `ClassNotFoundException` ì„ ë‚´ë±‰ëŠ”ë‹¤. ì´ëŠ” Checked Exception ì´ë‹¤.

**ê°€ì‹œì„± ì›ì¹™**

- í•˜ìœ„ í´ë˜ìŠ¤ ë¡œë”ê°€ ë¡œë”©í•œ í´ë˜ìŠ¤ëŠ” ìƒìœ„ í´ë˜ìŠ¤ ë¡œë”ê°€ ë³¼ ìˆ˜ ì—†ê³ 
- ìƒìœ„ í´ë˜ìŠ¤ ë¡œë”ê°€ ë¡œë”©í•œ í´ë˜ìŠ¤ëŠ” í•˜ìœ„ í´ë˜ìŠ¤ ë¡œë”ê°€ ë³¼ ìˆ˜ ìˆê³ 

**ìœ ì¼ì„± ì†ì„±**

> í´ë˜ìŠ¤ëŠ” ì˜¤ë¡œì§€ "í•œ ë²ˆ" ë§Œ ë¡œë“œí•œë‹¤.

ìœ ì¼ì„± ì‹ë³„ ê¸°ì¤€ì€ ìœ„ì˜ utf8 ì—ì„œ java.lang.String ê°™ì€ í´ë˜ìŠ¤ ëª…ì„ ì¼ì»«ëŠ”ë‹¤.

**Unload ë¶ˆê°€**

- í´ë˜ìŠ¤ë¡œë”ëŠ” í´ë˜ìŠ¤ë¥¼ ë¡œë”©ì€ ê°€ëŠ¥
- í´ë˜ìŠ¤ë¡œë”ëŠ” í´ë˜ìŠ¤ë¥¼ ì–¸ë¡œë”©ì€ ë¶ˆê°€

ì´ëŠ” í´ë˜ìŠ¤ ë¡œë”ê°€ ë¡œë“œí•œ í´ë˜ìŠ¤ëŠ” ë³´í†µ GC ì˜ ìˆ˜ê±°ëŒ€ìƒì´ ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë©°, ëŒ€ì‹  User-defined ClassLoader ëŠ” í´ë˜ìŠ¤ë¥¼ ë™ì ìœ¼ë¡œ ë¡œë“œí•˜ê³  ì–¸ë¡œë“œ í•  ìˆ˜ ìˆë‹¤.

#### Linking

ë¡œë”© ë‹¤ìŒ ê±°ì¹˜ëŠ” ë§í‚¹ì€ 3ë‹¨ê³„ì— ê±¸ì³ ì§„í–‰ëœë‹¤.

1. Verify: ë°”ì´íŠ¸ì½”ë“œê°€ JVM ê·œì¹™ ìœ„ë°˜í•˜ëŠ”ì§€ ì•ˆí•˜ëŠ”ì§€  
ê°€ì¥ ì‹œê°„ì´ ë§ì´ ê±¸ë¦¬ê³  ë³µì¡í•˜ë‹¤.

2. Prepare: í´ë˜ìŠ¤ê°€ í•„ìš”ë¡œ í•˜ëŠ” ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•œë‹¤.  
ì´ë•Œ `static variable`ì€ defualt ê°’ìœ¼ë¡œ ì„¤ì •  
(static variable ì„ true ë¡œ ì„¤ì •í•´ë„ default ë¡œ ì„¤ì •ë¨)

3. Resolve: **ì‹¬ë³¼ë¦­ ì°¸ì¡°** ë¥¼ **ì‹¤ì œ ì°¸ì¡°**ë¡œ ë³€í™˜

#### Initialize

- `static` ë³€ìˆ˜ì— ê°’ í• ë‹¹
- `static` ë¸”ë¡ ì‹¤í–‰
- ìµœì´ˆ í´ë˜ìŠ¤ê°€ ì‚¬ìš©ë  ë•Œ í•œ ë²ˆë§Œ ì‹¤í–‰ë¨

> ì´ ê³¼ì •ì„ ë³´ë©´ ì•Œê² ì§€ë§Œ, `static` ì´ ì—¬ê¸°ì„œ ì˜¬ë¼ê°ì„ ë³¼ ìˆ˜ ìˆë‹¤.

---

## âœ’ï¸ ìš©ì–´

###### Hotspot JVM

JVMì€ ì¶”ìƒí™”ëœ ê°œë…ì´ì§€ ì‹¤ì œ ìˆëŠ”ê±´ ì•„ë‹ˆë‹¤. ì´ êµ¬í˜„ì²´ê°€ ë°”ë¡œ Hotspot JVM ì´ë©°, JVM êµ¬í˜„ì²´ ì¤‘ í•˜ë‚˜ì´ë‹¤. ìœ„ ê·¸ë¦¼ë„ ì´ Hotspot JVMì—ì„œ ë‚˜ì˜¨ ê²ƒì´ë‹¤.