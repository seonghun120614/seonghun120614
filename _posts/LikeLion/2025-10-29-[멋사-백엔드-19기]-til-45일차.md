---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 45ì¼ì°¨ Rest API"
date:   2025-10-29 09:20:57 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Web
---

<!--more-->

## ğŸ“‚ ëª©ì°¨
- [Rest API](#rest-api)
    - [RESTì˜ ì£¼ìš” ì›ì¹™](#restì˜-ì£¼ìš”-ì›ì¹™)
    - [Rest Controller](#rest-controller)
        - [HttpMessageConverter](#httpmessageconverter)
    - [ResponseEntity](#responseentity)
        - [ResponseEntity Builder](#responseentity-builder)
        - [ResponseEntity BodyBuilder](#responseentity-bodybuilder)
        - [ResponseEntity ì‘ë‹µ ìƒì„±](#responseentity-ì‘ë‹µ-ìƒì„±)
    - [ServletUriComponentsBuilder](#servleturicomponentsbuilder)
        - [CREATE REST](#create-rest)
        - [READ REST](#read-rest)
        - [UPDATE REST](#update-rest)
        - [DELETE REST](#delete-rest)
    - [Spring HATEOAS](#spring-hateoas)

---

## ğŸ“š ë³¸ë¬¸

### Rest API

ì›¹ ì„œë¹„ìŠ¤ì˜ í•œ í˜•íƒœë¡œ **Representational State Transfer (REST)** ì•„í‚¤í…ì²˜ ìŠ¤íƒ€ì¼ì„ ë”°ë¥´ë„ë¡ êµ¬ì„±í•˜ëŠ” API ë¥¼ ì¨ì•¼ í•œë‹¤.

#### RESTì˜ ì£¼ìš” ì›ì¹™

1. **ìì›(Resource) ê¸°ë°˜ ì„¤ê³„**  
- RESTful ì„œë¹„ìŠ¤ì—ì„œ ëª¨ë“  ì½˜í…ì¸ ëŠ” **ìì›(Resource)** ìœ¼ë¡œ í‘œí˜„ëœë‹¤.  
- ê° ìì›ì€ **URI(Uniform Resource Identifier)** ë¡œ ì‹ë³„ëœë‹¤.  
- ì˜ˆì‹œ: `/api/users/1` â†’ idê°€ 1ì¸ ì‚¬ìš©ì ìì›

2. **ë¬´ìƒíƒœ(Stateless)**  
- ê° ìš”ì²­(Request)ì€ **ì„œë²„ì™€ ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬**ëœë‹¤.  
- ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìƒíƒœë¥¼ ì €ì¥í•˜ì§€ ì•Šìœ¼ë©°, ëª¨ë“  ìš”ì²­ì€ í•„ìš”í•œ ì •ë³´ë¥¼ ìŠ¤ìŠ¤ë¡œ í¬í•¨í•´ì•¼ í•œë‹¤.  
- ì´ë¥¼ í†µí•´ **ì„œë²„ ì„¤ê³„ê°€ ë‹¨ìˆœí•´ì§€ê³ **, **í™•ì¥ì„±(Scalability)** ì´ ë†’ì•„ì§„ë‹¤.

3. **í‘œì¤€ HTTP ë©”ì„œë“œ í™œìš©**  
- ìì›ì— ëŒ€í•œ CRUD ë™ì‘ì„ HTTP ë©”ì„œë“œë¡œ ëª…í™•íˆ í‘œí˜„í•œë‹¤.  
  - `GET`: ì¡°íšŒ(Read)  
  - `POST`: ìƒì„±(Create), ë©±ë“±ì„± ì„±ì§ˆ X  
  - `PUT`: ìˆ˜ì •(Update)  
  - `PATCH`: ë¶€ë¶„ ìˆ˜ì •
  - `DELETE`: ì‚­ì œ(Delete)  
- ì´ë¥¼ í†µí•´ **APIê°€ ì§ê´€ì ì´ê³  ì¼ê´€ì„± ìˆê²Œ ì„¤ê³„**ëœë‹¤.

> ë©±ë“±ì„±ì€ ë™ì¼ ìš”ì²­ì„ ë³´ë‚´ë©´ ì„œë²„ì˜ ìƒíƒœë¥¼ ë™ì¼í•˜ê²Œ ìœ ì§€í•˜ëƒì´ë‹¤.

4. **ë‹¤ì–‘í•œ í‘œí˜„(Representation)**  
- ìì›ì€ **JSON**, **XML** ë“± ë‹¤ì–‘í•œ í˜•íƒœë¡œ í‘œí˜„ë  ìˆ˜ ìˆë‹¤.  
- í´ë¼ì´ì–¸íŠ¸ì˜ `Accept` í—¤ë”ì— ë”°ë¼ ì„œë²„ëŠ” **ê°€ì¥ ì ì ˆí•œ ë°ì´í„° í˜•ì‹**ìœ¼ë¡œ ì‘ë‹µí•œë‹¤.

5. **ì—°ê²°ì„±(Connectivity) & HATEOAS**  
- ìì›ë“¤ì€ **í•˜ì´í¼ë§í¬(Hyperlink)** ë¥¼ í†µí•´ ì„œë¡œ ì—°ê²°ë  ìˆ˜ ìˆë‹¤.  
- **HATEOAS(Hypermedia As The Engine Of Application State)** ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ëŠ” API ì‘ë‹µ ë‚´ ë§í¬ë¥¼ ë”°ë¼ê°€ë©°  
  ì¶”ê°€ì ì¸ ìì›ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

#### Rest Controller

`@Controller` + `@ResponseBody` ì–´ë…¸í…Œì´ì…˜ì˜ ê²°í•©ì´ë©°, `viewname` ì„ ë°˜í™˜í•˜ëŠ” ë¶€ë¶„ì´ ë°ì´í„°(JSON/XML) ë¥¼ ì§ì ‘ ì‘ë‹µìœ¼ë¡œ ë³´ë‚´ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì˜ë¯¸í•œë‹¤.

{% highlight java %}
@RestController
@RequestMapping("/users")
public class UserController {
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        return new User(id, "í™ê¸¸ë™", "hong@example.com");
    }
}
{% endhighlight %}

ì´ì „ì— `Controller` ì–´ë…¸í…Œì´ì…˜ì€ `viewname` ì„ ë°˜í™˜í•˜ê³ , model ì— ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ëŠ” ì—­í• ì„ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” `Model` ì´ ì•ˆì“°ì´ê¸° ë•Œë¬¸ì— ì „ë‹¬í•˜ì§€ ì•Šê³  ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ `HandlerAdapter` ì— ì „ë‹¬í•œë‹¤.

##### HttpMessageConverter

ë°ì´í„°ë¥¼ ì „ë‹¬í•  ë•Œ ìœ„ì²˜ëŸ¼ ê°ì²´ë¥¼ ì „ë‹¬í•¨ì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, ìš°ì„  ë°˜í™˜ê°’ìœ¼ë¡œëŠ” ë‹¤ìŒì„ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.

- `String`
- `DTO`
- `ResponseEntity<?>`

`@RestController` ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•˜ë©´ ë·°ë¥¼ ë Œë”ë§í•˜ì§€ ì•Šê³ ,
`HttpMessageConverter` ê°€ ê·¸ ê°ì²´ë¥¼ `JSON` ë˜ëŠ” `XML` í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ HTTP ì‘ë‹µ ë³¸ë¬¸(Response Body) ì— ì§ì ‘ ê¸°ë¡í•œë‹¤.

ì¦‰, `HandlerAdapter` ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•œ ë’¤ ë°˜í™˜ê°’ì„ ì „ë‹¬í•˜ë©´, `HttpMessageConverter` ê°€ í•´ë‹¹ ê°ì²´ íƒ€ì…ê³¼ `Accept` í—¤ë”ë¥¼ ì°¸ê³ í•˜ì—¬ ì ì ˆí•œ ë³€í™˜ê¸°(`MappingJackson2HttpMessageConverter`)ë¥¼ ì„ íƒí•˜ê³  ì§ë ¬í™”(JSON ë³€í™˜)ë¥¼ ìˆ˜í–‰ í›„ ë°˜í™˜ì‹œí‚¤ê²Œ ëœë‹¤.

**ë³€í™˜ê¸° êµ¬í˜„ì²´**
- `MappingJackson2HttpMessageConverter`: JSON ë³€í™˜
- `Jaxb2RootElementHttpMessageConverter`: XML ë³€í™˜
- `StringHttpMessageConverter`: ë¬¸ìì—´ ì²˜ë¦¬

#### ResponseEntity

HTTP ì‘ë‹µì„ ê°ì²´ì˜ í˜•íƒœë¡œ ì¶”ìƒí™”í•œ í´ë˜ìŠ¤ì´ë‹¤. Spring MVC ì—ì„œ `@RestController` ë‚˜ `@Controller`(`@ResponseBody` ì–´ë…¸í…Œì´ì…˜ì„ í•¨ìˆ˜ì— ë¶™ì—¬ì•¼ í•¨) ì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•˜ë©°, HTTP ìŠ¤í™ ê¹Œì§€ ì„¸ë°€í•˜ê²Œ ì œì–´ê°€ ê°€ëŠ¥í•˜ë‹¤.

ë„£ì„ ìˆ˜ ìˆëŠ” ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤:
- Body

- Headers
    - `Content-Type`
    - `Location`
    - `Authorization`

- Status Code
    - 200
    - 201
    - 404
    - ...

ë©”ì„œë“œë“¤ì„ íŒŒí—¤ì³ ë³¸ë‹¤.

{% highlight java %}
public ResponseEntity(@Nullable T body, @Nullable MultiValueMap<String, String> headers, int rawStatus) {
    this(body, headers, HttpStatusCode.valueOf(rawStatus));
}

/**
    * Create a {@code ResponseEntity} with a body, headers, and a status code.
    * @param body the entity body
    * @param headers the entity headers
    * @param statusCode the status code
    */
public ResponseEntity(@Nullable T body, @Nullable MultiValueMap<String, String> headers, HttpStatusCode statusCode) {
    super(body, headers);
    Assert.notNull(statusCode, "HttpStatusCode must not be null");

    this.status = statusCode;
}
{% endhighlight %}

ìœ„ê°€ ì™„ì „ì²´ì˜ ìƒì„±ìì´ë‹¤. `body`, `headers`, `statusCode` ìˆœìœ¼ë¡œ ë„£ì„ ìˆ˜ ìˆìœ¼ë©°, headers ì—ëŠ” `MultiValueMap` ì´ ë“¤ì–´ê°€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. `ResponseEntity` ëŠ” ìœ„ ìƒì„±ì ì™¸ì—ë„ ì´ë¥¼ builder íŒ¨í„´ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒë„ í—ˆìš©í•œë‹¤. ë”°ë¼ì„œ ì •ì  Builder ë©”ì„œë“œë“¤ì„ ë³´ì.

##### ResponseEntity Builder

ìš°ì„  ê°€ì¥ ê¸°ë³¸ì ìœ¼ë¡œ `ResponseEntity.status()` ë¡œ ë¨¼ì € í‹€ì„ ì¡ëŠ”ë‹¤.

{% highlight java %}
public static BodyBuilder status(HttpStatusCode status) {
    Assert.notNull(status, "HttpStatusCode must not be null");
    return new DefaultBuilder(status);
}
{% endhighlight %}

ë‚´ë¶€ì ìœ¼ë¡œëŠ” ìœ„ì™€ ê°™ì´ ë˜ì–´ ìˆìœ¼ë©°, status ê°€ null ì´ë¼ë©´ ë‹¹ì—°íˆ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œëŠ” `DefaultBuilder`ë¥¼ ìƒì„±í•˜ë©´ì„œ ë¦¬í„´í•˜ê³  ìˆë‹¤. `DefaultBuilder` ëŠ” private static ì˜ nested class ë¡œ êµ¬ì„±í•˜ì—¬ì„œ ìš°ë¦¬ê°€ êµ³ì´ ë³¼ í•„ìš”ëŠ” ì—†ì§€ë§Œ, `ResponseEntity.BodyBuilder` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. ì´ë¥¼ ì ê¹ ì‚´í´ë³´ì.

##### ResponseEntity BodyBuilder

**í•„ë“œ**
- `HttpStatusCode`
- `HttpHeaders`

**ìƒì„±ì**
- `int statusCode`
- `HttpStatusCode statusCode`

**ê´€ë ¨ ë©”ì„œë“œ**

ë©”ì„œë“œëŠ” ì „ë¶€ Builder íŒ¨í„´ì´ê¸°ì— method chaining ì´ ê°€ëŠ¥í•˜ë‹¤.

{% highlight java %}
header(String name, String... values)        // ë‹¨ì¼/ë³µìˆ˜ í—¤ë” ì¶”ê°€
headers(HttpHeaders headers)                // HttpHeaders ì „ì²´ ë³µì‚¬
headers(Consumer<HttpHeaders> consumer)     // ëŒë‹¤ë¡œ í—¤ë” ì»¤ìŠ¤í„°ë§ˆì´ì§•

allow(HttpMethod... methods)        // Allow í—¤ë” ì„¤ì •
contentLength(long length)          // Content-Length
contentType(MediaType type)         // Content-Type
eTag(String tag)                    // ETag
lastModified(ZonedDateTime/Instant/long) // Last-Modified
location(URI location)              // Location í—¤ë”
cacheControl(CacheControl cache)    // Cache-Control
varyBy(String... headers)           // Vary í—¤ë”
{% endhighlight %}

ìµœì¢… ìƒì„± ResponseEntity ë¡œ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤:

{% highlight java %}
<T> ResponseEntity<T> body(T body)  // ì‹¤ì œ body í¬í•¨í•˜ì—¬ ìƒì„±
<T> ResponseEntity<T> build()       // body ì—†ì´ ResponseEntity ìƒì„±
{% endhighlight %}

ìœ„ë¥¼ í† ëŒ€ë¡œ `ResponseEntity` ëŠ” `HTTP` ìƒíƒœì½”ë“œì™€ í•¨ê»˜ `ResponseEntity` ë¥¼ ì‰½ê²Œ ìƒì„±í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

##### ResponseEntity ì‘ë‹µ ìƒì„±

**Status 200**
- `ok()`: ìƒíƒœ ì½”ë“œ `200 OK` ë¡œ `BodyBuilder` ìƒì„±
- `ok(T body)`: ìƒíƒœ ì½”ë“œ `200 OK` ì™€ `body` ë¥¼ í¬í•¨í•œ `ResponseEntity` ìƒì„±
- `of(Optional<T> body)`: `Optional` ê°’ì´ ìˆìœ¼ë©´ `200 OK` + `body`, ë¹„ì–´ìˆìœ¼ë©´ `404 Not Found`
- `ofNullable(T body)`: `null` ì´ë©´ `404 Not Found`, `null` ì´ ì•„ë‹ˆë©´ `200 OK` + `body`

**Status 201 created**

ë°˜ë“œì‹œ ìƒì„±ëœ ìì›ì˜ ìœ„ì¹˜ë¥¼ í—¤ë”ë¡œ ì•Œë ¤ì¤˜ì•¼ í•œë‹¤.

- `created(URI location)`: `201 Created` ìƒíƒœ + `Location` í—¤ë” ì„¤ì • ì£¼ë¡œ `POST` ì—ì„œ ìƒˆ ë¦¬ì†ŒìŠ¤ ìƒì„± ì‹œ ì‚¬ìš©

{% highlight java %}
URI location = ServletUriComponentsBuilder
    .fromCurrentRequest()
    .path("/{id}")
    .buildAndExpand(id)
    .toUri();

return ResponseEntity.created(location)
                    .body(memo);
{% endhighlight %}

**ê¸°íƒ€ ìƒíƒœ ì½”ë“œ ë¹Œë”**

- `accepted()` â†’ 202 Accepted
- `noContent()` â†’ 204 No Content
- `badRequest()` â†’ 400 Bad Request
- `notFound()` â†’ 404 Not Found
- `unprocessableEntity()` â†’ 422 Unprocessable Entity
- `internalServerError()` â†’ 500 Internal Server Error

ì´ì œ ìœ„ë¥¼ ì´ìš©í•˜ì—¬ CRUD ì „ë¶€ë¥¼ ë§Œë“¤ì–´ë³´ì.

#### ServletUriComponentsBuilder

`HTTP` ìš”ì²­ì„ ê¸°ë°˜ìœ¼ë¡œ URI ë¥¼ í¸ë¦¬í•˜ê²Œ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ì´ë©°, ì£¼ë¡œ REST API ì—ì„œ ìƒˆ ë¦¬ì†ŒìŠ¤ ìƒì„±(CREATED) í›„ì— `Location` í—¤ë” ì„¤ì •ì— ë§ì´ ì“°ì´ê²Œ ëœë‹¤.

**ìš”ì²­ ì„¤ì •**
- `fromCurrentRequest()`: í˜„ì¬ ìš”ì²­ URI ë¥¼ ê¸°ì¤€ìœ¼ë¡œ Builder ìƒì„±
- `fromCurrentContextPath()`: ì»¨í…ìŠ¤íŠ¸ ë£¨íŠ¸ ê¸°ì¤€
- `fromServletMapping()`: ì„œë¸”ë¦¿ ë§¤í•‘ ê¸°ì¤€

**Path ë³€ìˆ˜/ì¿¼ë¦¬ ì¶”ê°€**
- `path("/subpath")`: URI ë’¤ì— ê²½ë¡œ ì¶”ê°€
- `queryParm("page", 1)`: ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì¶”ê°€

**URI ê°ì²´ ìƒì„±**
- `buildAndExpand(Object... uriVariables)`: `{id}` ê°™ì€ Path ë³€ìˆ˜ ì¹˜í™˜
- `toUri()`: `java.net.URI` ê°ì²´ ë°˜í™˜

##### CREATE REST

201 ìƒíƒœ ì½”ë“œë¥¼ ê°€ì§€ë©°, `ResponseEntity.created()` í•¨ìˆ˜ë¡œ ê°„ë‹¨íˆ ì„¸íŒ…í•  ìˆ˜ ìˆë‹¤. ìƒíƒœì½”ë“œë§Œ ì„¸íŒ… ë˜ê¸° ë•Œë¬¸ì— `body` ì™€ `header` ëŠ” ììœ ë¡­ê²Œ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤.

{% highlight java %}
@PostMapping(consumes = "text/plain",
             produces = "application/json")
@Transactional
public ResponseEntity<Memo> createMemo(@RequestBody String content) {
    if (content.isBlank())
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).build();
    long idx = memos.size();
    var memo = memos.put(idx, new Memo(idx, content));

    URI location = ServletUriComponentsBuilder.fromCurrentRequest()
            .path("/{id}")
            .buildAndExpand("id", idx)
            .toUri();

    return ResponseEntity.created(location)
            .body(memo);
}
{% endhighlight %}

ì—¬ê¸°ì„œ `PostMapping` ì—ëŠ” ë“¤ì–´ì˜¬ `content-type` ì„ ì§€ì •í•´ì£¼ì–´ì•¼ `String` ìœ¼ë¡œ ì•Œë§ê²Œ mapping ì´ ë  ìˆ˜ ìˆê² ë‹¤. ë§Œì•½ `application/json` ìœ¼ë¡œ ë°›ìœ¼ë ¤ë©´ DTO ë¥¼ ë”°ë¡œ ì •ì˜í•´ì£¼ê³  Body ì—ëŠ” êµ¬ì¡°ì  ë°ì´í„° í˜•íƒœë¥¼ ì§€í‚¤ë©´ì„œ ìš”ì²­ì„ ë³´ë‚´ì•¼ í•œë‹¤.

> location ì„ ë„£ìŒìœ¼ë¡œì¨ self-descriptive ì„±ì§ˆì„ ì¶©ì¡±í•œë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.  
create ì—ëŠ” RESTful ì„ ìœ„í•´ ì´ë ‡ê²Œ ìê¸° ì„¤ëª…ì„ í•´ì£¼ëŠ” í—¤ë”ê°€ í•„ìš”í•˜ê³ ,  
ì´ë¥¼ í†µí•´ ìƒˆë¡œ ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ì˜ URI ê°€ ì–´ë””ìˆëŠ”ì§€ ì•Œë ¤ì£¼ì–´ì•¼ í•œë‹¤.

##### READ REST

**Mutiple READ**
{% highlight java %}
@GetMapping(produces = "application/json")
@Transactional(readOnly = true)
public ResponseEntity<List<Memo>> getMemos() {
    List<Memo> lst = Arrays.asList(memos.values().toArray(new Memo[0]));

    return ResponseEntity.ok()
            .header("Content-Type", "application/json")
            .header("X-Total-Count", String.valueOf(lst.size()))
            .body(lst);
}
{% endhighlight %}

**Single READ**
{% highlight java %}
@GetMapping(path = "/{id}",
            produces = "application/json")
@Transactional(readOnly = true)
public ResponseEntity<Memo> getMemos(@PathVariable Long id) {
    if (id == null || !memos.containsKey(id))
        return ResponseEntity.status(HttpStatus.NOT_FOUND)
                                .header("Content-Type", "application/json")
                                .build();
    return ResponseEntity.ok().header("Content-Type", "application/json")
                            .body(memos.get(id));
}
{% endhighlight %}

##### UPDATE REST

ì—…ë°ì´íŠ¸ëŠ” ì¢€ ë³µì¡í•˜ë‹¤. create + read ì˜ êµ¬í˜„ì„ ì¢€ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ë©´ ë˜ê² ë‹¤.

{% highlight java %}
@PutMapping(path = "/{id}",
            consumes = "text/plain",
            produces = "application/json")
@Transactional
public ResponseEntity<Memo> updateMemo(@PathVariable Long id,
                                        @RequestBody String content) {
    if (id == null || content.isBlank() || !memos.containsKey(id))
        return ResponseEntity.status(HttpStatus.BAD_REQUEST)
                             .header("Content-Type", "application/json")
                             .build();

    var memo = new Memo(id, content);
    memos.put(id, memo);

    URI location = ServletUriComponentsBuilder.fromCurrentRequest()
                                              .path("/{id}")
                                              .buildAndExpand("id", id)
                                              .toUri();

    return ResponseEntity.ok()
                         .header("Content-Type", "application/json")
                         .header("Location", location.toString())
                         .body(memo);
}
{% endhighlight %}

##### DELETE REST

{% highlight java %}
@DeleteMapping(path = "/{id}")
@Transactional
public ResponseEntity<?> deleteMemo(@PathVariable Long id) {
    if (id == null || !memos.containsKey(id))
        return ResponseEntity.status(HttpStatus.NOT_FOUND)
                                .header("Content-Type", "application/json")
                                .build();

    memos.remove(id);

    return ResponseEntity.noContent().build(); // 204 Status
}
{% endhighlight %}

ì´ë ‡ê²Œ í•˜ë©´ REST ì˜ ì œì•½ì¡°ê±´ë“¤ì„ ëŒ€ë¶€ë¶„ ë§Œì¡±í•˜ì§€ë§Œ **HATEOAS** ê°€ ì—†ê²Œ ëœë‹¤.

#### Spring HATEOAS

ìŠ¤í”„ë§ì—ì„œëŠ” REST ë¥¼ ì§€í‚¤ê¸° ìœ„í•´ `Spring HATEOAS` ë¥¼ ì œê³µí•œë‹¤. ì´ëŠ” REST ì›ì¹™ì„ ì—„ê²©í•˜ê²Œ ì§€í‚¤ê¸° ìœ„í•¨ì´ë©°, ë‹¨ìˆœí•œ DTO ë‚˜ ê°ì²´ ë°˜í™˜ë§Œìœ¼ë¡œëŠ” ë§í¬ ì •ë³´ ì œê³µì´ ë¶ˆê°€í•˜ê¸° ë•Œë¬¸ì— `Spring HATEOAS` ì—ì„œ ì œê³µí•´ì£¼ëŠ” `EntityModel` ìœ¼ë¡œ í•œ ë²ˆ ë” ê°ì‹¸ì„œ ë°˜í™˜ì‹œì¼œì£¼ëŠ”ê²Œ ì›ì¹™ì´ë‹¤.

{% highlight gradle %}
implementation 'org.springframework.boot:spring-boot-starter-hateoas'
{% endhighlight %}

ìœ„ë¥¼ ì¶”ê°€í•˜ë©´ ë‹¤ìŒì´ ìë™ìœ¼ë¡œ ì¶”ê°€ëœë‹¤:
- spring-hateoas
- spring-web
- spring-context
- Jackson ëª¨ë“ˆ

**ë°ì´í„°**

{% highlight java %}
class Memo {
    private Long id;
    private String content;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;

    public Memo(Long id, String content, LocalDateTime createdAt, LocalDateTime updatedAt) {
        this.id = id;
        this.content = content;
        this.createdAt = createdAt;
        this.updatedAt = updatedAt;
    }

    // getters and setters
    public Long getId() { return id; }
    public String getContent() { return content; }
    public void setContent(String content) { this.content = content; }
    public LocalDateTime getCreatedAt() { return createdAt; }
    public LocalDateTime getUpdatedAt() { return updatedAt; }
    public void setUpdatedAt(LocalDateTime updatedAt) { this.updatedAt = updatedAt; }
}

class MemoRequest {
    private String content;
    public String getContent() { return content; }
    public void setContent(String content) { this.content = content; }
}
{% endhighlight %}

ìœ„ë¥¼ í† ëŒ€ë¡œ ì‘ì„±í•´ë³´ì.

**CREATE**
{% highlight java %}
@PostMapping
@Transactional
public ResponseEntity<EntityModel<Memo>> createMemo(@RequestBody MemoRequest request) {
    // ìƒˆ ë©”ëª¨ ìƒì„±
    long id = memos.size();
    Memo memo = new Memo(id, request.getContent(), LocalDateTime.now(), LocalDateTime.now());
    memos.put(id, memo);

    // HATEOAS ë§í¬ ìƒì„±
    EntityModel<Memo> resource = EntityModel.of(memo);
    resource.add(WebMvcLinkBuilder.linkTo(
            WebMvcLinkBuilder.methodOn(MemoController.class).getMemo(id)
    ).withSelfRel());
    resource.add(WebMvcLinkBuilder.linkTo(
            WebMvcLinkBuilder.methodOn(MemoController.class).updateMemo(id, null)
    ).withRel("update"));
    resource.add(WebMvcLinkBuilder.linkTo(
            WebMvcLinkBuilder.methodOn(MemoController.class).deleteMemo(id)
    ).withRel("delete"));

    // HTTP 201 Createdì™€ Location í—¤ë” ë°˜í™˜
    URI location = WebMvcLinkBuilder.linkTo(
            WebMvcLinkBuilder.methodOn(MemoController.class).getMemo(id)
    ).toUri();

    return ResponseEntity.created(location).body(resource);
}
{% endhighlight %}

**READ ë‹¨ê±´**
{% highlight java %}
@GetMapping("/{id}")
public ResponseEntity<EntityModel<User>> getUser(@PathVariable Long id) {
    User user = userService.findById(id);

    if (user == null) return ResponseEntity.notFound().build();

    EntityModel<User> resource = EntityModel.of(user);
    resource.add(WebMvcLinkBuilder.linkTo(
        WebMvcLinkBuilder.methodOn(UserController.class).getUser(id)
    ).withSelfRel());
    resource.add(WebMvcLinkBuilder.linkTo(
        WebMvcLinkBuilder.methodOn(UserController.class).updateUser(id, null)
    ).withRel("update"));

    return ResponseEntity.ok(resource);
}
{% endhighlight %}

**READ ë‹¤ê±´**
{% highlight java %}
@GetMapping
public ResponseEntity<List<EntityModel<Memo>>> getAllMemos(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {

    List<Memo> allMemos = new ArrayList<>(memos.values());
    int start = page * size;
    int end = Math.min(start + size, allMemos.size());

    List<Memo> pagedMemos = allMemos.subList(start, end);

    List<EntityModel<Memo>> resources = new ArrayList<>();
    for (Memo memo : pagedMemos) {
        EntityModel<Memo> resource = EntityModel.of(memo);
        resource.add(WebMvcLinkBuilder.linkTo(
                WebMvcLinkBuilder.methodOn(MemoController.class).getMemo(memo.getId())
        ).withSelfRel());
        resources.add(resource);
    }

    return ResponseEntity.ok()
            .header("X-Total-Count", String.valueOf(allMemos.size()))
            .body(resources);
}
{% endhighlight %}

**UPDATE**
{% highlight java %}
@PutMapping("/{id}")
public ResponseEntity<EntityModel<Memo>> updateMemo(
        @PathVariable Long id,
        @RequestBody MemoRequest request) {

    Memo memo = memos.get(id);
    if (memo == null) return ResponseEntity.notFound().build();

    memo.setContent(request.getContent());
    memo.setUpdatedAt(LocalDateTime.now());

    EntityModel<Memo> resource = EntityModel.of(memo);
    resource.add(WebMvcLinkBuilder.linkTo(
            WebMvcLinkBuilder.methodOn(MemoController.class).getMemo(id)
    ).withSelfRel());
    resource.add(WebMvcLinkBuilder.linkTo(
            WebMvcLinkBuilder.methodOn(MemoController.class).deleteMemo(id)
    ).withRel("delete"));

    return ResponseEntity.ok(resource);
}
{% endhighlight %}

**DELETE**
{% highlight java %}
@DeleteMapping("/{id}")
public ResponseEntity<Void> deleteMemo(@PathVariable Long id) {
    Memo removed = memos.remove(id);
    if (removed == null) return ResponseEntity.notFound().build();
    return ResponseEntity.noContent().build();
}
{% endhighlight %}

ì½”ë“œê°€ ë„ˆë¬´ ë§ì•„ì„œ AI ë„ì›€ì„ ë°›ì•„ì„œ ì •í™•í•œ ë¶€ë¶„ì€ ì•„ì§ ê²€ì¦ì€ ëª»í–ˆë‹¤.  
í•˜ì§€ë§Œ ë‹¤ìŒ ë©”ì„œë“œë¥¼ í†µí•´ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œë¥¼ ì¡°ê¸ˆ ì¤„ì¼ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

{% highlight java %}
private EntityModel<Memo> wrapping(Memo memo) {
    EntityModel<Memo> resource = EntityModel.of(memo);

    var memoCtrl = WebMvcLinkBuilder.methodOn(MemoController.class);

    resource.add(WebMvcLinkBuilder.linkTo(memoCtrl.getMemo(memo.id())).withSelfRel());
    resource.add(WebMvcLinkBuilder.linkTo(memoCtrl.updateMemo(memo.id(), null)).withSelfRel());
    resource.add(WebMvcLinkBuilder.linkTo(memoCtrl.deleteMemo(memo.id())).withSelfRel());
    resource.add(WebMvcLinkBuilder.linkTo(memoCtrl.getMemos()).withSelfRel());
    return resource;
}
{% endhighlight %}


#### HTTP í—¤ë”

í—¤ë”ì—ëŠ” ë‹¤ì–‘í•œ ê°’ì„ ë„£ì„ ìˆ˜ ìˆëŠ”ë°:

- `Cache-Control`: í´ë¼ì´ì–¸íŠ¸ / ì¤‘ê°„ í”„ë¡ì‹œê°€ ìºì‹±í•  ìˆ˜ ìˆëŠ”ì§€, ì–¼ë§ˆë‚˜ ì˜¤ë˜ ìºì‹œí• ì§€ ì§€ì •
- `ETag`: ë¦¬ì†ŒìŠ¤ì˜ ê³ ìœ  ì‹ë³„ì(ë³´í†µ í•´ì‹œê°’), ë³€ê²½ ì‹œ ìƒˆ ê°’ìœ¼ë¡œ ê°±ì‹ 
- `Last-Modified`: ë¦¬ì†ŒìŠ¤ ìµœì¢… ìˆ˜ì • ì‹œê°
- `Expires`: ìºì‹œ ë§Œë£Œ ê¸°ê°„

##### Cache ê´€ë ¨ í—¤ë”

HTTPëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì „ì†¡í•˜ê¸° ìœ„í•´ ìºì‹±(Caching) ë©”ì»¤ë‹ˆì¦˜ì„ ì œê³µí•œë‹¤. ì´ë¥¼ ì œì–´í•˜ëŠ” í•µì‹¬ ìˆ˜ë‹¨ì€ HTTP í—¤ë”(Header) ì´ë©°, ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ë¦¬ì†ŒìŠ¤ì˜ ìœ íš¨ì„±, ë§Œë£Œ ì‹œì , ì¬ê²€ì¦ ì •ì±… ë“±ì„ í˜‘ì˜í•  ìˆ˜ ìˆë‹¤.

**Cache-Control**

ìºì‹œ ì •ì±…ì„ ê°€ì¥ ì„¸ë°€í•˜ê²Œ ì œì–´í•  ìˆ˜ ìˆëŠ” í•µì‹¬ í—¤ë”ë¡œì¨, HTTP/1.1 ì´í›„ì˜ ëª¨ë“  ìºì‹± ë¡œì§ì€ ì´ í—¤ë”ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë™ì‘í•œë‹¤.

> Cache-Control: <directive1>, <directive2>=<value>, ...

ë””ë ‰í‹°ë¸Œë¼ëŠ”ê²Œ ìˆëŠ”ë°, ë””ë ‰í‹°ë¸Œì—ëŠ” ë‹¤ìŒ ë‚´ìš©ë“¤ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤.

**ìºì‹± ê°€ëŠ¥ ì—¬ë¶€**
- `no-store`: ìš”ì²­/ì‘ë‹µ ëª¨ë‘ ìºì‹œì— ì €ì¥í•˜ì§€ ì•ŠìŒ
- `no-cache`: ì €ì¥ì€ ê°€ëŠ¥í•˜ì§€ë§Œ, ì¬ì‚¬ìš© ì „ ì„œë²„ ê²€ì¦ì´ í•„ìš”í•¨ (ETag / Last-Modified)
- `public`: ëª¨ë“  ìºì‹œ(ê³µìœ  ìºì‹œ í¬í•¨) ì—ì„œ ì €ì¥ ë° ì¬ì‚¬ìš© ê°€ëŠ¥
- `private`: ì‚¬ìš©ì ì „ìš© ìºì‹œ(ë¸Œë¼ìš°ì € ë“±) ì—ì„œë§Œ ì €ì¥ ê°€ëŠ¥

**ìœ íš¨ ê¸°ê°„**
- `max-age=ì´ˆ`: ìºì‹œëœ ë¦¬ì†ŒìŠ¤ì˜ ìœ íš¨ì‹œê°„(ì´ˆ ë‹¨ìœ„)
- `s-maxage=ì´ˆ`: ê³µìœ  ìºì‹œ(í”„ë¡ì‹œ, CDN ë“±)ì—ì„œì˜ ìœ íš¨ ì‹œê°„
- `max-stale=ì´ˆ`: ë§Œë£Œëœ ìºì‹œë¼ë„ ì§€ì •ëœ ì‹œê°„ ì•ˆì´ë©´ ì‚¬ìš© í—ˆìš©
- `min-fresh=ì´ˆ`: ì•ìœ¼ë¡œ ìµœì†Œ ì´ˆ ì´ë‚´ì— ìƒˆë¡œê³ ì¹¨í•´ì•¼ ì‚¬ìš© ê°€ëŠ¥

**ì¬ê²€ì¦ ì •ì±…**
- `must-revalidate`: ë§Œë£Œ í›„ ë°˜ë“œì‹œ ì›ì„œë²„ì— ê²€ì¦ í›„ ì‚¬ìš©
- `proxy-revalidate`: ì¤‘ê°„ í”„ë¡ì‹œ ìºì‹œë§Œ ì¬ê²€ì¦ ê°•ì œ

**ê¸°íƒ€**
- `immutable`: ë¦¬ì†ŒìŠ¤ê°€ ì ˆëŒ€ ë°”ë€Œì§€ ì•ŠìŒì„ ëª…ì‹œ(ë¸Œë¼ìš°ì € ì¬ê²€ì¦ ìƒëµ ê°€ëŠ¥)
- `stale-while-revalidate=ì´ˆ`: ë§Œë£Œ í›„ì—ë„ ì§€ì • ì‹œê°„ ë™ì•ˆ ìºì‹œ ì‚¬ìš©í•˜ë©° ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹ 
- `stale-if-error=ì´ˆ`: ì„œë²„ ì˜¤ë¥˜ ë°œìƒ ì‹œ, ì§€ì • ì‹œê°„ ë‚´ ìºì‹œ ì‚¬ìš© í—ˆìš©

- `Last-Modified`: ì„œë²„ -> í´ë¼ì´ì–¸íŠ¸ ë¡œì˜ ë¦¬ì†ŒìŠ¤ ìµœì¢… ìˆ˜ì • ì‹œê° ì œê³µ
- `If-Modified-Since`: í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„ ë¡œì˜ ì´ì „ ì‘ë‹µì˜ ìˆ˜ì • ì‹œê°ì„ ë³´ëƒ„(ì„œë²„ê°€ ë¹„êµ í›„ ë°˜í™˜)

**ETag & If-None-Match**

ë¦¬ì†ŒìŠ¤ì˜ ê³ ìœ  ì‹ë³„ì(Entity Tag) ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë” ì •ë°€í•˜ê²Œ ìºì‹œ ì¬ê²€ì¦ì„ ìˆ˜í–‰í•œë‹¤.

- `ETag`: ì„œë²„ -> í´ë¼ì´ì–¸íŠ¸, ë¦¬ì†ŒìŠ¤ ë²„ì „ ì‹ë³„ì(ë³´í†µ í•´ì‹œê°’)
- `If-None-Match`: í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„, ì´ì „ì— ë°›ì€ ETag ë¥¼ ì „ë‹¬, ì¼ì¹˜ ì‹œ 304 ì‘ë‹µ
    - ë§Œì•½ ë‹¤ë¥´ë©´ ìƒˆ ì½˜í…ì¸ ì™€ í•¨ê»˜ 200 OK + ìƒˆë¡œìš´ ETag ë°˜í™˜

**Vary**

ìºì‹œ êµ¬ë¶„ ê¸°ì¤€ì„ ì§€ì •í•˜ëŠ” í—¤ë”ì´ë©°, ê°™ì€ URL ì´ë¼ë„ ìš”ì²­ í—¤ë” ê°’ì— ë”°ë¼ ë‹¤ë¥¸ ì‘ë‹µì„ ìºì‹œí•´ì•¼ í•  ë•Œ ì‚¬ìš©í•œë‹¤.

> Vary: Accept-Encoding, User-Agent

í•˜ì§€ë§Œ ìºì‹œëŠ” í„°ë¯¸ë„ ìì²´ì—ì„œëŠ” ì—†ê³  ìºì‹œ ìŠ¤í† ë¦¬ì§€ ê¸°ëŠ¥ì´ ìˆëŠ” ìœ ì €ì—ê²Œë§Œ ìºì‹±ì´ ê°€ëŠ¥í•˜ë‹¤.

- ì›¹ ë¸Œë¼ìš°ì €
- `CDN(Cloudflare, Akamai, etc.)`: ì„œë²„ ì‘ë‹µ í—¤ë”ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì „ ì„¸ê³„ ìºì‹œ ì„œë²„ì— ì €ì¥
- `Reverse Proxy(nginx, Varnish)`: ì„œë²„ ì•ë‹¨ì—ì„œ HTTP ìºì‹œë¥¼ ìˆ˜í–‰
- `API Gateway` / `Load Balancer`: ì‘ë‹µ í—¤ë” ê¸°ë°˜ìœ¼ë¡œ ìºì‹± ê°€ëŠ¥ (AWS API, Gateway, Nginx reverse cache)
- HTTP í´ë¼ì´ì–¸íŠ¸ (Postman ë“±): ìì²´ ìºì‹œê°€ ì—†ê±°ë‚˜ ë¹„í™œì„±í™”ë¨(ì§ì ‘ êµ¬í˜„í•´ì•¼ í•¨)

ë‹¤ìŒ ì¥ì—ì„œ ì´ë¥¼ ë” ìì„¸íˆ ë‹¤ë£¨ì.