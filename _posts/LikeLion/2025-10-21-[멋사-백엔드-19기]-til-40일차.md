---
layout: post
title:  "[멋사 백엔드 19기] TIL 40일차 미니프로젝트와 Flux에 대해"
date:   2025-10-21 22:46:35 +0900
categories: 멋쟁이사자처럼 멋사 백엔드 TIL Java Spring
---

<!--more-->

## 📂 목차
- [Spring Flux](#flux)
    - [Flux 를 통해 Client 가 쿼리를 보내는 구조](#flux-를-통해-client-가-쿼리를-보내는-구조)
    - [Backpressure](#backpressure)
    - []()
- []()

---

## 📚 본문

### Flux

플럭스는 Spring WebFlux 에서 제공하는 Reactive Stream 타입 중 하나이다. 

- `Flux<T>`: 0-N 개의 데이터를 비동기 스트림으로 처리
- `Mono<T>`: 0-1 개의 데이터를 비동기 처리 (Flux 의 특수 형태)

플럭스는 non-blocking 방식의 비동기 처리이기 때문에 요청에 대한 효율적인 처리를 가능하다. 또한 이 때문에 MSA 에서 서비스 간의 통신과 데이터 스트림 처리에 유리하게 된다.

#### Flux 를 통해 Client 가 쿼리를 보내는 구조

WebFlux 를 쓰면 일반적으로 클라이언트에서 HTTP 요청을 `Controller`, `Service`, `Repository` 의 흐름으로 처리를 하게 될텐데, 이를 비동기/논블로킹으로 처리하게 된다.

만약 클라이언트 요청을 Flux 로 받고 싶다면, `Controller` 에서 Flux 를 직접 반환하는 경우가 많다. 예시를 보면

{% highlight java %}
@Component
public class UserClient {

    private final WebClient webClient;

    public UserClient(WebClient.Builder webClientBuilder) {
        this.webClient = webClientBuilder.baseUrl("http://user-service").build();
    }

    public Flux<UserDto> getUsers() {
        return webClient.get() // HTTP GET 요청 준비
                        .uri("/users") // 요청할 URI 지정
                        .retrieve() // 서버로부터 응답을 가져오기 위한 응답 처리 준비
                        .bodyToFlux(UserDto.class); // 서버 응답 Body 를 Flux<UserDto> 로 변환 - Mono 로 하면 안에 List 가 들어감 이를 Flux 로 저장하면 0-N 개의 데이터 처리 가능
    }
}
{% endhighlight %}

외부 MSA 서비스 호출용 `Client` 이며, 내부에서 `WebClient` 를 이용해 비동기 호출을 할 때 `Flux`/`Mono` 를 반환한다. 핵심은 `Flux` 를 직접 사용하는 로직은 `Service` 또는 `Client` 에서 구현하고, `Controller` 는 단순히 반환만 담당한다.

- `Client` 클래스: MSA API 호출 담당
- `Service` 클래스: 비즈니스 로직 수행

#### Backpressure

역압력이라고 하며, 소비자가 처리할 수 있는 속도보다 생산자가 데이터를 더 빨리 보내면 어떻게 처리할지 결정하는 전략을 말한다.

**Publisher**
- Cold Publisher: 구독할 때마다 데이터를 새로 생성하는 전략(`Flux.range()`)
- Hot Publisher: 이미 발생하는 이벤트를 여러 구독자가 공유하는 전략(`Flux.interval()`)

**Operators**
- 변환: `map`, `filterMap`, `concatMap`
- 필터링: `filter`, `take`, `skip`
- 결합: merge, `zip`, `combineLatest`
- 오류 처리: `onErrorReturn`, `onErrorResume`, `retry`
