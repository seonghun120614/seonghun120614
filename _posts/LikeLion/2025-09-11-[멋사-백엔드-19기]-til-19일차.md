---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 19ì¼ì°¨"
date:   2025-09-11 22:32:08 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Database
---

<!--more-->


## ğŸ“‚ ëª©ì°¨
- [JOIN](#join)
    - [CROSS JOIN](#cross-join)
    - [INNER JOIN](#inner-join)
        - [JOIN ì„±ëŠ¥ ì¸¡ë©´](#join-ì„±ëŠ¥-ì¸¡ë©´)
    - [OUTER JOIN](#outer-join)
    - [SELF JOIN](#self-join)
- [Sub Query](#sub-query)
- [Correlated Subquery](#correlated-subquery)
- [ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤](#ë‹¤ì–‘í•œ-ê¸°ëŠ¥ë“¤)
    - [Set Operation](#set-operation)
    - [Window í•¨ìˆ˜](#window-í•¨ìˆ˜)

---

## ğŸ“š ë³¸ë¬¸

### JOIN

JOINì€ ì—¬ëŸ¬ í…Œì´ë¸”ì˜ ë°ì´í„°ë“¤ì„ ì—°ê²°ì‹œì¼œ í•˜ë‚˜ì˜ ê²°ê³¼ ì§‘í•©ìœ¼ë¡œ ë§Œë“œëŠ” ë°©ë²•ì´ë‹¤.

{% highlight sql %}
table_references:
    escaped_table_reference [, escaped_table_reference] ...

escaped_table_reference: {
    table_reference
  | { OJ table_reference }
}

table_reference: {
    table_factor
  | joined_table
}

table_factor: {
    tbl_name [PARTITION (partition_names)]
        [[AS] alias] [index_hint_list]
  | [LATERAL] table_subquery [AS] alias [(col_list)]
  | ( table_references )
}

joined_table: {
    table_reference {[INNER | CROSS] JOIN | STRAIGHT_JOIN} table_factor [join_specification]
  | table_reference {LEFT|RIGHT} [OUTER] JOIN table_reference join_specification
  | table_reference NATURAL [INNER | {LEFT|RIGHT} [OUTER]] JOIN table_factor
}

join_specification: {
    ON search_condition
  | USING (join_column_list)
}

join_column_list:
    column_name[, column_name] ...

index_hint_list:
    index_hint[ index_hint] ...

index_hint: {
    USE {INDEX|KEY}
      [FOR {JOIN|ORDER BY|GROUP BY}] ([index_list])
  | {IGNORE|FORCE} {INDEX|KEY}
      [FOR {JOIN|ORDER BY|GROUP BY}] (index_list)
}

index_list:
    index_name [, index_name] ...
{% endhighlight %}

MySQL ë¬¸ë²• ì •ì˜ì„œ ì¸ë°, FROM ì ˆì—ì„œ í…Œì´ë¸” ì°¸ì¡° ë¥¼ ì–´ë–»ê²Œ ì“¸ ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ê·œì¹™ì„ ë‚˜ì—´í•œ ê²ƒì´ë‹¤. SELECT ë¬¸ì—ì„œë„ ë‹¹ì—°íˆ ë´¤ì„ ê²ƒì´ë‹¤.

#### CROSS JOIN

ì¹´í…Œì‹œì•ˆ ê³±ì´ë©°, ê·¸ëƒ¥ ê°€ëŠ¥í•œ ëª¨ë“  ì¡°í•©ì˜ ê²½ìš°ë¥¼ ê²°ê³¼ë¡œ ë‚´ë±‰ëŠ”ë‹¤. í•˜ì§€ë§Œ ì´ëŠ” ì˜ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©°, ì—¬ëŸ¬ ì—´ì´ ìˆë‹¤ë©´ êµ‰ì¥íˆ ë§ì€ í–‰ì´ ìƒì„±ë˜ë¯€ë¡œ ì„±ëŠ¥ì ìœ¼ë¡œ ë¬¸ì œê°€ ìˆë‹¤.

í¬ë¡œìŠ¤ ì¡°ì¸ì€ ê·¸ëƒ¥ ë‘ í…Œì´ë¸”ì„ FROM ì ˆì— ë†“ìœ¼ë©´ ëœë‹¤.

{% highlight sql %}
SELECT *
FROM customers c, orders o;  -- ì¡°ì¸ ì¡°ê±´ ì—†ìŒ
{% endhighlight %}

ë³´í†µì€ JOIN ì„ í•  ë•ŒëŠ” ê·¸ë˜ì„œ ì¡°ê±´ì„ ì£¼ëŠ”ê²Œ ì˜¤ë²„í—¤ë“œê°€ ì—†ë‹¤.

> ë§Œì•½ ì—¬ëŸ¬ í…Œì´ë¸”ì„ JOINí•œë‹¤ë©´, Nê°œì˜ í…Œì´ë¸”ì„ JOINí•  ë•Œ ìµœì†Œ (N-1)ê°œì˜ ì¡°ì¸ ì¡°ê±´ì´ í•„ìš”, ê·¸ë˜ì•¼ ë¶ˆí•„ìš”í•œ Cartesian Product ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

#### INNER JOIN

{% highlight sql %}
-- ì „í†µì ì¸ ì¡°ì¸ ë°©ì‹
SELECT 
    e.first_name,
    e.last_name,
    d.department_name
FROM 
    employees e, 
    departments d
WHERE 
    e.department_id = d.department_id;
{% endhighlight %}

ì˜ˆì „ì—ëŠ” ìœ„ì²˜ëŸ¼ ì½”ë”©ì„ í–ˆì§€ë§Œ, í…Œì´ë¸”ì„ FROM ì— ë‚˜ì—´í•˜ê³  WHERE ì¡°ê±´ì„ ì§€ì •í•˜ê²Œ ë˜ë©´ ì¡°ì¸ ì¡°ê±´ê³¼ í•„í„° ì¡°ê±´ì´ ì„ì—¬ ìˆì–´ì„œ í—·ê°ˆë¦´ ìˆ˜ê°€ ìˆë‹¤. ë˜í•œ ì‹¤ìˆ˜ë¡œ ì¡°ì¸ ì¡°ê±´ì„ ë¹¼ë¨¹ìœ¼ë©´ CROSS JOIN ì´ ë˜ì–´ë²„ë ¤ ëª¨ë“  ì¡°í•©ì˜ ë°ì´í„°ê°€ ë§Œë“¤ì–´ì§€ê²Œ ëœë‹¤.

ë”°ë¼ì„œ ì§€ê¸ˆì€ ANSI SQL í‘œì¤€ JOIN ë¬¸ë²•ì„ ì‚¬ìš©í•œë‹¤.

{% highlight sql %}
-- JOIN ~ ON
SELECT 
    e.first_name,
    e.last_name,
    d.department_name
FROM employees e
JOIN departments d ON e.department_id = d.department_id;

-- JOIN ~ USING (ë™ì¼í•œ ì»¬ëŸ¼ëª…ì¼ ë•Œ)
SELECT 
    e.first_name,
    e.last_name,
    d.department_name
FROM employees e
JOIN departments d USING(department_id);

-- NATURAL JOIN (ìë™ìœ¼ë¡œ ê°™ì€ ì´ë¦„ ì»¬ëŸ¼ ì¡°ì¸)
SELECT * FROM employees NATURAL JOIN departments;
{% endhighlight %}

##### JOIN ì„±ëŠ¥ ì¸¡ë©´

**INDEXINg**
INNER JOIN ì€ ì¡°ê±´ì´ ì˜ ê±¸ë ¤ìˆìœ¼ë©´ íš¨ìœ¨ì ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ëŒ€ìƒ í…Œì´ë¸”ì˜ index ê°€ ê±¸ë ¤ìˆì—ˆë‹¤ê³  í•´ë³´ì. ì´ë•Œ í•„í„°ë§ì„ ì£¼ëŠ” í…Œì´ë¸”ì˜ ê°’ë“¤ì„ ê¸°ì¤€ìœ¼ë¡œ ì´ë“¤ì„ ì°¾ì•„ë‚´ê¸°ë§Œ í•˜ë©´ ë˜ëŠ”ë°, ì°¾ì•„ë‚¼ ë•Œë„ searching ì‘ì—…ì´ í•„ìš”í•˜ê¸°ì— ì—¬ê¸°ì— index ë¥¼ ê±¸ì–´ì£¼ë©´ ë” ë¹ ë¥´ê²Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

indexing ì´ ì•ˆê±¸ë ¤ ìˆì—ˆë‹¤ë©´ searching ì‘ì—…ì´ ëŠë ¤ì§€ê²Œ ë˜ì–´ì„œ ì„±ëŠ¥ ì´ì ì„ ë³¼ ìˆ˜ê°€ ì—†ê²Œ ëœë‹¤. ë˜í•œ JOIN ì—†ì´ ì“°ë©´ ê¸°ë³¸ì ìœ¼ë¡œ cartesian ì´ ìˆ˜í–‰ë˜ëŠ”ë° ì´ëŠ” êµ‰ì¥íˆ ëŠë¦¬ë‹¤. JOIN ì´ ìˆê¸°ì— ê°€ëŠ¥í•˜ë‹¤.

**í…Œì´ë¸” í¬ê¸°ì™€ ìˆœì„œì— ë”°ë¥¸ ì„±ëŠ¥**

ì¡°ì¸í•˜ëŠ” í…Œì´ë¸”ì´ í¬ë©´ í´ìˆ˜ë¡ ì„±ëŠ¥ ì˜í–¥ì´ í¬ë‹¤. ì¼ë¶€ DBMSëŠ” ì¡°ì¸ ìˆœì„œë¥¼ ë°”ê¿” ìµœì í™”í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆì–´ ìƒê´€ì´ ì—†ì§€ë§Œ, í° í…Œì´ë¸”ì„ ë¨¼ì € JOIN í•˜ë©´ ì„ì‹œ í…Œì´ë¸”ì´ ì»¤ì ¸ì„œ ëŠë ¤ì§ˆ ìˆ˜ ìˆê²Œ ëœë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ customers í…Œì´ë¸”ì— 1000 ê°œì˜ ë ˆì½”ë“œê°€ ìˆê³ , orders í…Œì´ë¸”ì— 1000000 ë ˆì½”ë“œê°€ ìˆë‹¤ê³  í•˜ì.

{% highlight sql %}
-- orders(100ë§Œ í–‰) ê¸°ì¤€ìœ¼ë¡œ ë¨¼ì € customers ì™€ JOIN
SELECT o.id, o.order_date, c.name
FROM orders o
JOIN customers c
ON o.customer_id = c.id;
{% endhighlight %}

ë¬´ì¡°ê±´ ëŒ€ìƒ í…Œì´ë¸”ì€ ì‘ì•„ì•¼ í•œë‹¤. ìœ„ì²˜ëŸ¼ order í…Œì´ë¸”ì„ ë¨¼ì € ê°€ì ¸ì™€ë²„ë¦¬ë©´ ë§ì´ ê°€ì ¸ì˜¨ í–‰ì— ëŒ€í•´ì„œ ê²€ìƒ‰í•´ì•¼ í•  ì–‘ì´ ëŠ˜ì–´ë‚˜ê²Œ ëœë‹¤. ë˜í•œ ì‘ì€ í…Œì´ë¸”ì„ index ë¥¼ ìƒì„±í•´ì•¼ index í¬ê¸°ê°€ ì‘ì•„ì ¸ì„œ ê²€ìƒ‰í•  ì–‘ì´ ì¤„ì–´ë“¤ê¸°ì— customers ì˜ í…Œì´ë¸”ì´ ë¨¼ì € ì‘ì„±ë˜ì–´ì•¼ í•˜ëŠ” ê²ƒì´ë‹¤.

{% highlight sql %}
SELECT o.id, o.order_date, c.name
FROM customers c
JOIN orders o
ON c.id = o.customer_id
{% endhighlight %}

ìœ„ì²˜ëŸ¼ ì‘ì„±í•´ì£¼ë©´ ë˜ê² ë‹¤. ê·¸ë¦¬ê³  WHERE ì„ ì¨ì„œ ë„£ëŠ”ë‹¤ë©´ ëŒ€ìƒ í…Œì´ë¸” í¬ê¸°ê°€ ë” ì‘ì•„ì ¸ì„œ ë” íš¨ìœ¨ì ì´ê²Œ ë˜ê² ë‹¤. ë°‘ì€ ê·¸ ì˜ˆì‹œë‹¤.

{% highlight sql %}
-- íŠ¹ì • VIP ê³ ê°ì˜ ì£¼ë¬¸ë§Œ ì°¾ê³  ì‹¶ì„ ë•Œ
SELECT o.id, o.order_date, c.name
FROM customers c
JOIN orders o
ON c.id = o.customer_id
WHERE c.vip = true;
{% endhighlight %}

**Sub Query, CTE** 


#### OUTER JOIN

ì•„ìš°í„° ì¡°ì¸ì—ëŠ” LEFT JOIN ê³¼ RIGHT JOIN ì´ ìˆëŠ”ë° ê¸°ì¤€ë§Œ ë‹¤ë¥¼ ë¿ ë‘˜ì˜ ë™ì‘ ë°©ì‹ì€ ë™ì¼í•˜ë‹¤.

LEFT JOIN ì€ ì™¼ìª½ í…Œì´ë¸”ì˜ ëª¨ë“  í–‰ì´ ì „ë¶€ ê²°ê³¼ í…Œì´ë¸”ì— í¬í•¨ë˜ì–´ì•¼ ë˜ë©° RIGHT JOIN ì€ ê·¸ ë°˜ëŒ€ë‹¤.

**LEFT JOIN**
{% highlight sql %}
-- ë¶€ì„œê°€ ì—†ëŠ” ì§ì›ë„ í¬í•¨
SELECT 
    e.employee_id,
    e.first_name,
    d.department_name
FROM employees e
LEFT OUTER JOIN departments d 
ON e.department_id = d.department_id;

-- LEFT JOINìœ¼ë¡œ ì¶•ì•½ ê°€ëŠ¥
SELECT 
    e.employee_id,
    e.first_name,
    d.department_name
FROM employees e
LEFT JOIN departments d 
ON e.department_id = d.department_id;
{% endhighlight %}

**RIGHT JOIN**

{% highlight sql %}
-- ì§ì›ì´ ì—†ëŠ” ë¶€ì„œë„ í¬í•¨
SELECT 
    e.employee_id,
    e.first_name,
    d.department_name
FROM employees e
RIGHT OUTER JOIN departments d 
ON e.department_id = d.department_id;
{% endhighlight %}

ê°€ë ¹ ë‘ í…Œì´ë¸”ì˜ íŠœí”Œë“¤ ì „ë¶€ë¥¼ ê²°ê³¼ í…Œì´ë¸”ì— ë‚˜ì˜¤ë„ë¡, ì¦‰ LEFT, RIGHT ë‘˜ ë‹¤ ë˜ë„ë¡ í•˜ê²Œ í•˜ê³  ì‹¶ì„ ìˆ˜ ìˆë‹¤. ì´ë¥¼ FULL OUTER JOIN ì´ë¼ê³  í•˜ëŠ”ë° ì´ëŠ” MySQL ì—ì„œëŠ” ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— LEFT JOIN, RIGHT JOIN, UNION ì„ í•©ì³ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê² ë‹¤.

{% highlight sql %}
-- ë°©ë²• 1: LEFT JOIN + RIGHT JOIN + UNION
SELECT 
    e.employee_id,
    e.first_name,
    d.department_name
FROM employees e
LEFT JOIN departments d ON e.department_id = d.department_id
UNION
SELECT 
    e.employee_id,
    e.first_name,
    d.department_name
FROM employees e
RIGHT JOIN departments d ON e.department_id = d.department_id
WHERE e.department_id IS NULL;  -- ì¤‘ë³µ ì œê±°ë¥¼ ìœ„í•´ ì¶”ê°€
{% endhighlight %}

**Postgres, Oracle ë“±ë“±**
{% highlight sql %}
-- PostgreSQL, SQL Server, Oracleì—ì„œ ê°€ëŠ¥í•œ êµ¬ë¬¸
SELECT 
    e.employee_id,
    e.first_name,
    d.department_name
FROM employees e
FULL OUTER JOIN departments d 
ON e.department_id = d.department_id;
{% endhighlight %}

#### SELF JOIN

ìê¸° ìì‹ ì„ ê·¸ëƒ¥ JOIN ì ˆì˜ í…Œì´ë¸”ë¡œ ë„£ì–´ë²„ë¦¬ë©´ ëœë‹¤.

{% highlight sql %}
-- ì§ì›ê³¼ ìƒì‚¬ ì •ë³´ ì¡°íšŒ
SELECT 
    e.employee_id AS ì‚¬ì›ID,
    e.first_name AS ì‚¬ì›ì´ë¦„,
    m.employee_id AS ìƒì‚¬ID,
    m.first_name AS ìƒì‚¬ì´ë¦„
FROM employees e
JOIN employees m ON e.manager_id = m.employee_id;
{% endhighlight %}

### Sub Query

nested class ì²˜ëŸ¼ ì—¬ê¸°ì„œëŠ” ì¿¼ë¦¬ë¥¼ ì¤‘ì²©ì‹œí‚¤ë„ë¡ í•  ìˆ˜ ìˆë‹¤.

ë³´í†µ sub query ëŠ” ì˜ ì“°ì§€ëŠ” ì•ŠëŠ”ë‹¤. ê·¸ëƒ¥ Join ì´ ë” ìµœì í™”ì— ì¢‹ê³ , ì¬ì‚¬ìš©ì´ ì–´ë ¤ìš°ë©°, ë””ë²„ê¹…ì´ ë¶ˆí¸í•˜ë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤.

ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ë‹¨ì¼ ê°’ë§Œì„ ê°€ì ¸ì˜¤ê³  ì‹¶ì„ ë•ŒëŠ” sub query ë¥¼ ì“°ëŠ”ê²Œ ë” ì¢‹ì„ ìˆ˜ë„ ìˆê³ , ìƒí™©ë§ˆë‹¤ ê°€ë” ì“°ê¸´ í•œë‹¤.

**Single-row Subquery**
{% highlight sql %}
-- í‰ê·  ê¸‰ì—¬ë³´ë‹¤ ì ì€ ê¸‰ì—¬ë¥¼ ë°›ëŠ” ì‚¬ì›
SELECT ename, sal
FROM emp
WHERE sal < (
    SELECT AVG(sal)
    FROM emp
);

-- ê°€ì¥ ë¨¼ì € ì…ì‚¬í•œ ì‚¬ì›
SELECT ename, hiredate
FROM emp
WHERE hiredate = (
    SELECT MIN(hiredate)
    FROM emp
);
{% endhighlight  %}

**Multi-row Subquery**

{% highlight sql %}
-- IN ì—°ì‚°ì ì‚¬ìš©
SELECT ename, sal, deptno
FROM emp
WHERE deptno IN (
    SELECT deptno
    FROM dept
    WHERE loc IN ('NEW YORK', 'DALLAS')
);

-- ANY ì—°ì‚°ì ì‚¬ìš©
SELECT ename, sal
FROM emp
WHERE sal > ANY (
    SELECT sal
    FROM emp
    WHERE deptno = 30
);

-- ALL ì—°ì‚°ì ì‚¬ìš©
SELECT ename, sal
FROM emp
WHERE sal > ALL (
    SELECT sal
    FROM emp
    WHERE deptno = 30
);
{% endhighlight %}

#### Correlated Subquery

ì™¸ë¶€ ì¿¼ë¦¬ì™€ ë‚´ë¶€ ì¿¼ë¦¬ê°€ ì„œë¡œ ì—°ê´€ë˜ì–´ ìˆëŠ” ì„œë¸Œì¿¼ë¦¬ì´ë‹¤.

{% highlight sql %}
-- ìì‹ ì´ ì†í•œ ë¶€ì„œì˜ í‰ê·  ê¸‰ì—¬ë³´ë‹¤ ë§ì´ ë°›ëŠ” ì‚¬ì›
SELECT o.ename, o.sal, o.deptno
FROM emp o
WHERE o.sal > (
    SELECT AVG(i.sal)
    FROM emp i
    WHERE i.deptno = o.deptno
);
{% endhighlight %}

ë³„ íŠ¹ë³„í• ê±´ ì—†ë‹¤.

### ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤

#### Set Operation

- UNION
- MINUS
- INTERSECT

#### Window í•¨ìˆ˜

ë³´í†µ OVER ê³¼ í•¨ê»˜ ë™ë°˜ë˜ë©°, ì‚¬ìš©í•  ë•ŒëŠ” ê²€ìƒ‰ í›„ì— ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ë‹¤.

- RANK
- ROW_NUMBER
- DENSE_RANK