---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 43ì¼ì°¨ Spring Data Jpa"
date:   2025-10-27 09:03:50 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Java Spring
---

<!--more-->

## ğŸ“‚ ëª©ì°¨
- [Spring Data JPAë€?](#spring-data-jpaë€)
- [Spring Data JPAì˜ ë™ì‘ êµ¬ì¡°](#spring-data-jpaì˜-ë™ì‘-êµ¬ì¡°)
- [Repository ê³„ì¸µì˜ ì´í•´](#repository-ê³„ì¸µì˜-ì´í•´)
  - [CrudRepository](#crudrepository)
  - [JpaRepository](#jparepository)
- [ì¿¼ë¦¬ ë©”ì„œë“œ(Query Method)](#ì¿¼ë¦¬-ë©”ì„œë“œquery-method)
  - [ì¿¼ë¦¬ ë©”ì„œë“œ ìë™ ì¿¼ë¦¬ ìƒì„± ê¸°ëŠ¥ ì‚¬ìš©](#ì¿¼ë¦¬-ë©”ì„œë“œ-ìë™-ì¿¼ë¦¬-ìƒì„±-ê¸°ëŠ¥-ì‚¬ìš©)
  - [@Query ì• ë„ˆí…Œì´ì…˜ìœ¼ë¡œ ì§ì ‘ JPQL ì¿¼ë¦¬ ì‘ì„±](#query-ì• ë„ˆí…Œì´ì…˜ìœ¼ë¡œ-ì§ì ‘-jpql-ì¿¼ë¦¬-ì‘ì„±)
  - [ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ ì‚¬ìš©](#ë„¤ì´í‹°ë¸Œ-ì¿¼ë¦¬-ì‚¬ìš©)
- [JPQLê³¼ Criteria](#jpqlê³¼-criteria)
- [Spring Data JPA ì‹¤ë¬´ í™œìš©](#spring-data-jpa-ì‹¤ë¬´-í™œìš©)
  - [DTO Projection](#dto-projection)
  - [Specification (ë™ì  ì¿¼ë¦¬)](#specification-ë™ì -ì¿¼ë¦¬)
  - [Querydslê³¼ì˜ ë¹„êµ](#querydslê³¼ì˜-ë¹„êµ)

---

## ğŸ“š ë³¸ë¬¸

### Spring Data JPAë€?

**Spring Data JPA** ëŠ” **JPA(Java Persistence API)** ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì˜ ë°ì´í„° ì ‘ê·¼ ì¶”ìƒí™” ë„êµ¬ì…ë‹ˆë‹¤. ë³µì¡í•œ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ì½”ë“œë¥¼ ì¤„ì´ê³ , ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ì˜ ì„ ì–¸ì  ë°©ì‹ìœ¼ë¡œ CRUD ë° ì¿¼ë¦¬ ê¸°ëŠ¥ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê°œë°œìëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì§‘ì¤‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Spring Data JPAì˜ ë™ì‘ êµ¬ì¡°

**Spring Data JPA** ëŠ” `EntityManager` ë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ í•œë‹¤. `Repository` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í•˜ë©´ ìŠ¤í”„ë§ì´ ëŸ°íƒ€ì„ì— `Proxy` ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ì‹¤ì œ êµ¬í˜„ì²´ë¥¼ ì œê³µí•˜ê³  ì´ `Proxy` ëŠ” ë©”ì„œë“œ í˜¸ì¶œ ì‹œ ì ì ˆí•œ JPA ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œë‹¤.

- `EntityManager`: JPAì˜ í•µì‹¬ ì¸í„°í˜ì´ìŠ¤ë¡œ, ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬ ë° ì¿¼ë¦¬ ì‹¤í–‰ ë‹´ë‹¹
- `Repository`: ê°œë°œìê°€ ì •ì˜í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤
- `Proxy`: ìŠ¤í”„ë§ì´ ìë™ ìƒì„±í•˜ëŠ” êµ¬í˜„ì²´ë¡œ, ë©”ì„œë“œ í˜¸ì¶œì„ ì‹¤ì œ DB ì¿¼ë¦¬ë¡œ ë³€í™˜

### Repository ê³„ì¸µì˜ ì´í•´

Spring Data JPA ëŠ” ì—¬ëŸ¬ `Repository` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ëŠ”ë° Crud ëŠ” ìš°ì„  Spring Data ì—ì„œ ê³µí†µì ìœ¼ë¡œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ë©° ì´ë¥¼ í™•ì¥í•˜ëŠ” Spring Data JPA ì˜ `JpaRepository` ê°€ ìˆë‹¤.


#### JpaRepository

**JpaRepository** ì–´ë…¸í…Œì´ì…˜ì€ `CrudRepository` ë¥¼ í™•ì¥í•˜ë©° í˜ì´ì§• ê¸°ëŠ¥ê³¼ ì •ë ¬ ê¸°ëŠ¥ì„ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ê²Œ ëœë‹¤.

{% highlight text %}
Repository
 â””â”€ CrudRepository<T, ID>
     â””â”€ ListCrudRepository<T, ID>

 â””â”€ PagingAndSortingRepository<T, ID>
     â””â”€ ListPagingAndSortingRepository<T, ID>

QueryByExampleExecutor<T> + 
ListPagingAndSortingRepository<T, ID> + 
ListCrudRepository<T, ID>
  â””â”€ JpaRepository<T, ID>
{% endhighlight %}

í•„ìš”í•œ ê¸°ëŠ¥ì„ ì“¸ ë•ŒëŠ” í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ ë‚´ë¶€ì˜ ë©”ì„œë“œë“¤ì„ ë³´ë©´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ë˜í•œ `JpaRepository` ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `Iterator` ë³´ë‹¨ `List` ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì§œì—¬ì ¸ ìˆê¸° ë•Œë¬¸ì— ì„±ëŠ¥ì ìœ¼ë¡œ ì•ˆì¢‹ì„ ìˆ˜ ìˆë‹¤. ì´ëŸ´ë•ŒëŠ” `JpaRepository` ë¥¼ ì‚¬ìš©í•˜ê¸° ë³´ë‹¤ëŠ” ì§ì ‘ `BaseRepository` ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

### ì¿¼ë¦¬ ë©”ì„œë“œ(Query Method)

#### ì¿¼ë¦¬ ë©”ì„œë“œ ìë™ ì¿¼ë¦¬ ìƒì„± ê¸°ëŠ¥ ì‚¬ìš©

Spring Data JPAëŠ” ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìë™ ìƒì„±í•œë‹¤. ë©”ì„œë“œ ì´ë¦„ì„ ì‘ì„±í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê·œì¹™ìœ¼ë¡œ ì‘ì„±í•œë‹¤. ì´ì „ì—ë„ ë‹¤ë¤˜ê¸°ì— ê°„ë‹¨íˆ ì •ë¦¬í•˜ê³  ë„˜ì–´ê°„ë‹¤.

**Prefix**

- findâ€¦By: ì¡°íšŒ (ê°€ì¥ ë§ì´ ì‚¬ìš©ë¨)
- readâ€¦By: ì¡°íšŒ (findì™€ ë™ì¼ ê¸°ëŠ¥)
- getâ€¦By: ì¡°íšŒ (findì™€ ë™ì¼ ê¸°ëŠ¥)
- queryâ€¦By: ì¡°íšŒ (findì™€ ë™ì¼ ê¸°ëŠ¥)
- countâ€¦By: ì¡°ê±´ì— ë§ëŠ” ê°œìˆ˜ ì¡°íšŒ
- existsâ€¦By: ì¡°ê±´ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
- deleteâ€¦By: ì¡°ê±´ì— ë§ëŠ” ë°ì´í„° ì‚­ì œ
- removeâ€¦By: deleteì™€ ë™ì¼ ê¸°ëŠ¥

**Property Expressions**
- Is, Equals: `=` â€” `findByName(String name)`
- IsNot, Not: `!=` â€” `findByStatusNot(String status)`
- LessThan: `<` â€” `findByAgeLessThan(int age)`
- LessThanEqual: `<=` â€” `findByAgeLessThanEqual(int age)`
- GreaterThan: `>` â€” `findByAgeGreaterThan(int age)`
- GreaterThanEqual: `>=` â€” `findByAgeGreaterThanEqual(int age)`
- Between: `BETWEEN` â€” `findByCreatedAtBetween(Date start, Date end)`
- Like: `LIKE` (íŒ¨í„´ ë§¤ì¹­) â€” `findByNameLike(String name)`
- NotLike: `NOT LIKE` â€” `findByNameNotLike(String name)`
- StartingWith: `LIKE 'abc%'` â€” `findByNameStartingWith(String prefix)`
- EndingWith: `LIKE '%abc`' â€” `findByNameEndingWith(String suffix)`
- Containing: `LIKE '%abc%'` â€” `findByNameContaining(String keyword)`
- In: `IN (...)` â€” `findByIdIn(List<Long> ids)`
- NotIn: `NOT IN (...)` â€” `findByIdNotIn(List<Long> ids)`
- True, False: boolean ì¡°ê±´ â€” `findByActiveTrue()`
- IsNull: `IS NULL` â€” `findByDeletedAtIsNull()`
- IsNotNull: `IS NOT NULL` â€” `findByDeletedAtIsNotNull()`
- Before: `<` (ë‚ ì§œ ì „) â€” `findByCreatedAtBefore(LocalDate date)`
- After: `>` (ë‚ ì§œ í›„) â€” `findByCreatedAtAfter(LocalDate date)`

**Limit(Top / First)**

ì¡°íšŒ ê°œìˆ˜ë¥¼ ì œí•œí•  ë•Œ ì‚¬ìš©í•˜ë©°, ì ‘ë‘ì‚¬ ìª½ì— prefix ì™€ by ì‚¬ì´ì— ì‚¬ìš©í•œë‹¤.

- `Top{n}`, `First{n}`: ìƒìœ„ n ê°œ ì¡°íšŒ

**Distinct**

ë§ˆì°¬ê°€ì§€ë¡œ ì ‘ë‘ì‚¬ ìª½ì— prefix ì™€ by ì‚¬ì´ì— ì‚¬ìš©

{% highlight java %}
findDistinctByEmail(String email);
findDistinctTop3ByOrderByScoreDesc();
{% endhighlight %}

**IgnoreCase**

ì†ì„± í‘œí˜„ì‹ ë§ˆì§€ë§‰ì— ì¶”ê°€

{% highlight java %}
findByUsernameIgnoreCase(String username);
findByEmailContainingIgnoreCase(String keyword);
{% endhighlight %}

**ë°˜í™˜ íƒ€ì…**

- `Entity`: ë‹¨ì¼ ì—”í‹°í‹° ë°˜í™˜ (ê²°ê³¼ ì—†ìœ¼ë©´ null)
- `Optional`: ë‹¨ì¼ ê²°ê³¼ë¥¼ Optionalë¡œ ë°˜í™˜
- `Collection`: ì—¬ëŸ¬ ê°œ ê²°ê³¼ ë°˜í™˜
- `Page`: í˜ì´ì§• ì²˜ë¦¬ëœ ê²°ê³¼ ë°˜í™˜
- `Slice`: ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ë§Œ ìˆëŠ” ìŠ¬ë¼ì´ìŠ¤ ë°˜í™˜
- `Stream`: Java Streamìœ¼ë¡œ ë°˜í™˜
- `long`, `int`: count, delete ë“± ìˆ«ì ê²°ê³¼ ë°˜í™˜
- `boolean`: ì¡´ì¬ ì—¬ë¶€ ë°˜í™˜
- `Future`, `CompletableFuture`: ë¹„ë™ê¸° ë°˜í™˜

### @Query ì• ë„ˆí…Œì´ì…˜ìœ¼ë¡œ ì§ì ‘ JPQL ì¿¼ë¦¬ ì‘ì„±

`JPQL(Java Persistence Query Language)` ì€ ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë¡œ, ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ ì‘ì„±ì„ í•œë‹¤.

{% highlight java %}
String jpql = "SELECT u FROM User u WHERE u.age > :age";
List<User> users = em.createQuery(jpql, User.class)
                     .setParameter("age", 18)
                     .getResultList();
{% endhighlight %}

ì´ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ Spring Data JPA ê°€ ìë™ìœ¼ë¡œ ìƒì„±ì‹œì¼œì£¼ì–´ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±ë§Œ í•˜ë©´ íŒŒë¼ë¯¸í„°ì™€ ë§¤í•‘ì„ ì‹œí‚¬ ìˆ˜ ìˆê²Œ ëœë‹¤.

{% highlight java %}
// 1ë²ˆì§¸, 2ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¥¼ ?1, ?2ë¡œ ì§€ì •
@Query("SELECT u FROM User u WHERE u.age > ?1 AND u.status = ?2")
List<User> findByAgeAndStatus(int age, String status);

// ë‚ ì§œ ë²”ìœ„ ì¡°íšŒ
@Query("SELECT o FROM Order o WHERE o.createdAt BETWEEN ?1 AND ?2")
List<Order> findOrdersBetweenDates(LocalDate start, LocalDate end);

// :email ì´ ë©”ì„œë“œ íŒŒë¼ë¯¸í„° emailê³¼ ë§¤í•‘
@Query("SELECT u FROM User u WHERE u.email = :email")
User findByEmailNamed(@Param("email") String email);

@Query("SELECT u FROM User u WHERE u.age >= :minAge AND u.age <= :maxAge")
List<User> findByAgeRange(@Param("minAge") int minAge, @Param("maxAge") int maxAge);

// í˜ì´ì§• ë° ì •ë ¬ ê¸°ëŠ¥
@Query("SELECT u FROM User u WHERE u.status = :status ORDER BY u.createdAt DESC")
Page<User> findByStatusWithPaging(@Param("status") String status, Pageable pageable);
{% endhighlight %}

### ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ ì‚¬ìš©

ìœ„ì™€ ë˜‘ê°™ì§€ë§Œ `nativeQuery = true` ë¡œ í•´ì£¼ì–´ì•¼ í•œë‹¤.

{% highlight java %}
@Query(value = "SELECT * FROM users WHERE status = ?1", nativeQuery = true)
List<User> findByStatusNative(String status);
{% endhighlight %}

### JPQLê³¼ Criteria

`Criteria API` ëŠ” íƒ€ì… ì„¸ì´í”„í•œ ë™ì  ì¿¼ë¦¬ ìƒì„±ì— ìœ ìš©í•˜ë‹¤.

{% highlight java %}
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<User> cq = cb.createQuery(User.class);
Root<User> user = cq.from(User.class);
cq.select(user).where(cb.greaterThan(user.get("age"), 18));
List<User> result = em.createQuery(cq).getResultList();
{% endhighlight %}

í•˜ì§€ë§Œ ì´ëŠ” ë„ˆë¬´ ì¥í™©í•˜ë‹¤. ì¨ì•¼í•  ì½”ë“œë„ ë§ìœ¼ë©°, ê°€ë…ì„±ì´ ì•ˆì¢‹ê³ , í•„ë“œëª…ì„ ë¬¸ìì—´ë¡œ ì‘ì„±í•´ì•¼ í•´ì„œ ì»´íŒŒì¼ ì‹œì ì— ì²´í¬ê°€ ë¶ˆê°€í•˜ë‹¤. ë”°ë¼ì„œ `Querydsl` ì„ ì‚¬ìš©í•˜ëŠ”ë° ë‚˜ì¤‘ì— ë³´ì.

### Spring Data JPA ì‹¤ë¬´ í™œìš©

#### DTO Projection

ì—”í‹°í‹° ëŒ€ì‹  í•„ìš”í•œ ë°ì´í„°ë§Œ DTO ë¡œ í”„ë¡œì ì…˜í•˜ì—¬ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

{% highlight java %}
public interface UserDto {
    String getUsername();
    String getEmail();
}

@Query("SELECT u.username AS username, u.email AS email FROM User u")
List<UserDto> findUserDto();
{% endhighlight %}

#### Specification (ë™ì  ì¿¼ë¦¬)

ì¡°ê±´ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì¿¼ë¦¬ ìƒì„± ê°€ëŠ¥í•˜ë‹¤.

{% highlight java %}
public class UserSpecification implements Specification<User> {
    private String username;
    public UserSpecification(String username) { this.username = username; }
    @Override
    public Predicate toPredicate(Root<User> root, CriteriaQuery<?> query, CriteriaBuilder cb) {
        if (username == null) return cb.conjunction();
        return cb.equal(root.get("username"), username);
    }
}
{% endhighlight %}

#### Querydslê³¼ì˜ ë¹„êµ

**Querydsl** ì€ íƒ€ì… ì•ˆì „ì„±ê³¼ ë³µì¡í•œ ì¿¼ë¦¬ ì‘ì„±ì— ê°•ì ì´ ìˆìœ¼ë©°, **Spring Data JPA** ì™€ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤. **Spring Data JPA** ëŠ” ë¹ ë¥¸ ê°œë°œê³¼ ê°„ê²°í•œ ì½”ë“œì— ìœ ë¦¬í•˜ê¸° ë•Œë¬¸ì— ì´ ë‘ ì¥ì ì„ í•©ì³ì„œ í˜¼í•©í•˜ì—¬ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ë‹¤.

{% highlight java %}
QUser user = QUser.user;

JPAQuery<User> query = new JPAQuery<>(em);
List<User> users = query
    .from(user)
    .where(user.status.eq("ACTIVE")
           .and(user.age.gt(20)))
    .orderBy(user.createdAt.desc())
    .fetch();
{% endhighlight %}

> Querydsl ì„¸íŒ…ì€ ê²€ìƒ‰í•´ì„œ í•´ë³´ì.