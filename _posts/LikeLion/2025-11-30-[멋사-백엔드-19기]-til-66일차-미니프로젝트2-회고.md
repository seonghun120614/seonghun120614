---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 66ì¼ì°¨ ë¯¸ë‹ˆí”„ë¡œì íŠ¸2 íšŒê³ "
date:   2025-11-30 20:27:05 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Project
---

<!--more-->
ìˆ˜ì •ì¤‘

## ğŸ“‚ ëª©ì°¨

- [Spring Boot ë¹Œë“œë¥¼ ìœ„í•œ Gradle ì˜ í•„ìš” íŒŒì¼](#spring-boot-ë¹Œë“œë¥¼-ìœ„í•œ-gradle-ì˜-í•„ìš”-íŒŒì¼)
- [Nginx ì˜ ê¸°ë³¸ í™ˆí˜ì´ì§€ ê²½ë¡œ](#nginx-ì˜-ê¸°ë³¸-í™ˆí˜ì´ì§€-ê²½ë¡œ)
- [Docker Container ì˜ ìë™ ì‹¤í–‰ ê²½ë¡œ](#docker-container-ì˜-ìë™-ì‹¤í–‰-ê²½ë¡œ)
- [nginx.conf í™˜ê²½ë§ˆë‹¤ ë‹¬ë¦¬ ê°€ì ¸ê°€ê¸°](#nginxconf-í™˜ê²½ë§ˆë‹¤-ë‹¬ë¦¬-ê°€ì ¸ê°€ê¸°)
- [DBeaver(ë””ë¹„ë²„) Public Key Retrieval is not allowed](#dbeaverë””ë¹„ë²„-public-key-retrieval-is-not-allowed)
- [DB ì™€ Back Container ê°„ì˜ ì‹¤í–‰ ì‹œê° ì¡°ì •](#db-ì™€-back-container-ê°„ì˜-ì‹¤í–‰-ì‹œê°-ì¡°ì •)
- [WebMvcTest](#webmvctest)
- [Bash script ë¬¸ìì—´ íŒ¨í„´ case ë³„ ë§¤ì¹­](#bash-script-ë¬¸ìì—´-íŒ¨í„´-case-ë³„-ë§¤ì¹­)
- []()

---

## ğŸ“š ë³¸ë¬¸

ë¯¸ë‹ˆí”„ë¡œì íŠ¸ë¥¼ í† ëŒ€ë¡œ ë°°ìš´ ì ë“¤ì„ ë‚˜ì—´

#### Spring Boot ë¹Œë“œë¥¼ ìœ„í•œ Gradle ì˜ í•„ìš” íŒŒì¼

- `build.gradle`
- `settings.gradle`
- `src/main/*`
- `src/test/*` -> í…ŒìŠ¤íŠ¸ í•˜ê³  ì‹¶ì„ë•Œ
- `gradlew`
- `gradle/`

í˜¹ì€ 

```gradle
tasks.named('bootBuildImage') {
    imageName = "todo-app:0.1"
    environment = [
            "BP_JVM_VERSION": "21"
    ]
}
```

```bash
./gradlew bootBuildImage    # ì´ë¯¸ì§€ ë¹Œë“œ
docker images               # í™•ì¸
```

ë˜í•œ gradle ë¬¸ë²•ì„ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¸ìë¡œë„ ë°›ì„ ìˆ˜ ìˆë‹¤.

```gradle
tasks.named('bootBuildImage') {
    def imgName = project.hasProperty('imageName')
            ? project.property('imageName')
            : 'todo-back:latest'
    imageName = imgName
    environment = [
            "BP_JVM_VERSION": "21"
    ]
}
```

project ëŠ” ì˜ˆì•½ëœ ë³€ìˆ˜ì¸ ë“¯í•˜ë‹¤(ì¶”í›„ì— ê³µë¶€ ë” í•„ìš”).

#### Nginx ì˜ ê¸°ë³¸ í™ˆí˜ì´ì§€ ê²½ë¡œ

`/usr/share/nginx/html/`

#### Docker Container ì˜ ìë™ ì‹¤í–‰ ê²½ë¡œ

`/docker-entrypoint-initdb.d/` í´ë”ì— ìˆëŠ” `.sql`, `.sh`, `.sql.gz` ë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰

#### nginx.conf í™˜ê²½ë§ˆë‹¤ ë‹¬ë¦¬ ê°€ì ¸ê°€ê¸°

ë§Œì•½ `/usr/share/nginx/html/nginx.conf` ì— ì„¤ì •íŒŒì¼ì´ ìœ„ì¹˜ë˜ì–´ ìˆë‹¤ê³  í•˜ë©´ `Dockerfile` ì—ì„œ ì•„ë˜ì™€ ê°™ì´ ê°€ì ¸ê°€ë©´ ë  ë“¯í•˜ë‹¤.

```bash
CMD ["sh", "-c", "nginx -c /usr/share/nginx/html/nginx-${PROFILE}.conf -g 'daemon off;'"]
```

#### DBeaver(ë””ë¹„ë²„) Public Key Retrieval is not allowed

MySQL JDBC ì—°ê²° ë¬¸ìì—´ì— ë¶™ì—¬ ì“°ëŠ” íŒŒë¼ë¯¸í„°ë“¤ì´ë©°, DBeaver ì—ì„œ MySQL ì ‘ì† ì‹œ ìì£¼ ë³´ëŠ” ì˜¤ë¥˜ì¸ `Public Key Retrieval is not allowed` ë¥¼ í•´ê²°í•˜ëŠ” ì„¤ì •ì´ë‹¤.

ì˜¤ë¥˜ ì›ì¸ì€ MySQL 8.x ì´ìƒì—ì„œ caching_sha2_password ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•  ë•Œ, í´ë¼ì´ì–¸íŠ¸(DBeaver, ...) ê°€ ì„œë²„ë¡œë¶€í„° ì•”í˜¸í™”ìš© public keyë¥¼ ìë™ìœ¼ë¡œ ë°›ì•„ì˜¤ëŠ” ê¸°ëŠ¥ì´ ê¸°ë³¸ì ìœ¼ë¡œ ê¸ˆì§€ë˜ì–´ ìˆë‹¤.

ê·¸ë˜ì„œ ì•„ë˜ì²˜ëŸ¼ public key ìë™ ìš”ì²­ì´ í•„ìš”í•œ ìƒí™©ì´ë©´ ì˜¤ë¥˜ê°€ ëœ¨ê²Œ ëœë‹¤.

```yml
allowPublicKeyRetrieval=true&useSSL=true
```

#### DB ì™€ Back Container ê°„ì˜ ì‹¤í–‰ ì‹œê° ì¡°ì •

ì‹œê°„ ìƒ DB ê°€ êµ¬ë™ë˜ëŠ” ì‹œê°„ë³´ë‹¤ Back Container ê°€ êµ¬ë™ë˜ëŠ” ì‹œê°„ì´ ë” í´ ìˆ˜ ìˆë‹¤.  
ì´ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ê²Œ healthcheck ì´ë©°, back ì€ db ê°€ service healthy í•œì§€ ì²´í¬ í›„ì—  
ì •ìƒì ìœ¼ë¡œ êµ¬ë™ì´ ì‹œì‘ëœë‹¤.

```docker
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 5s
      timeout: 3s
      retries: 10
...
    depends_on:
      db:
        condition: service_healthy
```

#### WebMvcTest

í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸° ìœ„í•´ ë‹¤ë¥¸ layer ë¥¼ ì˜¬ë¦´ í•„ìš” ì—†ì´ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒ ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì.

```java
@WebMvcTest(TodoController.class)
```

#### Bash script ë¬¸ìì—´ íŒ¨í„´ case ë³„ ë§¤ì¹­

```bash
for arg in "$@"; do
    case "$arg" in
        name=*) BACK_SERVER_NAME="${arg#*=}" ;;
        version=*) VERSION="${arg#*=}" ;;
        no-execution) NO_EXEC=true ;;
        *)
            echo "ì•Œ ìˆ˜ ì—†ëŠ” ì¸ì: ${arg}"
            ;;
    esac
done
```

- `args#*=`: # ìœ¼ë¡œ ë¬¸ìì—´ íŒ¨í„´ ë§¤ì¹­ë˜ëŠ” ê²ƒë“¤ ì œê±°, "(ëª¨ë“  ë¬¸ìì—´)=" ëŠ” ì œê±° í›„ ë‚¨ì€ê±° ë°˜í™˜