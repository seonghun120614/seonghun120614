---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 49ì¼ì°¨ Spring Security Servlet"
date:   2025-11-04 09:45:31 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Java Spring
---

<!--more-->

## ğŸ“‚ ëª©ì°¨

- []()
- []()

---

## ğŸ“š ë³¸ë¬¸

### Spring Security

ì–´í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆì€ ì„œë¸”ë¦¿ê³¼ ë¦¬ì•¡í‹°ë¸Œ ìš©ìœ¼ë¡œ ë‚˜ë‰˜ì§€ë§Œ ì´ë¥¼ ë³´ê¸° ì „ì— ì „ë°˜ì ì¸ ì•„í‚¤í…ì³ë¥¼ ë°”ë¼ë³¸ë‹¤.

#### Architecture

![assets/img/filter-chain.png]({{ site.baseurl }}/assets/img/filter-chain.png)

ìš°ì„  ì„œë¸”ë¦¿ì—ì„œì˜ security ì—­í• ì„ ë¨¼ì € ë³´ì. ì„œë¸”ë¦¿ì—ì„œì˜ Spring Security ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ê°œë…ì¸ **Servlet Filters** ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ê¸° ë•Œë¬¸ì—, ë¨¼ì € í•„í„°ì˜ ê°œë…ê³¼ ì—­í• ì„ ì‚´í´ë³´ëŠ”ê²Œ ì¢‹ë‹¤.

##### Filters

í´ë¼ì´ì–¸íŠ¸ê°€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ìš”ì²­ì„ ë³´ë‚´ë©´, ì»¨í…Œì´ë„ˆëŠ” `FilterChain` ì„ ìƒì„±í•˜ê²Œ ëœë‹¤. `FilterChain` ì€ ìš”ì²­ `URI` ì˜ ê²½ë¡œì— ë”°ë¼ í•´ë‹¹ ìš”ì²­ì„ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” `FilterChain` ì¸ìŠ¤í„´ìŠ¤ ì™€ **Servlet** ì„ í¬í•¨í•œë‹¤.

Spring MVC ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ Servlet ì´ `DispatcherServlet` ì˜ ì¸ìŠ¤í„´ìŠ¤ì´ë©°, í•˜ë‚˜ì˜ `HttpServletRequest` ì™€ `HttpServletResponse` ëŠ” ìµœëŒ€ í•˜ë‚˜ì˜ `Servlet` ë§Œì´ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ ì—¬ëŸ¬ ê°œì˜ `Filter` ëŠ” ì„œë¸”ë¦¿ê³¼ ë‹¤ë¥´ê²Œ ì—¬ëŸ¬ ê°œë¥¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ê·¸ ëª©ì ì€ ë‹¤ìŒê³¼ ê°™ë‹¤:

- `FilterChain` ë‚´ ë‹¤ìŒ ìˆœì„œì˜ ë‹¤ë¥¸ `Filter` ì¸ìŠ¤í„´ìŠ¤ë‚˜ `Servlet` ì´ í˜¸ì¶œë˜ì§€ ì•Šë„ë¡ ì°¨ë‹¨í•¨, ì´ ê²½ìš°ì—ëŠ” í•´ë‹¹ `Filter` ê°€ ì§ì ‘ `HttpServletResponse` ë¥¼ ì‘ì„±í•˜ê²Œ ëœë‹¤.

- í•˜ìœ„ `Filter` ì¸ìŠ¤í„´ìŠ¤ í˜¹ì€ `Servlet` ì´ ì‚¬ìš©í•  `HttpServletResponse` ë¥¼ ì‘ì„±í•œë‹¤. ì¦‰, í˜„ì¬ í•„í„°ê°€ ìš”ì²­ì´ë‚˜ ì‘ë‹µì„ ê°€ë¡œì±„ì„œ ë°”ê¾¼ë’¤ ë‹¤ìŒ í•„í„°ë‚˜ ì„œë¸”ë¦¿ì—ê²Œ ì „ë‹¬ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤(doFilter ìª½).

ë‘ ë²ˆì§¸ ê²½ìš°ê°€ ê°€ì¥ ë§ì´ ì“°ì´ëŠ”ë° ë‹¤ìŒì„ ë³´ì.

**Request ìˆ˜ì •**
{% highlight java %}
public void doFilter(ServletRequest request,
                     ServletResponse response,
                     FilterChain chain)
        throws IOException, ServletException {
    
    HttpServletRequest httpRequest = (HttpServletRequest) request;

    // HttpServletRequestë¥¼ ê°ì‹¸ì„œ í—¤ë”ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” Wrapperë¥¼ ë§Œë“¦
    HttpServletRequestWrapper wrappedRequest = new HttpServletRequestWrapper(httpRequest) {
        @Override
        public String getHeader(String name) {
            if ("Authorization".equalsIgnoreCase(name))
                return "Bearer dummy-token"; // ìƒˆë¡œìš´ í—¤ë” ê°’ ì£¼ì…
            return super.getHeader(name);
        }
    };

    // ìˆ˜ì •ëœ ìš”ì²­ ê°ì²´ë¥¼ ë‹¤ìŒ Filterë‚˜ Servletì—ê²Œ ë„˜ê¹€
    chain.doFilter(wrappedRequest, response);
}
{% endhighlight %}

ì´ ê²½ìš°ì— ì›ë˜ `Authorization` í—¤ë”ê°€ ì—†ë˜ ìš”ì²­ì´, ë‹¤ìŒ ì„œë¸”ë¦¿ìœ¼ë¡œ ë„˜ì–´ê°ˆ ë•Œì—ëŠ” `Authorization: Bearer dummy-token` ì„ ê°€ì§„ ìš”ì²­ìœ¼ë¡œ ë°”ë€ë‹¤. ì´ ì—­í• ì€ `HttpServletRequestWrapper` ë¡œ í•˜ê²Œ ëœë‹¤.

**Response ìˆ˜ì •**

ì‘ë‹µì„ ë‹¤ìŒì²˜ëŸ¼ ìˆ˜ì •í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤. ëª¨ë“  ì‘ë‹µì— ê³µí†µ ë³´ì•ˆ í—¤ë”ë¥¼ ì¶”ê°€í•˜ê³  ì‹¶ì„ ë•Œ:

{% highlight java %}
public void doFilter(ServletRequest request,
                     ServletResponse response,
                     FilterChain chain)
        throws IOException, ServletException {

    HttpServletResponse httpResponse = (HttpServletResponse) response;

    // ì²´ì¸ ë‚´ ë‹¤ìŒ í•„í„°ë‚˜ ì„œë¸”ë¦¿ì„ ë¨¼ì € ì‹¤í–‰
    chain.doFilter(request, response);

    // ì‘ë‹µì— ê³µí†µ í—¤ë” ì¶”ê°€
    httpResponse.setHeader("X-Security-Checked", "true");
}
{% endhighlight %}

ì´ ê²½ìš°ëŠ” ì„œë¸”ë¦¿ì´ ì‘ë‹µì„ ë§Œë“  ë’¤, í•„í„°ë“¤ì„ ê±°ì¹˜ê²Œ ë˜ëŠ”ë° ê·¸ ì‘ë‹µì„ ë°›ì•„ì„œ **í—¤ë”ë¥¼ ë§ë¶™ì´ê³  ìµœì¢… í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬**í•˜ê²Œ ëœë‹¤.

ê²°êµ­ì—ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” ë°ì´í„° ë°”ë””ë§Œ ì²˜ë¦¬í•˜ë„ë¡ í•  ìˆ˜ ìˆê³ , ì±…ì„ì€ í•„í„°ìª½ìœ¼ë¡œ ë„˜ê¸°ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

> í•„í„°ëŠ” ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ í•„í„° ì¸ìŠ¤í„´ìŠ¤ì™€ ì„œë¸”ë¦¿ì—ë§Œ ì˜í–¥ì„ ë¯¸ì¹˜ë¯€ë¡œ ê° í•„í„°ê°€ í˜¸ì¶œë˜ëŠ” ìˆœì„œëŠ” ë§¤ìš° ì¤‘ìš”

##### DelegatingFilterProxy

Spring ì˜ í•„í„°ì—ëŠ” ê°€ì¥ ì¤‘ìš”í•œ í•„í„° êµ¬í˜„ì²´ì¸ **DelegatingFilterProxy** ê°€ ìˆë‹¤. ì„œë¸”ë¦¿ **ì»¨í…Œì´ë„ˆ(í†°ìº£ ë“±ë“±)** ì™€ `SpringApplicationContext` ì‚¬ì´ë¥¼ ì—°ê²°í•´ì£¼ëŠ” ë‹¤ë¦¬ ì—­í• ì„ í•œë‹¤.

ì´ëŸ°ê²Œ í•„ìš”í•œ ì´ìœ ëŠ” ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” ì›ë˜ ìë°” í‘œì¤€ì¸ `javax.servlet.Filter` ë¥¼ ì¸ì‹í•œë‹¤. ì´ ë§ì€ ì¦‰ìŠ¨ í•„í„° ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë“±ë¡í•˜ë©´ ìš”ì²­ê³¼ ì‘ë‹µì„ ê°€ë¡œì±„ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

ê·¸ëŸ°ë° ë¬¸ì œëŠ” **ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” Spring ì´ ê´€ë¦¬í•˜ëŠ” Bean ì„ ëª¨ë¥¸ë‹¤ëŠ” ê²ƒì´ë‹¤**(ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ IoC ëŠ” ì™„ì „íˆ ë³„ê°œì˜ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¡œ êµ¬ì„±ë˜ê¸° ë•Œë¬¸).

ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì´ ìƒê¸°ê²Œ ëœë‹¤:
- í†°ìº£: í•„í„°ëŠ” ë“±ë¡í–ˆëŠ”ë° ì–˜ëŠ” ê·¸ëƒ¥ ìë°” ê°ì²´ë¼ í•´ì„í•  ìˆ˜ ì—†ë‹¤
- ìŠ¤í”„ë§: í•„í„°ëŠ” ë‚´ê°€ ê´€ë¦¬í•˜ëŠ” ë¹ˆìœ¼ë¡œ ë“±ë¡í–ˆëŠ”ë° í†°ìº£ì´ ê·¸ê±¸ ëª¨ë¦„

ê·¸ë˜ì„œ ë“±ì¥í•œ ê²ƒì´ `DelegatingFilterProxy` ë¡œ ë§ ê·¸ëŒ€ë¡œ í•„í„°ë¥¼ ìœ„ì„í•˜ëŠ” ê²ƒì´ë‹¤.

1. ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” `DelegatingFilterProxy` ë¼ëŠ” ê»ë°ê¸° í•„í„°ë¥¼ ë“±ë¡í•˜ê³ 
2. ì‹¤ì œ ë¡œì§ì€ Spring ì´ ê´€ë¦¬í•˜ëŠ” `Bean`(ì§„ì§œ í•„í„° êµ¬í˜„ì²´) ì—ê²Œ ìœ„ì„í•˜ëŠ” ë°©ì‹

{% highlight text %}
[Client Request]
      â†“
[Servlet Container]
      â†“
[DelegatingFilterProxy]  â† (ë“±ë¡ëœ í‘œì¤€ ì„œë¸”ë¦¿ í•„í„°)
      â†“
[Spring Bean: ì‹¤ì œ Filter êµ¬í˜„ì²´]  â† (Springì´ ê´€ë¦¬)
      â†“
[DispatcherServlet â†’ Controller ...]
{% endhighlight %}

ë”°ë¼ì„œ Spring Security ì˜ ì§„ì…ì ì´ ë°”ë¡œ ì´ êµ¬ì¡°ì´ë‹¤. `DelegatingFilterProxy` ê°€ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì— ë“±ë¡ë˜ì–´ ìˆê³ , ì‹¤ì œ í•„í„° ì²´ì¸ì€ ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ ì•ˆì˜ `springSecurityFilterChain` ì´ë¼ëŠ” ë¹ˆì´ ë‹´ë‹¹í•˜ê²Œ ëœë‹¤(ì‹¤ì œë¡œ `springSecurityFilterChain` ì´ë¼ëŠ” ê²ƒì„ í•¨ìˆ˜ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë ¤ê³  í•˜ë©´ ì‹¤í–‰ ì‹œ ì˜¤ë¥˜ê°€ ëœ¬ë‹¤. ë™ì¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤).

{% highlight java %}
@Bean
public Filter springSecurityFilterChain() {
    // ì—¬ê¸°ì— ìˆ˜ë§ì€ SecurityFilterë“¤ì´ ì²´ì¸ í˜•íƒœë¡œ ì—°ê²°ë¨
}
{% endhighlight %}

ì´ì œ ê·¸ëŸ¬ë©´ í†°ìº£ ì…ì¥ì—ì„œëŠ” `DelegatingFilterProxy` ë§Œ ì•Œë©´, ì‹¤ì œ í•„í„°ëŠ” Spring ì´ ê´€ë¦¬í•˜ê²Œ ë˜ë©° Spring ì´ ì´ë¥¼ ì—°ê²°ì‹œí‚¤ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

**ì •ë¦¬**
- `Servlet Container`: í•„í„°ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ì§€ë§Œ, ìŠ¤í”„ë§ ë¹ˆì€ ëª¨ë¦„
- `Spring Application`: ìŠ¤í”„ë§ ë¹ˆì„ ê´€ë¦¬í•˜ì§€ë§Œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” ëª¨ë¦„
- `DelegatingFilterProxy`: ë‘˜ ì‚¬ì´ë¥¼ ì—°ê²°í•˜ëŠ” ìœ„ì„ í•„í„°ì´ë©° í”„ë¡ì‹œ ì—­í• ì„ í•¨

`DelegatingFilterProxy` ëŠ” ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì™€ ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ì˜ í•„í„° ì—°ê²° ì–´ëŒ‘í„°ì´ë‹¤. **Spring Security**, **Spring Session**, **Spring Web Flow** ë“±ë“±ê³¼ ê°™ì€ ë³´ì•ˆ/ì„¸ì…˜ ê´€ë ¨ ê¸°ëŠ¥ë“¤ì€ ì „ë¶€ ì´ êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëŒì•„ê°€ê²Œ ëœë‹¤.

ì•„ë˜ëŠ” ê·¸ ì˜ˆì‹œì´ë‹¤.

![assets/img/delegating-filter-proxy.png]({{ site.baseurl }}/assets/img/delegating-filter-proxy.png)

`DelegatingFilterProxy` ëŠ” `ApplicationContext` ì—ì„œ `Filter0` ë¼ëŠ” `Bean` ì„ ì°¾ì•„ë‚¸ ë‹¤ìŒ ê·¸ `Filter0` ë¥¼ í˜¸ì¶œí•˜ê²Œ ëœë‹¤. ì•„ë˜ ì˜ˆì‹œëŠ” DelegatingFilterProxy ì˜ ë™ì‘ ë°©ì‹ì„ ë³´ì—¬ì£¼ëŠ” pseudo code ì´ë‹¤.

{% highlight java %}
public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
	Filter delegate = getFilterBean(someBeanName);
	delegate.doFilter(request, response);
}
{% endhighlight %}

Spring Bean ìœ¼ë¡œ ë“±ë¡ëœ `Filter` ë¥¼ **lazy** í•´ì„œ ê°€ì ¸ì˜¤ê²Œ ë˜ë©°, `DelegatingFilterProxy` ì˜ ì˜ˆì‹œì—ì„œëŠ” delegate ê°€ Bean Filter0 ì˜ ì¸ìŠ¤í„´ìŠ¤ì´ë‹¤.

- ì‹¤ì œ ì‘ì—… ì²˜ë¦¬ëŠ” `Filter` ì—ê²Œ ìœ„ì„
- `DelegatingFilterProxy` ì˜ ë˜ ë‹¤ë¥¸ ì¥ì ìœ¼ë¡œ í•„í„° ë¹ˆ ì¸ìŠ¤í„´ìŠ¤ ì¡°íšŒë¥¼ ëŠ¦ì¶œ ìˆ˜ ìˆë‹¤

ë‘ ë²ˆì§¸ ë‚´ìš©ì€ í†°ìº£ê³¼ ê°™ì€ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì˜ë  ë•Œ ê°€ì¥ ë¨¼ì € Filterë“¤ì„ ë“±ë¡í•˜ê²Œ ëœë‹¤. í•„í„°ëŠ” `HTTP` ìš”ì²­ì´ ë“¤ì–´ì˜¤ëŠ” ê°€ì¥ ì²« ì‹œì ì—ì„œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ê°€ì¥ ë¨¼ì € ì¸ìŠ¤í„´ìŠ¤ê°€ ë“±ë¡ë˜ì–´ì•¼ í•œë‹¤.

> í•„í„° ë“±ë¡ > ìŠ¤í”„ë§ ë¹ˆ ë¡œë”©

í•˜ì§€ë§Œ ì´ë•Œ ë¬¸ì œê°€ ìƒê¸°ëŠ”ë°, ì˜ˆë¥¼ ë“¤ì–´ ìš°ë¦¬ì˜ Spring Security ì˜ í•„í„°ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í–ˆë‹¤ê³  í•˜ì.

{% highlight java %}
@Bean
public Filter securityFilter() {
    return new MySecurityFilter();
}
{% endhighlight %}

í†°ìº£ì´ í•„í„°ë¥¼ ë“±ë¡í•´ì•¼ í•˜ëŠ” ì‹œì ì— ì•„ì§ ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ê°€ ë§Œë“¤ì–´ì§€ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒì´ë‹¤. ì¦‰, `@Bean` ë“¤ì€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì€ ìƒíƒœì¸ë°, í†°ìº£ì´ í•„í„° ì¸ìŠ¤í„´ìŠ¤ ì¢€ ë‹¬ë¼ê³  ìš”ì²­ì´ ì™”ì„ ë•Œ, ìŠ¤í”„ë§ì€ ì´ì™€ ê°™ì€ êµ¬í˜„ì²´ ë¹ˆì„ ì•„ì§ ê°€ì§€ê³  ìˆì§€ ì•Šì•„ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.

ì´ë¥¼ ë°©ì§€í•˜ëŠ” ê²ƒì´ ë°”ë¡œ `DelegatingFilterProxy` ì´ë©°, ì´ ì¼ë°˜í™” ëœ í•„í„°ëŠ” ë‹¤ë¥¸ í•„í„°ë¥¼ `Lazy Lookup` ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ê°€ ë‚˜ì¤‘ì— ì—´ë¦° í›„ì— ê±°ê¸° ìˆëŠ” ì§„ì§œ í•„í„°ë¥¼ ì°¾ì•„ì™€ì„œ ì—°ê²°í•˜ëŠ” ì—­í• ì„ í•˜ê²Œ ëœë‹¤.

> DelegatingFilterProxy ì™€ í•¨ê»˜ í•„í„° ë“±ë¡ > ìŠ¤í”„ë§ ë¹ˆ ë¡œë”© > ì§„ì§œ í•„í„° ì°¾ì•„ì„œ ì—°ê²°

##### FilterChainProxy

![assets/img/delegating-filter-proxy.png]({{ site.baseurl }}/assets/img/delegating-filter-proxy.png)

ì§€ê¸ˆì²˜ëŸ¼ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ êµ¬ì¡°ì—ì„œ ì´ì œ `DelegatingFilterProxy` -> `FilterChainProxy` ë¥¼ ë³´ì.

`DelegatingFilterProxy` ëŠ” í†°ìº£ê³¼ ìŠ¤í”„ë§ì˜ ì»¨í…ìŠ¤íŠ¸ì˜ ìƒëª…ì£¼ê¸° ë¶ˆì¼ì¹˜ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ì„¤ê³„ì  í•´ë²•ì„ì„ ìœ„ì—ì„œ ë³´ì•˜ë‹¤. ì´ë•Œ í†°ìº£ì€ ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì‹œì‘ ì§€ì ì— ë“±ë¡í•´ì•¼ í•˜ì§€ë§Œ, ìŠ¤í”„ë§ì€ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ì´í›„ì—ì•¼ í•„í„° ë¹ˆì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤. 

ì¦‰ í•„í„°ì˜ ë“±ë¡ì‹œì ê³¼ ìƒì„±ì‹œì ì´ ì–´ê¸‹ë‚˜ê¸° ë•Œë¬¸ì—, `DelegatingFilterProxy` ë¡œ ì´ ê°„ê·¹ì„ ë©”ì›Œ ë“±ë¡ì€ í†°ìº£ì´ ë¨¼ì €, ì‹¤í–‰ì€ ìŠ¤í”„ë§ì´ ë‚˜ì¤‘ì— ì‹¤í–‰í•˜ëŠ” êµ¬ì¡°ë¥¼ ê°€ì§€ê²Œ ëœë‹¤.

ê·¸ë¦¬ê³  ì´ êµ¬ì¡° ìœ„ì— `FilterChainProxy` ê°€ ìˆëŠ”ë°, `FilterChainProxy` ëŠ” ì—¬ëŸ¬ `SecurityFilter` ë¥¼ ì²´ì¸ í˜•íƒœë¡œ ë¬¶ì–´ ë³´ì•ˆë¡œì§ì˜ ì¡°ë¦½ì‹ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•˜ê²Œ ëœë‹¤. Spring Security ì˜ ì‹¤ì§ˆì  ë™ì‘ì€ ì „ë¶€ ì´ `FilterChainProxy` ë‚´ë¶€ì—ì„œ ì¼ì–´ë‚˜ê²Œ ëœë‹¤.

##### SecurityFilterChain

![assets/img/security-filter-chain.png]({{ site.baseurl }}/assets/img/security-filter-chain.png)

ì´ì œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ í•µì‹¬ì¸ `SecurityFilterChain` ì„ ë³´ì. `SecurityFilterChain` ì•ˆì— ë“¤ì–´ìˆëŠ” `Security Filter` ë“¤ì€ ëŒ€ë¶€ë¶„ Spring Bean ì´ì§€ë§Œ, ì´ í•„í„°ë“¤ì€ `DelegatingFilterProxy` ì— ì§ì ‘ ë“±ë¡ë˜ì§€ ì•Šê³  ëŒ€ì‹  `FilterChainProxy` ì— ë“±ë¡ë˜ê²Œ ëœë‹¤.

ì´ë ‡ê²Œ í•˜ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì´ì ì„ ì§€ë‹ˆê¸° ë•Œë¬¸ì´ë‹¤:

1. Spring Security ì„œë¸”ë¦¿ ì§€ì›ì˜ ì‹œì‘ì  (Entry Point)
    - ì„œë¸”ë¦¿ ê¸°ë°˜ ë³´ì•ˆ ë¡œì§ì˜ ì¶œë°œì ì´ê¸° ë•Œë¬¸

2. `FilterChainProxy` ëŠ” ê³µí†µì ì´ê³  í•„ìˆ˜ì ì¸ ì‘ì—…ì„ ìˆ˜í–‰ í•˜ëŠ” ì±…ì„
    - ë”°ë¼ì„œ ì¤‘ì‹¬ë¶€ì— ìˆê¸°ì—, ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ë°˜ë“œì‹œ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ë“¤ì„ ë‹´ë‹¹í•˜ë„ë¡ í•  ìˆ˜ ìˆìŒ(`SecurityContext` ì´ˆê¸°í™” ë° ì •ë¦¬, `HttpFirewall` ì ìš©)

3. ìš”ì²­ ë§¤ì¹­ì˜ ìœ ì—°ì„±
    - ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì˜ ê¸°ë³¸ í•„í„° êµ¬ì¡°ëŠ” URL íŒ¨í„´ë§Œì„ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë¥¼ í˜¸ì¶œí•˜ì§€ë§Œ
    - `FilterChainProxy` ëŠ” `RequestMatcher` ì¸í„°í˜ì´ìŠ¤ ë“±ì„ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì˜ ì–´ë–¤ ì†ì„±ì´ë“  ë§¤ì¹­ ì¡°ê±´ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

4. ì—¬ëŸ¬ ê°œì˜ `SecurityFilterChain`
    - í•˜ë‚˜ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì—¬ëŸ¬ ê°œì˜ `SecurityFilterChain` ì´ ì¡´ì¬í•  ìˆ˜ ìˆìŒ

ì¦‰, `FilterChainProxy` ëŠ” ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ë³´ê³  ì–´ë–¤ `SecurityFilterChain` ì´ ì´ ìš”ì²­ì„ ì²˜ë¦¬í• ì§€ë¥¼ ê²°ì •í•˜ê³  ê·¸ ì²´ì¸ ì•ˆì˜ í•„í„°ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•˜ê²Œ ëœë‹¤.

> `DelegatingFilterProxy` ëŠ” **ìŠ¤í”„ë§ê³¼ ì„œë¸”ë¦¿ ì„¸ê³„ë¥¼ ì—°ê²°**í•˜ê³ ,  
`FilterChainProxy` ëŠ” **ìš”ì²­ íë¦„ì„ ë³´ì•ˆ ì²´ì¸ ë‹¨ìœ„ë¡œ ê´€ë¦¬**í•˜ë©°,  
`SecurityFilterChain` ì€ **ê° ìš”ì²­ì— ë§ëŠ” ë³´ì•ˆ ê·œì¹™ ì„¸íŠ¸ë¥¼ ì •ì˜**

ë‹¤ìŒê³¼ ê°™ì€ ì—¬ëŸ¬ ê°œì˜ ë³´ì•ˆ í•„í„° ì²´ì¸ì„ ê°€ì§ˆ ë•Œ `Spring Security` ê°€ ì–´ë–¤ ì²´ì¸ì„ ì„ íƒí•´ì„œ ì‹¤í–‰í•˜ëŠ”ì§€ ë³´ì.

![assets/img/multi-security-filter-chain.png]({{ site.baseurl }}/assets/img/multi-security-filter-chain.png)

`FilterChainProxy` ëŠ” ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì— ëŒ€í•´ ì–´ë–¤ `SecurityFilterChain` ì„ ì‚¬ìš©í• ì§€ ê²°ì •í•œë‹¤. ì—¬ëŸ¬ ì²´ì¸ ì¤‘ ê°€ì¥ ë¨¼ì € ë§¤ì¹­ë˜ëŠ”(`SecurityFilterChain`) "í•˜ë‚˜ë§Œ" ì‹¤í–‰ëœë‹¤.

**ì˜ˆì‹œ**

ìš”ì²­ URL ì´ `/api/messages` ì¸ ê²½ìš°

1. ì²«ë²ˆì§¸ ì²´ì¸ì¸ `SecurityFilterChain0` ì˜ íŒ¨í„´ `/api/**` ì— ë§¤ì¹­
2. ë”°ë¼ì„œ `SecurityFilterChain0` ë§Œ ì‹¤í–‰ëœë‹¤
3. ë¹„ë¡ `/api/messages/` ê°€ `SecurityFilterChainN` ì˜ íŒ¨í„´ê³¼ ë§ì„ ìˆ˜ë„ ìˆì§€ë§Œ, ê°€ì¥ ë¨¼ì € ì¼ì¹˜í•œ ì²´ì¸ë§Œì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì›ì¹™ìœ¼ë¡œ í•œë‹¤.

> ì‹¬ì§€ì–´ í•„í„°ê°€ 0ê°œ ì¼ ìˆ˜ë„ ìˆë‹¤.

##### SecurityFilters

`SecurityFilterChain` ì€ ë‚´ë¶€ì ìœ¼ë¡œ ì—¬ëŸ¬ ë³´ì•ˆ í•„í„°(`Security Filter`) ë“¤ì„ í¬í•˜ë§ˆê³  ìˆìœ¼ë©°, ì´ í•„í„°ë“¤ì€ `SecurityFilterChain API` ë¥¼ í†µí•´ `FilterChainProxy` ì•ˆì— ì‚½ì…ë˜ê²Œ ëœë‹¤.

ì¦‰, `FilterChainProxy` ê°€ ì „ì²´ ë³´ì•ˆ íŒŒì´í”„ë¼ì¸ì˜ ì»¨í…Œì´ë„ˆë¼ë©´, ê·¸ ì•ˆì— ë“¤ì–´ìˆëŠ” ê°œë³„ ë³´ì•ˆ ëª¨ë“ˆë“¤ì´ ë°”ë¡œ Security Filter ë“¤ì´ë‹¤.

í•„í„°ë“¤ì€ ë‹¤ì–‘í•œ ì—­í• ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

**ì—­í• **
- ìµìŠ¤í”Œë¡œì‡(ì·¨ì•½ì ) ë°©ì–´ - CSRF, ì„¸ì…˜ ê³ ì •, XSS ë“± ê³µê²© ì°¨ë‹¨
- ì¸ì¦(Authentication) - ì‚¬ìš©ìì˜ ì‹ ì› í™•ì¸
- ì¸ê°€(Authorization) - í•´ë‹¹ ì‚¬ìš©ìê°€ íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ ê°€ëŠ¥í•œì§€ í™•ì¸

ì´ ëª¨ë“  ê³¼ì •ì´ í•„í„° ì²´ì¸ ë‚´ë¶€ì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ ì¼ì–´ë‚˜ê²Œ ëœë‹¤.

ìœ„ì—ì„œ ë§í–ˆì§€ë§Œ, ì‹¤í–‰ ìˆœì„œëŠ” ì¤‘ìš”í•˜ë‹¤. ë³´ì•ˆ í•„í„°ë“¤ì€ ì •í•´ì§„ ìˆœì„œë¡œ ì‹¤í–‰ë˜ë©°, ì¸ì¦ì´ ëë‚˜ì•¼ ì¸ê°€ë¥¼ í•  ìˆ˜ ìˆê³ , ì„¸ì…˜ ê²€ì¦ì´ ëë‚˜ì•¼ ì¸ì¦ ì ˆì°¨ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ëŠ” ìˆœì„œë¥¼ ì§ì ‘ ì•Œ í•„ìš”ëŠ” ì—†ìœ¼ë©°, ì¼ë°˜ì ìœ¼ë¡œ Spring Security ê°€ ë‚´ë¶€ì ìœ¼ë¡œ í•„í„°ë“¤ì„ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ë“±ë¡í•´ì£¼ê¸° ë•Œë¬¸ì´ë‹¤.

ìˆœì„œë¥¼ ì•Œì•„ì•¼í•  ê²½ìš°ëŠ” ë‹¤ìŒ ë•Œê°€ ìˆë‹¤:
- ì»¤ìŠ¤í…€ í•„í„°ë¥¼ íŠ¹ì • í•„í„° ì•ì´ë‚˜ ë’¤ì— ì¶”ê°€í•˜ê³  ì‹¶ì„ë•Œ
- ë””ë²„ê¹… ì¤‘ ì–´ë–¤ í•„í„°ê°€ ë¨¼ì € ì‹¤í–‰ë˜ëŠ”ì§€ ì•Œê³  ì‹¶ì„ë•Œ

ì´ëŸ´ ë• `FilterOrderRegistration` ì½”ë“œë¥¼ ì°¸ê³ í•˜ë©´, ê° í•„í„°ê°€ ì–´ë–¤ ìˆœì„œë¡œ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**í•„í„° ë“±ë¡ ë°©ë²• - HttpSecurity**

ì´ ë³´ì•ˆ í•„í„°ë“¤ì„ ëŒ€ë¶€ë¶„ HttpSecurity ë¥¼ í†µí•´ ì„ ì–¸ëœë‹¤. ì¦‰ ìš°ë¦¬ê°€ í”íˆ ì‘ì„±í•˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì„¤ì • ì½”ë“œê°€ ê²°êµ­ì€ SecurityFilterChain ì•ˆì˜ í•„í„°ë“¤ì„ êµ¬ì„±í•˜ëŠ” ëª…ë ¹ì´ ëœë‹¤.

{% highlight java %}
@Override
protected void configure(HttpSecurity http) throws Exception {
    http
        .csrf().and()
        .authorizeRequests()
            .antMatchers("/admin/**").hasRole("ADMIN")
            .anyRequest().authenticated()
        .and()
        .formLogin();
}
{% endhighlight %}

- `.csrf()` - `CsrfFilter` ì¶”ê°€
- `.authorizeRequests()` - `AuthorizationFilter` ì¶”ê°€
- `.formLogin()` - `UserPasswordAuthenticationFilter` ì¶”ê°€

ì¦‰, `HttpSecurity` ëŠ” í•„í„° ì²´ì¸ì„ ì„ ì–¸ì ìœ¼ë¡œ ì¡°ë¦½í•˜ëŠ” DSL ì´ë¼ê³  ì´í•´í•  ìˆ˜ ìˆë‹¤.

ìœ„ ì„¤ì •ì€ ë‹¤ìŒ ì‹¤í–‰ ìˆœì„œë¥¼ ê°€ì§„ë‹¤

1. `CsrfFilter`: `HttpSecurity#csrf`, CSRF ê³µê²© ì°¨ë‹¨ì„ ìœ„í•œ ìœ íš¨í•œ í† í°ì„ í¬í•¨í•˜ê³  ìˆëŠ”ê°€?

2. Authentication ê´€ë ¨ í•„í„°
    - `BasicAuthenticationFilter`: `HttpSecurity#httpBasic`, Http Basic ì¸ì¦
    - `UsernamePasswordAuthenticationFilter`: `HttpSecurity#formLogin`, í¼ ë¡œê·¸ì¸ ê¸°ë°˜ ì¸ì¦

4. `AuthorizationFilter`: `HttpSecurity#authorizeHttpRequests`
    - ìŠ¹ì¸ëœ ì‚¬ìš©ì(role ë˜ëŠ” ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ì) ì¸ì§€ í™•ì¸


> ì´ ì™¸ì—ë„ ë‹¤ì–‘í•œ í•„í„°ë“¤ì´ ì¡´ì¬í•œë‹¤.  
SecurityContextPersistenceFilter  
LogoutFilter  
ExceptionTranslationFilter  
RequestCacheAwareFilter  
...  
  
**ì´ë“¤ì€ HttpSecurity ì„¤ì •ì˜ ì„¸ë¶€ ì˜µì…˜ì— ë”°ë¼ ì¶”ê°€ë˜ê¸°ë„ í•˜ê³  ìƒëµë˜ê¸°ë„ í•œë‹¤.**


##### ì²´ì¸ ë””ë²„ê¹…í•˜ê¸°

Spring Security ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ìš”ì²­ë§ˆë‹¤ ì–´ë–¤ í•„í„° ì²´ì¸ì´ êµ¬ì„±ë˜ì–´ ìˆëŠ”ì§€ ë¡œê¹…í•  ìˆ˜ ìˆë‹¤.

{% highlight java %}
import org.springframework.security.web.FilterChainProxy;

@Autowired
private FilterChainProxy filterChainProxy;

@PostConstruct // ìë°” í‘œì¤€(JSR-250) ì— ì •ì˜ëœ ì• ë„ˆí…Œì´ì…˜ì´ë©°, ì´ ê°ì²´ê°€ ì™„ì „íˆ ì¤€ë¹„ëœ ë‹¤ìŒì— ë”± í•œ ë²ˆ ì‹¤í–‰í•´ì¤˜ ë¼ëŠ” ì˜ë¯¸ì´ë‹¤.
public void printFilters() {
    filterChainProxy.getFilterChains().forEach(chain -> {
        System.out.println("=== Security FilterChain for pattern: " + chain.getRequestMatcher());
        chain.getFilters().forEach(f -> System.out.println(" - " + f.getClass().getSimpleName()));
    });
}
{% endhighlight %}

> ë³´í†µ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ `Configuration` ì´ë‚˜ `Component` ë¡œ ë“±ë¡ëœ í•˜ë‚˜ì—ë§Œ ì‘ì„±í•˜ë©´ ëœë‹¤.  
ë‹¤ë§Œ `FilterChainProxy` ë¹ˆì€ Spring Security ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ë“±ë¡í•˜ê¸° ë•Œë¬¸ì—  
`SpringAutoConfiguration` ì´ ì™„ë£Œëœ ì´í›„ì—ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

##### Spring Filters ì¶œë ¥

ë³´í†µ íŠ¹ì • ìš”ì²­ì— ëŒ€í•´ ì–´ë–¤ ë³´ì•ˆ í•„í„°ë“¤ì´ ì‹¤ì œë¡œ í˜¸ì¶œë˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œê°€ ìˆì„ ê²ƒì´ë‹¤.

**ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ í•„í„° ëª©ë¡ ë³´ê¸°**

ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— ê° ë³´ì•ˆ í•„í„° ì²´ì¸(`SecurityFilterChain`) ì— ì–´ë–¤ í•„í„°ë“¤ì´ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ë¥¼ `DEBUG` ë ˆë²¨ ë¡œê·¸ë¡œ ì¶œë ¥í•˜ê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•´ì¤€ë‹¤.

{% highlight java %}
logging.level.org.springframework.security=DEBUG
{% endhighlight %}

{% highlight text %}
2023-06-14T08:55:22.321-03:00  DEBUG 76975 --- [main]
o.s.s.web.DefaultSecurityFilterChain : Will secure any request with [
    DisableEncodeUrlFilter,
    WebAsyncManagerIntegrationFilter,
    SecurityContextHolderFilter,
    HeaderWriterFilter,
    CsrfFilter,
    LogoutFilter,
    UsernamePasswordAuthenticationFilter,
    DefaultLoginPageGeneratingFilter,
    DefaultLogoutPageGeneratingFilter,
    BasicAuthenticationFilter,
    RequestCacheAwareFilter,
    SecurityContextHolderAwareRequestFilter,
    AnonymousAuthenticationFilter,
    ExceptionTranslationFilter,
    AuthorizationFilter
]
{% endhighlight %}

í•„í„°ë“¤ì´ ìˆœì°¨ì ìœ¼ë¡œ ì–´ë–»ê²Œ ì‹¤í–‰ëëŠ”ì§€ ë³¼ ìˆ˜ ìˆë‹¤.

**ìš”ì²­ë§ˆë‹¤ í•„í„° í˜¸ì¶œ ê³¼ì •ì„ ë¡œê·¸ë¡œ í™•ì¸**

ì´ê²Œ ê°€ì¥ ìœ ìš©í•˜ë©°, ë‹¨ìˆœíˆ í•„í„°ê°€ ë“±ë¡ë˜ì—ˆëŠ”ê°€ ë¿ ì•„ë‹ˆë¼ íŠ¹ì • ìš”ì²­ì—ì„œ ì‹¤ì œë¡œ ì–´ë–¤ í•„í„°ë“¤ì´ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤. `Security Events` ë¥¼ ì¼œë©´ ê° í•„í„°ì˜ ì‹¤í–‰ ì‹œì , ì˜ˆì™¸ ë°œìƒ ìœ„ì¹˜, ì¸ì¦/ì¸ê°€ ì²˜ë¦¬ íë¦„ì´ ì „ë¶€ ë¡œê·¸ë¡œ ì°íˆê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

ì´ê±´ ë‚˜ì¤‘ì— ë³¸ë‹¤.

##### í•„í„° ì²´ì¸ì— í•„í„° ì¶”ê°€í•˜ê¸°

ë³´í†µì€ Spring Security ê°€ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” ë³´ì•ˆ í•„í„°ë“¤ë§Œìœ¼ë¡œë„ ì–´í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆì„ ì¶©ë¶„íˆ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ ë•Œë¡œëŠ” ê¸°ë³¸ í•„í„° ì™¸ì— ë‚´ê°€ ì§ì ‘ ë§Œë“  ì»¤ìŠ¤í…€ í•„í„°ë¥¼ SecurityFilterChain ì•ˆì— ì¶”ê°€í•´ì•¼ í•  ë•Œê°€ ìˆë‹¤.

- ìš”ì²­ ë¡œê¹…ì´ë‚˜ íŠ¸ë˜í‚¹ í•˜ê³  ì‹¶ì„ ë•Œ
- ì»¤ìŠ¤í…€ JWT í† í° ê²€ì¦ì„ í•˜ê³  ì‹¶ì„ ë•Œ
- íŠ¹ì • ìš”ì²­ í—¤ë”ë¥¼ ê°€ë¡œì±„ì„œ ë³€í™˜í•˜ê³  ì‹¶ì„ ë•Œ

**addFilterBefore(Filter, Class<?>)**

íŠ¹ì • í•„í„° ì•(before) ì— ìƒˆ í•„í„°ë¥¼ ì¶”ê°€í•œë‹¤.

{% highlight java %}
http.addFilterBefore(new JwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);
{% endhighlight %}

ì¦‰ ì´ UsernamePasswordAuthenticationFilter ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ë˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

**addFilterAfter(Filter, Class<?>)**

íŠ¹ì • í•„í„° ë’¤(after) ì— ì»¤ìŠ¤í…€ í•„í„°ë¥¼ ì¶”ê°€í•œë‹¤.

{% highlight java %}
http.addFilterAfter(new LoggingFilter(), BasicAuthenticationFilter.class);
{% endhighlight %}

ë³´í†µ ì–´ë–¤ í•„í„°ê°€ ëë‚œ ë’¤ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ê°€ê³µí•˜ê±°ë‚˜ í›„ì²˜ë¦¬, ë¡œê¹…í•  ë•Œ ì“°ì¸ë‹¤.

**addFilterAt(Filter, Class<?>)**

íŠ¹ì • í•„í„°ë¥¼ ëŒ€ì²´í•˜ê²Œ ëœë‹¤.

{% highlight java %}
http.addFilterAt(new CustomLoginFilter(), UsernamePasswordAuthenticationFilter.class);
{% endhighlight %}

ì£¼ë¡œ ê¸°ë³¸ í¼ ë¡œê·¸ì¸ ë°©ì‹ ëŒ€ì‹  ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ ì²˜ë¦¬ë¥¼ í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•˜ë©°, OAuth2 ë‚˜ ì™¸ë¶€ ì¸ì¦ ì„œë²„ì™€ ì—°ë™í•˜ì—¬ ë¡œê·¸ì¸ ë¡œì§ì„ ì§ì ‘ êµ¬ì„±í•  ë•Œ ì‚¬ìš©í•œë‹¤.

##### Adding Custom Filter

ì§ì ‘ ë§Œë“  ì»¤ìŠ¤í…€ í•„í„°ë¥¼ í•„í„° ì²´ì¸ì—ì„œ ì–´ë””ì— ë°°ì¹˜í•´ì•¼ í•˜ëŠ”ì§€ ëª¨ë¥¼ ìˆ˜ ìˆë‹¤.

ìì‹ ë§Œì˜ ì»¤ìŠ¤í…€ í•„í„°ë¥¼ ë§Œë“ ë‹¤ë©´, ê·¸ í•„í„°ë¥¼ í•„í„° ì²´ì¸ ì•ˆì˜ ì–´ëŠ ìœ„ì¹˜ì— ë„£ì„ì§€ ê²°ì •í•´ì•¼ í•œë‹¤. í•„í„°ì˜ ì‹¤í–‰ ìœ„ì¹˜ëŠ” ë³´ì•ˆ ì´ë²¤íŠ¸ì˜ ìˆœì„œì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤.

ì¦‰, ì´ í•„í„°ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ì–´ë˜ ì¼ì´ ì´ë¯¸ ëë‚˜ ìˆì–´ì•¼ í•˜ëŠ”ê°€? ë¥¼ ë¨¼ì € ìƒê°í•´ì•¼ í•œë‹¤.

ë³´í†µ Spring Security í•„í„° ì²´ì¸ ë‚´ì˜ ì£¼ìš” ì´ë²¤íŠ¸ ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

1. `SecurityContext` ë¡œë“œ
    - ì„¸ì…˜ì—ì„œ `SecurityContext` ë¥¼ ë¶ˆëŸ¬ì™€ ì¸ì¦ ì •ë³´(Authentication) ë¥¼ ë³µì›
    - ì´ ì‘ì—…ì€ `SecurityContextHolderFilter` ê°€ ë‹´ë‹¹
2. ìµìŠ¤í”Œë¡œì‡ ë°©ì–´: CSRF, CORS, ë³´ì•ˆ í—¤ë”(`X-Frame-Options`, `X-Content-Type-Options` ë“±) ìœ¼ë¡œ ìš”ì²­ì„ ë³´í˜¸í•œë‹¤.
    - ì‚¬ìš©ìì˜ ì‹ ì›ì„ ê²€ì¦í•˜ëŠ” ë‹¨ê³„
    - ë¡œê·¸ì¸ í¼, í† í°(`JWT`, `OAuth2`), ì„¸ì…˜ ë“± ë‹¤ì–‘í•œ ë°©ì‹ì´ ì—¬ê¸°ì— í•´ë‹¹í•œë‹¤.
3. ìš”ì²­ ì¸ì¦(`Authentication`)
    - ì‚¬ìš©ì ì‹ ì›ì„ ê²€ì¦
    - ë¡œê·¸ì¸ í¼, í† í°(JWT, OAuth2), ì„¸ì…˜ ë“± ë‹¤ì–‘í•œ ì¸ì¦ ë°©ì‹ì´ ì‚¬ìš©
4. ìš”ì²­ ì¸ê°€(`Authorization`)
    - ì¸ì¦ëœ ì‚¬ìš©ìê°€ ìš”ì²­í•œ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ê¶Œí•œì´ ìˆëŠ”ì§€ ê²€ì‚¬

> ê°€ì¥ í”í•œ ì»¤ìŠ¤í…€ í•„í„°ëŠ” ì»¤ìŠ¤í…€ ì¸ì¦ í•„í„°ì´ë‹¤, ì´ëŠ” ë³´í†µ `LogoutFilter` ë’¤ì— ìœ„ì¹˜ì‹œí‚¨ë‹¤.

ì‹¤ìŠµìœ¼ë¡œ í…Œë„ŒíŠ¸ ì»¤ìŠ¤í…€ í•„í„°ë¥¼ ì¶”ê°€í•´ë³´ì.

{% highlight java %}
public class TenantFilter implements Filter {
	@Override
	public void doFilter(ServletRequest request,
	                     ServletResponse response,
	                     FilterChain chain) throws IOException, ServletException {
		HttpServletRequest httpRequest = (HttpServletRequest) request;
		HttpServletResponse httpResponse = (HttpServletResponse) response;

		String tenantId = httpRequest.getHeader("X-Tenant-Id");
		boolean hasAccess = isUserAllowed(tenantId);
		if (hasAccess) {
			chain.doFilter(httpRequest, httpResponse);
			return;
		}
		throw new AccessDeniedException("Access Denied");
	}

	private boolean isUserAllowed(String tenantId) {
		return true;
	}
}
{% endhighlight %}

ìœ„ì™€ ê°™ì´ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. ì´ì œ ì´ í•„í„°ë¥¼ ì ìš©ë§Œ í•˜ë©´ ë˜ëŠ”ë° ê·¸ ì ìš©í•˜ëŠ” ê²ƒì€ `SecurityFilterChain` ì— ë¼ì›Œë„£ì–´ì•¼ í•˜ë¯€ë¡œ `HttpSecurity` ë¥¼ í† ëŒ€ë¡œ ë„£ì–´ì£¼ë©´ ëœë‹¤.

{% highlight java %}
@Configuration
@EnableWebSecurity
public class SecurityConfig {
	@Bean
	public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
		http
				.addFilterAfter(new TenantFilter(), AnonymousAuthenticationFilter.class);
		return http.build();
	}
}
{% endhighlight %}

##### Declaring Custom Filter as Bean with FilterRegistrationBean

ìœ„ì—ì„œëŠ” Configuration ìœ¼ë¡œ ë“±ë¡í–ˆë‹¤ë©´ ì´ë²ˆì—ëŠ” Bean ì„ í†µí•´ ë“±ë¡í•˜ëŠ” ê²½ìš°ë¥¼ ë³´ì

Filter ëŠ” ìš”ì²­ì´ Controller ë¡œ ê°€ê¸° ì „ì— ë˜ëŠ” ì‘ë‹µì´ ë‚˜ê°€ê¸° ì „ì— íŠ¹ì • ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ê°ì²´ì´ë‹¤. ì´ë•Œ ë¡œê·¸ì¸ ì •ë³´ í™•ì¸, ë¡œê·¸ ê¸°ë¡, í…Œë„ŒíŠ¸ ID í™•ì¸ ë“±ì„ í•  ìˆ˜ê°€ ìˆì„ ê²ƒì´ë‹¤.

ì´ë•Œ í•„í„°ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.

{% highlight java %}
@Component
public class TenantFilter implements Filter {
    ...
}

@Bean
public TenantFilter tenantFilter() {
    return new TenantFilter();
}
{% endhighlight %}

ì´ë ‡ê²Œ í•˜ë©´ Spring Bootê°€ ìë™ìœ¼ë¡œ `Filter` ë¥¼ **ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ(ë‚´ì¥ Tomcat ë“±)ì— ë“±ë¡í•˜**ê¸´ í•˜ì§€ë§Œ, Spring Security ë„ ìì²´ì ìœ¼ë¡œ `Filter` ì²´ì¸ì„ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— ì´ `Filter` ê°€ í•œ ë²ˆì€ Tomcat ìª½ì—ì„œ ì‹¤í–‰ë˜ê³  ë˜ í•œ ë²ˆì€ Spring Security `FilterChain` ì—ì„œ ì‹¤í–‰ë˜ê²Œ ëœë‹¤. ì¦‰ ë‘ ë²ˆ í˜¸ì¶œë˜ë©°, í˜¸ì¶œ ìˆœì„œë„ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ì„œ ì˜ë„ì¹˜ ì•Šì€ ë³´ì•ˆ ìˆœì„œ ë¬¸ì œê°€ ìƒê¸°ê²Œ ëœë‹¤.

ê·¸ë˜ì„œ Bean ì€ ë§Œë“¤ë˜ ìë™ ë“±ë¡ì€ ë§‰ëŠ” ë°©ë²•ìœ¼ë¡œ ë‹¤ìŒì´ ìˆë‹¤.

{% highlight java %}
@Bean
public FilterRegistrationBean<TenantFilter> tenantFilterRegistration(TenantFilter filter) {
    FilterRegistrationBean<TenantFilter> registration = new FilterRegistrationBean<>(filter);
    registration.setEnabled(false); // ìë™ ë“±ë¡ ë¹„í™œì„±í™”!
    return registration;
}
{% endhighlight %}

í•„í„° ì•ˆì—ì„œ DI ë¥¼ ì¨ì•¼ í•´ì„œ Bean ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ í•œë‹¤ë©´ ìë™ ë“±ë¡ë§Œ ìœ„ì²˜ëŸ¼ êº¼ë²„ë¦¬ë©´ ëœë‹¤.

##### Customizing a Spring Security Filter

ë³´í†µ Security ëŠ” ìë™ìœ¼ë¡œ HttpSecurity DSL ë¡œ ì„¤ì •ë§Œ í•´ë„ í•„ìš”í•œ í•„í„°ë“¤ì„ ì¶”ê°€í•´ì¤€ë‹¤.

{% highlight java %}
http.httpBasic(Customizer.withDefaults());
{% endhighlight %}

ì´ í•œ ì¤„ì´ë©´ ë‚´ë¶€ì ìœ¼ë¡œ BasicAuthenticationFilter ê°€ ìë™ ì¶”ê°€ë˜ê²Œ ëœë‹¤. í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ì§ì ‘ ë§Œë“  ë²„ì „ì˜ í•„í„°ë¥¼ ì“°ê³  ì‹¶ì„ë•Œ ë‹¤ìŒì„ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.

{% highlight java %}
@Bean
SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    BasicAuthenticationFilter basic = new BasicAuthenticationFilter(...);
    // ì»¤ìŠ¤í…€ ì„¤ì • ì¶”ê°€

    http
        // ...
        .addFilterAt(basic, BasicAuthenticationFilter.class);

    return http.build();
}
{% endhighlight %}

> ì—¬ê¸°ì„œ ì£¼ì˜í•  ì ì€ ê°™ì€ í•„í„°ë¥¼ ë‘ ë²ˆ ì¶”ê°€í•˜ë©´ ì•ˆëœë‹¤ëŠ” ê²ƒì´ë‹¤.

##### ExceptionTranslationFilter

![assets/img/exception-translation-filter.png]({{ site.baseurl }}/assets/img/exception-translation-filter.png)

ë³´ì•ˆ ë¡œì§ ì¤‘ì—ì„œë„ ì¸ì¦/ì¸ê°€ì— ì‹¤íŒ¨ë¥¼ í•˜ì˜€ì„ ë•Œ HTTP ì‘ë‹µìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” ì—­í• ì„ í•˜ëŠ” í•„í„°ì´ë‹¤.

- `AuthenticationException` ì¸ì¦ ì‹¤íŒ¨
- `AccessDeniedException` ì¸ê°€ ì‹¤íŒ¨

ì´ ë‘ ê°€ì§€ë¥¼ HTTP ì‘ë‹µìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê²Œ ì£¼ ì—­í• ì´ë‹¤. ì´ í•„í„°ì˜ ìœ„ì¹˜ëŠ” ë‹¤ìŒì— ìœ„ì¹˜ëœë‹¤

{% highlight text %}
[ì¸ì¦ ê´€ë ¨ í•„í„°ë“¤]
     â†“
[AuthorizationFilter]
     â†“
[ExceptionTranslationFilter] â† ì—¬ê¸°ì„œ ì˜ˆì™¸ ì²˜ë¦¬ ë‹´ë‹¹
     â†“
[ë‚˜ë¨¸ì§€ í•„í„° / ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§]
{% endhighlight %}

ì¦‰, ì•„ë˜ìª½ í•„í„°ë“¤ì´ ë˜ì§„ ì˜ˆì™¸(`AuthenticationException`, `AccessDeniedException`)ë¥¼ ë§¨ ìœ„ì—ì„œ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” â€œë³´ì•ˆ ì˜ˆì™¸ì˜ ìˆ˜ë¬¸ì¥â€ ì—­í• ì„ í•œë‹¤.

**ì‹¤ì œ ë™ì‘ ìˆœì„œ**

1. ìš”ì²­ ì‹¤í–‰ ì‹œë„
    - ë¨¼ì € `ExceptionTranslationFilter` ëŠ” ë‹¨ìˆœíˆ í•„í„° ì²´ì¸ë§Œ ì‹¤í–‰
2. `AuthenticationException` ë°œìƒ
    - í•˜ìœ„ í•„í„°ì—ì„œ ìœ„ ì˜ˆì™¸ ë°œìƒ
    - `SecurityContextHolder` ì•ˆì˜ ì¸ì¦ ì •ë³´(`Authentication`) ë¥¼ ë¹„ì›€
    - í˜„ì¬ ìš”ì²­ì„ ì €ì¥í•´ë‘  (ë¡œê·¸ì¸ ì„±ê³µ í›„ ë‹¤ì‹œ ì›ë˜ ìš”ì²­ì„ ë¦¬í”Œë ˆì´ í•˜ê¸° ìœ„í•¨)
    - `AuthenticationEntryPoint` í˜¸ì¶œ
        - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŒ…
        - `WWW-Authenticate` í—¤ë”ë¥¼ ì‘ë‹µì— ì¶”ê°€
3. `AccessDeniedException` ë°œìƒ
    - í•˜ìœ„ í•„í„°ì—ì„œ ìœ„ ì˜ˆì™¸ ë°œìƒ ì‹œ
    - ì¸ì¦ì€ ë˜ì—ˆì§€ë§Œ ê¶Œí•œì´ ì—†ëŠ” ê²½ìš°ì´ë©°,
    - `AccessDeniedHandler` ê°€ í˜¸ì¶œë˜ê³ 
    - ì´ í•¸ë“¤ëŸ¬ê°€ `403 Forbidden` ì‘ë‹µì„ ë³´ë‚¸ë‹¤.
    - ì¦‰, ë¡œê·¸ì¸ì„ í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ì´ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ê¶Œí•œì´ ì—†ë‹¤ê³  ë‚´ë±‰ëŠ” ê²ƒì´ë‹¤.

##### Saving Requests Between Authentication

Spring Securty ì—ì„œ ì¸ì¦ ì „ ìš”ì²­ì„ ì €ì¥í•˜ê³  ë³µì›í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ ì¦‰, `RequestCache` ì— ëŒ€í•´ ì´ì œ ë³´ì.

ì‹¤ì œ ë¡œê·¸ì¸ ì²˜ë¦¬ì— ëŒ€í•´ êµ‰ì¥íˆ ì¤‘ìš”í•œ ë¶€ë¶„ì´ë‹¤.

**ë¡œê·¸ì¸ ì „ ìš”ì²­ ë³µì›**

ìš”ì²­ì„ ì €ì¥í•˜ëŠ” ì´ìœ ëŠ” ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í•˜ì§€ ì•ŠëŠ” ìƒíƒœì—ì„œ `/mypage` ê°™ì€ ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•´ì•¼ í•œë‹¤ê³  ê°€ì •í•˜ì. ì´ë•Œ

1. Spring Security ëŠ” "ì´ URL ì€ ì¸ì¦ì´ í•„ìš”í•¨" ì„ ê°ì§€í•˜ê²Œ ë˜ê³ 
2. `ExceptionTranslationFilter` ê°€ `AuthenticationException` ì„ ë°›ì•„, `RequestCache` ì— í˜„ì¬ ìš”ì²­ì„ ì €ì¥í•´ë‘”ë‹¤.
3. ê·¸ë¦¬ê³  ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŒ… ì‹œí‚¤ë©°,
4. ë¡œê·¸ì¸ ì„±ê³µ ì‹œì— ì›ë˜ ê°€ë ¤ë˜ `/mypage` ë¥¼ `RequestCacheAwareFilter` ì—ì„œ `RequestCache` ì˜ ì €ì¥ëœ ìš”ì²­ì„ ë‹¤ì‹œ ë³µì›ì‹œí‚¤ê²Œ ëœë‹¤. ì´ë¡œì¨ **ë¡œê·¸ì¸ ì „ ìš”ì²­ ë³µì›** ê¸°ëŠ¥ì´ ì™„ì„±ë˜ê²Œ ëœë‹¤.

**ì „ì²´ íë¦„**
{% highlight java %}
[ì‚¬ìš©ì: /mypage ìš”ì²­] â†’ [ì¸ì¦ ì•ˆ ë¨]
     â†“
[ExceptionTranslationFilter]
  â””â”€> RequestCache.save(request)
  â””â”€> ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ redirect
     â†“
[ì‚¬ìš©ì ë¡œê·¸ì¸ ì„±ê³µ]
     â†“
[RequestCacheAwareFilter]
  â””â”€> RequestCache.getSavedRequest()
  â””â”€> ì›ë˜ /mypageë¡œ redirect
{% endhighlight %}

**ê¸°ë³¸ êµ¬í˜„ì²´ - HttpSessionRequestCache**

ê¸°ë³¸ì ìœ¼ë¡œ Spring Security ëŠ” `HttpSessionRequestCache` ë¥¼ ì‚¬ìš©í•˜ë©° `HttpSession` ì— ìš”ì²­ ì •ë³´ë¥¼ ì €ì¥í•œë‹¤.

- ì›ë˜ URL
- HTTP ë©”ì„œë“œ
- ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°
- í—¤ë” ì •ë³´

**ì»¤ìŠ¤í„°ë§ˆì´ì§• - ì €ì¥ ì¡°ê±´ ë³€ê²½**

ì˜ˆë¥¼ë“¤ì–´ `continue` ë¼ëŠ” íŒŒë¼ë¯¸í„°ê°€ ìˆì„ ë•Œë§Œ, ìš”ì²­ì„ ì €ì¥í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

{% highlight java %}
@Bean
SecurityFilterChain springSecurity(HttpSecurity http) throws Exception {
    HttpSessionRequestCache requestCache = new HttpSessionRequestCache();
    requestCache.setMatchingRequestParameterName("continue");

    http
        .requestCache(cache -> cache
            .requestCache(requestCache)
        );

    return http.build();
}
{% endhighlight %}

ì´ë ‡ê²Œ í•˜ë©´ ìš”ì²­ URL ì´ `/mypage?continue=true` ì¼ë•Œë§Œ ìš”ì²­ì„ ì €ì¥í•˜ê²Œ ëœë‹¤.

**ìš”ì²­ ì €ì¥ ê¸°ëŠ¥ ë„ê¸° - NullRequestCache**

ì–´ë–¤ ì•±ì€ ë¡œê·¸ì¸ ì„±ê³µ í›„ ë¬´ì¡°ê±´ í™ˆìœ¼ë¡œ ê°€ê²Œ í•˜ê³  ì‹¶ì„ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ì´ë•ŒëŠ” ì•„ì˜ˆ ìš”ì²­ì„ ì²˜ë¦¬í•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•˜ë©´ ëœë‹¤.

{% highlight java %}
@Bean
SecurityFilterChain springSecurity(HttpSecurity http) throws Exception {
    RequestCache nullRequestCache = new NullRequestCache();
    http
        .requestCache(cache -> cache
            .requestCache(nullRequestCache)
        );
    return http.build();
}
{% endhighlight %}

> Spring Security ëŠ” ì´ì „ ìš”ì²­ì„ ì ˆëŒ€ ì €ì¥í•˜ì§€ ì•ŠìŒ => ë¡œê·¸ì¸ í›„ í•­ìƒ `/home` ê°™ì€ ê¸°ë³¸ í˜ì´ì§€ë¡œ ì´ë™í•¨

**RequestCacheAwareFilter**

- ë¡œê·¸ì¸ ì„±ê³µ ì‹œì ì— RequestCache ì—ì„œ ì €ì¥ëœ ìš”ì²­ì„ ì°¾ì•„ë‚´ê³ 
- ì›ë˜ ìš”ì²­ì´ ìˆì—ˆë‹¤ë©´ í•´ë‹¹ URL ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ëŠ” ê¸°ëŠ¥ì„ ê°€ì§„ë‹¤
- ì—†ìœ¼ë©´ ê¸°ë³¸ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤

> ì €ì¥ëœ ìš”ì²­ì„ ë³µì›í•˜ëŠ” ë‹´ë‹¹ì

---

### ìš©ì–´

###### Tenant

ì„ì°¨ì¸ì´ë¼ëŠ” ì˜ë¯¸ì´ë©°, ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œëŠ” í•˜ë‚˜ì˜ ì‹œìŠ¤í…œì„ ì—¬ëŸ¬ ì¡°ì§ì´ë‚˜ ì‚¬ìš©ìê°€ ê³µìœ í•  ë•Œ, ê° ì‚¬ìš©ìë¥¼ êµ¬ë¶„í•˜ëŠ” ë‹¨ìœ„ë¥¼ ì˜ë¯¸í•œë‹¤. ì´ ê°œë…ì€ ë©€í‹°í…Œë„Œì‹œ(Multi-Tenancy) êµ¬ì¡°ì—ì„œ ì¤‘ìš”í•˜ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ì–´ë–¤ íšŒì‚¬ê°€ exam.com ì´ë¼ëŠ” SaaS ë¥¼ ìš´ì˜í•˜ê³  ìˆë‹¤ê³  í•˜ì. ê·¸ëŸ¬ë©´ ì´ ì„œë¹„ìŠ¤ë¥¼ ì—¬ëŸ¬ A íšŒì‚¬, B íšŒì‚¬ê°€ í•¨ê»˜ ì‚¬ìš©í•œë‹¤ê³  ì¹œë‹¤ë©´, A íšŒì‚¬ ì§ì›ì€ tenantId = A, B íšŒì‚¬ì˜ ì§ì›ì€ tenantId = B ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

ì´ë•Œ A íšŒì‚¬ì™€ B íšŒì‚¬ëŠ” ê°™ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì™€ DBë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ì„œë¡œì˜ ë°ì´í„°ì—ëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ì–´ì•¼ í•œë‹¤.

ì—¬ê¸°ì„œ `Tenant` ëŠ” ë‹¤ìŒ ì—­í• ì„ í•˜ê²Œ ëœë‹¤.
- **ë°ì´í„° ë¶„ë¦¬**: ê° í…Œë„ŒíŠ¸ë§ˆë‹¤ ë³„ë„ì˜ ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ìŠ¤í‚¤ë§ˆë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ í…Œì´ë¸” ë‚´ì—ì„œ `tenant_id` ì»¬ëŸ¼ìœ¼ë¡œ ë°ì´í„° êµ¬ë¶„
- **ì¸ì¦ ë° ì¸ê°€ êµ¬ë¶„**: ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìê°€ ì†í•œ tenant ì— ë”°ë¼ ì ‘ê·¼ ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤ ì œí•œ
- **ì„¤ì • ë° ì»¤ìŠ¤í„°ë§ˆì´ì§• ë¶„ë¦¬**: ê° í…Œë„ŒíŠ¸ë§ˆë‹¤ ì„¤ì •, ë¡œê³ , í…Œë§ˆ, ì •ì±… ë“±ì„ ë‹¤ë¥´ê²Œ ìœ ì§€

**TenanFilter**

í…Œë„ŒíŠ¸ í”¼í„°ëŠ” ìš”ì²­ì— í¬í•¨ëœ í—¤ë”ë‚˜ í† í°ì—ì„œ `X-Tenant-Id` ë¥¼ ì½ì–´ì„œ í˜„ì¬ ìš”ì²­ì´ ì–´ëŠ í…Œë„ŒíŠ¸ ì†Œì†ì¸ì§€ íŒë³„í•˜ê³ , í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ê·¸ í…Œë„ŒíŠ¸ì— ì ‘ê·¼í•  ê¶Œí•œì´ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ë¥¼ ê²€ì‚¬í•˜ê²Œ ëœë‹¤.

{% highlight java %}
GET /api/data
X-Tenant-Id: companyA
Authorization: Bearer <token>
{% endhighlight %}