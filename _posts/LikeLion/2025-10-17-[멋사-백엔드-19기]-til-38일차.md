---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 38ì¼ì°¨"
date:   2025-10-17 13:12:51 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Java Spring
---

<!--more-->

## ğŸ“‚ ëª©ì°¨
- [Cookie](#cookie)
    - []()
    - []()
    - []()

- [Session]()
    - []()
    - []()

---

## ğŸ“š ë³¸ë¬¸

### Cookie

ì›¹ ë¸Œë¼ìš°ì €ì™€ ì„œë²„ ì‚¬ì´ì—ì„œ ì •ë³´ë¥¼ ì‘ê³  ë‹¨ìˆœí•œ ë¬¸ìì—´ í˜•íƒœë¡œ ì €ì¥í•˜ê³  ì£¼ê³  ë°›ëŠ” ë°©ë²•ì´ë©°, ì„œë²„ê°€ ë¸Œë¼ìš°ì €ì— ë°ì´í„°ë¥¼ ì ê¹ ê¸°ì–µí•´ë‹¬ë¼ê³  ìš”ì²­í•˜ë©´ ë¸Œë¼ìš°ì €ëŠ” ì´ë¥¼ ë¡œì»¬ì— ì €ì¥í•˜ê³  ê°™ì€ ë„ë©”ì¸ìœ¼ë¡œ ìš”ì²­í•  ë•Œë§ˆë‹¤ ì„œë²„ì— ë‹¤ì‹œ ì „ë‹¬í•˜ê²Œ ëœë‹¤.

**ìš©ë„**
- ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€(Session ID ì €ì¥)
- ì‚¬ìš©ì ì„ í˜¸ ì„¤ì • ì €ì¥(ì–¸ì–´, í…Œë§ˆ)
- íŠ¸ë˜í‚¹ ë° ë¶„ì„(ë°©ë¬¸ ê¸°ë¡, ì¥ë°”êµ¬ë‹ˆ ì •ë³´)

ì„œë²„ì¸¡ì—ì„œëŠ” ì‘ë‹µìœ¼ë¡œ ë³´ë‚¼ë•Œ ì¿ í‚¤ë¥¼ ì €ì¥í•´ë‹¬ë¼ê³  ìš”ì²­í•  ìˆ˜ ìˆê³ , ê·¸ë•Œ HTTP ì—ëŠ” `Set-Cookie` í—¤ë”ê°€ í¬í•¨ë˜ê²Œ ëœë‹¤. ì´í›„ì— ë¸Œë¼ìš°ì €ê°€ ìš”ì²­ì„ ì„œë²„ì— í•œë‹¤ë©´ ìë™ìœ¼ë¡œ ì´ ì¿ í‚¤ë“¤ì´ ì „ì†¡ë˜ê²Œ ëœë‹¤.

**ì„œë²„ -> ë¸Œë¼ìš°ì € Set-Cookie í—¤ë”**
{% highlight text %}
Set-Cookie: userId=park123; Path=/; Max-Age=3600; HttpOnly; Secure
{% endhighlight %}

**ë¸Œë¼ìš°ì € -> ì„œë²„ Cookie**
{% highlight text %}
Cookie: userId=park123
{% endhighlight %}

> HTTP ìƒíƒœë¥¼ ë³´ì¡´í•˜ëŠ” ê°€ì¥ ë‚®ì€ ë ˆë²¨ì˜ ë©”ì»¤ë‹ˆì¦˜ì´ ë°”ë¡œ Cookie ì´ë‹¤.

#### Cookie ì˜ êµ¬ì„±ìš”ì†Œ

- `Name`: ì´ë¦„
- `Value`: ê°’
- `Domain`: ì¿ í‚¤ê°€ ì ìš©ë  ë„ë©”ì¸
- `Path`: ì¿ í‚¤ê°€ ì ìš©ë  ê²½ë¡œ
- `Max-Age`: ì¿ í‚¤ ìœ íš¨ê¸°ê°„(-1 ì´ë©´ ì°½ì„ ê»ë‹¤ í‚¤ë©´ ì‚¬ë¼ì§€ëŠ” ì˜µì…˜)
- `Secure`: HTTPS ì—ì„œë§Œ ì „ì†¡
- `HttpOnly`: JS ì—ì„œ ì ‘ê·¼ ë¶ˆê°€, XSS ë°©ì–´ìš©
- `SameSite`: CSRF ê³µê²© ë°©ì§€(`Strict`, `Lax`, `None`)

#### Spring ì—ì„œ Cookie ë‹¤ë£¨ê¸°

**@CookieValue ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì½ì–´ì˜¤ê¸°**
{% highlight java %}
@GetMapping("/viewCookie")
public String viewCookie(@CookieValue(value = "userId", required = false) String userId,
                         Model model) {
    model.addAttribute("userId", userId);
    return "cookie_view";
}
{% endhighlight %}

> ë¸Œë¼ìš°ì €ì— ì¿ í‚¤ê°€ ì €ì¥ë˜ì–´ ìˆê³  `userId` ë¼ëŠ” ì´ë¦„ì˜ ì¿ í‚¤ê°€ ìˆë‹¤ë©´ ë“¤ê³ ì˜´ ì—†ìœ¼ë©´ `null`

**ì¿ í‚¤ ìƒì„± ë° ì €ì¥**
{% highlight java %}
@PostMapping("/addCookie")
public String addCookie(CookieRequest cookieRequest, /* @ModelAttribute ìƒëµ ê°€ëŠ¥ */
                        HttpServletResponse response) {

    Cookie cookie = new Cookie(cookieRequest.cookieName(), cookieRequest.cookieValue());
    cookie.setPath("/");
    cookie.setMaxAge(-1);

    response.addCookie(cookie);

    return "redirect:/viewCookie";
}
{% endhighlight %}

> `@ModelAttribute` ëŠ” í•˜ë‚˜ì˜ object ë§Œì´ ìš”ì²­ìœ¼ë¡œ ì˜¤ê²Œ ë˜ë©´ ìƒëµì´ ê°€ëŠ¥í•˜ë‹¤.

**ì¿ í‚¤ ì‚­ì œ**
{% highlight java %}
@GetMapping("/delCookie")
public String deleteCookie(HttpServletResponse response) {
    Cookie cookie = new Cookie("userId", null);
    cookie.setMaxAge(0); // ë§Œë£Œ
    cookie.setPath("/");
    response.addCookie(cookie);
    return "cookie_deleted";
}
{% endhighlight %}

> ë¸Œë¼ìš°ì €ì—ì„œ ì¿ í‚¤ë¥¼ ì œê±°í•˜ë ¤ë©´ ê°™ì€ ì´ë¦„, ê°™ì€ `Path`, `MaxAge=0` ìœ¼ë¡œ ë‹¤ì‹œ ë³´ë‚´ì•¼ í•¨

##### setHttpOnly

ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì¿ í‚¤ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ì°¨ë‹¨í•œë‹¤. ì¦‰, `document.cookie` ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ê²Œ ëœë‹¤.

- `XSS` ê³µê²© ë°©ì§€ìš©
- `SessionID` ê°€ ë“œëŸ¬ë‚˜ì§€ ì•Šë„ë¡

##### setSecure

HTTPS ì—°ê²°ì—ì„œë§Œ ì¿ í‚¤ë¥¼ ì „ì†¡í•˜ë„ë¡ ì œí•œì„í•˜ë©°, HTTP ìš”ì²­ì—ì„œëŠ” ì´ ì¿ í‚¤ê°€ ì „ì†¡ë˜ì§€ ì•ŠëŠ”ë‹¤.

- ë„¤íŠ¸ì›Œí¬ ìƒì—ì„œ ì¿ í‚¤ê°€ ë…¸ì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê³ 
- HTTP ì˜ ì•”í˜¸í™” ë¶€ì¬ë¡œ, ëˆ„êµ°ê°€ íŠ¸ë˜í”½ ê°ì²­ ì‹œ ì„¸ì…˜ID ê°€ ë…¸ì¶œë˜ë©´ ì•ˆëœë‹¤

##### setSameSite

`CSRF` ê³µê²© ë°©ì§€ë¥¼ ìœ„í•´ ì¿ í‚¤ê°€ ì–´ë–¤ ìš”ì²­ ìƒí™©ì—ì„œ ì „ì†¡ë  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì œí•œí•˜ëŠ” ì˜µì…˜ì´ë‹¤. ê¸°ë³¸ê°’ì€ `Lax` ì´ë‹¤.

> `CSRF` ëŠ” ìš”ì²­ì„ ë³´ë‚¸ í˜ì´ì§€ì˜ ë„ë©”ì¸ ê³¼ ìš”ì²­ì„ ë°›ëŠ” ì„œë²„ì˜ ë„ë©”ì¸ì´ ë‹¤ë¥¼ ìˆ˜ ìˆëŠ”ë° ì´ëŸ´ë•Œ í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìš”ì²­ì´ë¼ê³  í•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì˜ ìš”ì²­ì€ ì¿ í‚¤ë¥¼ ì „ì†¡í•˜ì§€ ì•ŠëŠ”ë‹¤.

### Session

ì›¹ì—ì„œ `HTTP` ëŠ” `stateless` í”„ë¡œí† ì½œì´ë‹¤. ì¦‰, ìš”ì²­ -> ì‘ë‹µ ì‚¬ì´ì— ì„œë²„ëŠ” ì‚¬ìš©ìë¥¼ ê¸°ì–µí•˜ì§€ ëª»í•˜ëŠ”ë°, ëŒ€ë¶€ë¶„ì˜ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ ì‚¬ìš©ì ìƒíƒœ ìœ ì§€ê°€ í•„ìš”í•˜ë‹¤.

ì—¬ê¸°ì„œ ë“±ì¥í•˜ëŠ” ê²ƒì´ `session` ì´ë©°, ì„¸ì…˜ì€ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ ë³„ë¡œ ìœ ì§€í•˜ëŠ” ì¼ì‹œì  ë°ì´í„° ì €ì¥ ê³µê°„ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.

#### Session ë™ì‘ ì›ë¦¬

1. ì‚¬ìš©ìê°€ ë¸Œë¼ìš°ì €ë¡œ ìš”ì²­ì„ ë³´ëƒ„
2. ì„œë²„ëŠ” ì„¸ì…˜ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ê³ ìœ í•œ Session ID ë¥¼ ë°œê¸‰ ë°›ìŒ
3. ì„¸ì…˜ ID ëŠ” ì£¼ë¡œ ì¿ í‚¤(JSESSIONID) ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬ë¨
4. í´ë¼ì´ì–¸íŠ¸ëŠ” ì´í›„ ìš”ì²­ë§ˆë‹¤ ì„¸ì…˜ ID ë¥¼ ì„œë²„ì— ë³´ë‚´ê³ , ì„œë²„ëŠ” ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ì…˜ ì €ì¥ì†Œë¥¼ ì¡°íšŒí•˜ê²Œ ëœë‹¤.

##### Session ìƒì„±

Spring MVC ì—ì„œ Session ì€ `HttpSession` ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì œê³µë˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” `Servlet` ì»¨í…Œì´ë„ˆ(Tomcat, Jetty ë“±)ì—ì„œ ê´€ë¦¬í•œë‹¤. ì¦‰, Spring ì´ ì§ì ‘ ì„¸ì…˜ ê°ì²´ë¥¼ ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ìš”ì²­ ì‹œ `Servlet` ì»¨í…Œì´ë„ˆê°€ ì„¸ì…˜ì„ ì •í•˜ê³  Spring ì€ ê·¸ê±¸ í™œìš©í•œë‹¤.

ë”°ë¼ì„œ `DispatcherServlet` ì—ì„œ ë°›ì•„ì§„ `HttpServletRequest` ì•ˆì— `Session` ì´ ë“¤ì–´ìˆê²Œ ëœë‹¤.

1. `request.getSession()` í˜¸ì¶œ
    1. ìš”ì²­ ì¿ í‚¤ì— JSESSIONID ë¥¼ í™•ì¸
    2. ì—†ìœ¼ë©´ ìƒˆë¡œìš´ ì„¸ì…˜ ê°ì²´ ìƒˆì„±
    3. ê³ ìœ í•œ ì„¸ì…˜ ID ë¥¼ ìƒì„±(UUID ë˜ëŠ” ëœë¤ ë¬¸ìì—´)
    4. ì„œë²„ ë©”ëª¨ë¦¬(ê¸°ë³¸ì€ HashMap ë“±)ì— ì„¸ì…˜ ì €ì¥
    5. í´ë¼ì´ì–¸íŠ¸ì—ê²Œ `Set-Cookie: JSESSIONID=ëœë¤ê°’` ì „ì†¡
2. ì´í›„ ìš”ì²­ì—ì„œ ì„¸ì…˜ ì‚¬ìš©
    1. ë¸Œë¼ìš°ì €ê°€ `JSESSIONID` ì¿ í‚¤ë¥¼ ë³´ë‚´ë©´ ì»¨í…Œì´ë„ˆê°€ ì„¸ì…˜ ê°ì²´ë¥¼ ì¡°íšŒí•´ì„œ ë°˜í™˜
    2. Spring `Controller` ì—ì„œ ë°”ë¡œ `session.getAttribute("user")` ë“±ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥

#### Session êµ¬ì¡°

- `HttpSession`: ì¸í„°í˜ì´ìŠ¤
- `StandardSession` (Tomcat êµ¬í˜„)
    - `id`: ì„¸ì…˜ ì‹ë³„ì
    - `creationTime`: ì„¸ì…˜ ìƒì„± ì‹œê°„
    - `lastAccessedTime`: ë§ˆì§€ë§‰ ì ‘ê·¼ ì‹œê°„
    - `attributes`: ì„¸ì…˜ì— ì €ì¥ëœ key-value `Map`

> Servlet ì´ ìƒì„±í•¨ì„ ì•Œê³  ìˆì

#### Session í™œìš© ì˜ˆì‹œ

{% highlight java %}
@GetMapping("/login")
public String login(HttpSession session) {
    // ë¡œê·¸ì¸ ì„±ê³µ í›„ ì‚¬ìš©ì ì •ë³´ë¥¼ ì„¸ì…˜ì— ì €ì¥
    session.setAttribute("user", "park");
    session.setAttribute("role", "admin");
    return "home";
}
{% endhighlight %}

> ì´ë•Œ String, `Object` ë¡œ ë“¤ì–´ê°€ëŠ”ë°, `Object` ëŠ” `Serializable` í•´ì•¼ í•œë‹¤.

**SessionAttribute**

`@ModelAttribute` ì²˜ëŸ¼ ì—¬ê¸°ì„œë„ `@SessionAttribute` ì˜ `name` ì˜µì…˜ì€ ìƒëµ ê°€ëŠ¥í•˜ë‹¤.

{% highlight java %}
@GetMapping("/dashboard")
public String dashboard(@SessionAttribute(name="user", required=false) String user) {
    if (user == null) return "redirect:/login";
    return "dashboard";
}
{% endhighlight %}

**SessionAttributes**

ì´ ì–´ë…¸í…Œì´ì…˜ì€ ì‚´ì§ í—·ê°ˆë¦´ ìˆ˜ ìˆëŠ”ë°, ìƒˆë¡­ê²Œ ì ‘ì†í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ëŠ” ì“¸ë ¤ëŠ” `key` ê°€ `Session` ì— ì—†ê¸° ë•Œë¬¸ì— `@ModelAttribute` ë¡œ `key` ê°€ ìƒì„±ë˜ë©´ `@SessionAttributes` ë•ë¶„ì— ì´ ê°’ì´ ì„¸ì…˜ì—ë„ ì €ì¥ë˜ê²Œ ëœë‹¤. ì¦‰, HTTP Session ì´ ìƒì„±ë  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ì €ì¥í•˜ë„ë¡ ì§€ì •í•œë‹¤.

{% highlight java %}
@SessionAttributes("visitCount")
public class SessionController {

	// HTTP Request ì—ì„œ ëª¨ë¸ì— ê°’ì´ ì—†ì„ ë•Œë§Œ í˜¸ì¶œë˜ëŠ” ì• ë„ˆí…Œì´ì…˜ì´ë‹¤.
    // í•˜ì§€ë§Œ, ìœ„ì—ì„œ SessionAttributes ë¡œ HTTP Session ë²”ìœ„ë¡œ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— í•´ë‹¹ key ëŠ” ì„¸ì…˜ì´ ëë‚ ë•Œê¹Œì§€ ê³„ì† ìœ ì§€
	@ModelAttribute("visitCount")
	public Integer initVisitCount() {
		System.out.println("initVisitCount");
		return 0;
	}

    ...
}
{% endhighlight %}

> ë§Œì•½ í´ë¼ì´ì–¸íŠ¸ê°€ ê°™ì€ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë‹¤ë¥¸ ìš”ì²­ì„ ë‹¤ì‹œ ë³´ë‚´ê²Œ ë˜ë©´ ì„¸ì…˜ì— ì´ë¯¸ `key` ê°€ ì¡´ì¬í•´ì„œ, ì´ ê°’ì„ ìë™ìœ¼ë¡œ `Model` ì— ì ìš©í•˜ê³ , ì´ ì–´ë…¸í…Œì´ì…˜ì€ `Controller` ë‹¨ìœ„ë¡œ ì ìš©ë˜ë¯€ë¡œ ë‹¤ë¥¸ ì»¨í‹€ë¡¤ëŸ¬ì—ì„œëŠ” í•´ë‹¹ `key-value` ë¥¼ ëª»ì“´ë‹¤. ë‹¤ë§Œ, ë‹¤ë¥¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë™ì¼ key ë¥¼ ìˆ˜ë™ìœ¼ë¡œ êº¼ë‚´ì„œ ì“°ëŠ”ê±´ ê°€ëŠ¥í•˜ë‹¤. ì„¸ì…˜ì€ ê³µìœ  ì˜ì—­ì´ê¸° ë•Œë¬¸

### JWT í† í°

JSON ê¸°ë°˜ì˜ URL-safe í† í°ìœ¼ë¡œ, ì¸ì¦ê³¼ ì •ë³´ ì „ë‹¬ì— ì‚¬ìš©í•œë‹¤. ì„œë²„ê°€ ë°œê¸‰í•œ í† í° ì•ˆì— **claim** ì´ë¼ëŠ” ì •ë³´ê°€ ë“¤ì–´ìˆê³ , í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ ì‹œ í† í°ì„ ë³´ë‚´ë©´ ì„œë²„ëŠ” ì„¸ì…˜ì´ ì—†ì´ë„ ì‚¬ìš©ì ìƒíƒœë¥¼ ê²€ì¦í•  ìˆ˜ ìˆê²Œ ëœë‹¤(ì„¸ì…˜ì´ ì—†ê¸°ì— ì„œë²„ëŠ” êµ‰ì¥íˆ ê°€ë²¼ì›Œì§).

- `Stateless` ì¸ì¦ê°€ëŠ¥
- í† í° ìì²´ê°€ `Signature` ë˜ì–´ì„œ ìœ„ë³€ì¡°ë¥¼ ë°©ì§€í•œë‹¤

**Header.Payload.Signature êµ¬ì¡°**

{% highlight java %}
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyMSIsImlhdCI6MTY5NTQ2NDg5OCwiZXhwIjoxNjk1NDY4NDk4fQ.Z7kY0lFzFZKxjH7g
{% endhighlight %}

#### JWT êµ¬ì¡°

- `Header`: í† í° íƒ€ì…(JWT), ì„œëª… ì•Œê³ ë¦¬ì¦˜ëª…

> `{"alg":"HS256","typ":"JWT"}`

- `Payload`: ì‚¬ìš©ì ì •ë³´(claims), ë§Œë£Œ ì‹œê°„ ë“±

> `{"sub":"user1","iat":1234567890,"exp":1234567990}`

- â­ï¸ `Signature`: `HMACSHA256(Header + Payload, secret)`

> Z7kY0lFzFZKxjH7g...  
> â­ï¸ Signature = HMACSHA256(base64UrlEncode(header) + â€œ.â€ + base64UrlEncode(payload), secretKey) ì˜ ì½”ë“œë¥¼ ê±°ì¹˜ê²Œ ëœë‹¤.  
> signature ëŠ” ìœ„ë³€ì¡°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë„£ëŠ”ë‹¤.

ìµœì¢…ì ìœ¼ë¡œ `Header.Payload.Signature` ë¥¼ ì´ì–´ ë¶™ì´ë©´ `JWT` ê°€ ì™„ì„±ëœë‹¤.

#### JWT ìƒì„±í•˜ê¸°

ìŠ¤í”„ë§ì—ì„œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ë§¤ìš° ê°„ë‹¨íˆ `JWT` í† í°ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ë‹¤ìŒ ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì¤€ë‹¤.

{% highlight java %}
implementation 'org.springframework.boot:spring-boot-starter-security'
implementation 'org.springframework.boot:spring-boot-starter-oauth2-resource-server'
{% endhighlight %}

ì´ì œ ë‹¤ìŒ ì½”ë“œë¥¼ í†µí•´ ê°„ë‹¨íˆ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

{% highlight java %}
import com.auth0.jwt.JWT;
import com.auth0.jwt.algorithms.Algorithm;

public class JwtGenerator {
    public static void main(String[] args) {
        String token = JWT.create()
                .withSubject("user1")
                .withClaim("role", "ADMIN")
                .sign(Algorithm.HMAC256("secret-key"));
        System.out.println(token);
    }
}
{% endhighlight %}

####