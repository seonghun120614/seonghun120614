---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 46ì¼ì°¨ Rest API 2"
date:   2025-10-30 09:07:20 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Java Spring
---

<!--more-->

## ğŸ“‚ ëª©ì°¨
- [URI ì„¤ê³„ ì›ì¹™](#uri-ì„¤ê³„-ì›ì¹™)
- [HTTP ìƒíƒœ ì½”ë“œì˜ ì„¸ë¶„í™”](#http-ìƒíƒœ-ì½”ë“œì˜-ì„¸ë¶„í™”)
    - [RestControllerAdvice](#http-ìƒíƒœ-ì½”ë“œì˜-ì„¸ë¶„í™”)
- [Versioning](#versioning)
- [Content Negotiation](#content-negotiation)
- [ETag ê¸°ë°˜ ì¡°ê±´ë¶€ ìš”ì²­ (If-Match, If-None-Match)](#etag-ê¸°ë°˜-ì¡°ê±´ë¶€-ìš”ì²­-if-match-if-none-match)
- [Idempotency-Key](#idempotency-key)
- [CORS & CSRF](#cors--csrf)
    - [CORS](#cors)
        - [Simple Request](#simple-request)
        - [Preflight Request](#preflight-request)
        - [ì „ì²´ íë¦„](#ì „ì²´-íë¦„)
    - [CSRF](#csrf)
        - [CSRF í† í°](#csrf-í† í°)
        - [SameSite Cookie ì„¤ì •](#samesite-cookie-ì„¤ì •)
        - [Referer / Origin ê²€ì¦](#referer--origin-ê²€ì¦)
- [Spring HATEOAS ì‹¬í™”](#spring-hateoas-ì‹¬í™”)
    - [HATEOAS Representation Model](#hateoas-representation-model)
- [GlobalExceptionHandler](#globalexceptionhandler)

---

## ğŸ“š ë³¸ë¬¸

REST ì— ëŒ€í•´ ë” ê¹Šì´ ì‚´í´ë³¸ë‹¤.

### URI ì„¤ê³„ ì›ì¹™

- ëª…ì‚¬ ê¸°ë°˜ ì„¤ê³„ (`/createUser` X , `/users` O)
- ë³µìˆ˜í˜• ì‚¬ìš© (`/users`)
- í•„í„°ë§ & ì •ë ¬ (`/users?age=20&sort=name,desc`)
- sub resource (`/users/{id}/orders`)
- ê´€ê³„ ìì› í‘œí˜„ (`/orders/{id}/items`)

### HTTP ìƒíƒœ ì½”ë“œì˜ ì„¸ë¶„í™”

[HTTP Semantics](https://datatracker.ietf.org/doc/html/rfc9110)

#### RestControllerAdvice

ì˜ˆì™¸ì²˜ë¦¬ëŠ” `ControllerAdvice` ì™€ ë³„ë°˜ ë‹¤ë¥´ì§€ ì•Šë‹¤. ë°˜í™˜ìœ¼ë¡œëŠ” `ErrorResponse` ë¥¼ ë‚´ë³´ë‚´ê²Œ ëœë‹¤.

{% highlight java %}
@RestControllerAdvice
public class GlobalExceptionHandler {

    // ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ ì²˜ë¦¬
    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<ErrorResponse> handleNotFound(
            ResourceNotFoundException e) {

        ErrorResponse error = new ErrorResponse(
            HttpStatus.NOT_FOUND.value(),
            e.getMessage(),
            LocalDateTime.now()
        );

        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
    }

    // ê²€ì¦ ì˜ˆì™¸ ì²˜ë¦¬
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ErrorResponse> handleValidation(
            MethodArgumentNotValidException e) {

        List<String> errors = e.getBindingResult()
            .getFieldErrors()
            .stream()
            .map(err -> err.getField() + ": " + err.getDefaultMessage())
            .collect(Collectors.toList());

        ErrorResponse error = new ErrorResponse(
            HttpStatus.BAD_REQUEST.value(),
            "Validation failed",
            errors,
            LocalDateTime.now()
        );
        return ResponseEntity.badRequest().body(error);

    }

    // ì¼ë°˜ ì˜ˆì™¸ ì²˜ë¦¬
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleGeneral(Exception e) {
        ErrorResponse error = new ErrorResponse(
            HttpStatus.INTERNAL_SERVER_ERROR.value(),
            "Internal server error",
            LocalDateTime.now()
        );

        return ResponseEntity
            .status(HttpStatus.INTERNAL_SERVER_ERROR)
            .body(error);
    }
}

@Data
@AllArgsConstructor
public class ErrorResponse {
    private int status;
    private String message;
    private List<String> errors;
    private LocalDateTime timestamp;

    public ErrorResponse(int status, String message, LocalDateTime timestamp) {
        this(status, message, null, timestamp);
    }
}

// ì»¤ìŠ¤í…€ ì˜ˆì™¸
public class ResourceNotFoundException extends RuntimeException {
    public ResourceNotFoundException(String message) {
        super(message);
    }
}
{% endhighlight %}

### Versioning

ë³´í†µ URI ìª½ì— ë²„ì „ì„ ë„£ëŠ” ë°©ì‹ì´ í‘œì¤€ì ìœ¼ë¡œ ë§ì´ ì‚¬ìš©ëœë‹¤.

- URI: `/api/v1/users`
- Header: `Accept: application.vnd.example.v1+json`
- Parameer: `/users?version=1`

### Content Negotiation

REST API ì˜ í•µì‹¬ ê°œë… ì¤‘ í•˜ë‚˜ì´ë©°, ì´ê±¸ ì´í•´í•˜ë©´ ì›í•˜ëŠ” ë°ì´í„° í˜•ì‹ì„ ì„œë²„ì—ê²Œ ìš”ì²­í•˜ê³  ì„œë²„ê°€ ê°€ì¥ ì ì ˆí•œ í‘œí˜„ìœ¼ë¡œ ì‘ë‹µí•  ìˆ˜ ìˆê²Œ ëœë‹¤.

ì½˜í…ì¸  í˜‘ìƒì´ë¼ê³  í•˜ëŠ” ê°œë…ì€ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ ìš”ì²­/ì‘ë‹µì˜ ë°ì´í„° í˜•ì‹ì„ í˜‘ì˜í•˜ëŠ” ê³¼ì •ì´ë‹¤. ë‹¤ìŒ ë‘ ê°€ì§€ í—¤ë”ê°€ í•µì‹¬ì´ë‹¤.

- ìš”ì²­ì—ì„œì˜ `Accept`: í´ë¼ì´ì–¸íŠ¸ê°€ ë°›ê³  ì‹¶ì€ ì‘ë‹µ í˜•ì‹ì„ ì§€ì •í•œë‹¤.
- ìš”ì²­ì—ì„œì˜ `Content-Type`: í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚´ëŠ” ë°ì´í„° í˜•ì‹ ì§€ì •
- ì‘ë‹µì—ì„œì˜ `Content-Type`: ì„œë²„ê°€ ë³´ë‚´ëŠ” ì‹¤ì œ ë°ì´í„° í˜•ì‹ ëª…ì‹œ

{% highlight text %}
### Request
GET /api/users/1 HTTP/1.1
Accept: application/json
- Content-Type: application/json <- ë³´ë‚´ëŠ” body ê°€ ìˆì„ë•Œë§Œ ì‚¬ìš©

### Response
HTTP/1.1 200 OK
Content-Type: application/json

{
  "id": 1,
  "name": "í™ê¸¸ë™"
}
{% endhighlight %}

**Spring MVC ì—ì„œì˜ ë™ì‘**

ì „ì²´ íë¦„ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

{% highlight text %}
ìš”ì²­ â†’ DispatcherServlet
        â†“
     HandlerMapping (ì ì ˆí•œ Controller ì°¾ê¸°)
        â†“
   HandlerAdapter(RequestMappingHandlerAdapter) (ì ì ˆí•œ ì‹¤í–‰ ì–´ëŒ‘í„° ì„ íƒ)
        â†“
   HandlerMethod(@Controller or @RestController) ì‹¤í–‰
        â†“
   HandlerMethodReturnValueHandler ë¡œ HandlerMethod ë°˜í™˜ê°’ ì²˜ë¦¬ 
        â†“
   ë°˜í™˜ ê°ì²´ë¥¼ HttpMessageConverter ë¡œ ì§ë ¬í™”
        â†“
   ContentNegotiationManager ê°€ Accept í—¤ë” ê¸°ë°˜ìœ¼ë¡œ MIME íƒ€ì… ê²°ì •
        â†“
   ResponseEntity / ResponseBody ë¡œ ì‘ë‹µ ë°˜í™˜
{% endhighlight %}

1. `RequestMappingHandlerAdapter` ê°€ í´ë¼ì´ì–¸íŠ¸ ë§¤ê°œë³€ìˆ˜, ë°˜í™˜ê°’, ìš”ì²­/ì‘ë‹µ body ì§ë ¬í™”/ì—­ì§ë ¬í™” ë¶„ì„
    - ì´ ì•ˆì—” ì—¬ëŸ¬ ê°ì²´ê°€ ìˆëŠ”ë°, `HandlerMethodArgumentResolver`, `HandlerMethodReturnValueHandler`, `HttpMessageConverter` ê°€ ìˆë‹¤.
2. `ReturnHandler` ì˜ `HandlerMethodReturnValueHandler` ë¡œ `Accept` í—¤ë” ì½ì–´ë“¤ì„
3. ì•Œë§ì€ `HttpMessageConverter` ë¥¼ ì„ íƒí•´ ì§ë ¬í™”
    - `MappingJackson2HttpMessageConverter` -> `application/json`
    - `Jaxb2RootElementHttpMessageConverter` -> `application/xml`
    - `StringHttpMessageConverter` -> `text/plain`
    - `ByteArrayHttpMessageConverter` -> `application/octet-stream`
3. ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë¦¬í„´ ê°ì²´ë¥¼ ê·¸ í¬ë§·ìœ¼ë¡œ ì§ë ¬í™”

ì´ë¥¼ ì§€í‚¤ê¸° ìœ„í•´ Mapping ì—ëŠ” `produces`, `consumes` ë¥¼ ë¶™ì´ëŠ” ê²ƒì„ ì „ í¬ìŠ¤íŠ¸ì—ì„œ ë³´ì•˜ë‹¤. ì½”ë“œëŠ” ìƒëµí•œë‹¤.

### ETag ê¸°ë°˜ ì¡°ê±´ë¶€ ìš”ì²­ (If-Match, If-None-Match)

`ETag` ëŠ” ì„œë²„ê°€ ë¦¬ì†ŒìŠ¤ì˜ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ ë¶€ì—¬í•˜ëŠ” ê³ ìœ í•œ ì‹ë³„ì(í† í°)ì´ë‹¤. ë¦¬ì†ŒìŠ¤ì˜ ë‚´ìš©ì´ ë°”ë€Œë©´, `ETag` ì˜ ê°’ë„ ë°”ë€Œê²Œ ëœë‹¤.

{% highlight text %}
HTTP/1.1 200 OK
Content-Type: application/json
ETag: "v1-users-12345"

{
  "id": 1,
  "name": "í™ê¸¸ë™"
}
{% endhighlight %}

ë§Œì•½ ì „ìš© ìŠ¤í† ë¦¬ì§€ê°€ ìˆë‹¤ë©´, ë¸Œë¼ìš°ì €ë‚˜ í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ê±¸ ê¸°ì–µí•´ë’€ë‹¤ê°€ ë‹¤ìŒ ìš”ì²­ ì‹œì— ì‚¬ìš©í•œë‹¤.

- ìºì‹± ìµœì í™”
- ë™ì‹œì„± ì œì–´
- ë„¤íŠ¸ì›Œí¬ ì ˆì•½

{% highlight java %}
@GetMapping(path = "/{id}",
            produces = "application/json")
public ResponseEntity<ProductResponseDto> getProduct(@PathVariable Long id) {
    if (id == null)
        return ResponseEntity.notFound().build();

    var product = productService.getProduct(id);

    return ResponseEntity.ok()
                         .header("Content-Type", "application/json")
                         .header("ETag", String.valueOf(product.hashCode()))
                         .body(product);
}
{% endhighlight %}

ì´ì œ client-side ì˜ storage ìì²´ì—ì„œ ì´ë¥¼ ì“¸ ìˆ˜ ìˆë‹¤. ìœ„ í—¤ë”ë¥¼ í†µí•´ì„œ ì´ì œ CRUD ì—ì„œ ë‹¤ìŒ ì˜µì…˜ë„ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.

**If-None-Match**

GET ë°©ì‹ì—ì„œ ìºì‹± ìµœì í™”ë¥¼ ìœ„í•´ ì‚¬ìš©ëœë‹¤.  
í´ë¼ì´ì–¸íŠ¸ê°€ ê°€ì§€ê³  ìˆëŠ” ë¦¬ì†ŒìŠ¤ì˜ ETag ê°’ì´ ì„œë²„ì™€ ê°™ë‹¤ë©´, ë‹¤ì‹œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

{% highlight text %}
GET /api/products/1 HTTP/1.1
If-None-Match: "v1-users-12345"
{% endhighlight %}

ì„œë²„ ë™ì‘:
- í˜„ì¬ ë¦¬ì†ŒìŠ¤ì˜ ETagë¥¼ ê³„ì‚°
- If-None-Match ê°’ê³¼ ë¹„êµ
  - ê°™ìœ¼ë©´ â†’ `304 Not Modified`
  - ë‹¤ë¥´ë©´ â†’ `200 OK` + ìƒˆë¡œìš´ ETag + ìƒˆ ë°ì´í„°

ì´ë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ì ˆì•½ê³¼ ì‘ë‹µ ì†ë„ í–¥ìƒì„ ì–»ì„ ìˆ˜ ìˆë‹¤. ê¸°ëŠ¥ìƒ `GET` ë°©ì‹ì— ë” ì–´ìš¸ë¦°ë‹¤. ë‹¤ìŒ ì½”ë“œë¥¼ ë³´ì.

{% highlight java %}
@GetMapping(path = "/{id}",
            produces = "application/json")
public ResponseEntity<ProductResponseDto> getProduct(
        @PathVariable Long id,
        @RequestHeader(name = "If-None-Match", required = false) String eTag) {
    if (id == null)
        return ResponseEntity.notFound().build();

    var product = productService.getProduct(id);

    if (eTag != null && eTag.equals(String.valueOf(product.hashCode())))
        return ResponseEntity.status(HttpStatus.NOT_MODIFIED).build();

    return ResponseEntity.ok()
                            .header("Content-Type", "application/json")
                            .header("ETag", String.valueOf(product.hashCode()))
                            .body(product);
}
{% endhighlight %}

GET ë°©ì‹ìœ¼ë¡œ HTTP ìš”ì²­ì„ ë‹¤ìŒê³¼ ê°™ì´ ë³´ë‚´ë©´ 304 ë¡œ ë¦¬í„´ ë°›ê³  ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤:

![assets/img/etag-if-none-match.png]({{ site.baseurl }}/assets/img/etag-if-none-match.png)

> HttpStatus.NOT_MODIFIED ëŠ” 302 ë²ˆì´ë‹¤.

**If-Match**

ì´ì œ PUT, PATCH, DELETE ë“±ì— ì“¸ ìˆ˜ ìˆëŠ” ë°©ì‹ì´ë‹¤. `If-Match` ëŠ” ì´ ë²„ì „ì´ ì•„ì§ ìœ íš¨í•  ë•Œë§Œ ìˆ˜ì • í—ˆìš© -> ë™ì‹œì„± ì œì–´

{% highlight java %}
@PutMapping(path = "/{id}",
            consumes = "application/json",
            produces = "application/json")
public ResponseEntity<ProductResponseDto> updateProduct(
        @PathVariable Long id,
        @RequestBody ProductResponseDto productRequestDto,
        @RequestHeader(value = "If-Match", required = false) String eTag) {

    if (id == null ||
        productRequestDto.name().isBlank() ||
        productRequestDto.price() < 0)
        return ResponseEntity.badRequest().build();

    var oldProduct = productService.getProduct(id);
    if (eTag != null && eTag.equals(String.valueOf(oldProduct.hashCode())))
        return ResponseEntity.status(HttpStatus.PRECONDITION_FAILED).build();

    var product = productService.updateProduct(id, productRequestDto.name(), productRequestDto.price());

    return ResponseEntity.ok()
                            .header("Content-Type", "application/json")
                            .body(product);
}

@DeleteMapping(path = "/{id}")
public ResponseEntity<Void> deleteProduct(
        @PathVariable Long id,
        @RequestHeader(value = "If-Match", required = false) String eTag) {
    if (id == null)
        ResponseEntity.notFound().build();

    var product = productService.getProduct(id);
    if (eTag != null && !eTag.equals(String.valueOf(product.hashCode())))
        return ResponseEntity.status(HttpStatus.PRECONDITION_FAILED).build();

    productService.deleteProduct(id);

    return ResponseEntity.noContent().build();
}
{% endhighlight %}

> `HttpStatus.PRECONDITION_FAILED` ëŠ” 412 ë²ˆì´ë‹¤.

### Idempotency-Key

POST ìš”ì²­ì€ ë‹¤ë¥¸ ìš”ì²­ë“¤ê³¼ëŠ” ë‹¤ë¥´ê²Œ ë©±ë“±ì„±ì„ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤. ì¤‘ë³µ ìš”ì²­ ì‹œ ìƒíƒœê°€ ë‹¬ë¼ì§€ë©°, ì´ëŠ” ë‹¤ìŒ ë¬¸ì œë“¤, **ê²°ì œ, ì£¼ë¬¸ ìƒì„±, íšŒì› ê°€ì…** ë“± í•œ ë²ˆë§Œ ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ëŠ” ìš”ì²­ì— ìˆì–´ ì¤‘ë³µ ì‹¤í–‰ì„ ë°©ì§€í•´ì•¼ í•¨ì„ ë§í•œë‹¤.

`Idempotency-Key` ëŠ” í—¤ë”ì— ìˆê³ , ì„œë²„ëŠ” ê°™ì€ í‚¤ë¥¼ ê°€ì§„ ìš”ì²­ì´ ì´ë¯¸ ì²˜ë¦¬ëëŠ”ì§€ í™•ì¸í•˜ë©°, ì´ë¯¸ ì²˜ë¦¬ëœ ìš”ì²­ì´ë©´ ì¤‘ë³µ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ì´ì „ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤.

**ìš”ì²­ ì˜ˆì‹œ**
{% highlight java %}
POST /api/orders HTTP/1.1
Content-Type: application/json
Idempotency-Key: 123e4567-e89b-12d3-a456-426614174000

{
  "productId": 1,
  "quantity": 2
}
{% endhighlight %}

### CORS & CSRF

#### CORS

CORS(Cross-Origin Resource Sharing) ëŠ” **ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ë¥¸ ì¶œì²˜(Origin) ìœ¼ë¡œì˜ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ë°œìƒí•˜ëŠ” ë³´ì•ˆ ì •ì±…ì„ ì œì–´í•˜ëŠ” ê¸°ë²•**ì´ë‹¤.

ì´ë•Œ Origin = í”„ë¡œí† ì½œ + ë„ë©”ì¸ + í¬íŠ¸ ë¡œ ì •ì˜ë˜ë©°, ë‹¤ìŒê³¼ ê°™ì´ ìƒê°í•˜ë©´ ëœë‹¤:
- `https://localhost:8080`

**Same-Origin Policy**

ë¸Œë¼ìš°ì €ì˜ ê¸°ë³¸ ì •ì±…ì€ ë‹¤ë¥¸ ì¶œì²˜ë¡œë¶€í„° ìŠ¤í¬ë¦½íŠ¸ê°€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ë§‰ëŠ”ë‹¤. ì´ëŠ” ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆì„ ìˆ˜ë„ ìˆê³ , ì‚¬ìš©ìì˜ ë°ì´í„°ë¥¼ íƒˆì·¨í•  ìˆ˜ë„ ìˆê¸°ì— ë§‰ëŠ”ê²Œ ì¢‹ìœ¼ë©° ì´ë•Œ ì´ ì•ˆì—ëŠ” CORS ë¼ëŠ” ê¸°ìˆ ì„ í†µí•´ ì„œë²„ê°€ íŠ¹ì • ë‹¤ë¥¸ ì¶œì²˜ë¥¼ í—ˆìš©í•´ì£¼ì–´ì„œ ë¸Œë¼ìš°ì €ê°€ ìš”ì²­ì„ í—ˆìš©í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆë„ë¡ í•˜ë©° ë‹¤ë¥¸ í—ˆìš©ë˜ì§€ ì•Šì€ ì›¹ ì‘ë‹µì´ë‚˜ ìš”ì²­ì„ ë§‰ëŠ” ê¸°ëŠ¥ì´ ë°”ë¡œ CORS ì´ë‹¤.

> ì„œë²„ -> ë¸Œë¼ìš°ì €: `Access-Control-Allow-Origin` í—¤ë”ë¥¼ í†µí•´ í—ˆìš©

CORS ìš”ì²­ì—ëŠ” ë‘ ê°€ì§€ê°€ ìˆë‹¤.

##### Simple Request

HTTP ë©”ì„œë“œì—ëŠ” 8ê°€ì§€ê°€ ìˆë‹¤.
1. `GET`: ë¦¬ì†ŒìŠ¤ë¥¼ ì¡°íšŒ. ì„œë²„ ìƒíƒœë¥¼ ë³€ê²½í•˜ì§€ ì•ŠìŒ
2. `HEAD`: GET ê³¼ ë™ì¼í•˜ì§€ë§Œ, ì‘ë‹µ ë³¸ë¬¸ì€ ì œì™¸í•˜ê³  í—¤ë”ë§Œ ë°˜í™˜
3. `POST`: ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì„œë²„ì— ë°ì´í„°ë¥¼ ì „ì†¡. ìƒíƒœ ë³€ê²½ ê°€ëŠ¥
4. `PUT`: ë¦¬ì†ŒìŠ¤ë¥¼ ì „ì²´ ê°±ì‹ . ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìƒì„± ê°€ëŠ¥
5. `DELETE`: ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œ
6. `CONNECT`: í„°ë„ë§ì„ ìœ„í•´ ì‚¬ìš©. ì£¼ë¡œ HTTPS í”„ë¡ì‹œ ì—°ê²°ì— ì“°ì„
7. `OPTIONS`: ì„œë²„ê°€ ì§€ì›í•˜ëŠ” ë©”ì„œë“œ, CORS í—ˆìš© ë“± ì˜µì…˜ í™•ì¸ ìš©
8. `TRACE`: ìš”ì²­-ì‘ë‹µ ê²½ë¡œë¥¼ ë””ë²„ê¹…ìš©ìœ¼ë¡œ ê·¸ëŒ€ë¡œ ë°˜í™˜

ì´ ì¤‘ì—ì„œ ë‹¨ìˆœ ìš”ì²­ì€ **GET, POST, HEAD** ì— í•´ë‹¹í•œë‹¤.

ë‹¨ìˆœìš”ì²­ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ `Content-Type` ì œì•½ì´ ë“¤ì–´ê°„ë‹¤:
- `application/x-www-form-urlencoded`
- `multipart/form-data`
- `text/plain`

ë˜í•œ, í—¤ë”ì—ëŠ” ì‚¬ìš©ì ì •ì˜ í—¤ë” ë“¤ì–´ê°€ë©´ ì•ˆëœë‹¤. ì´ëŠ” ì•„ì£¼ ê¸°ë³¸ì ì¸ ìš”ì²­ì¼ ë•Œ ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³ , ì„œë²„ì— í—ˆìš©í•˜ë©´ ë°”ë¡œ ì‘ë‹µì´ ë“¤ì–´ì˜¤ê²Œ ëœë‹¤.

**ìš”ì²­ ì‘ë‹µ íë¦„**
{% highlight text %}
GET /api/users HTTP/1.1
Origin: http://localhost:3000
{% endhighlight %}

ë¸Œë¼ìš°ì €ê°€ ìœ„ì™€ ê°™ì´ ë³´ëƒˆë‹¤ê³  í•˜ì. ê·¸ëŸ¬ë©´ ì„œë²„ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ë‹µí•  ìˆ˜ ìˆë‹¤.

{% highlight text %}
HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://localhost:3000
Content-Type: application/json
{% endhighlight %}

ì—¬ê¸°ì„œ `Access-Control-Allow-Origin` í—¤ë”ê°€ ë¸Œë¼ìš°ì €ê°€ ìš”ì²­í•œ origin ê³¼ ì¼ì¹˜í•´ì•¼ ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤. ì´ë ‡ë“¯ ë‹¨ìˆœ ìš”ì²­ì€ **Preflight** ì—†ì´ ë°”ë¡œ ìš”ì²­ì´ ì§„í–‰ëœë‹¤.

##### Preflight Request

**Preflight Request(ì‚¬ì „ ìš”ì²­)** ì—ëŠ” `PUT`, `DELETE`, `PATCH`, `OPTIONS` ê°€ ìˆê³ , `Content-Type` ì—ëŠ” `application/json` ë“±ì´ ë“¤ì–´ê°„ë‹¤.

ì´ ì¤‘ `OPTIONS ìš”ì²­`ì´ `Preflight` ìš”ì²­ì˜ í•µì‹¬ì´ë©°, ëª©ì ì€ ë¸Œë¼ìš°ì €ê°€ ì‹¤ì œ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— ì„œë²„ê°€ í—ˆìš©í•˜ëŠ” ë©”ì„œë“œ, í—¤ë”, ì¶œì²˜ë¥¼ ë¯¸ë¦¬ í™•ì¸í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•˜ê²Œ ëœë‹¤. í•­ìƒ `OPTIONS` ìš”ì²­ì´ ë¨¼ì € ì¼ì–´ë‚˜ê³  ê·¸ ë‹¤ìŒ `PUT`, `DELETE`, `PATCH` ìš”ì²­-ì‘ë‹µì´ ì´ë£¨ì–´ì§„ë‹¤.

**Preflight Reqeust íë¦„**

{% highlight text %}
OPTIONS /api/products/1 HTTP/1.1
Origin: http://localhost:3000
Access-Control-Request-Method: PUT
Access-Control-Request-Headers: Content-Type
{% endhighlight %}

ìœ„ì™€ ê°™ì´ ìš”ì²­ì„ ë³´ë‚¸ë‹¤ë©´,

{% highlight text %}
HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type
Access-Control-Max-Age: 3600
{% endhighlight %}

ìœ„ì™€ ê°™ì´ ì‘ë‹µì„ í•  ìˆ˜ ìˆë‹¤(GET ì€ ê¸°ë³¸ì ìœ¼ë¡œ í—ˆìš©í•˜ê¸° ë•Œë¬¸ì— ë‹¹ì—°íˆ ëª…ì‹œì ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ”ê²Œ ë§ìŒ).

- `Access-Control-Allow-Origin`: http://localhost:8080
- `Access-Control-Allow-Methods`: í—ˆìš©ë˜ëŠ” ë©”ì„œë“œ(GET, POST, PUT, DELETE)
- `Access-Control-Allow-Headers`: í—ˆìš©ë˜ëŠ” ìš”ì²­ í—¤ë”
- `Access-Control-Max-Age`: Preflight ìºì‹± ì‹œê°„

ì´ì œ ë“œë””ì–´ `GET`, `POST`, `PUT`, `DELETE` ë¥¼ ì“¸ ìˆ˜ ìˆê²Œ ëœë‹¤.

{% highlight text %}
PUT /api/products/1 HTTP/1.1
Origin: http://localhost:3000
Content-Type: application/json

{
  "name": "ìƒˆ ì œí’ˆ"
}
{% endhighlight %}

##### ì „ì²´ íë¦„

ì„œë²„ A(REST API ì„œë²„), ìœ ì € ê°€ ìˆë‹¤ê³  í•˜ì. ì´ì œ ì „ë°˜ì ì¸ íë¦„ì„ ë³¸ë‹¤.

**ë‹¨ìˆœ GET, POST, HEAD**
1. ë¸Œë¼ìš°ì €ê°€ ìš”ì²­
    - ë‹¨ìˆœ ìš”ì²­ ì œì•½ì„ ë§Œì¡±í•˜ë„ë¡ ìš”ì²­ì„ ë³´ë‚¸ë‹¤:
    - `Content-Type`: `text/plain` ë˜ëŠ” ìœ„ì˜ ì œì•½ì¡°ê±´ ë”°ë¥´ë„ë¡, ì•„ì˜ˆ ì—†ì–´ë„ë¨
    - ì‚¬ìš©ì ì •ì˜ í—¤ë” X
2. ì„œë²„ A ê°€ ì‘ë‹µ
    - ë‹¨ìˆœ ìš”ì²­ ì¡°ê±´ì„ ë§Œì¡±í•˜ë¯€ë¡œ Preflilght ì—†ì´ ë°”ë¡œ ì„œë²„ ìš”ì²­
    - ë¸Œë¼ìš°ì €ê°€ `Access-Control-Allow-Origin` ì„ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ì‘ë‹µì„ ë³´ë‚´ê²Œ ë¨
3. ë¸Œë¼ìš°ì €ê°€ ë°›ìŒ
    - ë°›ì„ ë•Œ Origin ì´ í—ˆìš©ë˜ì–´ ìˆë‹¤ë©´ ë¸Œë¼ìš°ì €ëŠ” ë°ì´í„°ë¥¼ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê²Œ ë˜ê³ 
    - ë¸Œë¼ìš°ì € ìì²´ì—ì„œ í—ˆìš©ë˜ì§€ ì•ŠëŠ” Origin ì´ë¼ë©´ CORS ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ê²Œ ëœë‹¤.

**ì‚¬ì „ OPTIONS ì´ í•„ìš”í•œ PUT, DELETE, PATCH**

1. ë¸Œë¼ìš°ì €ê°€ Preflight(OPTIONS) ì „ì†¡
    - ë¸Œë¼ìš°ì €ëŠ” ì‹¤ì œ ìš”ì²­(PUT, DELETE, PATCH) ë¥¼ ë³´ë‚´ê¸° ì „ì— ì„œë²„ê°€ ì´ìš”ì²­ì„ í—ˆìš©í•˜ëŠ”ì§€ ë¯¸ë¦¬ í™•ì¸í•˜ê¸° ìœ„í•´ ìë„ìœ¼ë¡œ OPTIONS ìš”ì²­ì„ ë³´ëƒ„

{% highlight text %}
OPTIONS /api/products/1 HTTP/1.1
Origin: http://localhost:3000
Access-Control-Request-Method: PUT
Access-Control-Request-Headers: Content-Type, Authorization
{% endhighlight %}

2. ì„œë²„ Aê°€ OPTIONS ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µ ì „ì†¡
    - ì´ë•Œ ì´ ì‘ë‹µì´ ìœ íš¨í•´ì•¼ë§Œ ë¸Œë¼ìš°ì €ê°€ ì‹¤ì œ ìš”ì²­(2ë‹¨ê³„) ë¡œ ë„˜ì–´ê°
    - í•˜ë‚˜ë¼ë„ ëˆ„ë½ë˜ë©´ CORS ì—ëŸ¬ ë°œìƒ

{% highlight text %}
HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, PATCH
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Max-Age: 3600
{% endhighlight %}

3. ë¸Œë¼ìš°ì €ê°€ ì‹¤ì œ ìš”ì²­ ì „ì†¡
    - Preflight ì‘ë‹µì´ ìœ íš¨í•˜ë©´, ì´ì œ ë¸Œë¼ìš°ì €ëŠ” ì§„ì§œ ìš”ì²­ì„ ë³´ë‚´ê²Œ ëœë‹¤.

{% highlight text %}
PUT /api/products/1 HTTP/1.1
Origin: http://localhost:3000
Content-Type: application/json
Authorization: Bearer 123456

{
  "name": "ìƒˆ ì œí’ˆ"
}
{% endhighlight %}

4. ì„œë²„ Aê°€ ì‹¤ì œ ì‘ë‹µ ì „ì†¡

{% highlight text %}
HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://localhost:3000
Content-Type: application/json

{
  "id": 1,
  "name": "ìƒˆ ì œí’ˆ"
}
{% endhighlight %}

5. ë¸Œë¼ìš°ì €ê°€ ì‘ë‹µ ì²˜ë¦¬
    - ì‘ë‹µì˜ Access-Control-Allow-Origin í—¤ë”ë¥¼ ë¨¼ì € ì½ì–´ì„œ ìì‹ ì˜ Origin ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ë§ë‹¤ë©´ ë°ì´í„° ì ‘ê·¼ì„ í•œë‹¤.

#### CSRF

CSRF(Cross-Site Request Forgery, ì‚¬ì´íŠ¸ ê°„ ìš”ì²­ ìœ„ì¡°)ëŠ” ì‚¬ìš©ìê°€ ì¸ì¦ëœ ì„¸ì…˜ ìƒíƒœì— ìˆì„ ë•Œ, ê³µê²©ìê°€ ì‚¬ìš©ìë¥¼ ì†ì—¬ ì•…ì˜ì ì¸ ìš”ì²­ì„ ëŒ€ì‹  ë³´ë‚´ê²Œ í•˜ëŠ” ê³µê²©ì´ë‹¤. ìš”ì²­ì´ ì •ìƒì ì¸ ì‚¬ìš©ìì˜ ì¿ í‚¤ë¥¼ í¬í•¨í•˜ë¯€ë¡œ ì§„ì§œ ìš”ì²­ì²˜ëŸ¼ ë³´ì´ê²Œ ëœë‹¤. ê³µê²½ë‹¹í•˜ê²Œ ë˜ëŠ” ê³¼ì •ì„ ë³´ì.

1. ì‚¬ìš©ìëŠ” `https://bank.com` ì— ë¡œê·¸ì¸ ëœ ìƒíƒœ(ì„¸ì…˜ ì¿ í‚¤ë¥¼ ì–»ì€ ìƒíƒœ)
    - sessionId = abc123
2. ê³µê²©ìê°€ ë§Œë“  ì‚¬ì´íŠ¸ëŠ” `https://evil.com`
3. ê·¸ ìƒíƒœë¡œ ê³µê²©ì ì‚¬ì´íŠ¸ ìš°ì—°íˆ ì ‘ì†(`evil.com`)
4. `evil.com` ì— ë‹¤ìŒ HTML ì´ ìˆ¨ì–´ ìˆë‹¤ê³  ê°€ì •
    - `<img src="https://bank.com/transfer?to=hacker&amount=100000" />`
5. ë¸Œë¼ìš°ì €ëŠ” ì´ë¯¸ `bank.com` ì˜ ì¿ í‚¤(`sessionId=abc123`) ì„ ì €ì¥í•˜ê³  ìˆê¸° ë•Œë¬¸ì—
    - ìë™ìœ¼ë¡œ ì´ ì¿ í‚¤ë¥¼ í¬í•¨í•œ GET ìš”ì²­ì„ `https://bank.com` ìœ¼ë¡œ ë³´ë‚´ê²Œ ë¨
6. ì„œë²„ëŠ” ì •ìƒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ìš”ì²­ìœ¼ë¡œ ì¸ì‹í•˜ê²Œ ë˜ê³ , ì†¡ê¸ˆì„ ìˆ˜í–‰í•¨

ì´ë¥¼ ë°©ì–´í•˜ëŠ” ë°©ë²•ì´ CSRF í† í°ì´ë©° ê°€ì¥ ì¼ë°˜ì ì¸ ë°©ë²•ì´ë‹¤.

##### CSRF í† í°

- ì„œë²„ê°€ í¼ì„ ë Œë”ë§í•  ë•Œ ë‚œìˆ˜ í† í°ì„ í¬í•¨ì‹œí‚¤ê³ 
- í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ ì‹œ ì´ í† í°ì„ í•¨ê»˜ ì „ì†¡í•´ì•¼ë§Œ ìœ íš¨í•œ ìš”ì²­ìœ¼ë¡œ ì¸ì •í•˜ê²Œ ëœë‹¤.
- ê³µê²©ìëŠ” í† í° ê°’ì„ ëª¨ë¥´ë¯€ë¡œ ìœ„ì¡°ê°€ ë¶ˆê°€í•˜ë‹¤

**ì˜ˆì‹œ**
{% highlight html %}
<form action="/transfer" method="POST">
  <input type="hidden" name="_csrf" value="a1b2c3d4e5f6" />
  <input type="text" name="to" />
  <button>ì†¡ê¸ˆ</button>
</form>
{% endhighlight %}

ì´ëŠ” Spring Security ì—ì„œ ë‹¤ë£¨ì.

##### SameSite Cookie ì„¤ì •

ë¸Œë¼ìš°ì € ì¿ í‚¤ì˜ `SameSite` ì†ì„±ìœ¼ë¡œ `Cross-Site` ìš”ì²­ì—ì„œ ì¿ í‚¤ ìë™ ì „ì†¡ì„ ì œí•œí•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

{% highlight http %}
Set-Cookie: sessionId=abc123; SameSite=Lax; Secure; HttpOnly
{% endhighlight %}

##### Referer / Origin ê²€ì¦

ì„œë²„ë‹¨ì—ì„œ í•  ìˆ˜ ìˆëŠ” ë³´ì•ˆì´ë©°, ì„œë²„ê°€ ìš”ì²­ì˜ Origin í˜¹ì€ Referer í—¤ë”ë¥¼ ë³´ê³  í—ˆìš©ëœ ë„ë©”ì¸ì—ì„œ ì˜¨ ìš”ì²­ë§Œ ì²˜ë¦¬í•˜ë„ë¡ ê²€ì¦í•œë‹¤.

{% highlight java %}
Set-Cookie: sessionId=abc123; SameSite=Lax; Secure; HttpOnly
{% endhighlight %}

### Spring HATEOAS ì‹¬í™”

HATEOAS (Hypermedia as the Engine of Application State)ëŠ” RESTì˜ ë§ˆì§€ë§‰ ë‹¨ê³„(â€œREST Level 3â€)ë¡œ, API ì‘ë‹µ ì•ˆì— ë§í¬ ì •ë³´ë¥¼ í¬í•¨í•´ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ â€œë‹¤ìŒ í–‰ë™â€ì„ API ë¬¸ì„œ ì—†ì´ë„ ìœ ë„í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê°œë…ì´ë‹¤.

ê¸°ë³¸ì ì¸ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

**Mapping Method**
{% highlight java %}
@GetMapping("/{id}")
public EntityModel<User> getUser(@PathVariable Long id) {
    var user = userService.findById(id);

    var userModel = EntityModel.of(user);
    userModel.add(linkTo(methodOn(UserController.class).getUser(id)).withSelfRel());
    userModel.add(linkTo(methodOn(UserController.class).getOrdersByUser(id)).withRel("orders"));

    return userModel;
}
{% endhighlight %}

**ì‘ë‹µ**
{% highlight json %}
{
  "id": 1,
  "name": "í™ê¸¸ë™",
  "_links": {
    "self": { "href": "http://localhost:8080/api/users/1" },
    "orders": { "href": "http://localhost:8080/api/users/1/orders" }
  }
}
{% endhighlight %}

**ì£¼ìš” í´ë˜ìŠ¤**
- `EntityModel<T>`: ë‹¨ì¼ ë¦¬ì†ŒìŠ¤ì— ë§í¬ ì¶”ê°€
- `CollectionModel<T>`: ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤(ë¦¬ìŠ¤íŠ¸)ì— ê³µí†µ ë§í¬ ì¶”ê°€
- `PagedModel<T>`: íŒ¨ì´ì§• ì²˜ë¦¬ëœ ë¦¬ì†ŒìŠ¤ ì‘ë‹µ

{% highlight java %}
package com.example.resthateoasexam;

public record Memo(
		Long id,
		String content
) { }
{% endhighlight %}

ìœ„ë¥¼ í† ëŒ€ë¡œ ê³„ì† ì§„í–‰í•´ë³´ì.

#### HATEOAS Representation Model

{% highlight java %}
@PostMapping(consumes = "text/plain", produces = "application/json")
@Transactional
public ResponseEntity<Memo> createMemo(@RequestBody String content) {
    if (content.isBlank())
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).build();
    long idx = memos.size();
    var memo = memos.put(idx, new Memo(idx, content));

    URI location = ServletUriComponentsBuilder.fromCurrentRequest()
                                                .path("/{id}")
                                                .buildAndExpand("id", idx)
                                                .toUri();

    return ResponseEntity.created(location)
                            .body(memo);
} 
{% endhighlight %}

ìœ„ëŠ” ì „í˜•ì ì¸ create ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì´ë‹¤. ì´ë•Œ `Memo` ì™€ `ResponseEntity` ì¤‘ê°„ì— `EntityModel` ì„ í•œ ë²ˆ ë” ê°ì‹¸ì„œ ì²˜ë¦¬í•´ì£¼ë©´ ëœë‹¤. ì—¬ê¸°ì„œ `URI` ë¥¼ ì§ì ‘ ë§Œë“¤ê³  ë„£ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë° ì´ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

{% highlight java %}
@PostMapping(consumes = "text/plain",
             produces = "application/json")
public ResponseEntity<EntityModel<MemoResponseDTO>> createMemo(
        @RequestBody String Memo) {
    if (memo.trim().isBlank()) return ResponseEntity.badRequest().build();

    MemoResponseDTO response = memoService.createMemo(memo);

    URI location = UriComponentsBuilder.fromUriString("/api/memos/")
                                        .path("/{id}")
                                        .buildAndExpand(response.id())
                                        .toUri();

    return ResponseEntity.created(location)
                         .eTag(getETag(response).toString())
                         .body(wrap(response));
}
// ...
private EntityModel<MemoResponseDTO> wrap(MemoResponseDTO dto) {
    return EntityModel.of(dto)
                      .add(linkTo(MEMO_CTRL.createMemo("This is create function"))
                                  .withRel("createMemo"))
                      .add(linkTo(MEMO_CTRL.getMemo(dto.id(), null))
                                  .withRel("getMemo"))
                      .add(linkTo(MEMO_CTRL.getMemos(null))
                                  .withRel("getMemos"))
                      .add(linkTo(MEMO_CTRL.updateMemo(dto.id(), null, null))
                                  .withRel("updateMemo"))
                      .add(linkTo(MEMO_CTRL.deleteMemo(dto.id(), null))
                                  .withRel("deleteMemo"));
}

private ETag getETag(MemoResponseDTO dto) {
    String eTagValue = "\"" + dto.hashCode() + "\"";
    return ETag.create(eTagValue);
}
{% endhighlight %}

#### GlobalExceptionHandler

ì´ì œ `RestControllerAdvice` ì–´ë…¸í…Œì´ì…˜ì„ ë³¼ ê²ƒì´ë‹¤. ì´ì „ì— ë´¤ë‹¤ì‹œí”¼ `ControllerAdvice` ë„ ìˆê³  ì´ì™€ ìœ ì‚¬í•˜ë‹¤.

**ë™ì‘**

1. ì˜ˆì™¸ ë°œìƒ
    - í´ë¼ì´ì–¸íŠ¸ê°€ API ë¥¼ ìš”ì²­í•œ í›„
    - **ì„œë¹„ìŠ¤ë‚˜ ì»¨íŠ¸ë¡¤ëŸ¬** ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒ
2. ì˜ˆì™¸ íƒìƒ‰
    - Spring MVC ëŠ” `HandlerExceptionResolver` ì²´ì¸ì„ í†µí•´ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬
    - `@ControllerAdvice` í˜¹ì€ `@RestControllerAdvice` ê°€ ìˆëŠ” í´ë˜ìŠ¤ ì¤‘ì—ì„œ
        - `@ExceptionHandler` ë¡œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œê°€ ìˆëŠ”ì§€ íƒìƒ‰
3. ì˜ˆì™¸ ì²˜ë¦¬ ë©”ì„œë“œ í˜¸ì¶œ
    - ì´ë•Œ ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ì˜ˆì™¸ ê°ì²´ë¥¼ ì¸ìë¡œ ì£¼ì…ì‹œì¼œì¤€ë‹¤.
    - ëŒ€ë¶€ë¶„ì˜ ì—ëŸ¬ ì‘ë‹µì€ `ErrorResponse` ì¸í„°í˜ì´ìŠ¤ ë‚´ë¶€ì˜ `builder()` ë¡œ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

{% highlight java %}
ErrorResponse.builder(ex, HttpStatusCode.valueOf(404), ex.getMessage())
             .title("Resource Not Found")
             .property("timestamp", LocalDateTime.now())
             .build();
{% endhighlight %}

> `ErrorResponse` ëŠ” Spring 6ë¶€í„° ë„ì…ë˜ì—ˆë‹¤. Spring í‘œì¤€ì¸ `ProblemDetail` ê¸°ë°˜ìœ¼ë¡œ `RFC 9457` ê·œê²©ì˜ JSON ì‘ë‹µì„ ë§Œë“œëŠ” ë°©ì‹ì´ë¼ ì›¹ ê·œì•½ì— ë§ì•„ ì ì ˆí•œ ì—ëŸ¬ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.

**ì˜ˆì‹œ**

{% highlight java %}
@RestControllerAdvice
public class GlobalExceptionHandler {

	@ExceptionHandler(ResourceNotFoundException.class)
	public ErrorResponse handleNotFound(
			ResourceNotFoundException e) {
		return ErrorResponse.builder(e, HttpStatusCode.valueOf(404), e.getMessage())
				.title("Resource Not Found")
				.property("timestamp", LocalDateTime.now())
				.build();
	}

	@ExceptionHandler(Exception.class)
	public ErrorResponse handleGeneral(Exception ex) {
		return ErrorResponse.builder(ex, HttpStatusCode.valueOf(500), "Internal server error")
		                    .title("Server Error")
		                    .property("timestamp", LocalDateTime.now())
		                    .build();
	}
}
{% endhighlight %}
