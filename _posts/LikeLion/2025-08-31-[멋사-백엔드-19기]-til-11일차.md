---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 11ì¼ì°¨"
date:   2025-08-31 14:32:17 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Java
---

<!--more-->

## ğŸª› í•œê³„ì 

ì‹¤ë¬´ì—ì„œ ì´ë¡ ì„ ì ìš©ì‹œí‚¤ê¸°ì—ëŠ” ëª¸ì´ ë‹¨ë ¨ì´ ë˜ì–´ ìµìˆ™í•´ìˆì–´ì•¼ í•œë‹¤.  
ë¯¸ë‹ˆ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ì„œ ì²´í™” ë˜ë„ë¡ ì—°ìŠµí•´ì•¼í•œë‹¤.

## ğŸ“‚ ëª©ì°¨
- [Context](#context)
    - [ThreadLocal](#threadlocal)
    - [ExecutorService](#executorservice)
    - [Modern Java Concurrent ë²„ì „](#modern-java-concurrent-ë²„ì „)
        - [allOf(), anyOf()](#allof-anyof)
        - [exceptionally()](#exceptionally)
- []()

---

## ğŸ“š ë³¸ë¬¸

ë¯¸ë‹ˆí”„ë¡œì íŠ¸ë¥¼ í•˜ë©´ì„œ í•„ìš”í–ˆë˜ ê²ƒë“¤ì„ êµ¬í˜„í•´ë³´ì. ì—¬ê¸°ì„œëŠ” ìˆœìˆ˜ ìë°”ì— ëŒ€í•œ êµ¬í˜„ì— ëŒ€í•´ ë§í•œë‹¤.

### Context

ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœ, í™˜ê²½ ì •ë³´, ê³µí†µ ë¦¬ì†ŒìŠ¤ ë“±ì„ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤.  

- RequestContext: ìš”ì²­ë³„ ì •ë³´(ì‚¬ìš©ì, ì„¸ì…˜, íŠ¸ëœì­ì…˜) ë“±ì„ ì €ì¥í•œë‹¤.
- ThreadPool + Context: ìŠ¤ë ˆë“œ í’€ì—ì„œ ì‘ì—…ì„ ì‹¤í–‰í•  ë•Œ,  
ì‘ì—…ì´ í•„ìš”í•œ í™˜ê²½ ì •ë³´ë‚˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.

ë‘ ë²ˆì§¸ í˜•íƒœëŠ” ë³´í†µ ìˆœìˆ˜ ìë°” ì„œë²„ì—ì„œ íŠ¹ì • ì‹œìŠ¤í…œì„ êµ¬í˜„í•  ë•Œ ì‚¬ìš©í•œë‹¤ê³  í•œë‹¤.

#### ThreadLocal

ìš°ì„  ì‘ì—…ì„ ì²˜ë¦¬í•  ìŠ¤ë ˆë“œ ì—¬ëŸ¬ ê°œë¥¼ ë‹¤ë£° ìˆ˜ ìˆê²Œ ìŠ¤ë ˆë“œ í•œ ë‹¨ìœ„ë¥¼ êµ¬í˜„í•´ë³´ì.

ìˆœìˆ˜ ìë°”ì—ì„œëŠ” `ThreadLocal` ì´ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ì œê³µí•˜ëŠ”ë°, í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ëŠ” ë…ë¦½ì ìœ¼ë¡œ  
ë³€ìˆ˜ ì €ì¥ì†Œë¥¼ ê°€ì§€ê³ , ì¼ë°˜ì ì¸ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë‚˜ static ë³€ìˆ˜ì™€ëŠ” ë‹¬ë¦¬ thread ë§ˆë‹¤ ë³„ë„ì˜ ê°’ì„ ì§€ë‹Œë‹¤.

ë”°ë¼ì„œ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê°™ì€ `ThreadLocal` ê°ì²´ë¥¼ ê³µìœ í•´ë„, ì‹¤ì œ ê°’ì€ ìŠ¤ë ˆë“œ ë³„ë¡œ ë…ë¦½ì ì´ë‹¤.

{% highlight java %}
// ThreadLocal ì„ ì–¸
ThreadLocal<String> threadLocal = new ThreadLocal<>();

// ê°’ ì €ì¥
threadLocal.set("Alice");

// ê°’ ì½ê¸°
String user = threadLocal.get();
System.out.println(user); // Alice

// ê°’ ì œê±° (í•„ìˆ˜ëŠ” ì•„ë‹ˆì§€ë§Œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ë¥¼ ìœ„í•´ ê¶Œì¥)
threadLocal.remove();
{% endhighlight %}

**ìš”ì•½**
- ê° thread ì—ì„œ `get()` ì„ í˜¸ì¶œ ì‹œ ìê¸° ìŠ¤ë ˆë“œ ì „ìš© ê°’ì´ ë‚˜ì˜´
- ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ `set()` ì„ í•´ë„ ë‹¤ë¥¸ ìŠ¤ë ˆë“œ ì „ìš© ê°’ì—ëŠ” ì˜í–¥ì„ ì•ˆë¯¸ì¹¨

ì´ë¥¼ í† ëŒ€ë¡œ `RequestContext` ì— í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì ìš©ì‹œí‚¤ë©´,

{% highlight java %}
public class RequestContext {
    private static final ThreadLocal<RequestContext> context =
        ThreadLocal.withInitial(RequestContext::new);

    private String currentUser;

    public static RequestContext get() {
        return context.get();
    }

    public String getCurrentUser() {
        return currentUser;
    }

    public void setCurrentUser(String user) {
        this.currentUser = user;
    }

    public static void clear() {
        context.remove();
    }
}
{% endhighlight %}

ìœ„ì™€ ê°™ì´ ì„ ì–¸í•˜ë©´ ìŠ¤ë ˆë“œ ë³„ë¡œ ë‹¤ë¥¸ ê°’ë“¤ì„ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

#### ExecutorService

ì´ì œ ë¡œì»¬ ìŠ¤ë ˆë“œì˜ ì €ì¥ì†Œ ê´€ë¦¬ë¥¼ ë³´ì•˜ìœ¼ë‹ˆ, ì²˜ë¦¬í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ì •ì˜ í•  ì°¨ë¡€ì´ë‹¤.

ìˆœìˆ˜ ìë°”ì—ì„œ `ExecutorService` ëŠ” ìŠ¤ë ˆë“œ í’€(Thread Pool)ì„ ê´€ë¦¬í•˜ê³ ,  
ìŠ¤ë ˆë“œ ì‘ì—…ì„ ì‰½ê²Œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í•µì‹¬ í´ë˜ìŠ¤ì´ë‹¤.  
ì—¬ê¸°ì— ì‘ì—…ì„ ì œì¶œí•˜ì—¬ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ëœë‹¤.


**ì˜ˆì‹œ**
{% highlight java %}
import java.util.concurrent.*;

public class ExecutorServiceExample {
    public static void main(String[] args) {

        // 1. ê³ ì • ìŠ¤ë ˆë“œ í’€ ìƒì„± (ìŠ¤ë ˆë“œ 3ê°œ)
        ExecutorService executor = Executors.newFixedThreadPool(3);

        // 2. ì‘ì—… ì œì¶œ
        for (int i = 1; i <= 5; i++) {
            final int taskId = i;
            executor.submit(() -> {
                System.out.println(Thread.currentThread().getName() + " ì²˜ë¦¬ì¤‘: Task-" + taskId);
            });
        }

        // 3. ì¢…ë£Œ
        executor.shutdown();
    }
}
{% endhighlight %}

ìœ„ì²˜ëŸ¼ ì‘ì—…(`Runnable`, `Callable`)ì„ ë°›ì•„ë“¤ì—¬ ì‘ì—… íë¥¼ í†µí•´ 3ê°œì˜ ìŠ¤ë ˆë“œë¡œ ë“¤ì–´ê°€ ì²˜ë¦¬í•œë‹¤. ì—¬ê¸°ì„œ `submit` ì€ ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ëœë‹¤.

`ExecutorService` ì— `submit()` ëœ task ë“¤ì€ ì „ë¶€ Future ë¥¼ í†µí•´ ê°’ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.

#### Modern Java Concurrent ë²„ì „

í•˜ì§€ë§Œ ìœ„ì™€ ê°™ì´ ì—¬ëŸ¬ ê°œì˜ ì‘ì—…ì„ ì‹¤í–‰ í›„ì— `Future` ë¡œ ë°›ëŠ”ë‹¤ê³  ì¹˜ë©´ `Future` ì´ ì—¬ëŸ¬ê°œ ìˆì–´ì•¼ í•œë‹¤. ì´ë¥¼ í•œ ë³€ìˆ˜ë¡œ ë‹´ì•„ì„œ í•œ ë²ˆì— ì²˜ë¦¬í•˜ë ¤ë©´ ë‹¤ìŒ ì½”ë“œë¥¼ ë³´ì:

{% highlight java %}
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.ThreadLocalRandom;

public class CompletableFutureExample {

    public static void main(String[] args) {
        ExecutorService executor = Executors.newFixedThreadPool(3);

        System.out.println("ì‘ì—… ì‹œì‘...");

        CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
            System.out.println(Thread.currentThread().getName() + "ì—ì„œ ë¹„ë™ê¸° ì‘ì—… ì‹¤í–‰ ì¤‘...");
            try {
                Thread.sleep(ThreadLocalRandom.current().nextInt(1000, 3000));
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
            return "ì‘ì—… ì™„ë£Œ!";
        }, executor); // ì‚¬ìš© í•  Executorë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •

        future.thenAccept(result -> {
            System.out.println(Thread.currentThread().getName() + "ì—ì„œ ê²°ê³¼ê°’ ë°›ìŒ: " + result);
        });

        System.out.println("ë©”ì¸ ìŠ¤ë ˆë“œëŠ” ë‹¤ë¥¸ ì‘ì—… ì§„í–‰ ì¤‘...");


        try {
            future.get(); // ì‘ì—…ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
        } catch (Exception e) {
            e.printStackTrace();
        }
        executor.shutdown();
        System.out.println("ëª¨ë“  ì‘ì—… ì¢…ë£Œ.");
    }
}
{% endhighlight %}

ìœ„ ì˜ˆì œì—ì„œëŠ” `CompletableFuture` ë¼ëŠ” í´ë˜ìŠ¤ì˜
- `thenAccept` ë¥¼ í†µí•´ ê°’ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ `consume` ë˜ë„ë¡ í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë³¼ ìˆ˜ ìˆê³ ,
- `supplyAsync` í•¨ìˆ˜ë¥¼ í†µí•´ ê°’ì„ `Supplier` ë¥¼ í†µí•´ `ExecutorService` ì—ê²Œ ì œê³µí•¨ì„ ë³¼ ìˆ˜ ìˆë‹¤.
- ë§Œì•½ ìŠ¤ë ˆë“œ ê°„ì˜ ê° task ë¥¼ ì²˜ë¦¬ ì¤‘ì— ìˆì–´ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ìë™ì ìœ¼ë¡œ ìŠ¤ë ˆë“œì˜ interrupt ê°’ì€ true -> false ë¡œ ì´ˆê¸°í™”ê°€ ëœë‹¤. ì´ë•Œ ìƒìœ„ í˜¸ì¶œìì—ê²Œ í•˜ìœ„ í˜¸ì¶œìê°€ interrupt ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì•Œë¦¬ê¸° ìœ„í•´ `interrupt()` ë¥¼ í˜¸ì¶œí•˜ì—¬ ì—¬ê¸°ì— `Exception` ì´ í„°ì¡Œë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì£¼ê²Œ ëœë‹¤.

##### allOf(), anyOf()

- `CompletableFuture.allOf()` ì¸ìë¡œ ë°›ì€ `CompletableFuture` ë“¤ì— ëŒ€í•´ ëª¨ë“  ê²°ê³¼ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëì„ ë•Œ, `CompletableFuture<Void>` ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜

{% highlight java %}
CompletableFuture<String> future1 = CompletableFuture.supplyAsync(() -> "ê²°ê³¼1");
CompletableFuture<String> future2 = CompletableFuture.supplyAsync(() -> "ê²°ê³¼2");

// ëª¨ë“  ì‘ì—…ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
CompletableFuture<Void> allFutures = CompletableFuture.allOf(future1, future2);

// ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œëœ í›„ì— ì‹¤í–‰
allFutures.thenRun(() -> {
    System.out.println("ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
});
{% endhighlight %}

- `CompletableFuture.anyOf()` ì¸ìë¡œ ë°›ì€ `CompletableFuture` ì¤‘ì— í•˜ë‚˜ë¼ë„ ì™„ë£Œë˜ë©´ í•´ë‹¹ ì™„ë£Œëœ ê°’ì„ ë‹´ëŠ” ìƒˆë¡œìš´ `CompletableFuture<Object>` ë¥¼ ìƒì„±í•œë‹¤.

{% highlight java %}
CompletableFuture<String> futureA = CompletableFuture.supplyAsync(() -> {
    try { Thread.sleep(3000); } catch (Exception e) {}
    return "ì„œë²„ Aì˜ ê²°ê³¼";
});
CompletableFuture<String> futureB = CompletableFuture.supplyAsync(() -> {
    try { Thread.sleep(1000); } catch (Exception e) {}
    return "ì„œë²„ Bì˜ ê²°ê³¼"; // ë” ë¹¨ë¦¬ ëë‚¨
});

// ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ë¨¼ì € ëë‚˜ëŠ” ê²ƒì„ ê¸°ë‹¤ë¦¼
CompletableFuture<Object> anyFuture = CompletableFuture.anyOf(futureA, futureB);

// ê°€ì¥ ë¨¼ì € ì™„ë£Œëœ ì‘ì—…ì˜ ê²°ê³¼ê°’ì„ ì‚¬ìš©
anyFuture.thenAccept(result -> {
    System.out.println("ê°€ì¥ ë¨¼ì € ì™„ë£Œëœ ê²°ê³¼: " + result);
});
{% endhighlight %}

> ì´ë•Œ ëª…ì‹œì  í˜•ë³€í™˜ì´ ë¶ˆê°€í”¼í•˜ë‹¤.

##### exceptionally()

`CompletableFuture` ì—ì„œ ë¹„ë™ê¸° ì‘ì—… ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ ê·¸ ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ê³ , ì •ìƒì ì¸ ê²°ê³¼ê°’ìœ¼ë¡œ ë³µêµ¬í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë©”ì„œë“œì´ë‹¤.

{% highlight java %}
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.Executors;

public class ExceptionallyExample {
    public static void main(String[] args) {
        // 1. ì˜ë„ì ìœ¼ë¡œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ëŠ” CompletableFuture
        CompletableFuture<String> futureWithException = CompletableFuture.supplyAsync(() -> {
            System.out.println("ì‘ì—… ì‹œì‘: ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.");
            throw new RuntimeException("ê³ ì˜ë¡œ ë°œìƒì‹œí‚¨ ì—ëŸ¬!");
        }, Executors.newSingleThreadExecutor());

        // 2. exceptionally()ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì™¸ ì²˜ë¦¬
        CompletableFuture<String> recoveredFuture = futureWithException.exceptionally(ex -> {
            System.out.println("ì˜ˆì™¸ë¥¼ ì¡ì•˜ìŠµë‹ˆë‹¤: " + ex.getMessage());
            // ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ ëŒ€ì²´í•  ê°’(ì •ìƒ ê°’)ì„ ë°˜í™˜
            return "ë³µêµ¬ëœ ê¸°ë³¸ê°’"; 
        });

        // 3. thenAccept()ë¡œ ìµœì¢… ê²°ê³¼ë¥¼ ë°›ì•„ì„œ ì¶œë ¥
        recoveredFuture.thenAccept(result -> {
            System.out.println("ìµœì¢… ê²°ê³¼: " + result);
        });
        
        // main ìŠ¤ë ˆë“œê°€ ì¢…ë£Œë˜ì§€ ì•Šë„ë¡ ì ì‹œ ëŒ€ê¸°
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
{% endhighlight %}