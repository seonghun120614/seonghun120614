---
layout: post
title:  "[ë©‹ì‚¬ ë°±ì—”ë“œ 19ê¸°] TIL 42ì¼ì°¨ JPA ì‹¬í™”"
date:   2025-10-24 10:12:05 +0900
categories: ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë©‹ì‚¬ ë°±ì—”ë“œ TIL Java Spring
---

<!--more-->

## ğŸ“‚ ëª©ì°¨

- [JPA ì‹¬í™”](#jpa-ì‹¬í™”)
    - [ORM](#orm)
    - [JPA ì£¼ìš” Class](#jpa-ì£¼ìš”-class)
    - [JPA í™œìš©](#jpa-í™œìš©)
        - [@Entity](#entity)
        - [EntityTransaction](#entitytransaction)
        - [Entity ë™ì¼ì„± vs ë™ë“±ì„±](#entity-ë™ì¼ì„±-vs-ë™ë“±ì„±)
        - [@Column](#column)
        - [@Enumerated](#enumerated)
        - [@Temporal](#temporal)
        - [@Lob](#lob)
        - [@PrePersist ì™€ @PostPersist](#prepersist-ì™€-postpersist)
    - [JPA ì—”í‹°í‹° ë§¤í•‘](#jpa-ì—”í‹°í‹°-ë§¤í•‘)
        - [@OneToOne](#onetoone)
        - [OneToOne ì—ì„œì˜ FetchType.LAZY ë¡œë”©ì˜ ë¬¸ì œì ](#onetoone-ì—ì„œì˜-fetchtypelazy-ë¡œë”©ì˜-ë¬¸ì œì )
        - [toString(), JSON ì˜ ì¬ê·€ì  í˜¸ì¶œ ê°€ëŠ¥ì„±](#tostring-json-ì˜-ì¬ê·€ì -í˜¸ì¶œ-ê°€ëŠ¥ì„±)
        - [@ManyToOne, @OneToMany](#manytoone-onetomany)
        - [EAGER, LAZY ê·¸ë¦¬ê³  N+1 ë¬¸ì œ](#eager-lazy-ê·¸ë¦¬ê³ -n1-ë¬¸ì œ)
        - [@ManyToMany](#manytomany)
        - []()

---

## ğŸ“š ë³¸ë¬¸

### JPA ì‹¬í™”

JPA ëŠ” ê°ì²´ì§€í–¥ì ì¸ ë°ì´í„° ì ‘ê·¼ì´ë¼ëŠ” ëª¨í† ë¥¼ ê°€ì§€ê³  ë§Œë“¤ì–´ì§„ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ íŒ¨ëŸ¬ë‹¤ì„ì„ ê°ì²´ì§€í–¥ì ìœ¼ë¡œ ë°”ê¿”ì„œ ì ‘ê·¼í•˜ëŠ” ê¸°ìˆ ì´ì ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.

JDBC ì™€ëŠ” ë‹¤ë¥´ê²Œ ì‘ë™í•˜ê³ , ì´í›„ì— ì‹¤ë¬´ì—ì„œë„ ìì£¼ ì‚¬ìš©í•˜ë‹ˆ ë§¤ìš° ìì„¸íˆ ë“¤ì—¬ë‹¤ ë³¼ ê²ƒì´ë‹¤.

#### ORM

ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ë³´ê¸° ìœ„í•´ ë°ì´í„° ì ‘ê·¼ ë¡œì§ì„ SQL ì—ì„œ ë¶„ë¦¬ì‹œí‚¤ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ë§Œ ì§‘ì¤‘í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ê¸° ìœ„í•´ ORM(Object-Relational Mapping) ì´ë¼ëŠ” ê°œë…ì„ í†µí•´ ê°ì²´ì™€ í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ë§¤í•‘í•œë‹¤.

ì´ëŸ¬í•œ ê°œë…ì´ í•„ìš”í•œ ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. SQLì„ ì§ì ‘ ì‘ì„±í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°˜ë³µ ì‘ì—…ì´ í•„ì—°ì ìœ¼ë¡œ ë°œìƒí•œë‹¤.

**ë¬¸ì œì **
- ìë°” ìƒì˜ ê°ì²´ë¥¼ í…Œì´ë¸”ì˜ row ì™€ ë§¤í•‘ì‹œí‚¤ê¸° ìœ„í•œ ë°ì´í„° ë³€í™˜ì´ í•„ìš”
- SQL ë¬¸ìì—´ì„ ì§ì ‘ ì‘ì„± ë° ìœ ì§€ë³´ìˆ˜ í•˜ëŠ” ê²ƒì€ êµ‰ì¥íˆ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ì½”ë“œ
- DBMS ì— ì˜ì¡´í•˜ê²Œ ë˜ëŠ” ì¿¼ë¦¬ ì²˜ë¦¬
- ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ ëª¨ë“  SQL ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•˜ê³ , ì´ëŠ” ê³§ JAVA ë‚´ë¶€ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ê²ƒê³¼ ë™ì¼

> ë‚˜ë¬´ ìœ„í‚¤ ì°¸ì¡°

ì´ëŸ¬í•œ ì´ìœ  ë•Œë¬¸ì— 1ì°¨ì ì¸ ìˆ˜ì • ì´í›„ì—ë„ nì°¨ ìˆ˜ì •ì´ í•„ìš”í•˜ê²Œ ë˜ëŠ” ìƒí™©ì´ ë°œìƒí•˜ë©°, ë§¤ë²ˆ ìœ ì‚¬ ì½”ë“œë¥¼ ì¼ì¼íˆ ì…ë ¥í•˜ëŠ” ê²ƒì€ êµ‰ì¥íˆ ë…¸ë™ ì§‘ì•½ì ì¸ ì¼ì´ë‹¤. JPA ëŠ” ì´ë¦„ì— ê±¸ë§ê²Œ Persistence ë¼ëŠ” ë…¼ë¦¬í™”ëœ ì €ì¥ê³µê°„ì„ ì œê³µí•¨ìœ¼ë¡œì¨ ê°œë°œìì—ê²Œ ìœ„ ë¬¸ì œë“¤ì„ í•´ê²° í•  í¸ë¦¬í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•œë‹¤.

#### JPA ì£¼ìš” Class

{% highlight text %}
+----------------------------------+
|          javax.persistence       |
+----------------------------------+

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         Persistence          â”‚  â† JPA ì§„ì…ì  (static í´ë˜ìŠ¤)
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   EntityManagerFactory       â”‚  â† EM ìƒì„± íŒ©í† ë¦¬ (Thread-safe)
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       EntityManager          â”‚  â† ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‹¨ìœ„ ê´€ë¦¬ ê°ì²´
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚      â–²               â–²
          â”‚      â”‚               â”‚
          â”‚      â”‚               â”‚
          â–¼      â”‚               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EntityTransaction â”‚   â”‚       Query        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                              â”‚
   â–¼                              â–¼
begin(), commit(), rollback()   getResultList(), getSingleResult()
{% endhighlight %}

- `Persistence` ì •ì  í´ë˜ìŠ¤: `EntityManagerFactory` ë¥¼ ìƒì„±í•˜ëŠ” ì§„ì…ì 
    - `createEntityManagerFactory(String persistenceUnitName)`: ë‚´ë¶€ì ìœ¼ë¡œ `META-INF/persistence.xml` ì„ ì½ì–´ ì„¤ì • ì •ë³´ë¥¼ ë¡œë“œí•˜ëŠ” ì—­í• ì„ í•œë‹¤.

- `EntityManagerFactory` ì¸í„°í˜ì´ìŠ¤: EntityManager ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” íŒ©í† ë¦¬(Thread-safety)
    - `createEntityManger()`
    - `close()`
    - ì‹±ê¸€í†¤ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

- `EntityManager` ì¸í„°í˜ì´ìŠ¤: ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸°ì™€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ì¸í„°í˜ì´ìŠ¤
    - `persist()`, `find()`, `merge()`, `remove()`
    - íŠ¸ëœì­ì…˜ ì œì–´: `EntityManager getTransaction()`
    - `JPQL` ì‹¤í–‰: `createQuery()`
    - `SQL` ì‹¤í–‰: `createNativeQuery()`
    - ì“°ë ˆë“œ ì•ˆì „í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í•œ ë²ˆ íŠ¸ëœì­ì…˜ì´ ì‹¤í–‰ë  ë•Œ ë™ì•ˆë§Œ ìƒì„±ë˜ê³  ì‚¬ë¼ì§„ë‹¤.
    - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•œë‹¤.
    - `AutoClosable` ì„ í™•ì¥í•˜ì—¬ ì œê³µí•˜ê¸° ë•Œë¬¸ì— ìì›ì„ ë‹«ì•„ì£¼ëŠ” ê²ƒì´ í•„ìš”

- `EntityTransaction` ì¸í„°í˜ì´ìŠ¤: íŠ¸ëœì­ì…˜ì„ ìˆ˜ë™ìœ¼ë¡œ ì œì–´í•  ìˆ˜ ìˆëŠ” ì¸í„°í˜ì´ìŠ¤
    - `begin()`, `commit()`, `rollback()`, `isActive()`

- `Query` ì¸í„°í˜ì´ìŠ¤: `JPQL` ë˜ëŠ” ë„¤ì´í‹°ë¸Œ SQL ì„ ì‹¤í–‰í•˜ëŠ” ê°ì²´
    - `setParameter(String name, Object value)`
    - `setResultList(), getSingleResult()`

#### JPA í™œìš©

ìˆœìˆ˜ JPA ë¥¼ ì“°ê¸° ìœ„í•´ ë‹¤ìŒì„ ì¶”ê°€í•œë‹¤.

{% highlight gradle %}
implementation 'org.hibernate:hibernate-core:6.4.4.Final'
implementation 'jakarta.persistence:jakarta.persistence-api:3.1.0'
{% endhighlight %}

JPA í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ëŠ” `jakarta` ë¡œ, êµ¬í˜„ì²´ëŠ” `hibernate-core` ë¡œ ë“¤ê³ ì˜¨ë‹¤. DB ë“œë¼ì´ë²„ëŠ” ê°ì ë§ê²Œ ë“¤ê³ ì˜¤ì(í•„ìëŠ” mysql).

**Hibernate ì„¤ì • íŒŒì¼**

`src/main/resources/META-INF/persistence.xml` ë¥¼ í†µí•´ ìƒì„±í•  `EntityManagerPersistence` ë¥¼ ì„¤ì •í•´ì¤˜ì•¼ í•œë‹¤(ìœ„ `Persistence` ì •ì  í´ë˜ìŠ¤ ì°¸ê³ ).

{% highlight xml %}
<?xml version="1.0" encoding="UTF-8"?>
<persistence xmlns="http://java.sun.com/xml/ns/persistence"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"
             version="2.0">

    <persistence-unit name="examplePU" transaction-type="RESOURCE_LOCAL">
        <provider>org.hibernate.jpa.HibernatePersistenceProvider</provider>
        <class>com.example.Member</class>

        <properties>
            <!-- JDBC ì„¤ì • -->
            <property name="jakarta.persistence.jdbc.driver" value="com.mysql.cj.jdbc.Driver"/>
            <property name="jakarta.persistence.jdbc.url" value="jdbc:mysql://localhost:3306/exampledb"/>
            <property name="jakarta.persistence.jdbc.user" value="{ì´ë¦„}"/>
            <property name="jakarta.persistence.jdbc.password" value="{ë¹„ë°€ë²ˆí˜¸}"/>

            <!-- hibernate ì„¤ì • -->
            <property name="hibernate.hbm2ddl.auto" value="update"/>
            <property name="hibernate.dialect" value="org.hibernate.dialect.MySQLDialect"/>
            <property name="hibernate.show_sql" value="true"/>
            <property name="hibernate.format_sql" value="true"/>
        </properties>
    </persistence-unit>
</persistence>
{% endhighlight %}

`persistence` íƒœê·¸ ì•ˆì— `persistence-unit` ì´ ì™€ì•¼ í•˜ë©° ê° `persistence-unit` ì€ persistence ì„¤ì • íŒŒì¼ í•˜ë‚˜ë¥¼ ì˜ë¯¸í•˜ëŠ” ë“¯í•˜ë‹¤. ì—¬ê¸° ì•ˆì— í•´ë‹¹ `persistence-unit` ì´ ê´€ë¦¬ í•  class íƒœê·¸ë“¤ì„ ë„£ì–´ì¤€ë‹¤.

> transaction-type ì˜µì…˜: [JTA](#jta) ëŒ€ì‹  íŠ¸ëœì­ì…˜ì„ ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê´€ë¦¬í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸  
> provider íƒœê·¸: JPA í”„ë¡œë°”ì´ë”ë¡œ Hibernate Core ì˜ `org.hibernate.jpa.HibernatePersistenceProvider` ë¥¼ ì‚¬ìš©

`properties` ë¡œ jdbc ì™€ hibernate êµ¬í˜„ì²´ì—ê²Œ ì¸ìë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.

- `dialect`: ë‹¤ì–‘í•œ íŒŒìƒëœ SQL ë“¤ì¤‘ ì–´ë–¤ ê²ƒì„ ì“¸ì§€ ì •í•˜ëŠ” íƒœê·¸
- `hbm2ddl.auto`
    - `create`: DB ë¥¼ ë°ì´í„° ì •ì˜ì–´ë¥¼ ì½”ë“œ ê¸°ì¤€ìœ¼ë¡œ ìƒˆë¡œ ìƒì„±
    - `update`: ì´ë¯¸ ìƒì„±ë˜ì–´ì ¸ ìˆëŠ” DB ì™€ ì½”ë“œê°€ ì„œë¡œ ë‹¤ë¥´ë‹¤ë©´ ì½”ë“œ ê¸°ì¤€ìœ¼ë¡œ ì—…ë°ì´íŠ¸
    - `create-update`: ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ ì½”ë“œ ê¸°ì¤€ìœ¼ë¡œ í…Œì´ë¸”ì„ ìƒì„±í•˜ê³ , ì¢…ë£Œ ì‹œì ì— ëª¨ë‘ ì‚­ì œ
    - `validate`: Java ì½”ë“œì™€ DB ìŠ¤í‚¤ë§ˆê°€ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì¦ë§Œ ìˆ˜í–‰í•˜ê³ , ìˆ˜ì •ì€ í•˜ì§€ ì•ŠëŠ” ì„¤ì •
    - `none`: DDL ìë™ ìƒì„± ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- `show_sql`: JPA(Hibernate) ê°€ ì‹¤í–‰í•˜ëŠ” SQL ì¿¼ë¦¬ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ë„ë¡ ì„¤ì •. SQLì´ ì‹¤ì œë¡œ ì–´ë–¤ ì‹ìœ¼ë¡œ ìˆ˜í–‰ë˜ëŠ”ì§€ í™•ì¸í•  ë•Œ ìœ ìš©í•¨, ë³´í†µ ê°œë°œ ë‹¨ê³„ì—ì„œ ì‚¬ìš©
- `format_sql`: ìœ„ sql ì„ ë³´ì—¬ì¤„ ë•Œ, indent ì‹œì¼œ ë³´ì—¬ì¤„ì§€ ì•„ë‹ì§€ ì •í•˜ëŠ”ê±°

##### @Entity

ìœ„ `Persistence` ê°€ ê´€ë¦¬í•  í´ë˜ìŠ¤ë¡œ `com.example.Member` ë¥¼ ì •ì˜í–ˆë‹¤. ìœ„ ê²½ë¡œëŒ€ë¡œ í´ë˜ìŠ¤ íŒŒì¼ì„ ìƒì„±í•˜ì.

{% highlight java %}
import jakarta.persistence.Entity;
import jakarta.persistence.Id;

@Entity
public class Member {
	@Id
	private Long id;
}
{% endhighlight %}

`@Entity` ëŠ” JPA ê°€ ê´€ë¦¬í•  ë°ì´í„°ë¼ëŠ” ê²ƒì„ ëª…ì‹œí•´ì£¼ê³ , ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ë ¤ë©´ ë°ì´í„°ì˜ êµ¬ë¶„ ê¸°ì¤€ì„ `@Id` ë¡œ ì •ì˜í•´ì¤˜ì•¼ í•œë‹¤. ë”°ë¼ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ìœ„ êµ¬ì„±ì„ ë”°ë¼ì•¼ í•œë‹¤.

{% highlight java %}
/**
* (Optional) The entity name. Defaults to the unqualified
* name of the entity class. This name is used to refer to the
* entity in queries. The name must not be a reserved literal
* in the Jakarta Persistence query language.
*/
String name() default "";
{% endhighlight %}

ì£¼ì„ì— ë”°ë¥´ë©´, í•´ë‹¹ ì´ë¦„ì€ ë‚˜ì¤‘ì— ì¿¼ë¦¬ì— ì“°ì¼ ì´ë¦„ì´ë©°, ì´ëŠ” ë”±íˆ ì§€ì •í•˜ì§€ ì•Šì•„ë„ ë‚´ë¶€ì ìœ¼ë¡œ `Member` ë¼ëŠ” ê²ƒìœ¼ë¡œ query langugage ì— ì“°ì¼ ì˜ˆì •ì´ë‹¤. ì´ì œ ì´ ì—”í‹°í‹°ë¥¼ ê´€ë¦¬í•˜ëŠ” Persistence Context ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ Entity Manager ë¥¼ ìƒì„±í•˜ê³ , Entity Manager ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ Entity Manager Factory ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤.

{% highlight java %}
public class Application {
	public static void main(String[] args) {
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("examplePU");
		EntityManager em = emf.createEntityManager();
	}
}
{% endhighlight %}

ì‹¤í–‰í•˜ë©´ ë‹¤ìŒ í…Œì´ë¸”ì´ ìƒì„±ë¨ì„ ë³¼ ìˆ˜ ìˆë‹¤.

![assets/img/jpa-member-table.png]({{ site.baseUrl }}/assets/img/jpa-member-table.png)

JPA ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ **ë¹„ì–´ìˆëŠ” ìƒì„±ìë¥¼ í†µí•´ ë¨¼ì € ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ê·¸ ì´í›„ì— ê°’ì„ ì„¸íŒ…**í•´ì£¼ê²Œ ëœë‹¤. ë”°ë¼ì„œ ë¹ˆ ìƒì„±ìëŠ” í•„ìˆ˜ì´ë‹¤. ë˜ ì—¬ê¸°ì„œ `@Id` ë¥¼ ê¼­ ë„£ì–´ì•¼ í•˜ëŠ” ì´ìœ ëŠ” ê°ì²´ë¥¼ êµ¬ë¶„í•  ëª…ë¶„ì´ í•„ìš”í•´ì„œ ì´ë‹¤. ì´ë¥¼ ì¢€ ë” ìì„¸íˆ ë³´ì.

**ì—”í‹°í‹° êµ¬ë¶„ ê¸°ì¤€**

> A persistence context is a set of entity instances in which for any given persistent entity identity (defined by an entity type and primary key) there is at most one entity instance

ê³µì‹ ë¬¸ì„œì— ë”°ë¥´ë©´, `entity type` ê³¼ `primary key` ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ì˜ë˜ëŠ” ì¡´ì¬ì„±ì´ ë°”ë¡œ ì—”í‹°í‹°ì´ë‹¤. ì´ë•Œ í…Œì´ë¸”ì€ id ë¥¼ í‚¤ë¡œ í•˜ê³ , id ë¥¼ í†µí•´ ê°ì²´ë¥¼ êµ¬ë¶„í•˜ê²Œ ëœë‹¤.

**í…Œì´ë¸” ëª… ë°”ê¾¸ê¸°**

ìƒì„±ë˜ëŠ” Member í…Œì´ë¸”ì€ í´ë˜ìŠ¤ ëª…ì„ ë”°ë¼ê°€ê²Œ ë˜ë©° ëª…ì‹œì ìœ¼ë¡œ ìë™ ìƒì„±ë˜ëŠ” í…Œì´ë¸” ëª…ì„ ì§€ì •ì‹œì¼œì£¼ë ¤ë©´ ë‹¤ìŒ ì–´ë…¸í…Œì´ì…˜ì„ ì…ë ¥í•œë‹¤.

{% highlight java %}
import jakarta.persistence.Entity;
import jakarta.persistence.Id;
import jakarta.persistence.Table;

@Entity
@Table(name = "members")
public class Member {
	@Id
	private Long id;
}
{% endhighlight %}

ì‹¤í–‰ ì‹œ ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±ë˜ì–´ ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤.

![assets/img/jpa-library-members.png]({{ site.baseUrl }}/assets/img/jpa-library-members.png)

ì´ì œ ì´ ì—”í‹°í‹°ê°€ ì–´ë–»ê²Œ ìƒì„±ë˜ê³  ì‚­ì œë˜ê¸° ê¹Œì§€ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ë³´ì.

**Entity ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨**

![assets/img/jpa-entity-lifecycle.png]({{ site.baseUrl }}/assets/img/jpa-entity-lifecycle.png)

- New: ê°ì²´ ìƒì„± ìƒíƒœ
- Managed: ì˜ì†í™” ìƒíƒœ
- Removed: ì‚­ì œì˜ˆì • ìƒíƒœ
- Detached: ë¹„ì˜ì†í™” ìƒíƒœ

ì—”í‹°í‹°ëŠ” ìœ„ì™€ ê°™ì€ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§„ë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ì˜ì†í™” ëœ ì´í›„ì—ì„œì•¼ ë‹¤ë¥¸ `Removed`, `Detached` ë¡œ ê°ˆ ìˆ˜ ìˆë‹¤.

**New ìƒíƒœ**
{% highlight java %}
public class Application {
	public static void main(String[] args) {
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("examplePU");
		EntityManager em = emf.createEntityManager();

		// New ìƒíƒœ
		Member member = new Member();
	}
}
{% endhighlight %}

**New ìƒíƒœ**
{% highlight java %}
public class Application {
	public static void main(String[] args) {
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("examplePU");
		EntityManager em = emf.createEntityManager();

		// New ìƒíƒœ
		Member member = new Member();
	}
}
{% endhighlight %}

**Managed ìƒíƒœ**
{% highlight java %}
public class Application {
	public static void main(String[] args) {
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("examplePU");
		EntityManager em = emf.createEntityManager();

		Member member = new Member();

		// ì˜ì†í™” ìƒíƒœ
		em.persist(member);
	}
}
{% endhighlight %}

**Detached ìƒíƒœ**
{% highlight java %}
public class Application {
	public static void main(String[] args) {
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("examplePU");
		EntityManager em = emf.createEntityManager();

		Member member = new Member();

		em.persist(member);
		
		em.detach(member);
	}
}
{% endhighlight %}

**Removed ìƒíƒœ**
{% highlight java %}
public class Application {
	public static void main(String[] args) {
		EntityManagerFactory emf = Persistence.createEntityManagerFactory("examplePU");
		EntityManager em = emf.createEntityManager();

		Member member = new Member();

		em.persist(member);
		
		em.remove(member);
	}
}
{% endhighlight %}

ìœ„ ì½”ë“œë“¤ì„ ì‹¤í–‰ì‹œí‚¤ë©´ ì•„ì§ persistence context ì—ë§Œ ì˜¬ë¼ê°ˆ ë¿, `Id` ë¥¼ ìƒì„±ì‹œì¼œì£¼ì§€ ì•Šì•„ì„œ í‘¸ì‰¬ê¹Œì§€ëŠ” ëª»í•œë‹¤(ì»¤ë°‹í•˜ë©´ `org.hibernate.id.IdentifierGenerationException` ì—ëŸ¬ ëœ¬ë‹¤..). ë”°ë¼ì„œ DB ìì²´ì— ìë™ìœ¼ë¡œ ID ë¥¼ ìƒì„±ì‹œì¼œì£¼ëŠ” `AUTO_INCREMENT` ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì£¼ì–´ ì•„ì´ë””ë¥¼ ìƒì„±ì‹œì¼œì£¼ê³  ì»¤ë°‹ì„ í•´ì¤˜ì•¼ í•œë‹¤.

**GeneratedValue**

ìë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ëŠ” `@GeneratedValue` ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì˜ì† ì»¨í…ìŠ¤íŠ¸ì— ì§„ì…í•˜ëŠ” ê°ì²´ì— ëŒ€í•´ `Id` ê°’ì´ `null` ì´ë©´ ì•„ì´ë””ë¥¼ ìë™ ìƒì„±ì‹œì¼œì£¼ì–´ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“¤ì—¬ì˜¤ë„ë¡ í•  ìˆ˜ ìˆë‹¤. ì• ì´ˆì— `Id` ê°€ `null` ì´ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“¤ì–´ì˜¬ ìˆ˜ ì—†ë‹¤.

{% highlight java %}
@Entity
@Table(name = "members")
public class Member {
	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;
	private String name;

	public Member() { }
	public Member(String name) {
		this.name = name;
	}
}
{% endhighlight %}

ìœ„ì™€ ê°™ì´ ì…ë ¥í•´ì¤€ë‹¤. ì•ˆì— ë“¤ì–´ê°ˆ ìë™ ìƒì„± ì „ëµì€ ë‹¤ìŒ ì˜µì…˜ë“¤ì´ ìˆë‹¤.

- `GenerationType.IDENTITY`: ì—”í‹°í‹° ê¸°ë³¸ í‚¤ë¥¼ DBì˜ identity ì»¬ëŸ¼ì„ ì‚¬ìš©í•˜ì—¬ `PersistenceProvider` ê°€ í• ë‹¹í•´ì•¼ í•¨ì„ ëª…ì‹œ
- `GenerationType.SEQUENCE`: ì—”í‹°í‹° ê¸°ë³¸ í‚¤ë¥¼ DBì˜ `SEQUENCE` í˜•ì„ ì‚¬ìš©í•˜ì—¬ `PersistenceProvider` ê°€ í• ë‹¹í•´ì•¼ í•¨ì„ ëª…ì‹œ
- `GenerationType.UUID`: ì—”í‹°í‹° ê¸°ë³¸ í‚¤ë¥¼ RFC 4122 í‘œì¤€ì˜ UUID ë¥¼ ìƒì„±í•˜ì—¬ `PersistenceProvider` ê°€ í• ë‹¹í•´ì•¼ í•¨ì„ ëª…ì‹œ
- `GenerationType.TABLE`: ì—”í‹°í‹° ê¸°ë³¸ í‚¤ë¥¼ `PersistenceProvider `ê°€ ê¸°ë³¸ DB í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì—¬ í• ë‹¹, ì‹¤ì œ DB ì•ˆì— ë³„ë„ì˜ ì‹œí€€ìŠ¤ í…Œì´ë¸”ì„ ë§Œë“¤ì–´ì„œ í‚¤ ê°’ì„ ì €ì¥í•˜ê³  ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì— DB ì¢…ë¥˜ì— ìƒê´€ ì—†ì´ ì‹œí€€ìŠ¤ ì—­í•  í…Œì´ë¸”ì„ ë§Œë“¤ì–´ì„œ í‚¤ ê°’ì„ ì €ì¥
- `GenerationType.AUTO`: ìœ„ 4ê°œ ì˜µì…˜ ì¤‘ ì•Œì•„ì„œ í• ë‹¹

ì•„ì´ë””ë¥¼ ìƒì„±ì‹œì¼œì¤¬ë‹¤ë©´ ë‹¤ìŒì„ ì‹¤í–‰ì‹œì¼œì„œ í‘¸ì‹œí•  ìˆ˜ ìˆë‹¤.

{% highlight java %}
EntityManager em = EMF.createEntityManager();
Member member = new Member();
em.getTransaction().begin();
em.persist(member);
em.getTransaction().commit();
{% endhighlight %}

##### EntityTransaction

ìœ„ì—ì„œ `getTransaction()` ì´ë¼ëŠ” ë©”ì„œë“œê°€ `EntityTransaction()` ì„ ë°˜í™˜í•œë‹¤ê³  ì´ í¬ìŠ¤íŒ… ì•ë¶€ë¶„ì—ì„œ ì–˜ê¸°í–ˆë‹¤. ì´ í´ë˜ìŠ¤ëŠ” ì˜¤ì§ `transaction-type` ì„¤ì • ê°’ì´ `RESOURCE_LOCAL` ì¼ë•Œ ì‚¬ìš©ëœë‹¤.

**ì£¼ìš” ë©”ì„œë“œ**
- `begin()` â€“ íŠ¸ëœì­ì…˜ ì‹œì‘
  - ì´ë¯¸ í™œì„±í™” ìƒíƒœë©´ `IllegalStateException` ë°œìƒ
- `commit()` â€“ íŠ¸ëœì­ì…˜ ì»¤ë°‹, DB ë°˜ì˜
  - ë¹„í™œì„± ìƒíƒœë©´ `IllegalStateException`
  - ì‹¤íŒ¨ ì‹œ RollbackException
- `rollback()` â€“ íŠ¸ëœì­ì…˜ ë¡¤ë°±
  - ë¹„í™œì„± ìƒíƒœë©´ `IllegalStateException`
  - ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜ ë°œìƒ ì‹œ PersistenceException
- `setRollbackOnly()` â€“ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±ë§Œ ê°€ëŠ¥í•˜ë„ë¡ í‘œì‹œ
  - ë¹„í™œì„± ìƒíƒœë©´ `IllegalStateException`
- `getRollbackOnly()` â€“ ë¡¤ë°± í‘œì‹œ ì—¬ë¶€ í™•ì¸
- `isActive()` â€“ íŠ¸ëœì­ì…˜ ì§„í–‰ ì—¬ë¶€ í™•ì¸

í•˜ë‚˜ì˜ ì»¤ë°‹ ë‹¨ìœ„, ìŠ¤ëƒ…ìƒ· ë‹¨ìœ„ë¥¼ êµ¬ë¶„ì§€ì„ ìˆ˜ ìˆëŠ” íŠ¸ëœì­ì…˜ ê°œë…ì„ ì œê³µí•œë‹¤. ë”°ë¼ì„œ ìœ„ ì½”ë“œë¥¼ ì¢€ ë” ë³´ê¸° ì¢‹ê³ , ë©”ëª¨ë¦¬ë¥¼ ê³ ë ¤í•œ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•œë‹¤.

{% highlight java %}
EntityManager em = EMF.createEntityManager();

Member member = new Member("í™ê¸¸ë™");

em.getTransaction().begin();
try {
    em.persist(member);
    em.getTransaction().commit();
} catch (Exception e) {
    if (em.getTransaction().isActive())
        em.getTransaction().rollback();
    throw e;
} finally {
    em.close();
}
{% endhighlight %}

ì´ì œ DBì— record ê°€ ì¶”ê°€ë˜ì–´ ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤.

##### Entity ë™ì¼ì„± vs ë™ë“±ì„±

ë™ì¼ì„±ì€ ë©”ëª¨ë¦¬ ìƒì—ì„œ ê°™ì€ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ì¸ì§€ë¥¼ ë¹„êµí•œë‹¤.

**ë™ì¼ì„±**
{% highlight java %}
Member member1 = new Member("í™ê¸¸ë™");
Member member2 = member1;
{% endhighlight %}

ë™ë“±ì„±ì„ ë³´ì. ë™ë“±ì„±ì€ ì—”í‹°í‹°ì˜ ë‚´ë¶€ì ì¸ í•„ë“œ ê°’ë“¤ì— ëŒ€í•´ ê°™ìŒì— ëŒ€í•œ ë…¼ë¦¬ì ì¸ ë¹„êµë¥¼ í†µí•˜ì—¬ ê°™ì€ ì—”í‹°í‹°ì¸ì§€ ë¹„êµë¥¼ í•œë‹¤. `equals()` ê°€ ë™ë“±ì„±ì˜ ì˜ˆì‹œì´ë‹¤.

ì´ë•Œ JPA ì—ì„œì˜ ì˜ì†í™” ì»¨í…ìŠ¤íŠ¸ ë‚´ëŠ” `@Id` ê¸°ì¤€ **ë™ë“±ì„±** ë¹„êµë¥¼ í•˜ë©°, ì»¬ë ‰ì…˜ì—ì„œëŠ” `hashCode()` + `equals()` ê¸°ì¤€ **ë™ë“±ì„±** ë¹„êµë¥¼ í•œë‹¤. ë”°ë¼ì„œ Id ë§Œ ì˜ìƒì„±ì‹œì¼œì¤¬ë‹¤ë©´ ì•Œì•„ì„œ ì˜ì†í™” ì»¨í…ìŠ¤íŠ¸ì— ë“¤ì–´ê°€ëŠ” ì—”í‹°í‹°ê°€ ê°™ì€ì§€ íŒë³„í•´ì¤€ë‹¤. í•˜ì§€ë§Œ ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì„ ìœ ë°œí•œë‹¤.

{% highlight java %}
@Entity
public class Member {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;

    public Member() {}
    public Member(String name) { this.name = name; }

    // ID ê¸°ì¤€ìœ¼ë¡œë§Œ ì¦‰, persistence context ë‚´ì—ì„œë§Œ êµ¬ë¶„
    // equals/hashCode ë¯¸êµ¬í˜„
}

// Main.class
em.getTransaction().begin();

// New ê°ì²´ ìƒì„± í›„ persist
Member m1 = new Member("í™ê¸¸ë™");
em.persist(m1);
em.getTransaction().commit();

// m1ì€ ì´ì œ Managed ìƒíƒœë¡œ IDê°€ ë¶€ì—¬ë¨
System.out.println("m1 ID: " + m1.getId()); // e.g. 1L

// Detached ìƒíƒœì—ì„œ ê°ì²´ ìˆ˜ì •
em.detach(m1);
Member m2 = new Member("í™ê¸¸ë™"); // ìƒˆë¡œìš´ ê°ì²´, ID ì—†ìŒ
m2.setId(m1.getId());           // ê°™ì€ IDë¥¼ ê°•ì œë¡œ ì„¸íŒ…

// ì»¬ë ‰ì…˜ì— ë„£ê¸°
Set<Member> members = new HashSet<>();
members.add(m1);
members.add(m2); // equals/hashCodeê°€ ì—†ìœ¼ë©´ ì¤‘ë³µ íŒë‹¨ ì‹¤íŒ¨ â†’ ë‘ ê°ì²´ ëª¨ë‘ ì¶”ê°€

System.out.println("Set í¬ê¸°: " + members.size()); // ì¶œë ¥: 2 (ì¤‘ë³µ ìˆìŒ)
// ë¹„ì •ìƒì 
{% endhighlight %}

ìœ„ì™€ ê°™ì€ ì˜¤ë¥˜ ë•Œë¬¸ì— `equals`, `hashCode` ì˜ êµ¬í˜„ì´ Id ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ë„ë¡ êµ¬í˜„í•´ì•¼ í•œë‹¤.

{% highlight java %}
// equals ë©”ì„œë“œ: id ê¸°ë°˜ ë¹„êµ
@Override
public boolean equals(Object o) {
    if (this == o) return true;  // 1. ê°™ì€ ì°¸ì¡°ë©´ true
    if (o == null || getClass() != o.getClass()) return false;  // 2. null ë˜ëŠ” ë‹¤ë¥¸ í´ë˜ìŠ¤ë©´ false
    Member member = (Member) o;
    return id != null && id.equals(member.id);  // 3. idê°€ ìˆê³  ê°™ìœ¼ë©´ true
}

// hashCode ë©”ì„œë“œ: id ê¸°ë°˜
@Override
public int hashCode() {
    return id != null ? id.hashCode() : 0;  // idê°€ ì—†ìœ¼ë©´ 0 ë°˜í™˜
}
{% endhighlight %}

í•˜ì§€ë§Œ ì´ ë˜í•œ ë‹¤ìŒ ìƒí™©ì— ëŒ€ì²˜ë¥¼ ëª»í•œë‹¤.

{% highlight java %}
Set<Member> members = new HashSet<>();
members.add(member1);
em.persist(member1);  // id í• ë‹¹
// HashSetì—ì„œ hashCode ë³€ê²½ìœ¼ë¡œ member1ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
{% endhighlight %}

ë”°ë¼ì„œ JPA ì— ë“¤ì–´ê°€ê¸°ì „ ë¬´ì¡°ê±´ value ê°€ ìˆëŠ” ê°’ì— ëŒ€í•œ `equals()` ì™€ `hashCode()` ë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì„ ì‹¤ë¬´ì—ì„œëŠ” ì‚¬ìš©í•˜ë©°, ì´ë¥¼ candidate key(í›„ë³´ í‚¤) ë¡œ ì„ ì •ë  ìˆ˜ ìˆëŠ” ê°’ì„ ê³ ë¥´ê²Œ ëœë‹¤(ì‹¤ë¬´ì—ì„œëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ë¼ê³  í•˜ëŠ” ë“¯í•˜ë‹¤). ë”°ë¼ì„œ `equals()` + `hashCode()` ë¥¼ id ê¸°ì¤€ìœ¼ë¡œ ê·œì¹™ì— ë§ê²Œ ì„¤ì •í•´ì¤˜ì•¼ í•œë‹¤.

{% highlight java %}
@Override
public boolean equals(Object o) {
    if (this == o) return true;
    if (o == null || getClass() != o.getClass()) return false;
    Member member = (Member) o;
    return phoneNumber != null && phoneNumber.equals(member.phoneNumber);
}

@Override
public int hashCode() {
    return phoneNumber != null ? phoneNumber.hashCode() : 0;
}
{% endhighlight %}

ìœ„ì—ì„œëŠ” `phoneNumber` ì„ ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ë¡œ ë³´ê³  ë™ë“±ì„± êµ¬í˜„ì„ í•œë‹¤. ì´ê²ƒë§Œ ì„¤ì •í•´ì£¼ë©´ ë˜ëŠ”ê²Œ ì•„ë‹ˆë¼ entity ë‚´ë¶€ì—ì„œ `phoneNumber` ì„ ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ë¡œ í•œë‹¤ê³  ê¸°ì¤€ì„ ì‚¼ì•˜ë‹¤ë©´, **ì—”í‹°í‹° ìƒëª…ì£¼ê¸° ì „ êµ¬ê°„ì—ì„œ í•­ìƒ not null ì„ì„ ë³´ì¥í•´ì£¼ì–´ì•¼ í•œë‹¤.**

ê¸°ì¤€ìœ¼ë¡œ ì‚¼ì€ í‚¤ëŠ” ë‹¤ìŒ ê·œì¹™ì„ í†µí•´ ë™ë“±ì„± êµ¬í˜„ì„ í•´ì£¼ì–´ì•¼ í•œë‹¤.

**ì—”í‹°í‹° ë™ë“±ì„± êµ¬í˜„ ê·œì¹™**
1. ì‹ë³„ì(id) ê¸°ë°˜ ë¹„êµ: ë°ì´í„°ë² ì´ìŠ¤ ë ˆì½”ë“œë¥¼ ëŒ€í‘œí•˜ëŠ” idë¡œ ë¹„êµ
2. ì¼ê´€ì„± ìœ ì§€: `equals()`ê°€ trueë©´ `hashCode()`ë„ ê°™ì€ ê°’ ë°˜í™˜
3. `null` ì²˜ë¦¬: ë¹„ì˜ì† ì—”í‹°í‹°ëŠ” id ê°€ `null` ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ `null` ì²˜ë¦¬ í•„ìˆ˜
    - ê·¸ë˜ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ë¡œ ìš°íšŒ
4. ë³µí•© í‚¤: í‚¤ê°€ ì—¬ëŸ¬ í•„ë“œë¡œ êµ¬ì„±ë˜ë©´ ëª¨ë“  í•„ë“œë¡œ ë¹„êµ

##### @Column

JPA(Entity í´ë˜ìŠ¤ì˜ í•„ë“œ) ì™€ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì»¬ëŸ¼(column) ì„ ë§¤í•‘í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì• ë„ˆí…Œì´ì…˜ì´ë‹¤.

**ì†ì„±**
- `name`: ì»¬ëŸ¼ì˜ ì´ë¦„, ê¸°ë³¸ê°’ì€ í•´ë‹¹ ë³€ìˆ˜ëª…ìœ¼ë¡œ í•„ë“œëª…ì´ DDL ë¡œ ì„ ì–¸ë˜ê²Œ ëœë‹¤. ì•„ë˜ì™€ ê°™ì´ camel í‘œê¸°ë²•ì„ snake ë¡œ ë°”ê¿”ì¤„ ìˆ˜ ìˆë‹¤.

{% highlight java %}
@Column(name = "phone_number")
private String phoneNumber;
{% endhighlight %}

- `unique`: @UniqueConstraint ì• ë„ˆí…Œì´ì…˜ì˜ ë˜ ë‹¤ë¥¸ ì‚¬ìš©ìœ¼ë¡œ ìœ ì¼ ì œì•½ ì¡°ê±´ì´ ë‹¨ì¼ ì»¬ëŸ¼ì—ë§Œ ì ìš©ë  ë•Œ ì“°ë©´ ëœë‹¤. ê¸°ë³¸ê°’ì€ false ì´ë‹¤.
- `nullable`: ë°ì´í„°ë² ì´ìŠ¤ì˜ ì»¬ëŸ¼ì´ NULL ì„ í—ˆìš©í•˜ëŠ”ì§€ ì—¬ë¶€, ê¸°ë³¸ ê°’ì€ true ë¼ì„œ null ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ ë˜ì–´ ìˆë‹¤.
- `insertable`: PersistenceProvider ê°€ ìƒì„±í•˜ëŠ” SQL `INSERT` ë¬¸ì— ì´ ì»¬ëŸ¼ì´ í¬í•¨ë ì§€ì˜ ì—¬ë¶€ì´ë‹¤. ë§Œì•½ false ë¼ë©´ insert ê°€ ê°€ëŠ¥í•˜ì§€ ì•Šì€ í•„ë“œë©°, ê¸°ë³¸ ê°’ì€ true ì´ë‹¤.
- `updatable`: PersistenceProvider ê°€ ìƒì„±í•˜ëŠ” SQL `UPDATE` ë¬¸ì— ~ ì´í•˜ ìƒëµ
- `columnDefinition`: DDL ë¬¸ì„ ìƒì„±í•  ë•Œ, ì¹¼ëŸ¼ì˜ íƒ€ì…ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œí•˜ëŠ” ì˜µì…˜ì´ë‹¤.
    - ì˜ˆ: `@Column(columnDefinition = "VARCHAR(32) DEFAULT 'A'")` â†’ ìƒì„±ë˜ëŠ” DDLì— `VARCHAR(32) DEFAULT 'A'`ê°€ ê·¸ëŒ€ë¡œ ë“¤ì–´ê°
    - NOT NULL ë„ ë„£ì–´ë„ ë˜ì§€ë§Œ, nullable ì— ì“°ëŠ”ê²Œ ê°€ë…ì„±ì´ ë” ì¢‹ì„ ë“¯í•˜ë‹¤.
- `table`: ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ, íŠ¹ì • ì—”í‹°í‹°ê°€ ì—¬ëŸ¬ í…Œì´ë¸”ì— ë§¤í•‘ì´ ë  ë•Œ, í•´ë‹¹ ì»¬ëŸ¼ì´ ì–´ëŠ í…Œì´ë¸”ì— ì†í•˜ëŠ”ì§€ ì§€ì •í•˜ê¸° ìœ„í•´ ì¡´ì¬í•¨. ë³´í†µ `SecondaryTable` ì´ë‚˜ `SecondaryTables` ì™€ ê°™ì€ ì–´ë…¸í…Œì´ì…˜ê³¼ í•¨ê»˜ ì—”í‹°í‹°ê°€ ì—¬ëŸ¬ í…Œì´ë¸”ì—ì„œ ì‚¬ìš©ë  ë•Œ ì‚¬ìš©í•˜ëŠ”ë°, ë‹¤ìŒ ì˜ˆì œë¥¼ ë³´ë©´ ì´í•´ê°€ ë  ê²ƒì´ë‹¤.

{% highlight java %}
@Entity
@Table(name = "members")
@SecondaryTable(name = "member_details")
public class Member {

    @Id
    private Long id;

    @Column(name = "username")
    private String username; // ê¸°ë³¸ í…Œì´ë¸” members

    @Column(table = "member_details", name = "address")
    private String address;  // ë³´ì¡° í…Œì´ë¸” member_details

    @Column(table = "member_details", name = "phone_number")
    private String phoneNumber; // ë³´ì¡° í…Œì´ë¸” member_details
}
{% endhighlight %}

`address`, `phoneNumber` ëŠ”  `member_details` ë¼ëŠ” ë³´ì¡° í…Œì´ë¸”ì— ì €ì¥ë˜ê³ , JPA ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ë‘ í…Œì´ë¸”ì„ ID ê¸°ì¤€ìœ¼ë¡œ ì¡°ì¸í•´ì„œ ê´€ë¦¬í•˜ê²Œ ëœë‹¤.

> í•˜ì§€ë§Œ ì´ëŠ” left join ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ìƒ ì•ˆì¢‹ë‹¤. ë”°ë¼ì„œ ìì£¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì„¸ë¶€ ì •ë³´ë¥¼ ë¶„ë¦¬ì‹œì¼œì•¼ í•  ë•Œë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

- `length`: DDL í…Œì´ë¸”ì„ ìƒì„±í•  ë•Œ, `VARCHAR` í˜•íƒœì˜ ì»¬ëŸ¼ì„ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤. `length = 100` ì´ë¼ë©´ `VARCHAR(100)` ì— ë§¤í•‘ëœë‹¤.
- `precision`: ìˆ«ì(DECIMAL, NUMERIC ë“±) íƒ€ì…ì˜ ì „ì²´ ìë¦¿ìˆ˜(ì •ìˆ˜ë¶€ + ì†Œìˆ˜ë¶€)ë¥¼ ì§€ì •í•˜ëŠ” ì˜µì…˜ì´ë‹¤, scale ê³¼ ê°™ì´ ì¨ì•¼ í•œë‹¤. ë§Œì•½ scale ì„ ì•ˆì“°ë©´ DB ë§ˆë‹¤ ì´ë¥¼ ë‹¬ë¦¬ í•´ì„í•˜ì—¬ íƒ€ì…ì„ ì •í•˜ê²Œ ëœë‹¤.
- `scale`: ì†Œìˆ˜ì  ì´í•˜ì˜ ìë¦¿ìˆ˜ë¥¼ ì§€ì •í•˜ëŠ” ì˜µì…˜, precision ê³¼ ê°™ì´ ì¨ì•¼ í•œë‹¤. ë§Œì•½ scale ë§Œ ìˆê²Œ ë˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒ í•  ìˆ˜ë„ ìˆê³  ì•„ë‹ ìˆ˜ë„ ìˆë‹¤. ê·¸ëƒ¥ ê°™ì´ ì“°ì.

##### @Enumerated

`Enum` íƒ€ì… ë§¤í•‘ì„ í•  ìˆ˜ ìˆë‹¤.

{% highlight java %}
public @interface Enumerated {
    /** (Optional) The type used in mapping an enum type. */
    EnumType value() default ORDINAL;
}
{% endhighlight %}

- `EnumType.ORDINAL`: DB ì— Enum ìˆœì„œ(0, 1, 2, ...) ë¡œ ì €ì¥í•˜ë„ë¡ í•œë‹¤.
- `EnumType.STRING`: DB ì— Enum ì´ë¦„(String) ìœ¼ë¡œ ì €ì¥í•˜ë„ë¡ í•œë‹¤.

{% highlight java %}
public enum MemberStatus {
    ACTIVE,
    INACTIVE,
    SUSPENDED
}
{% endhighlight %}

`ORDINAL` ê·œì¹™ì„ ì‚¬ìš©í•˜ì—¬ ì €ì¥í•  ê²ƒì´ë¼ë©´, ìˆœì„œê°€ ë°”ë€Œë©´ ëª¨ë“  ë°ì´í„°ê°€ ì„œë¡œ ë§¤í•‘(ìˆœì„œ)ì´ ì´ìƒí•˜ê²Œ ë˜ê¸° ë•Œë¬¸ì— `STRING` ì„ í•˜ëŠ”ê²Œ ì¢‹ë‹¤. ì´ë•Œ `STRING` ìœ¼ë¡œ í•˜ë©´ ìë™ìœ¼ë¡œ `VARCHAR` íƒ€ì…ì´ ë¨ì„ ì•Œê³  ìˆì.

##### @Temporal

Java ì˜ `Date`/`Calendar` íƒ€ì…ì—ëŠ” ë‚ ì§œ + ì‹œê°„ ì •ë³´ê°€ ëª¨ë‘ ë“¤ì–´ìˆëŠ”ë°, DB ì—ëŠ” `DATE`, `TIME`, `TIMESTAMP` ë“±ì˜ ì—¬ëŸ¬ íƒ€ì…ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ì €ì¥í•´ì•¼í•  ìˆ˜ë„ ìˆë‹¤. ì´ë“¤ì—ê²Œ ë§¤í•‘ì‹œí‚¤ê¸° ìœ„í•´ `Temporal` ì–´ë…¸í…Œì´ì…˜ì„ ì œê³µí•˜ë©°, í•„ë“œì— ì ìš©ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

- `TemporalType.Date`: ë‚ ì§œë§Œ ì €ì¥ (DATE `yyyy-MM-dd`)
- `TemporalType.TIME`: ì‹œê°„ë§Œ ì €ì¥ (TIME `HH:mm:ss`)
- `TemporalType.TIMESTAMP`: ë‚ ì§œ + ì‹œê°„ ëª¨ë‘ ì €ì¥ (`yyyy-MM-dd HH:mm:ss`)

> `Temporal` ì€ ìë™ ìƒì„±ì´ ì•„ë‹ˆë‹¤. ê·¸ëƒ¥ ë§¤í•‘ë§Œ í•˜ëŠ”ê²ƒì´ë‹¤. ìƒì„±ì€ ë”°ë¡œ í•´ì¤˜ì•¼ í•œë‹¤..

##### @Lob

ë¬¸ìì—´ CLOB, ë°”ì´ë„ˆë¦¬ BLOB ì™€ ê°™ì€ ë°ì´í„°ë¥¼ ì •ì˜í•˜ê³  ì‹¶ì„ë•Œ í•„ë“œì— ë¶™ì´ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ë‹¤. êµ‰ì¥íˆ í° ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ì–´ë…¸í…Œì´ì…˜ì´ê¸° ë•Œë¬¸ì— ê¸°ë³¸ì ìœ¼ë¡œ ì¡°íšŒí•  ë•Œ Lazy ë¡œë”©ì„ ì¨ì•¼ í•œë‹¤.

{% highlight java %}
@Lob
@Basic(fetch = FetchType.LAZY)
private byte[] imageData;
{% endhighlight %}

> `@Basic` ì€ `fetch`, `optional` ì†ì„±ë§Œ ê°€ì§€ê³ , ì–´ë µì§€ ì•Šê¸°ì— ì“°ê²Œ ë  ê²½ìš°ì—ëŠ” ì½”ë“œ ë‚´ë¶€ë¥¼ ì¦‰ì„ìœ¼ë¡œ íŒŒí—¤ì³ì„œ ì“°ëŠ”ê²Œ ì¢‹ë‹¤, ê¸°ë³¸ ê°’ì€ ê°ê° `FetchType.EAGER`, `true` ì´ë‹¤.

##### @PrePersist ì™€ @PostPersist

`@PrePersist` ëŠ” ìš°ì„  ë©”ì„œë“œì— ì ìš©í•˜ëŠ” `JPA` í‘œì¤€ ì–´ë…¸í…Œì´ì…˜ì´ë©°, ì´ ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ë©”ì„œë“œëŠ” `JPA` ì—”í‹°í‹° ë‚´ë¶€ì—ì„œ ì„ ì–¸ë˜ê³ , `JPA` ì—”í‹°í‹°ë¥¼ ì˜ì†í™” í›„ **ì»¤ë°‹í•˜ê¸° ì§ì „ì— í˜¸ì¶œ**í•˜ê²Œ ëœë‹¤. `@PostPersist` ëŠ” ë‹¹ì—°í•˜ê²Œë„ SQL ì‹¤í–‰ í›„ì˜ ì‹¤í–‰ì´ë‹¤(INSERT ë¬¸ ì‹¤í–‰ ì§ì „/ì§í›„).

{% highlight java %}
@Entity
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @PrePersist
    protected void onCreate() {
        System.out.println("PrePersist í˜¸ì¶œ!");
        createdAt = LocalDateTime.now();
    }

    @PostPersist
    protected void afterInsert() {
        System.out.println("PostPersist í˜¸ì¶œ!");
    }
}
{% endhighlight %}

> ìœ ì‚¬í•˜ê²Œ `@PreUpdate`, `@PostUpdate`, `@PreRemove`, `@PostRemove` ë„ ìˆë‹¤. `@PostLoad` ëŠ” ì—”í‹°í‹° SELECT ì§í›„ì— ìˆ˜í–‰ëœë‹¤.

#### JPA ì—”í‹°í‹° ë§¤í•‘

í…Œì´ë¸”ì—ëŠ” `JOIN` ê³¼ ê°™ì€ ì—°ì‚°ì„ í†µí•´ í…Œì´ë¸”ì— ë¶„ì‚°ëœ í•„ë“œë“¤ì„ í•©ì³ì„œ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. ì´ë¥¼ JPA ì—ì„œë„ í•  ìˆ˜ ìˆë‹¤. ì—¬ê¸°ì„œëŠ” ì†Œìœ ì£¼(Foreign Key ë¥¼ ê°€ì§€ëŠ” ì—”í‹°í‹°)ê°€ ëˆ„êµ¬ëƒê°€ ì¤‘ìš”í•˜ë©°, ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì“°ëŠ” ì• ë„ˆí…Œì´ì…˜ì´ ë‹¬ë¼ì§„ë‹¤.

##### @OneToOne

ë‹¨ë°©í–¥ ê´€ê³„ë¥¼ ì •ì˜í•˜ê³  ì‹¶ì„ë•Œ ì‚¬ìš©í•œë‹¤.

{% highlight java %}
@Entity
public class Member {

    @Id
    private Long id;

    @OneToOne
    @JoinColumn(name = "locker_id") // FK ì»¬ëŸ¼ ì§€ì •
    private Locker locker;
}
{% endhighlight %}

`@JoinColumn` ì€ ì™¸ë˜ í‚¤ ì»¬ëŸ¼ì„ ì •ì˜í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ë©°, ì‹¤ì œ `locker_id` ë¼ëŠ” í•„ë“œëª…ì˜ ì—´ì´ ìƒì„±ë˜ë©°, ì´ ë§ì€ `Member` ì´ í•´ë‹¹ ê´€ê³„ì˜ ì†Œìœ ì£¼ë¼ëŠ” ê²ƒì´ë‹¤. `@JoinColumn` ì€ ì´ëŸ¬í•œ @~To~ ì˜ ì–´ë…¸í…Œì´ì…˜ê³¼ í•¨ê»˜ ì¨ì•¼í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ë‹¤.

`@JoinColumn` ì´ ë¶™ì—¬ì§„ í•„ë“œëŠ” íƒ€ì…ì„ í†µí•´ì„œ ì €ì¥í•  ì—”í‹°í‹°ë¥¼ ì‹ë³„í•˜ê³ , í•´ë‹¹ ì—”í‹°í‹°ì˜ ì‹ë³„ì(`@Id`) ì •ë³´ë¥¼ ê°€ì ¸ì™€ `@JoinColumn` ì•ˆì˜ `name` ì†ì„±ì„ í†µí•´ì„œ ì—´ì„ ì •ì˜í•˜ê²Œ ëœë‹¤. JoinColumn ì–´ë…¸í…Œì´ì…˜ì€ name ì†ì„±ì™¸ì— ë‹¤ì–‘í•œ ì†ì„±ë“¤ì„ ë„£ì„ ìˆ˜ ìˆë‹¤:

**JoinColumn ì†ì„±**
- `referencedColumnName`: ì°¸ì¡°í•  ì»¬ëŸ¼ ì§€ì •, ê¸°ë³¸ì ìœ¼ë¡œ `@Id` ê°€ ë¶™ì€ í•„ë“œ ì§€ì •
- `nullable`: FK ì»¬ëŸ¼ì´ NULL ì„ í—ˆìš©í• ì§€ì˜ ì—¬ë¶€ì´ë‹¤, ê¸°ë³¸ ê°’ì€ **true** ì´ë‹¤.
- `insertable / updatable`: ì„¤ëª… ìƒëµ, ê¸°ë³¸ ê°’ì€ ë‘˜ ë‹¤ **true** ì´ë‹¤.
- `unique`: FK ì»¬ëŸ¼ì˜ ìœ ì¼ ì—¬ë¶€(`OneToOne` ì—ì„œëŠ” ì´ ì†ì„±ì´ ë°˜ë“œì‹œ `true` ì—¬ì•¼ í•œë‹¤.), ê¸°ë³¸ê°’ì€ **false** ì´ë‹¤.

> `UNIQUE` ì œì•½ì€ `NULL` ë¼ë¦¬ì˜ ì¤‘ë³µì€ í—ˆìš©í•˜ê²Œ ëœë‹¤.

**OneToOne ì†ì„±**
- `mappedBy`: ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •í•  ë•Œ í•µì‹¬ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì†ì„±ì¸ë°, ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì—ì„œ ì‚¬ìš©í•œë‹¤. ì¦‰, FK ë¥¼ ì•ˆê°€ì§€ê³  ìˆëŠ” ìª½ì—ì„œ ì‚¬ìš©í•˜ë©° ì†ì„± ê°’ìœ¼ë¡œëŠ” ì£¼ì¸ì´ ê°€ì§„ í•„ë“œ ì´ë¦„(ë³€ìˆ˜ ëª…)ì„ ì§€ì •í•˜ê²Œ ëœë‹¤.

- `fetch`: ì—°ê´€ ì—”í‹°í‹°ì˜ ë¡œë”© ë°©ì‹ì„ ì§€ì •í•œë‹¤. `FetchType.EAGER` ê°€ ê¸°ë³¸ ê°’ì´ë‹¤.
    - `FetchType.EAGER`: í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¬ ë•Œ, ì—°ê´€ ì—”í‹°í‹°ë„ ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ ê°€ì ¸ì˜´
    - `FetchType.LAZY`: ê¸°ë³¸ì ìœ¼ë¡œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ë¯¸ë¦¬ ì±„ì›Œë†¨ë‹¤ê°€, ë¡œì§ì—ì„œ í•„ìš”í•œ ì¼ì´ ìƒê¸¸ë•Œ ê·¸ì œì„œì•¼ SQL ë¬¸ì„ ë˜ì ¸ í•´ë‹¹ í”„ë¡ì‹œ ê°ì²´ë¥¼ ëŒ€ì²´í•˜ì—¬ ì±„ìš°ê²Œ ëœë‹¤(ë©”ëª¨ë¦¬ ìµœì í™”).

- `cascade`: ì—°ê´€ ì—”í‹°í‹°ì— ëŒ€í•œ ì‘ì—…ì„ ì „íŒŒí• ì§€ ì•ˆí• ì§€ì´ë‹¤. ì´ëŠ” ì´ì „ì— ë°°ì› ë˜ JS ì—ì„œì˜ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ í•˜ìœ„ ìì‹ì—ê²Œë„ ì „íŒŒí• ì§€ ì•„ë‹ˆë©´ ìƒìœ„ ë¶€ëª¨ì—ê²Œë„ ì „íŒŒí• ì§€ ì•„ë‹ì§€ì˜ ê°œë…ê³¼ ê°™ë‹¤.
    - `CascadeType.PERSIST`: í•´ë‹¹ ì—”í‹°í‹°ë¥¼ `Persistence Context` ì— ì˜¬ë¦´ ë•Œ ì—°ê´€ ì—”í‹°í‹°ë„ ìë™ìœ¼ë¡œ `Persistence Context` ì— ì˜¬ë¦¼
    - `CascadeType.MERGE`: í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ë³‘í•©í•  ë•Œ(ë¹„ì˜ì†-> ì˜ì†) ì—°ê´€ ì—”í‹°í‹°ë„ ë³‘í•©
    - `CascadeType.REMOVE`: í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•  ë•Œ ì—°ê´€ ì—”í‹°í‹°ë„ ìë™ ì‚­ì œ
    - `CascadeType.REFRESH`: ì—”í‹°í‹°ë¥¼ DB ì—ì„œ ë‹¤ì‹œ ì½ì–´ë“¤ì¼ ë•Œ, ì—°ê´€ ì—”í‹°í‹°ë„ ë‹¤ì‹œ ì½ì–´ë“¤ì„
    - `CascadeType.DETACH`: ì˜ì† -> ë¹„ì˜ì† ì´í•˜ ì„¤ëª… ë™ì¼
    - `CascadeType.ALL`: ìœ„ ì˜µì…˜ë“¤ ë‹¤ ë•Œë ¤ ë„£ì€ ì†ì„±

- `orphanRemoval`: ì»¬ë ‰ì…˜ì´ë‚˜ ë‹¨ì¼ ì—”í‹°í‹°ë¥¼ ì†Œìœ í•˜ëŠ” ê´€ê³„(owner) ìª½ì—ì„œ ì‚¬ìš©í•´ì•¼ ì˜ë¯¸ê°€ ìˆìœ¼ë©°, í•´ë‹¹ ì†Œìœ ìê°€ ì‚­ì œë˜ë©´ ê·¸ í•˜ìœ„ ê´€ë ¨ ì—”í‹°í‹°ë„ ìë™ ì‚­ì œê°€ ëœë‹¤. ê¸°ë³¸ê°’ì€ `false` ì´ë‹¤.

- `optional`: `null` ê°’ í—ˆìš© ì—¬ë¶€ ê¸°ë³¸ì€ `true`

ìœ„ì²˜ëŸ¼ ì• ë„ˆí…Œì´ì…˜ì„ í•„ë“œì— ë„£ì—ˆë‹¤ë©´ ì—°ê´€ëœ ë‹¤ë¥¸ ê°ì²´ì—ì„œëŠ” êµ³ì´ ì•„ë¬´ê²ƒë„ ì•ˆí•´ì¤˜ë„ ëœë‹¤. í•˜ì§€ë§Œ ì„œë¡œê°„ì˜ ë°ì´í„°ë¥¼ ì„œë¡œ ê°€ì§€ê²Œ í•˜ê³  ì‹¶ê²Œ í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±í•´ì•¼ í•œë‹¤(ì–‘ë°©í–¥ ì†Œìœ ).

{% highlight java %}
@Entity
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @OneToOne(mappedBy = "member") // Lockerê°€ FK ì†Œìœ í•˜ê¸°ì— mappedBy ëŠ” ì†Œìœ ì£¼ ìª½ì˜ ë³€ìˆ˜ëª…ì„ String ë¦¬í„°ëŸ´ë¡œ ì„ ì–¸
    private Locker locker;
}

@Entity
public class Locker {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String code;

    @OneToOne
    @JoinColumn(name = "member_id", unique = true) // FK ì†Œìœ , UNIQUE ì œì•½ ì¡°ê±´ ëª…ì‹œ
    private Member member;
}
{% endhighlight %}

DDL ì€ ë‹¤ìŒê³¼ ê°™ì´ ëœë‹¤.

{% highlight sql %}
CREATE TABLE member (
    id BIGINT PRIMARY KEY,
    name VARCHAR(255)
);

CREATE TABLE locker (
    id BIGINT PRIMARY KEY,
    code VARCHAR(255),
    member_id BIGINT UNIQUE,  -- 1:1 ê´€ê³„ì´ë¯€ë¡œ UNIQUE ì œì•½
    CONSTRAINT fk_locker_member FOREIGN KEY (member_id)
        REFERENCES member(id)
);
{% endhighlight %}

##### OneToOne ì—ì„œì˜ FetchType.LAZY ë¡œë”©ì˜ ë¬¸ì œì 

ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ì´ë•Œ `FetchType.LAZY` ë¡œë”©ì„ ì“°ê³  ì‹¶ì„ ìˆ˜ ìˆëŠ”ë°, `Locker` ëŠ” FK ë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— owner ì´ë©°, `Member` ëŠ” FK ê°€ ì—†ëŠ” `mappedBy` ë¡œ ì¢…ì†ë˜ê³  ìˆëŠ” í•„ë“œì´ë‹¤. ì´ë•Œ `Member` ìª½ì˜ í•„ë“œì—ì„œ `FetchType.LAZY` ë¥¼ ì ìš©í–ˆë‹¤ê³  ì³¤ì„ ë•Œ, `Member` ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” JPA ê°€ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì‹¤ì œ ê°ì²´ëŠ” í•„ìš”í•  ë•Œë§Œ ê°€ì ¸ì˜¤ê²Œ ë  ê²ƒì´ë‹¤.

ê·¼ë° ì—¬ê¸°ì„œ í”„ë¡ì‹œ ê°ì²´ê°€ ì •ìƒ ë™ì‘ì„ í•˜ë ¤ë©´ FK ê°’ì´ë‚˜ ì‹ë³„ìë¥¼ ë¯¸ë¦¬ ì•Œì•„ì•¼ í•œë‹¤. ê·¼ë° DB ìŠ¤í‚¤ë§ˆì—ëŠ” `member` í…Œì´ë¸”ì— FK ê°€ ìˆì§€ ì•Šê³  `locker` í…Œì´ë¸”ì— FK ë¥¼ ì†Œìœ í•˜ë„ë¡ ì†Œìœ ìë¥¼ ì •í–ˆê¸° ë•Œë¬¸ì— í”„ë¡ì‹œ ê°ì²´ê°€ ì˜ ë™ì‘í•˜ì§€ ì•Šê²Œ ë˜ì–´ì„œ ê²°êµ­ì—ëŠ” JPA ê°€ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„± ëª»í•˜ê³  í•´ë‹¹ í•„ë“œë¥¼ ì±„ìš°ê¸° ìœ„í•´ ë°”ë¡œ ì¡°íšŒí•˜ë„ë¡ í•˜ê²Œ ë§Œë“¤ê²Œ ëœë‹¤. ì´ëŠ” `Fetch.EAGER` ë¡œ ë™ì‘í•˜ê²Œ ë˜ëŠ” ê²ƒê³¼ ê°™ì€ ì›ë¦¬ë‹¤.

ë”°ë¼ì„œ ë‹¤ìŒì„ í†µí•´ í•´ê²·í•œë‹¤:
- FK ë¥¼ ì£¼ì¸ ìª½ì— ëšœê¸° -> ì •ìƒ `LAZY`
- `ManyToOne` + `UNIQUE` ì œì•½ íŒ¨í„´ ì‚¬ìš© -> `LAZY` ì •ìƒ ë™ì‘ ê°€ëŠ¥

##### toString(), JSON ì˜ ì¬ê·€ì  í˜¸ì¶œ ê°€ëŠ¥ì„±

`OneToOne` ì—ì„œë‚˜ ì–´ëŠ ë‹¤ë¥¸ ê´€ê³„ì—ì„œë‚˜ ì„œë¡œ ì—”í‹°í‹° ë‚´ë¶€ì— ì„œë¡œì˜ ë³€ìˆ˜ë¥¼ ê°€ì§€ë„ë¡ í•œë‹¤ê³  í•´ë³´ì. ê·¸ë ‡ë‹¤ë©´, `toString()` ìœ¼ë¡œ ì¶œë ¥í•  ë•Œ, `JSON` ìœ¼ë¡œ ì§ë ¬í™” í• ë•Œì—ì„œ ì„œë¡œ ê³„ì† í˜¸ì¶œí•˜ê²Œ ë˜ì–´ì„œ ë¬´í•œ ë£¨í”„ê°€ ë°œìƒí•œë‹¤.

ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ `OneToOne` ì—ì„œë‚˜ `OneToMany` ì—ì„œëŠ” ë‹¤ìŒ í•´ê²°ì±…ì„ ì“´ë‹¤:

- ë¬¸ìì—´ ì¶œë ¥ ë¬¸ì œëŠ” `toString()` ë‘ ì—”í‹°í‹° ì¤‘ í•œ ìª½ì—ì„œ ë‚´ë¶€ì ìœ¼ë¡œ í•´ë‹¹ í•„ë“œ ì œì™¸
- ì§ë ¬í™” ë¬¸ì œëŠ” `@JsonIgnore` ì‚¬ìš©
- DTO ë¡œ ë³€í™˜ì‹œì¼œ ë”°ë¡œ í•„ë“œë¥¼ ì„ ì–¸ í›„ ê´€ë¦¬

##### @ManyToOne, @OneToMany

{% highlight java %}
@Entity
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    // Member â†’ Order (1:N)
    @OneToMany(mappedBy = "member", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Order> orders = new ArrayList<>();

    // í¸ì˜ ë©”ì„œë“œ
    public void addOrder(Order order) {
        orders.add(order);
        order.setMember(this);
    }

    public void removeOrder(Order order) {
        orders.remove(order);
        order.setMember(null);
    }
}

@Entity
public class Order {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String orderNumber;

    // Order â†’ Member (N:1)
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "member_id")
    private Member member;

    public void setMember(Member member) {
        this.member = member;
    }
}
{% endhighlight %}

`ManyToOne` ê³¼ `OneToMany` ëŠ” í•­ìƒ ì„œë¡œ ë¶™ì–´ ë‹¤ë‹ˆëŠ” ê²ƒì„ ê¸°ì–µí•˜ì. ()To() ì¤‘ì— ì²«ë²ˆì¬ë¡œ ì˜¤ëŠ” ë‹¨ì–´ì˜ ê¸°ì¤€ì€ í•­ìƒ í•´ë‹¹ ì—”í‹°í‹°ì—ì„œ ë‚˜ì•„ê°€ëŠ” ëŒ€ì‘ë˜ëŠ” ê²ƒìœ¼ë¡œ ìƒê°í•œë‹¤. ë”°ë¼ì„œ `Order` ì˜ ë‹¤ìˆ˜ê°€ `Member` 1ëª…ìœ¼ë¡œ ê°€ê¸° ë•Œë¬¸ì— `Order` ì—ì„œëŠ” `ManyToOne` ì„ ì“´ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

ë‚˜ë¨¸ì§€ëŠ” ë‹¤ ë˜‘ê°™ë‹¤. `JoinColumn` ì€ ì†Œìœ í•˜ëŠ” ì—”í‹°í‹° ìª½ì— ì„ ì–¸í•˜ê³ , FK í•„ë“œë¥¼ ìƒì„±í•˜ê²Œ `Member` í•˜ë‚˜ë§Œ ê°€ì§€ê²Œ ë˜ëŠ” ìª½ì— ë‹¹ì—°íˆ ë“¤ì–´ê°€ëŠ”ê²Œ ë§ë‹¤(`Member` ìª½ì— `JoinColumn` ì„ ë„£ì—ˆë‹¤ë©´ `Order` ê°€ ì—¬ëŸ¬ ê°œ ì´ê¸° ë•Œë¬¸ì— ì´ëŠ” í•œ í•„ë“œì— ì—¬ëŸ¬ ì—”í‹°í‹°ê°€ ë“¤ì–´ê°€ê²Œ ë¨ì„ ì˜ë¯¸í•œë‹¤... ëª¨ìˆœì´ë©° ì¤‘ê°„ í…Œì´ë¸”ì´ ìƒì„±ë˜ê²Œ ë  ìˆ˜ë„ ìˆë‹¤ bad pattern). ë˜í•œ `mappedBy` ëŠ” ë‹¹ì—°íˆ FK ì— ì˜í•´ ì¢…ì†ë˜ëŠ” ê³³ ìª½ì˜ ì—”í‹°í‹°ì—ì„œ ê°€ì ¸ì•¼ í•œë‹¤.

##### EAGER, LAZY ê·¸ë¦¬ê³  N+1 ë¬¸ì œ

ì´ì „ì— ë´¤ë“¯ì´ `EAGER` ëŠ” ì‚¬ìš© ì•ˆí•˜ëŠ” í¸ì´ ì¢‹ìŒì„ ë³¼ ìˆ˜ ìˆë‹¤. êµ³ì´ ì‚¬ìš©í•˜ì§€ë„ ì•ŠëŠ” í•„ë“œì— ëŒ€í•´ ë‹¤ ê°€ì§€ê³  ì™€ì„œëŠ” ë©”ëª¨ë¦¬ë¥¼ ë‹¤ ì¡ë„ë¡ í•˜ê¸° ë•Œë¬¸ì— ê¸°ë³¸ì ìœ¼ë¡œ ì‹¤ë¬´ì—ì„œëŠ” `LAZY` ë¥¼ ì „ë¶€ ë‹¤ ì“´ë‹¤. ë˜í•œ `EAGER` ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ SQL ë¬¸ì´ ë‹¤ìŒê³¼ ê°™ì´ ë§¤ë²ˆ ë°”ë€ë‹¤:

- ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ê³  ê·¸ ì•ˆì˜ ì—°ê´€ ì—”í‹°í‹°ë“¤ë„ ì¡°íšŒí•˜ë ¤ê³  í•  ë•Œ,
    - **N+1 SELECT** ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ (ì˜ˆ: `Team` ì¡°íšŒ í›„ `Team` ë‚´ë¶€ì˜ `Member` ë¥¼ ìˆœíšŒí•˜ë©´ì„œ ê° `Member` ë¥¼ ë³„ë„ë¡œ ì¡°íšŒ)

- ì»¬ë ‰ì…˜ í•„ë“œê°€ `EAGER`ì¼ ê²½ìš°, ë‚´ë¶€ì ìœ¼ë¡œ SQLì´ í•œ ë²ˆì— ì¡°ì¸ë˜ê±°ë‚˜ ë³„ë„ `SELECT` ë¡œ ì¡°íšŒë  ìˆ˜ ìˆìŒ
    - FK ì»¬ëŸ¼ì´ `nullable = true`ì¸ ê²½ìš°, `LEFT JOIN` ì´ ì‚¬ìš©ë˜ì–´ ì—°ê´€ ì—”í‹°í‹°ê°€ ì—†ì–´ë„ ë¶€ëª¨ ì—”í‹°í‹°ëŠ” ì¡°íšŒë¨ â†’ ì¹´ë¥´í…Œì‹œì•ˆ ê³±ìœ¼ë¡œ ë¶ˆí•„ìš”í•œ ë°ì´í„° ë¡œë”©, ì„±ëŠ¥ ìƒ ì•ˆì¢‹ìŒ
    - FK ì»¬ëŸ¼ì´ `nullable = false`ì¸ ê²½ìš°, `INNER JOIN` ìœ¼ë¡œ ìµœì í™”ë˜ì–´ ë¶ˆí•„ìš”í•œ í–‰ì´ ì¤„ì–´ë“¦ ì´ëŠ” ì„±ëŠ¥ ìƒ ì¢‹ìŒ

> ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ì.

ë”°ë¼ì„œ `LAZY` ë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ê² ì§€ë§Œ, `LAZY` ì—ì„œ í•˜ë‚˜ë¥¼ ë“¤ê³  ì˜¤ê³ (`Team` ì„ ë“¤ê³ ì˜¤ê³  ë‚´ë¶€ì ìœ¼ë¡œ `List<Member>` ì— í”„ë¡ì‹œ ê°ì²´ë“¤ì„ ë„£ì–´ë†“ìŒ) ë‹¤ì‹œ ê·¸ ë‚´ë¶€ ì—°ê´€ ì—”í‹°í‹°ë“¤ì„ ìˆœíšŒí•  ë•ŒëŠ” ë‹¹ì—°íˆ N+1 ë²ˆ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤. ë”°ë¼ì„œ ìœ„ ë¬¸ì œë“¤ì„ ì „ë¶€ í•´ê²°í•˜ì§€ëŠ” ëª»í•˜ê³  N+1 ì˜ ë¬¸ì œë§Œì„ ì—¬ì „íˆ ë‚¨ê²¨ë‘”ë‹¤.

> ì´ ë¬¸ì œëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ë‚´ë¶€ì ìœ¼ë¡œ ì—°ê´€ ì—”í‹°í‹°ë¥¼ ì „ë¶€ ìˆœíšŒí•´ì•¼í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•  ë•Œ ë°œìƒí•˜ê¸°ì— ì´ëŸ° ë¡œì§ì´ ì—†ë‹¤ë©´ ê·¸ëƒ¥ `LAZY` ë§Œ ì¨ë„ ëœë‹¤. ì•„ë˜ì˜ `fetch join` ì€ ì„ íƒì ìœ¼ë¡œ ì¨ì•¼í•œë‹¤.

ì´ë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ”ê²Œ ë°”ë¡œ **fetch join** ì´ë‹¤. `fetch join` ì€ sql ë¬¸ì— ì§ì ‘ ìˆëŠ” ê¸°ëŠ¥ì´ë©°, ì´ëŠ” inner join ìœ¼ë¡œ íš¨ìœ¨ì ìœ¼ë¡œ ë“¤ê³ ì˜¤ë©°, eager ì—ì„œì˜ N ë²ˆì˜ select ì—†ì´ í•´ë‹¹ ì—°ê´€ ì—”í‹°í‹°ë“¤ë„ ì „ë¶€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì˜¬ë¼ê°€ê²Œ ë˜ë©°, ë‚´ë¶€ì˜ ì—°ê´€ ì—”í‹°í‹°ê¹Œì§€ ì¡°íšŒí• ë•Œ ì¶”ê°€ì ì¸ SQL ë¬¸ ì—†ì´ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

##### @ManyToMany

ë‹¤ ëŒ€ ë‹¤ì˜ ê´€ê³„ëŠ” ë³´í†µ ì‹¤ë¬´ì—ì„œëŠ” ì¤‘ê°„ í…Œì´ë¸”ì„ í†µí•´ êµ¬í˜„ëœë‹¤. ë”°ë¼ì„œ ë‹¤ ëŒ€ ë‹¤ ì–´ë…¸í…Œì´ì…˜ì´ ìˆë‹¤ë©´ ë¬¼ë¦¬ì ìœ¼ë¡œ ì¤‘ê°„ì— í…Œì´ë¸”ì´ ë”°ë¡œ ìˆë‹¤ê³  ë³´ë©´ ëœë‹¤.

> ì¤‘ê°„ì— í…Œì´ë¸”ì„ ë”°ë¡œ ë‘ëŠ” ì´ìœ ëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë‹¤ëŒ€ë‹¤ë¼ëŠ” ê´€ê³„ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. ì»¬ë ‰ì…˜ í•„ë“œë¥¼ ì €ì¥í•  ìˆ˜ ì—†ì„ ë¿ë”ëŸ¬ FK í•œ ê°œë¡œëŠ” 1:N ê´€ê³„ë§Œì´ ê°€ëŠ¥í•˜ê¸°ì—, ì¤‘ê°„ í…Œì´ë¸”ì„ ë‘¬ì„œ ê´€ë¦¬í•˜ê²Œ ëœë‹¤.

{% highlight java %}
@Entity
public class Student {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @ManyToMany
    @JoinTable(
        name = "student_course",  // ì¤‘ê°„ í…Œì´ë¸” ì´ë¦„
        joinColumns = @JoinColumn(name = "student_id"),   // í˜„ì¬ ì—”í‹°í‹° FK
        inverseJoinColumns = @JoinColumn(name = "course_id") // ìƒëŒ€ ì—”í‹°í‹° FK
    )
    private List<Course> courses = new ArrayList<>();
}

@Entity
public class Course {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String title;
}
{% endhighlight %}

`Student` ê°€ `Courses` ë¥¼ ì†Œìœ í•˜ëŠ” ì˜ˆì‹œì´ë‹¤. ë‘ ìª½ ë‹¤ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•˜ë ¤ë©´ ë‹¤ìŒ ì½”ë“œë¡œ ì§ ë‹¤.

{% highlight java %}
@Entity
public class Student {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @ManyToMany
    @JoinTable(
        name = "student_course",
        joinColumns = @JoinColumn(name = "student_id"),
        inverseJoinColumns = @JoinColumn(name = "course_id")
    )
    private List<Course> courses = new ArrayList<>();
}

@Entity
public class Course {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String title;

    @ManyToMany(mappedBy = "courses")
    private List<Student> students = new ArrayList<>();
}
{% endhighlight %}

`JoinTable` ì— ëŒ€í•´ì„œë§Œ ì •ë¦¬í•˜ì:

- ë‹¤ëŒ€ë‹¤(ManyToMany) ê´€ê³„ì—ì„œ **ì¤‘ê°„ í…Œì´ë¸”(join table)**ì„ ì •ì˜í•  ë•Œ ì‚¬ìš©
- ì¤‘ê°„ í…Œì´ë¸” ì´ë¦„, ì™¸ë˜ í‚¤ ì»¬ëŸ¼ ë“±ì„ ì§€ì • ê°€ëŠ¥
- ë‹¨ë°©í–¥/ì–‘ë°©í–¥ ê´€ê³„ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥

| ì†ì„± | ì„¤ëª… | ê¸°ë³¸ê°’ |
|------|------|--------|
| `name` | ì¤‘ê°„ í…Œì´ë¸”ì˜ ì´ë¦„ ì§€ì • | ì—”í‹°í‹° ì´ë¦„ ê¸°ë°˜ ìë™ ìƒì„± |
| `joinColumns` | í˜„ì¬ ì—”í‹°í‹°(FK ì†Œìœ  ì—”í‹°í‹°)ì™€ ì—°ê²°ë˜ëŠ” ì»¬ëŸ¼ ì§€ì • | ìë™ ìƒì„± |
| `inverseJoinColumns` | ìƒëŒ€ ì—”í‹°í‹°ì™€ ì—°ê²°ë˜ëŠ” ì»¬ëŸ¼ ì§€ì • | ìë™ ìƒì„± |
| `catalog` | í…Œì´ë¸”ì´ ì†í•˜ëŠ” DB ì¹´íƒˆë¡œê·¸ ì´ë¦„ | "" |
| `schema` | í…Œì´ë¸”ì´ ì†í•˜ëŠ” DB ìŠ¤í‚¤ë§ˆ ì´ë¦„ | "" |
| `uniqueConstraints` | ì¤‘ê°„ í…Œì´ë¸”ì˜ `UNIQUE` ì œì•½ ì¡°ê±´ ì§€ì • | ì—†ìŒ |
| `indexes` | ì¤‘ê°„ í…Œì´ë¸”ì— ìƒì„±í•  ì¸ë±ìŠ¤ ì§€ì • | ì—†ìŒ |

---

### ìš©ì–´

###### JTA

- ìë°” í‘œì¤€ íŠ¸ëœì­ì…˜ ê´€ë¦¬ API
- ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤(DB, ë©”ì‹œì§€ í ë“±)ì— ê±¸ì¹œ ë¶„ì‚° íŠ¸ëœì­ì…˜ ê´€ë¦¬ ê°€ëŠ¥
- ACID íŠ¸ëœì­ì…˜ ë³´ì¥

- **JTA vs RESOURCE_LOCAL**

| êµ¬ë¶„ | JTA | RESOURCE_LOCAL |
|------|-----|----------------|
| íŠ¸ëœì­ì…˜ ê´€ë¦¬ | ì»¨í…Œì´ë„ˆ(EJB, Spring) / ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ | ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì—ì„œ ì§ì ‘ |
| ì§€ì› ë²”ìœ„ | ì—¬ëŸ¬ DB, JMS ë“± ë¶„ì‚° íŠ¸ëœì­ì…˜ | ë‹¨ì¼ DB íŠ¸ëœì­ì…˜ |
| ì„ ì–¸ | `transaction-type="JTA"` | `transaction-type="RESOURCE_LOCAL"` |
| ì»¤ë°‹/ë¡¤ë°± | ì»¨í…Œì´ë„ˆê°€ ê´€ë¦¬ | ê°œë°œìê°€ ì§ì ‘ `EntityTransaction` ì‚¬ìš© |

- **JPAì—ì„œ í™œìš©**
  - `persistence.xml`ì—ì„œ `transaction-type="JTA"` ì„¤ì •
  - ì»¨í…Œì´ë„ˆê°€ íŠ¸ëœì­ì…˜ ê´€ë¦¬ â†’ `EntityTransaction` ì‚¬ìš© ë¶ˆí•„ìš”
  - Springì—ì„œëŠ” `@Transactional` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ê°„í¸í•˜ê²Œ íŠ¸ëœì­ì…˜ ê´€ë¦¬ ê°€ëŠ¥

- **í•µì‹¬ ìš”ì•½**
  - JTAëŠ” ë¶„ì‚° íŠ¸ëœì­ì…˜ ê´€ë¦¬ìš© í‘œì¤€ API
  - ë‹¨ì¼ DBë§Œ ì‚¬ìš©í•  ê²½ìš°ëŠ” RESOURCE_LOCAL ì‚¬ìš©
  - ì—”í„°í”„ë¼ì´ì¦ˆ í™˜ê²½ì—ì„œ ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ë¥¼ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©

###### PersistenceProvider

- JPA êµ¬í˜„ì²´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì¸í„°í˜ì´ìŠ¤
- JPA í‘œì¤€ ì¸í„°í˜ì´ìŠ¤(`EntityManager`, `EntityManagerFactory` ë“±)ë¥¼ ì‹¤ì œ êµ¬í˜„ì²´(`Hibernate`, `EclipseLink` ë“±)ì™€ ì—°ê²°
- `Persistence.createEntityManagerFactory()` í˜¸ì¶œ ì‹œ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©

- **ì—­í• **
  - `EntityManagerFactory` ìƒì„±
  - `EntityManager` ìƒì„± ì‹œ ë‚´ë¶€ ë¡œì§ ì œê³µ
  - íŠ¸ëœì­ì…˜ ì²˜ë¦¬, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬, SQL ìƒì„± ë“± JPA ê¸°ëŠ¥ì„ êµ¬í˜„

- **ëŒ€í‘œ êµ¬í˜„ì²´ ì˜ˆì‹œ**
  - Hibernate: `org.hibernate.jpa.HibernatePersistenceProvider`
  - EclipseLink: `org.eclipse.persistence.jpa.PersistenceProvider`

- **JPA ì„¤ì • ì˜ˆì‹œ (`persistence.xml`)**

{% highlight xml %}
<persistence-unit name="examplePU" transaction-type="RESOURCE_LOCAL">
    <provider>org.hibernate.jpa.HibernatePersistenceProvider</provider>
    <class>com.example.Member</class>
    <properties>
        <!-- JDBC ë° Hibernate ì„¤ì • -->
    </properties>
</persistence-unit>
{% endhighlight %}