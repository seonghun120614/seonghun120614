---
layout: post
title:  7. Spring Data
date:   2025-06-27 13:50:14 +0900
categories: Java Spring
---

<!--more-->

## ğŸª› í•œê³„ì 
ë‹¤ì–‘í•œ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•˜ë ¤ë©´ DAO ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê°ì²´ë“¤ì„ ì—¬ëŸ¬ê°œ ì •ì˜í•´ì•¼ í•œë‹¤.


## ğŸ“‚ ëª©ì°¨
- [ê°œìš”](#ê°œìš”)
    - [Java Persistence API (JPA)](#java-persistence-api-jpa)
    - [Spring Template](#spring-template)
    - [Repository](#repository)
    - [Spring Data Modules](#spring-data-modules)
- [Spring Boot RDBMS ì—°ë™í•˜ê¸°](#spring-boot-rdbms-ì—°ë™í•˜ê¸°)
    - [Spring Boot Database ìŠ¤í‚¤ë§ˆ ì •ì˜ ë° ì´ˆê¸° ë°ì´í„° ì„¤ì •](#spring-boot-database-ìŠ¤í‚¤ë§ˆ-ì •ì˜-ë°-ì´ˆê¸°-ë°ì´í„°-ì„¤ì •)
    - [Spring Boot MySQL Database](#spring-boot-mysql-database)
        - [properties ì„¤ì •í•˜ê¸°](#properties-ì„¤ì •í•˜ê¸°)
        - [Testing](#testing)
    - [Spring Boot PostgreSQL Database ë¡œ ë³€ê²½í•´ë³´ê¸°](#spring-boot-postgresql-database-ë¡œ-ë³€ê²½í•´ë³´ê¸°)
        - [properties ë¶„ë¦¬í•˜ê¸°](#properties-ë¶„ë¦¬í•˜ê¸°)
        - [Postgre SQL ì‘ì„±](#postgre-sql-ì‘ì„±)
        - [Testing](#testing-1)
- [Spring Data JPA ì‚¬ìš©í•˜ê¸°](#spring-data-jpa-ì‚¬ìš©í•˜ê¸°)
    - [CrudRepository](#crudrepository)
    - [@Entity ì™€ @Table](#entity-ì™€-table)
    - [CrudRepositoryë¥¼ í™œìš©í•œ User Table Schema êµ¬í˜„](#crudrepositoryë¥¼-í™œìš©í•œ-user-table-schema-êµ¬í˜„)
    - [JPA ì™€ sql ì‚¬ì´ì˜ DB ì´ˆê¸°í™” ê³ ì°°](#jpa-ì™€-sql-ì‚¬ì´ì˜-db-ì´ˆê¸°í™”-ê³ ì°°)
        - [Case 1: JPAê°€ í…Œì´ë¸”ì„ ë§Œë“¤ê³ , SQLì€ ì´ˆê¸° ë°ì´í„°ë§Œ ì‚½ì…](#case-1-jpaê°€-í…Œì´ë¸”ì„-ë§Œë“¤ê³ -sqlì€-ì´ˆê¸°-ë°ì´í„°ë§Œ-ì‚½ì…)
        - [Case 2: SQLë¡œ í…Œì´ë¸”ì„ ì •ì˜í•˜ê³ , JPAëŠ” ê±´ë“¤ì§€ ì•ŠìŒ](#case-2-sqlë¡œ-í…Œì´ë¸”ì„-ì •ì˜í•˜ê³ -jpaëŠ”-ê±´ë“¤ì§€-ì•ŠìŒ)
        - [Case 3: ë‘˜ ë‹¤ ì‚¬ìš©í–ˆì§€ë§Œ ì¶©ëŒ ë°œìƒ ê°€ëŠ¥](#case-3-ë‘˜-ë‹¤-ì‚¬ìš©í–ˆì§€ë§Œ-ì¶©ëŒ-ë°œìƒ-ê°€ëŠ¥)
        - [Case 4: í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œë§Œ ì´ˆê¸°í™”](#case-4-í…ŒìŠ¤íŠ¸-í™˜ê²½ì—ì„œë§Œ-ì´ˆê¸°í™”)
    - [Testing](#testing-2)
---

## ğŸ“š ë³¸ë¬¸

ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì ‘ê·¼í•˜ê¸° ìœ„í•´ ìì£¼ ì“°ëŠ” ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ì½”ë“œë“¤ì„ ì•ˆì“°ë„ë¡ í•˜ê³ , ë‹¤ì–‘í•œ ë°ì´í„° ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ì„ ì¼ê´€ëœ ì½”ë“œë¡œ ê°€ì ¸ê°€ì„œ ê°œë°œìì—ê²Œ í¸ì˜ì„±ì„ ì œê³µí•¨ê³¼ ë™ì‹œì— ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì œê³µí•˜ê¸° ìœ„í•œ DAO ìƒì„± í…œí”Œë¦¿ì„ ì§€ì›í•œë‹¤.

ì´ë¥¼ ìœ„í•´ **[JDBC(Java Database Connectivity)](#java-database-connectivity)** ë¥¼ í™œìš©í•´ DBì— ì—°ê²°, ì¿¼ë¦¬ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ **[PreparedStatement](#preparedstatement)**ë¥¼ ì •ì˜ë§Œ í•˜ë©´ ë‚´ë¶€ì ì¸ ë¡œì§ì„ ìë™ìœ¼ë¡œ ì§œì£¼ì–´ì„œ DB ì— ì ‘ê·¼í•˜ëŠ” ì„¸ë¶€ ë¡œì§ë“¤ì„ ë‹¤ ì•ˆì§œì£¼ì–´ë„ ëœë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ìƒì‚°ì„±ì´ ë¹„ì•½ì ìœ¼ë¡œ ëŠ˜ì–´ë‚œë‹¤.

ìš°ì„  ê°œë…ë¶€í„° ë³´ê³  ê°€ì.

### ê°œìš”

#### Java Persistence API (JPA)

JPAëŠ” ìë°” ê°ì²´(Entity)ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë§¤í•‘í•˜ê¸° ìœ„í•œ **[ORM(Object-Relational Mapping)](#orm)** í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.

ê¸°ë³¸ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤:
> Entity (ìë°” ê°ì²´) â†’ Persistence Provider (ì˜ˆ: Hibernate, EclipseLink) â†’ Database

ìš°ë¦¬ëŠ” JPAê°€ ì •ì˜í•œ **ì¸í„°í˜ì´ìŠ¤(API ëª…ì„¸)**ë¥¼ ì‚¬ìš©í•˜ê³ , ì‹¤ì œ ë™ì‘ì€ Hibernate ë“±ì˜ í¼ì‹œìŠ¤í„´ìŠ¤ ì œê³µìê°€ êµ¬í˜„í•œë‹¤.

ì¦‰, JPAëŠ” í‘œì¤€ì„ ì •ì˜í•˜ê³ , êµ¬í˜„ì²´ëŠ” ì´ë¥¼ ë”°ë¥´ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤.

#### Spring Template

**JDBC, JMS(Java Message Service), JNDI** ë“± ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì €ìˆ˜ì¤€ APIì—ì„œëŠ” DB ì—°ê²°, ì˜ˆì™¸ ì²˜ë¦¬, ìì› í•´ì œ ë“±ì˜ **ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ**ê°€ ë°˜ë³µì ìœ¼ë¡œ ë°œìƒí•œë‹¤.

Springì€ ì´ëŸ¬í•œ ë°˜ë³µ ì‘ì—…ì„ ì¤„ì´ê¸° ìœ„í•´ **Template ê¸°ë°˜ì˜ ì¶”ìƒí™” í´ë˜ìŠ¤**ë¥¼ ì œê³µí•œë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ `JdbcTemplate`ì€ JDBC APIë¥¼ ì‚¬ìš©í•  ë•Œ í•„ìš”í•œ **ì—°ê²°, ì¿¼ë¦¬ ì‹¤í–‰, ì˜ˆì™¸ ì²˜ë¦¬, ìì› ì •ë¦¬** ë“±ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤€ë‹¤.

> ì¦‰, ë³µì¡í•œ try-catch íŒ¨í„´ ì—†ì´ë„ DB ì‘ì—…ì„ ê°„ë‹¨í•˜ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

**JdbcTemplateì˜ ì—­í• **
- DB ì—°ê²° ë° ìì› í•´ì œ ìë™ ì²˜ë¦¬
- **SQLException** â†’ **DataAccessException** (ìŠ¤í”„ë§ ê³µí†µ ì˜ˆì™¸ë¡œ ë³€í™˜)
- SQL ì‹¤í–‰ ë° ê²°ê³¼ ë§¤í•‘ ì§€ì› (`query`, `update` ë“±)

#### Repository

Springì—ì„œ **Repository**ëŠ” ì „í†µì ì¸ **DAO(Data Access Object)**ì˜ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” ê°œë…ì´ë‹¤. `@Repository` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ **ë°ì´í„° ì ‘ê·¼ ê³„ì¸µì„ ì •ì˜**í•˜ë©°, ì´ëŠ” **Spring Data Commons**ì— í¬í•¨ëœ ì—¬ëŸ¬ ì¸í„°í˜ì´ìŠ¤ë“¤ì„ í†µí•´ ê¸°ëŠ¥ì´ í™•ì¥ëœë‹¤.

**Spring Data JPA**ë‚˜ **JdbcTemplate** ê¸°ë°˜ **Repository**ë¥¼ ì‚¬ìš©í•˜ë©´,
- CRUD ë©”ì„œë“œê°€ ìë™ ìƒì„±ë˜ë©°
- ì¿¼ë¦¬ ë©”ì„œë“œ(`findByName`, `countByStatus` ë“±)ë„ ìë™ êµ¬í˜„ëœë‹¤
- DB ì—°ê²°, íŠ¸ëœì­ì…˜ ì²˜ë¦¬, ì˜ˆì™¸ ë³€í™˜ ë“±ì€ ëª¨ë‘ ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤

> ì¦‰, **ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ë©´ êµ¬í˜„ ì—†ì´ë„ ê¸°ë³¸ì ì¸ ë°ì´í„° ì ‘ê·¼ ë¡œì§ì„ ìë™ìœ¼ë¡œ ìƒì„±**í•´ì¤€ë‹¤.

#### Spring Data Modules

- Spring Data Commons
- Spring Data JDBC
- Spring Data JPA
- Spring Data MongoDB
- Spring Data Redis
- Spring Data REST
- Spring Data Apache Casandra
- ...

ë°ì´í„° ì†ŒìŠ¤ë“¤ë§ˆë‹¤ ëª¨ë“ˆë“¤ì´ ìˆì–´ êµ‰ì¥íˆ ë§ì€ ëª¨ë“ˆì´ ìˆë‹¤. ëª¨ë“ˆë“¤ì„ ì´í•´í•˜ê¸° ìœ„í•´ ëª¨ë“ˆì„ ê³„ì¸µì ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.

- **Spring Data Commons**: Repository, CrudRepository, PagingAndSortingRepository
- **Spring Data Sub-modules**: JDBC, JPA, MongoDB, Casandra
- **DB Layer**: JDBC-MySQL, JPA-PostgreSQL, MongoDB-MongoDB, ...

Spring Data CommonsëŠ” Data ì„œë¸Œ ëª¨ë“ˆë“¤ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì¼ê´€ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°œë°œìì—ê²Œ ì œê³µí•˜ê³ , ì„œë¸Œ ëª¨ë“ˆì€ ê°ê°ì˜ ë‹¤ì–‘í•œ DBì— ì—°ê²°ë˜ì–´ ë°ì´í„° ì†ŒìŠ¤ë§ˆë‹¤ ì½”ë“œ ì°¨ì´ë¥¼ ê°œë°œìê°€ êµ³ì´ ëª°ë¼ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

### Spring Boot RDBMS ì—°ë™í•˜ê¸°

ìš°ì„  JPAë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì˜ì¡´ì„±ì„ ì¶”ê°€í•œë‹¤.

{% highlight java %}
implementation('org.springframework.boot:spring-boot-starter-data-jpa') {
    exclude group: 'com.zaxxer', module: 'HikariCP'
}
{% endhighlight %}

ì—¬ê¸°ì„œ HikariCP ë§ê³  **[Connection Pool](#connection-pool)** ë¡œ ë‹¤ìŒì„ ì„¤ì •í•œë‹¤.

{% highlight java %}
implementation 'org.apache.tomcat:tomcat-jdbc:10.1.20' // ì»¤ë„¥ì…˜ í’€ tomcat jdbc ì‚¬ìš©
{% endhighlight %}

ì»¤ë„¥ì…˜ í’€ì€ ì„œë¹„ìŠ¤ë§ˆë‹¤ ì•Œë§ì€ê±¸ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

#### Spring Boot Database ìŠ¤í‚¤ë§ˆ ì •ì˜ ë° ì´ˆê¸° ë°ì´í„° ì„¤ì •

ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•˜ëŠ” ë¶€ë¶„ì€ `resources/schema.sql`, `resources/data.sql` ì—ì„œ í•  ìˆ˜ ìˆë‹¤. ê·¸ ì „ì— *.sqlì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ê¸° ìœ„í•´ spring ì—ì„œ ë‹¤ìŒ í”„ë¡œí¼í‹°ë¥¼ ì„¤ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.

{% highlight properties %}
# application.properties

# always ë‚´ì¥DB, ì™¸ì¥DBë“  ìƒê´€ ì—†ì´ í•­ìƒ SQL íŒŒì¼ ì‹¤í–‰
# embedded(ê¸°ë³¸ê°’) H2, HSQL ë“±ì˜ ë‚´ì¥ DB ì—ì„œë§Œ SQL íŒŒì¼ ì‹¤í–‰
# never SQL ì´ˆê¸°í™” íŒŒì¼ ì‹¤í–‰ ì•ˆí•¨
spring.sql.init.mode=always

# schema.sql + data.sql ì‚¬ìš©ì„ ëª…ì‹œ
spring.sql.init.schema-locations=classpath:schema.sql
spring.sql.init.data-locations=classpath:data.sql

# Hibernateê°€ í…Œì´ë¸” ë§Œë“¤ì§€ ì•Šë„ë¡ ì„¤ì •
spring.jpa.hibernate.ddl-auto=none

# JPA SQL ì¿¼ë¦¬ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ë„ë¡ í•¨
spring.jpa.show-sql=true
{% endhighlight %}

ìŠ¤í‚¤ë§ˆë¥¼ ì„¤ì •í•œë‹¤.
{% highlight sql %}
// schema.sql
CREATE TABLE IF NOT EXISTS USERS (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100),
  email VARCHAR(100)
);
{% endhighlight %}

ê¸°ë³¸ì ìœ¼ë¡œ í•¸ë“¤ë§ í•  ë°ì´í„°ë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.
{% highlight sql %}
// data.sql
INSERT INTO USERS(id, name, email)
SELECT 1, 'Alice', 'alice@example.com'
WHERE NOT EXISTS (SELECT 1 FROM USERS WHERE id = 1);
{% endhighlight %}

ë°ì´í„°ëŠ” ê·¸ëƒ¥ GPT ê°€ ì£¼ëŠ” ì˜ˆì‹œë¡œ í–ˆë‹¤.

#### Spring Boot MySQL Database

ìš°ì„  mysqlì„ ì—°ê²°í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤.

{% highlight java %}
runtimeOnly 'mysql:mysql-connector-java:8.0.33'
{% endhighlight %}

dev í™˜ê²½ì—ì„œ MySql serverë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë‹¤ìŒì„ ì…ë ¥í•œë‹¤. **í¬íŠ¸ëŠ” 3306**ì´ë‹¤.

{% highlight bash %}
docker run --name mysql-dev \
  -e MYSQL_ROOT_PASSWORD={password} \
  -e MYSQL_DATABASE={DB ì´ë¦„} \
  -p 3306:3306 \
  -d mysql:8
{% endhighlight %}

##### properties ì„¤ì •í•˜ê¸°
ìì£¼ ì‚¬ìš©ë˜ëŠ” urlê³¼ password ë“±ì„ propertiesì— ì €ì¥í•œë‹¤.

{% highlight properties %}
# mysql.properties
spring.datasource.url=jdbc:mysql://localhost:3306/{DB ì´ë¦„}
spring.datasource.username=root
spring.datasource.password=1234
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
{% endhighlight %}

í•„ìëŠ” `mysql.properties` ë¥¼ ë§Œë“¤ì–´, `application.properties`ì—

{% highlight properties %}
spring.config.import=classpath:mysql.properties
{% endhighlight %}

ë¥¼ ì¶”ê°€í•´ì¤¬ë‹¤.

ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ import í•´ì¤€ë‹¤. Spring Data ì—ì„œ ìì²´ì ìœ¼ë¡œ **DataSource** ë¼ëŠ” ì‹±ê¸€í†¤ ê°ì²´ì— ìš°ë¦¬ê°€ ì •ì˜í•œ spring.datasource í”„ë¡œí¼í‹°ë“¤ì„ í† ëŒ€ë¡œ ìë™ìœ¼ë¡œ **connection** ì„ ìƒì„±í•´ì¤€ë‹¤. ì´ë¥¼ log ì°ì–´ë³´ì.

##### Testing

{% highlight java %}
@Test
public void givenDatasourceAvailableWhenAccessDetailsThenExpectDetails()
        throws SQLException {
    assertThat(dataSource.getClass().getName())
            .isEqualTo("org.apache.tomcat.jdbc.pool.DataSource");
    assertThat(dataSource.getConnection().getMetaData().getDatabaseProductName())
            .isEqualTo("MySQL");
}
{% endhighlight %}

ê¸°ë³¸ì ìœ¼ë¡œ ì˜ˆì™¸ ì²˜ë¦¬ ë˜í•œ ì¼ê´€ì„± ìˆê²Œ ì§€ì›í•´ì£¼ê¸° ë•Œë¬¸ì— ë©”ì„œë“œì— throws **SQLException** ë§Œ ë„£ì–´ì£¼ë©´ exception ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. ì´ì œ ë°ì´í„° ë˜í•œ ë“¤ì–´ê°”ëŠ”ì§€ë¥¼ ì‚´í´ë³´ì.

{% highlight java %}
@Test
public void givenUserWhenGetUserNameByIdThenGetUser() throws Exception {
    try(
            Connection cn = dataSource.getConnection();
            PreparedStatement ps = cn.prepareStatement("SELECT name FROM USERS WHERE id=1");
            ResultSet rs = ps.executeQuery();
    ) {
        if (rs.next())
            assertThat("Alice").isEqualTo(rs.getString("name"));
        else
            fail("No user found with id=1");
    }
}
{% endhighlight %}

í˜„ì¬ JPA Repositoryë¥¼ ë”°ë¡œ ì •ì˜í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, Spring Data JPAì˜ ê¸°ëŠ¥ì€ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìˆœìˆ˜ JDBC ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆë‹¤.

#### Spring Boot PostgreSQL Database ë¡œ ë³€ê²½í•´ë³´ê¸°

Postgre ì „ìš© db ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì„ì‹œ ì„œë²„ë¥¼ ì—°ë‹¤. **í¬íŠ¸ëŠ” 5432** ì´ë‹¤.
{% highlight bash %}
docker run --name postgres-dev \
  -e POSTGRES_USER={username} \
  -e POSTGRES_PASSWORD={password} \
  -e POSTGRES_DB={DB ì´ë¦„} \
  -p 5432:5432 \
  -d postgres:15
{% endhighlight %}

ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì¤€ë‹¤.
{% highlight java %}
runtimeOnly 'org.postgresql:postgresql'
{% endhighlight %}

##### properties ë¶„ë¦¬í•˜ê¸°
postgre ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì„¸íŒ… ê°’ì´ ë°”ë€Œì–´ì•¼ í•˜ë¯€ë¡œ postgres, mysql ë³„ë¡œ properties ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤. 
{% highlight properties %}
# application-postgres.properties
# DB Initialize
spring.sql.init.schema-locations=classpath:db/postgres/schema.sql
spring.sql.init.data-locations=classpath:db/postgres/data.sql

# DataSource
spring.datasource.url=jdbc:postgresql://localhost:5432/{DB ì´ë¦„}
spring.datasource.username={username}
spring.datasource.password={password}
spring.datasource.driver-class-name=org.postgresql.Driver
{% endhighlight %}

ìœ„ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤ê³  í•´ì„œ ìë™ìœ¼ë¡œ ì°¸ì¡°í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. application.propertiesì—ì„œ ë‹¤ìŒì„ ë„£ì–´ì£¼ë©´ ëœë‹¤.
{% highlight properties %}
# application.properties
spring.profiles.active=postgres
{% endhighlight %}
ì´ë ‡ê²Œ ë˜ë©´ db server ê°€ ë°”ë€” ë•Œë§ˆë‹¤ ì´ property ë§Œ ë°”ê¿”ì£¼ë©´ ë  í„°ì´ë‹¤.

##### Postgre SQL ì‘ì„±
{% highlight sql %}
-- shema.sql
CREATE TABLE IF NOT EXISTS USERS (
  id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  name VARCHAR(100),
  email VARCHAR(100)
);
{% endhighlight %}

{% highlight sql %}
-- data.sql
INSERT INTO USERS(id, name, email)
OVERRIDING SYSTEM VALUE
VALUES (1, 'Alice', 'alice@example.com')
ON CONFLICT (id) DO NOTHING;
{% endhighlight %}

##### Testing
{% highlight java %}
@Test
public void givenDatasourceAvailableWhenAccessDetailsThenExpectDetails()
        throws SQLException {
    assertThat(dataSource.getClass().getName())
            .isEqualTo("org.apache.tomcat.jdbc.pool.DataSource");
//		assertThat(dataSource.getConnection().getMetaData().getDatabaseProductName())
//				.isEqualTo("MySQL");
    assertThat(dataSource.getConnection().getMetaData().getDatabaseProductName())
            .isEqualTo("PostgreSQL");
}

@Test
public void givenUserWhenGetUserNameByIdThenGetUser() throws Exception {
    try(
            Connection cn = dataSource.getConnection();
            PreparedStatement ps = cn.prepareStatement("SELECT name FROM USERS WHERE id=1");
            ResultSet rs = ps.executeQuery();
    ) {
        if (rs.next())
            assertThat("Alice").isEqualTo(rs.getString("name"));
        else
            fail("No user found with id=1");
    }
}
{% endhighlight %}

í…ŒìŠ¤íŠ¸ì—ì„œ ìˆ˜ì •í•  ë¶€ë¶„ì€ í•œê°€ì§€ ë¿ì´ë‹¤(ì°¾ì•„ë³´ì•„ë¼).

### Spring Data JPA ì‚¬ìš©í•˜ê¸°

ì½”ë“œì—ì„œë„ ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ëª…ë ¹ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê³ , ì´ë¥¼ JPAë¥¼ í†µí•´ í•œë‹¤ê³  ì‚¬ì „ì— ë³´ì•˜ì„ ê²ƒì´ë‹¤. ì—¬ê¸°ì„œëŠ” ì´ JPAì˜ ê°€ì¥ ê¸°ë³¸ì ì¸ **Persistence Provider** ì˜ **Repository** ë¥¼ ë³¸ë‹¤.

{% highlight java %}
@Indexed
public interface Repository<T, ID> { }
{% endhighlight %}
`Repository` ì¸í„°í˜ì´ìŠ¤ë¥¼ íŒŒë³´ë©´ ì œë„ˆë¦­ íƒ€ì… T, ID ê°€ ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤. ID ëŠ” í–‰ì„ êµ¬ë¶„í•˜ëŠ” ì¦‰, ë ˆì½”ë“œë¥¼ êµ¬ë¶„í•˜ëŠ” ì»¬ëŸ¼ ëª… í˜¹ì€ í•„ë“œ ëª…ì´ë‹¤. TëŠ” ì´ ID ì˜ íƒ€ì…ì„ ì„ ì–¸í•œë‹¤.

í•˜ì§€ë§Œ ë‚´ë¶€ëŠ” ë¹„ì–´ìˆëŠ”ê±¸ ë³¼ ìˆ˜ ìˆëŠ”ë° ì´ë¥¼ **[Marker Interface](#marker-interface)** ë¼ê³  í•œë‹¤.

#### CrudRepository

`Repository`ë¥¼ ìƒì† ë°›ëŠ” `CrudRepository`ë¥¼ ë³´ì. ìì£¼ ì‚¬ìš©í•˜ëŠ” ë†ˆì´ë‹¤.

{% highlight java %}
@NoRepositoryBean
public interface CrudRepository<T, ID> extends Repository<T, ID> {

	<S extends T> S save(S entity);

	<S extends T> Iterable<S> saveAll(Iterable<S> entities);

	Optional<T> findById(ID id);

	boolean existsById(ID id);

	Iterable<T> findAll();

	Iterable<T> findAllById(Iterable<ID> ids);

	long count();

	void deleteById(ID id);

	void delete(T entity);

	void deleteAllById(Iterable<? extends ID> ids);

	void deleteAll(Iterable<? extends T> entities);

	void deleteAll();
}
{% endhighlight %}

ë©”ì„œë“œ ëª…ì€ ì„¤ëª… ì•ˆí•´ë„ ë  ì •ë„ë¡œ ì§ê´€ì ì´ê³  ëª…í™•í•˜ë‹¤. ìœ„ ë©”ì„œë“œë¥¼ ë‹¤ ì§€ì›í•˜ë©°, êµ³ì´ ì´ë¥¼ ìƒì†í•˜ëŠ” êµ¬í˜„ì²´ì— ìœ„ ë©”ì„œë“œë¥¼ ë‹¤ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ìˆ˜ê³ ë¥¼ ëœ ìˆ˜ ìˆë‹¤.

ì´ì œ ì´ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ë°, JVMì€ DB ìª½ ì„œë²„ì—ì„œ ì •ì˜ëœ ìŠ¤í‚¤ë§ˆë¥¼ ëª¨ë¥´ê¸°ì— Java ë‚´ì—ì„œ í•´ë‹¹ ë ˆì½”ë“œì™€ ë§ë¨¹ëŠ” í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤. ë‹¤ìŒì„ ì •ì˜í•˜ì.

#### @Entity ì™€ @Table

ì—”í‹°í‹°ëŠ” DBì˜ í•œ í…Œì´ë¸”ì— ë§¤í•‘ë˜ëŠ” **ë„ë©”ì¸ ê°ì²´(ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸)**ì´ë©°, ìŠ¤í‚¤ë§ˆì™€ 1:1ë¡œ ëŒ€ì‘ë  ìˆ˜ ìˆë„ë¡ ì •ì˜ëœë‹¤. `USERS` í…Œì´ë¸”ì— ëŒ€ì‘ë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì—”í‹°í‹°ë¥¼ ë§Œë“¤ì–´ë³´ì.

{% highlight java %}
import jakarta.persistence.*;
import lombok.*;

@Entity
@Table(name = "USERS")
@Data
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;
    @Column(length = 100)
    private String name;
    @Column(length = 100, nullable = false)
    private String email;

    public User() {}
    public User(@NonNull String name, @NonNull String email) {
        this.name = name;
        this.email = email;
    }
}
{% endhighlight %}

> NonNull ê³¼ Data ì–´ë…¸í…Œì´ì…˜ì€ í•„ìì˜ [Lombok][lombok] ê¸€ì„ ë³´ì.
> `@NonNull`ê³¼ `@Data`ëŠ” Lombok ì• ë…¸í…Œì´ì…˜ì´ë©°, `@NonNull`ì€ ìƒì„±ì ì¸ìì— nullì´ ë“¤ì–´ì˜¤ì§€ ì•Šë„ë¡ ëŸ°íƒ€ì„ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œë‹¤.  
> `@Data`ë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ **Spring Data JPAëŠ” ìƒì„±ì ê¸°ë°˜ ê°ì²´ ìƒì„±ì„ í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì—**, ëª…ì‹œì  ìƒì„±ìë¥¼ ì„ ì–¸í•´ì£¼ëŠ” ê²ƒì´ ì•ˆì •ì ì´ë‹¤.

MySQL ê¸°ì¤€ìœ¼ë¡œ Java ì˜ íƒ€ì…ê³¼ DB ìŠ¤í‚¤ë§ˆì˜ í•„ë“œ íƒ€ì… ë§¤í•‘ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- INT - Integer, int
- BIGINT - Long
- VARCHAR(n) - String
- CHAR(n) - String
- TEXT, LONGTEXT - String
- BOOLEAN, TINYINT(1) - Boolean / boolean
- DATE - java.time.LocalDate
- DATETIME, TIMESTAMP - javatime.LocalDateTime
- DECIMAL, NUMERIC, FLOAT, DOUBLE - java.math.BigDecimal
- ì´ì§„ ê´€ë ¨ ë°ì´í„° - byte[]

**ì£¼ì˜í•  ì **
> int ëŠ” null ì„ í—ˆìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” IDì˜ ê°’ê³¼ ì¶©ëŒ ê°€ëŠ¥ì„±ì´ ìˆë‹¤  
Integerì´ë‚˜ Longì„ ì‚¬ìš©í•˜ì—¬ nullì„ í—ˆìš©í•˜ê³  DB ìì²´ì— ì ‘ê·¼ì´ ë ë•Œ ë¯¸ì§€ì • ìƒíƒœë¡œ ë„£ì–´ì£¼ë©´ DBì—ì„œ ì•Œì•„ì„œ ì •ì˜í•´ì¤„ ê²ƒì´ë‹¤.  
  
ë”°ë¼ì„œ, Longì€ **BIGINT AUTO_INCREMENT** ì™€ë„ ê°™ê³ , Integerì€ **INT AUTO_INCREMENT**ì™€ ê°™ë‹¤. int ì˜ ì‚¬ìš©ì€ ë˜ë„ë¡ ì¼ë°˜ì ì¸ í•„ë“œì—ì„œë§Œ ì‚¬ìš©í•˜ë„ë¡ í•˜ì. ê·¸ë¦¬ê³  ì´ë¥¼ java ì—ì„œ ëª…ì‹œí•´ì£¼ê³  ì‹¶ë‹¤ë©´ `@GeneratedValue(strategy = GenerationType.IDENTITY)`ë¥¼ ì¶”ê°€í•˜ì—¬ í•´ë‹¹ í•„ë“œê°€ AUTO_INCREMENT ì„ì„ íƒ€ í”„ë¡œê·¸ë˜ë¨¸ì™€ ì œ 3ìì—ê²Œ ì•Œë ¤ì£¼ì.  
  
ë˜í•œ, **PK, FK, ëˆ„ì ê°’ì— ëŒ€í•œ í•„ë“œì— ëŒ€í•´ì„œëŠ” Longì„ ì“°ëŠ” ê²ƒ**ì´ ë” ë°”ëŒì§í•˜ë‹¤.

> TEXT ê³„ì—´ì€ ì¸ë±ì‹± ì œí•œì´ ìˆê¸° ë•Œë¬¸ì— ê²€ìƒ‰ í•„ë“œë¡œëŠ” ì‚¬ìš© ì£¼ì˜ê°€ í•„ìš”í•˜ë‹¤.

**TIP**
> ì–´ë…¸í…Œì´ì…˜ `@Column` ì— ìì²´ì ìœ¼ë¡œ `length` ë¼ëŠ” ì¸ìë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ”ë° ì´ë¥¼ ì„¤ì •í•´ì£¼ëŠ” ê±¸ë¡œ VARCHAR ì˜ ê¸¸ì´ì™€ ë§¤í•‘ì´ ëœë‹¤.  
  
Javaì—ëŠ” `String`ì´ `null` ê°’ì„ ê°€ì§ˆ ìˆ˜ë„ ìˆëŠ”ë°, ì´ë¥¼ ì œì–´í•˜ê¸° ìœ„í•´ `@Column(nullable = false)` ë¥¼ í•´ì£¼ë©´ ë¬´ì¡°ê±´ ì…ë ¥í•˜ë„ë¡ í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤(`unique` ì¸ìë„ ìˆìŒ).

ì´ì œ ì •ì˜ëœ Entity ë¥¼ Table Schemaì™€ ì—°ê²°ì‹œí‚¤ì.
{% highlight java %}
@Data
@Table(name = "USERS")
public class User {
{% endhighlight %}

ì´ì œ JPA ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì¤€ë¹„ê°€ ëë‚¬ë‹¤(`Repository` ì‚¬ìš© ì¤€ë¹„ ë).

#### CrudRepositoryë¥¼ í™œìš©í•œ User Table Schema êµ¬í˜„

{% highlight java %}a
import com.example.study.dao.entity.*;
import org.springframework.stereotype.Repository;
import org.springframework.data.repository.CrudRepository;

@Repository
public interface UserRepository extends CrudRepository<User, Long> { }
{% endhighlight %}

ì´ì œ JPA ì—ì„œ ì œê³µí•˜ëŠ” **CRUD, ì¿¼ë¦¬ ë©”ì„œë“œ**ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤. ë‚˜ë¨¸ì§€ í•„ìš”í•œ ë©”ì„œë“œëŠ” ì„œë¹„ìŠ¤ê°€ ìš”êµ¬í•˜ëŠ” ìƒí™©ì— ë§ì¶° ê·¸ë•Œê·¸ë•Œ ì¶”ê°€í•´ì£¼ëŠ”ê²Œ ë°”ëŒì§í•˜ë‹¤.

#### JPA ì™€ sql ì‚¬ì´ì˜ DB ì´ˆê¸°í™” ê³ ì°°

ì´ì œ í”„ë¡œí¼í‹°ì— ê´€í•´ì„œ ë³´ì. ì•ì„œ ë´¤ë“¯ì´ ìš°ë¦¬ëŠ” sql ë¬¸ì„ í†µí•´ ì´ˆê¸° ë°ì´í„°ë“¤ì„ ì •ì˜í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í–ˆëŠ”ë° ê·¸ë ‡ë‹¤ë©´, ë‹¨ìˆœ SQL íŒŒì¼ì´ ì•„ë‹Œ JPA ìì²´ë¥¼ í†µí•´ì„œë„ ì´ˆê¸° ë°ì´í„°ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ í•˜ëŠ” ì˜ë¬¸ì´ ìƒê¸´ë‹¤.

sqlë¡œ ìˆ˜í–‰í•  ë•Œ, ë‹¤ìŒ properties ë“¤ì„ ì¼ë‹¤:
- `spring.jpa.hibernate.ddl-auto`: JPAê°€ ddlì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ì§€ì— ëŒ€í•´ ëª…ì‹œ
- `spring.sql.init.mode`: `schema.sql`/`data.sql` ì‹¤í–‰ ì—¬ë¶€ ì œì–´

ì´ì œ ì´ë¥¼ ì¡°ê¸ˆ ë°”ê¿”ê°€ë©´ì„œ ì¼€ì´ìŠ¤ë§ˆë‹¤ ì–´ë–¤ í”„ë¡œí¼í‹° ê°’ì„ ê°€ì§€ê²Œ í•´ì•¼í• ì§€ ì •ë¦¬í•´ë³´ì.

##### Case 1: JPAê°€ í…Œì´ë¸”ì„ ë§Œë“¤ê³ , SQLì€ ì´ˆê¸° ë°ì´í„°ë§Œ ì‚½ì…

{% highlight properties %}
spring.jpa.hibernate.ddl-auto=create
spring.sql.init.mode=always
{% endhighlight %}

createëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ í…Œì´ë¸”ì„ ëª¨ë‘ **ë“œë¡­ í›„ ì¬ìƒì„±**í•˜ëŠ” ì„¤ì •ì´ë‹¤.  
ì¦‰, ê¸°ì¡´ ë°ì´í„°ëŠ” **ë§¤ë²ˆ ì‚­ì œ**ë˜ë©°, í…ŒìŠ¤íŠ¸ë‚˜ ê°œë°œ ì´ˆê¸°ì—ë§Œ ì‚¬ìš©í•˜ê¸° ì í•©í•˜ë‹¤.

ì´ ì„¤ì •ì—ì„œëŠ” JPAê°€ ì§ì ‘ ìŠ¤í‚¤ë§ˆë¥¼ ìƒì„±í•˜ë¯€ë¡œ, `schema.sql`ì€ ë¬´ì‹œë˜ê³  ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.  
ë‹¤ë§Œ `data.sql`ì€ **JPAê°€ í…Œì´ë¸” ìƒì„±ì„ ì™„ë£Œí•œ í›„ì— ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì—** ì´ˆê¸° ë°ì´í„° ì‚½ì… ìš©ë„ë¡œëŠ” ìœ íš¨í•˜ë‹¤.

##### Case 2: SQLë¡œ í…Œì´ë¸”ì„ ì •ì˜í•˜ê³ , JPAëŠ” ê±´ë“¤ì§€ ì•ŠìŒ

{% highlight properties %}
spring.jpa.hibernate.ddl-auto=none
spring.sql.init.mode=always
{% endhighlight %}

SQL íŒŒì¼ì— ëª¨ë“  í…Œì´ë¸”ê³¼ ì´ˆê¸° ë°ì´í„°ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤. ë³´í†µ ì‹¤ë¬´ì—ì„œ ë§ì´ ì‚¬ìš©í•œë‹¤.

##### Case 3: ë‘˜ ë‹¤ ì‚¬ìš©í–ˆì§€ë§Œ ì¶©ëŒ ë°œìƒ ê°€ëŠ¥

updateëŠ” JPA ê¸°ì¤€ìœ¼ë¡œ í…Œì´ë¸”ì„ ìˆ˜ì •í•˜ë ¤ê³  ì‹œë„í•˜ë©°, ë™ì‹œì— `schema.sql`ì´ ì ìš©ë˜ë©´
ì„œë¡œì˜ êµ¬ì¡°ê°€ ì¶©ëŒí•  ìˆ˜ ìˆë‹¤. íŠ¹íˆ ì»¬ëŸ¼ ì¤‘ë³µ, íƒ€ì… ë¶ˆì¼ì¹˜ ì‹œ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥í•˜ë‹¤.

{% highlight properties %}
spring.jpa.hibernate.ddl-auto=update
spring.sql.init.mode=always
{% endhighlight %}

ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µê³  ì˜ˆì¸¡ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤. ë¹„ì¶”ì²œ

##### Case 4: í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œë§Œ ì´ˆê¸°í™”

ë‚´ì¥ DB ì „ìš©ì´ë‹¤.

{% highlight properties %}
spring.jpa.hibernate.ddl-auto=create
spring.sql.init.mode=embedded
{% endhighlight %}

ë‚´ì¥ DBì¼ ë•Œë§Œ, `schema.sql`, `data.sql`ì´ ì‹¤í–‰ë˜ê³ ,  
ì‹¤ì œ **MySQL**ì´ë‚˜ **PostgreSQL**ì—ì„œëŠ” `schema.sql`, `data.sql`ì´ ë¬´ì‹œëœë‹¤.

ì„œë²„ë¥¼ ì˜¬ë¦¬ê³  ë‚˜ì„œëŠ” JPAë¥¼ ê¸°ì¤€ìœ¼ë¡œ ëŒì•„ê°€ê²Œ ëœë‹¤.

#### Testing

í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸° ì „ì— ìœ„ì˜ ê²½ìš°ë“¤ì— ë§ì¶° í”„ë¡œí¼í‹°ë¥¼ ì„¤ì •í•´ì£¼ê¸¸ ë°”ë€ë‹¤.

{% highlight java %}
import com.example.study.dao.entity.*;
import org.junit.jupiter.api.*;
import org.springframework.beans.factory.annotation.*;
import org.springframework.boot.test.context.*;

import static org.junit.jupiter.api.Assertions.*;

@SpringBootTest
public class UserRepositoryTest {

    @Autowired
    UserRepository userRepository;

    @Test
    public void givenCreateUserWhenLoadTheUserThenExpectExistedUser() {
        User user = new User("IU", "1234");

        userRepository.save(user);

        assertEquals("IU", userRepository.findById(1L).orElseThrow(
                () -> new AssertionError("User not found")
        ).getName());
    }

    @Test
    public void givenCreateUserWhenLoadTheUserThenExpectSameUser() {
        User user = new User("Alice", "alice@alice.co.kr"); // ì—¬ê¸°ì„  user id ê°€ null ì´ì§€ë§Œ
        User savedUser = userRepository.save(user); // ì—¬ê¸°ì„œëŠ” user idê°€ ìë™ ì„¤ì •ë¨

        assertEquals(user, savedUser);
    }

    @Test
    public void givenUpdateUserWhenLoadTheUserThenExpectUpdatedUser() {
        User user = userRepository.findById(1L)
                .orElseThrow(() -> new AssertionError("User not found"));

        user.setName("Bob");
        userRepository.save(user);

        User foundUser = userRepository.findById(1L).get();

        assertNotEquals("IU", foundUser.getName());
        assertEquals("Bob", foundUser.getName());
    }

    @Test
    public void givenDeleteUserWhenLoadTheUserThenExpectNoUser() {
        long total = userRepository.count();
        User user = userRepository.findById(1L)
                .orElseThrow(() -> new AssertionError("User not found"));

        userRepository.delete(user);
        assertEquals(total-1,userRepository.count());

        userRepository.deleteAll();
        assertEquals(0L, userRepository.count());
    }
}
{% endhighlight %}

ì „ë¶€ í†µê³¼í•´ì•¼ í•œë‹¤.

---

## âœ’ï¸ ìš©ì–´

###### ORM

ê°ì²´ì™€ DB í…Œì´ë¸”ì„ ë§¤í•‘í•˜ì—¬ ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë‹¤ë£° ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ê¸°ìˆ ì´ë‹¤. SQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ê°ì²´ë¥¼ í†µí•´ ë°ì´í„° ì¡°ì‘ì´ ê°€ëŠ¥í•˜ë‹¤.

> ì˜ˆ) ìë°” í´ë˜ìŠ¤ì˜ Member ì •ì˜ì™€ DBì˜ member í…Œì´ë¸”ì´ ìë™ìœ¼ë¡œ ë§¤í•‘ë¨

{% highlight java %}
Member member = entityManager.find(Member.class, 1L);
{% endhighlight %}

###### Java Database Connectivity (JDBC)

ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤(RDBMS)ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” **ìë°” í‘œì¤€ API**ì´ë‹¤.  
ìë°” ì½”ë“œì—ì„œ **SQLì„ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê¸°ëŠ¥**ì„ ì œê³µí•˜ëŠ” ì €ìˆ˜ì¤€ì˜ DB ì—°ê²° ë„êµ¬ì´ë‹¤.

{% highlight java %}
String sql = "SELECT * FROM member WHERE id = ?";
PreparedStatement pstmt = conn.prepareStatement(sql);
pstmt.setLong(1, 1L);
ResultSet rs = pstmt.executeQuery();
{% endhighlight %}

JPA(ORM)ë¥¼ ì‚¬ìš©í•œ ì½”ë“œì™€ ë¹„êµí•´ ë³´ë©´, JDBCëŠ” SQLê³¼ ì—°ê²° ì½”ë“œ(ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸)ë¥¼ **ì§ì ‘ ëª…ì‹œí•´ì•¼** í•˜ëŠ” ë°˜ë©´, JPAëŠ” ë¯¸ë¦¬ ì •ì˜ëœ ë©”ì„œë“œ(`find`, `persist`, `remove` ë“±)ë¥¼ í†µí•´ **ê°„ê²°í•˜ê³  ì¶”ìƒí™”ëœ ì½”ë“œë¡œ DBë¥¼ ë‹¤ë£° ìˆ˜ ìˆë‹¤.**

###### PreparedStatement

JDBCì—ì„œ **SQL êµ¬ë¬¸ì„ ë¯¸ë¦¬ ì»´íŒŒì¼**í•˜ì—¬ ì‹¤í–‰í•˜ëŠ” ê°ì²´ì´ë‹¤.  
**SQL Injection** ë°©ì§€, ì„±ëŠ¥ í–¥ìƒ ë“±ì˜ ì¥ì ì´ ìˆìœ¼ë©°,  
**ë™ì  íŒŒë¼ë¯¸í„°ë¥¼ ì•ˆì „í•˜ê²Œ ë°”ì¸ë”©**í•  ìˆ˜ ìˆë‹¤.

###### Connection Pool

DBë¥¼ ì—°ê²°í•  ë•ŒëŠ” ë„¤íŠ¸ì›Œí¬ ì—°ê²°, ì‚¬ìš©ì ì¸ì¦, ì„¸ì…˜ ì„¤ì • ë“± ë§ì€ ì‘ì—…ì´ í•„ìš”í•˜ë‹¤. ë§¤ ìš”ì²­ë§ˆë‹¤ ì´ë¥¼ ìƒˆë¡œí•˜ê²Œ ë˜ë©´ ì†ë„ ì €í•˜, ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ê°€ ëœë‹¤.

í•œ ë²ˆë§Œ ë§Œë“¤ì–´ë†“ê³  ì¬ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì»¤ë„¥ì…˜ í’€ì„ ìƒì„±í•˜ë©´, ìŠ¤ë ˆë“œë¥¼ ì—¬ëŸ¬ ê°œ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë“¤ì´ ì—¬ëŸ¬ëª… ìˆì–´ë„ ìƒˆë¡œ ìƒì„±í•˜ì§€ ì•Šê³ , ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ êº¼ë‚´ì„œ ì‚¬ìš©í•˜ê³  ë‹¤ ì‚¬ìš©í•˜ë©´ í’€ì— ë°˜ë‚©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ë™í•œë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ DB ì—°ê²° ì†ë„ê°€ í–¥ìƒë˜ë©°, ë¦¬ì†ŒìŠ¤ ì ˆì•½ì´ ëœë‹¤. Spring Bootì—ì„œëŠ” HikariCP ë¼ëŠ” ì»¤ë„¥ì…˜ í’€ì„ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ”ë°, tomcat-jdbcì˜ ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•´ë„ ëœë‹¤. ì·¨í–¥ ì°¨ì´ì´ë‹¤.

> ì˜ˆ: maximum-pool-size í”„ë¡œí¼í‹°ê°€ 10, ìœ ì €ê°€ ë™ì‹œ ì ‘ê·¼ì´ 11ëª…, 1ëª…ì€ ìŠ¤ë ˆë“œ(ìì›)ì´ ë°˜í™˜ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•¨.

###### Marker Interface

ë§ ê·¸ëŒ€ë¡œ 'í‘œì‹' ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. ì•„ë¬´ ë©”ì„œë“œë„ ìˆ˜í–‰í•˜ì§€ ì•Šê³  ì´ëŸ° ì¸í„°í˜ì´ìŠ¤ì´ë‹¤ ë¼ëŠ” ë©”íƒ€ ë°ì´í„°ë§Œ ì£¼ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•œë‹¤. ë³´í†µ java ë¥¼ ëœ¯ì–´ë‚´ë‹¤ ë³´ë©´ ë‹¤ìŒì„ ë³¼ ìˆ˜ ìˆëŠ”ë° ë‹¤ìŒë„ ë§ˆì»¤ ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.

- Serializable
- Cloneable
- Remote

í•´ë‹¹ interfaceë¥¼ í†µí•´ JVM í˜¹ì€ í”„ë ˆì„ì›Œí¬ ë‹¨ì—ì„œ ì¡°ê±´ ë¶„ê¸° ì²˜ë¦¬ê°€ ê°€ëŠ¥í•´ì§€ë¯€ë¡œ ê°€ë…ì„±ê³¼ ë™ì‘ ì œì–´ê°€ ë›°ì–´ë‚˜ë‹¤.

[lombok]: {{ site.baseurl }}/java/2025/06/09/lombok