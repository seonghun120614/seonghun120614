---
layout: post
title:  8. Spring Boot Auto Configuration and Actuator
date:   2025-08-08 15:45:34 +0900
categories: Java Spring
---

<!--more-->

## ğŸª› í•œê³„ì 


## ğŸ“‚ ëª©ì°¨
- []()
- []()

---

## ğŸ“š ë³¸ë¬¸

ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ê°œë°œì— í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ìë™ìœ¼ë¡œ ì„¤ì •í•´ì£¼ëŠ” ê¸°ëŠ¥ì´ ìˆëŠ”ë° ì´ë¥¼ Auto Configuration ì´ë¼ê³  í•œë‹¤. ë§Œì•½ `spring-boot-starter-web` ì„ ì¶”ê°€í•œë‹¤ë©´, Spring BootëŠ” ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™ì— í•„ìš”í•œ ì›¹ ì„œë²„ê°€ í•„ìš”í•  ê²ƒì´ë¼ê³  ì¶”ë¡ í•˜ê³  ì•„íŒŒì¹˜ í†°ìº£(ê¸°ë³¸ê°’ì„) ì›¹ì„œë²„ë¥¼ ê¸°ë³¸ ì›¹ ì„œë²„ë¡œ ì¶”ê°€í•´ì¤€ë‹¤. í†°ìº£ ë§ê³ ë„ Jettyë¥¼ ì‚¬ìš©í•´ë„ ë¬´ê´€í•˜ë‹¤. ê·¸ë•ŒëŠ” dependenciesë¥¼ Jettyë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•´ì£¼ë©´ ëœë‹¤(`spring-boot-starter-jetty`).

í•˜ì§€ë§Œ ì´ê²Œ ëª¨ë“  ìƒí™©ì— í¸ë¦¬í•  ìˆ˜ëŠ” ì—†ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê°œë°œíŒ€1 ì—ì„œ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•´ì„œ ì—¬ëŸ¬ê°€ì§€ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ê³  ìˆëŠ”ë° spring bean ì„¤ì •ì´ ëª¨ë“  íŒ€(ê°œë°œíŒ€2, ê°œë°œíŒ€3)ì—ì„œ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©´ ì¤‘ë³µë˜ëŠ” bean ë“¤ì„ ì—¬ëŸ¬ ê°œ ìƒì„±í•˜ëŠ” ê²ƒì€ ë§¤ìš° ë¹„íš¨ìœ¨ì ì¼ ê²ƒì´ë‹¤. ë”°ë¼ì„œ **ê³µí†µ êµ¬ì„± ì„¤ì •** ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤.

### Common Context Configuration ì„¤ì •

`@Configuration` ì• ë„ˆí…Œì´ì…˜ì„ í†µí•´ ì´ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ì„¤ì •ìœ¼ë¡œ ë‹´ë‹¹í•˜ëŠ”ë°, ë”°ë¡œ `CommonApplicationContextConfiguration` ì´ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì´ í´ë˜ìŠ¤ë¥¼ í¬í•¨í•˜ëŠ” í”„ë¡œì íŠ¸ëŠ” ë©”ì´ë¸ì´ë‚˜ ê·¸ë ˆì´ë“¤ ì»´í¬ë„ŒíŠ¸ë¡œ ë°°í¬ë˜ê³  ê°œë°œ íŒ€ì—ì„œëŠ” ì´ í”„ë¡œì íŠ¸ë¥¼ ì˜ì¡´ ê´€ë¡œ ì¶”ê°€í•´ì„œ ì„¤ì • í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì„ í„°ì´ë‹¤(ì¤‘ë³µëœ ì„¤ì • ì‘ì—… ë§‰ê¸°).

{% highlight java %}
@Configuration
public class CommonApplicationContextConfiguration {
    @Bean
    public RelationalDataSourceConfiguration dataSourceConfiguration() {
        return new RelationalDataSourceConfiguration
    }
}
{% endhighlight %}

ìœ„ëŠ” `RelationalDataSourceConfiguration` ì˜ ë‹¤ë¥¸ ëª¨ë“  íŒ€ì—ì„œ ìì£¼ ì‚¬ìš©í•  ë²•í•œ ê·¸ëŸ° í´ë˜ìŠ¤ë“¤ì„ ë¹ˆìœ¼ë¡œ ì •ì˜í•˜ê³  ìˆë‹¤. ì´ë ‡ê²Œ ì •ì˜í•´ë‘ë©´ ë‹¤ë¥¸ íŒ€ì—ì„œ ì´ë¥¼ ì‚¬ìš©í•  ë•Œ ì„¤ì • íŒŒì¼ ë‚´ìš©ì„ ìˆ˜ì •í•˜ëŠ” ìˆ˜ê³ ë¥¼ ëœ ìˆ˜ ìˆë‹¤. ì´ì œ ì´ë¥¼ í•¨ì˜í•˜ëŠ” ë‹¤ë¥¸ Application Context(IoC ì»¨í…Œì´ë„ˆ)ë¥¼ ì •ì˜í•˜ì. ì˜ì—…íŒ€ì€ ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

{% highlight java %}
package com.example.study.config;

import org.springframework.context.annotation.*;

@Configuration
@Import(CommonApplicationContextConfiguration.class)
public class CommonBusinessApplicationContextConfiguration {
    // ì˜ì—…íŒ€ì˜ Common ApplicationContext
}
{% endhighlight %}

### Conditional ì„ í†µí•œ íŠ¹ì • Bean ì œì™¸í•˜ê³  Import í•˜ê¸°

ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ëŠ” ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì˜ ìƒì„±ì„ ì œì–´í•  ìˆ˜ ìˆë„ë¡ `@Bean`, `@Component`, `@Configuration` ì• ë„ˆí…Œì´ì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” `@Conditional` ì• ë„ˆí…Œì´ì…˜ì„ ì œê³µí•œë‹¤.

{% highlight java %}
@Configuration
public class CommonApplicationContextConfiguration {
    @Bean
    @Conditional(RelationalDatabaseCondition.class)
    public RelationalDataSourceConfiguration dataSourceConfiguration() {
        return new RelationalDataSourceConfiguration();
    }
}
{% endhighlight %}

Conditional ì„ ë¶™ì—¬ ì¡°ê±´ì„ ê±¸ ìˆ˜ ìˆê³ , ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” Contextë“¤ì—ë§Œ í•´ë‹¹ Beanì´ ë“¤ì–´ê°€ê²Œ ëœë‹¤. `RelationalDatabaseCondition` ì€ `Condition` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ì´ê³ , `boolean matches()` ì„ êµ¬í˜„í•˜ë„ë¡ í•œë‹¤.

{% highlight java %}
package com.example.study.config;

import org.springframework.context.annotation.*;
import org.springframework.core.type.*;

public class RelationalDatabaseCondition implements Condition {

    @Override
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
        return isMySqlDatabase();
    }

    private boolean isMySqlDatabase() {
        try {
            Class.forName("com.mysql.jdbc.Driver");
            return true;
        } catch (ClassNotFoundException e) {
            return false;
        }
    }
}
{% endhighlight %}

ìœ„ì—ì„œëŠ” `reflect` APIë¥¼ í™œìš©í•˜ì—¬ JVMì— jdbc.Driver ê°€ ì˜¬ë¼ê°€ ìˆëŠ”ì§€ë¥¼ ì‚´í”¼ëŠ” ë¡œì§ì´ë‹¤. ì•ˆì— ì–¼ë§ˆë“ ì§€ ë³µì¡í•œ ë¡œì§ì„ ì‚¬ìš©í•˜ì—¬ Application Context ë¥¼ ìœ ì—°í•˜ê²Œ í™œìš©í•  ìˆ˜ ìˆë‹¤.

### @Condition ë™ì‘ ë°©ì‹

ì• ë„ˆí…Œì´ì…˜ë§Œìœ¼ë¡œ ì¡°ê±´ë¶€ ë¹ˆ ìƒì„±ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ìŠ¤í”„ë§ì—ì„œëŠ” ë‹¤ì–‘í•œ ì¡°ê±´ì„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë‹¤ì–‘í•œ ê³ ìˆ˜ì¤€ì˜ ì• ë„ˆí…Œì´ì…˜ì„ ë”°ë¡œ ì œê³µí•œë‹¤. ëª‡ ê°œë§Œ ì™¸ìš°ì.

| ì• ë„ˆí…Œì´ì…˜ | ì˜ˆì‹œ | ì˜ˆì‹œ ì„¤ëª… |
|:===:|:===:|:===:|
| @ConditionalOnBean | @Conditional(DataSource.class) | ì„¤ì •ì—ì„œ DataSource ë¹ˆì´ ëª…ì‹œë¼ ìˆìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnClass | @ConditionalOnClass(DataSource.class) | í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— DataSource í´ë˜ìŠ¤ê°€ ìˆìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnProperty | @ConditionalOnClass("some.property") | some.property ê°€ ì •ì˜ë˜ì–´ ìˆìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnCloud | @ConditionalOnCloud(CloudPlatform.KUBERNETES) | CloudPlatform ì´ KUBERNETESë¡œ ì„¤ì •ë¼ìˆìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnJava | @ConditionalOnJava(JavaVersion.EIGHT) | Java ë²„ì „ì´ 8ì„ ì§€ì›í•˜ë©´ ë°˜í™˜ |
| @ConditionalOnMissingBean | @ConditionalOnMissingBean(DataSource.class) | DataSource ë¹ˆì´ ì„¤ì •ë¼ ìˆì§€ ì•Šìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnMissingClass | @ConditionalOnMissingClass(DataSource.class) | í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— DataSource ë¹ˆì´ ì„¤ì •ë¼ ìˆì§€ ì•Šìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnNotWebApplication | @ConditionalOnNotWebApplication | ì›¹ ì–´í”Œì´ ì•„ë‹ˆë©´ true ë°˜í™˜ |
| @ConditionalOnSingleCandidate | @ConditionalOnSingleCandidate(DataSource.class) | DataSource ë¹ˆì´ í•˜ë‚˜ë§Œ ì •ì˜ë¼ ìˆìœ¼ë©´ true |

### spring.factories

ëª¨ë“  ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ëŠ” spring-boot-autoconfigure ì˜ ì˜ì¡´ê´€ê³„ë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤.

![spring-boot-autoconfigure-jar.png](/assets/img/spring-boot-autoconfigure-jar.png)

ì´ ëª¨ë“ˆì˜ JAR íŒŒì¼ì˜ META-INF í´ë”ë¥¼ íŒŒí—¤ì¹˜ë©´

{% highlight txt %}
...

# Auto Configuration Import Listeners
org.springframework.boot.autoconfigure.AutoConfigurationImportListener=\
org.springframework.boot.autoconfigure.condition.ConditionEvaluationReportAutoConfigurationImportListener

# Auto Configuration Import Filters
org.springframework.boot.autoconfigure.AutoConfigurationImportFilter=\
org.springframework.boot.autoconfigure.condition.OnBeanCondition,\
org.springframework.boot.autoconfigure.condition.OnClassCondition,\
org.springframework.boot.autoconfigure.condition.OnWebApplicationCondition

...
{% endhighlight %}

ìœ„ì™€ ê°™ì€ properties ê°€ ë³´ì´ë©°, Auto Configuration ìœ¼ë¡œ í‘œì‹œëœ ë¶€ë¶„ì´ ìŠ¤í”„ë§ ë¶€íŠ¸ ì»´í¬ë„ŒíŠ¸, ì„œë“œ íŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±ì— ëŒ€í•œ ìë™ êµ¬ì„± ì •ë³´ê°€ í¬í•¨ë¼ ìˆëŠ” ê³³ì´ë‹¤.

ìœ„ Condition ë“¤ ìˆœì„œëŒ€ë¡œ 
1. OnBeanCondition
2. OnClassCondition
3. OnWebApplicationCondition

ì„ í†µí•´ ê±¸ëŸ¬ì§€ê³  ë‚¨ì€ Configuration ë“¤ë§Œ `@Configuration` ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤.

### Auto Configuration êµ¬ì„±í•˜ê¸°

ëª¨ë“  íŒ€ë“¤ì´ ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©í•  ë°ì´í„° ì†ŒìŠ¤ì˜ ìë™ ì„¤ì •ì„ ê±´ë“œë ¤ë³´ì.

- dev í™˜ê²½: mysql, postgresql ì‚¬ìš©
- test í™˜ê²½: H2 ì‚¬ìš©
- prod í™˜ê²½: mysql, postgresql ì‚¬ìš©

ê° í™˜ê²½ë§ˆë‹¤ ì €ë ‡ê²Œ êµ¬ì„±í•˜ê³  ì‹¶ë‹¤ê³  í•´ë³´ì. properties ë¥¼ ìš°ì„  ì„¤ì •í•˜ì—¬ profiles ë§Œ ë°”ê¾¸ëŠ” ê²ƒë§Œìœ¼ë¡œ `DataSource` ë¥¼ ìë™ ë³€ê²½ì„ ì‹œí‚¤ë„ë¡ í•˜ê³  ì‹¶ì„ ê²ƒì´ë‹¤.

test í™˜ê²½ì—ì„œëŠ” `spring.active.profiles` ë¼ëŠ” springì—ì„œ ì§€ì •ëœ key ì— ì˜í•´ `application-{spring.active.profiles}.properties` ì˜ ì„¤ì • ì •ë³´ë¥¼ ì½ì–´ ë“¤ì—¬ ì‹¤í–‰í•˜ê²Œ ëœë‹¤. ì´ ê°’ì„ í†µí•´ Condition ì„ ì§œë³´ì.

{% highlight java %}
public class InMemoryDatabaseCondition implements Condition {
    @Override
    public boolean matches(
            ConditionContext context,
            AnnotatedTypeMetadata metadata) {
        Environment env = context.getEnvironment();
        String activeProfile = env.getProperty("spring.profiles.active");
        return // activeProfile == null ||
                activeProfile.equals("test");
    }
}
{% endhighlight %}

InMemoryëŠ” ë‚´ì¥ RAM ì„ í†µí•œ db source ë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ì‹ì´ë‹¤. context ë¥¼ í†µí•´ì„œ ë“¤ê³  ì™€ë„ ë˜ê³ , javax.lang.reflectë¥¼ í†µí•´ JVMì— ì˜¬ë¼ê°„ driver class ì˜ name ì„ ê²€ì‚¬í•´ë„ ë¬´ë°©í•˜ë‹¤. ì™ ë§Œí•´ì„œëŠ” Springì„ ì“°ì.

{% highlight java %}
@Configuration
@Conditional(InMemoryDatabaseCondition.class)
public class InMemoryDataSourceConfiguration {

    private final DataSourceProperties dsp;

    @Autowired
    public InMemoryDataSourceConfiguration(DataSourceProperties dataSourceProperties) {
        this.dsp = dataSourceProperties;
    }

    @Bean
    public DataSource dataSource() {
        HikariDataSource ds = new HikariDataSource();
        ds.setJdbcUrl(dsp.getUrl());
        ds.setUsername(dsp.getUsername());
        ds.setPassword(dsp.getPassword());
        return ds;
    }
}
{% endhighlight %}

ê³µí†µ DB Configuration ì„ ì„ ì–¸í•˜ì—¬ inner class ë¥¼ í†µí•´ ë‹¤ìˆ˜ì˜ class ë¥¼ ë“¤ê³  ì˜¤ê²Œ í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í†µí•´ ê° DBì— ëŒ€í•œ property ë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•˜ì—¬ ë“¤ê³  ì˜¬ ìˆ˜ ìˆê³ , NoSQL ì„ ì‚¬ìš©í•˜ëŠ” DBì— ëŒ€í•´ì„œë„ ì¶”ê°€ì ìœ¼ë¡œ í™•ì¥í•  ìˆ˜ ìˆì„ í„°ì´ë‹¤. ì—¬ê¸°ì„œ DataSource ëŠ” `HikariDataSource` ë¥¼ ì‚¬ìš©í•œë‹¤(ê²½ë‘, ì„±ëŠ¥ ì¢‹ìŒ)(Spring 2.x ì—ì„œëŠ” ì»¤ë„¥ì…˜ í’€ì´ Hikari ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë”°ë¡œ ì„¤ì •í•´ì¤„ í•„ìš”ê°€ ì—†ë‹¤).

### Auto Configure ë˜ëŠ” DataSource í´ë˜ìŠ¤ ìš°íšŒí•˜ê¸°

Spring BootëŠ” DataSource ë¥¼ `spring.datasource` prefix ì˜ key-value í”„ë¡œí¼í‹°ë¥¼ ì½ì–´ë“¤ì—¬ì„œ DataSourceë¥¼ êµ¬ì„±í•˜ê²Œ ëœë‹¤. ì´ë•Œ, ìì‹ ì˜ project ì— `DataSource` íƒ€ì…ì˜ Bean ì´ ì¡´ì¬í•˜ê²Œ ë˜ë©´ ë‚´ë¶€ì˜`@ConditionalOnMissingBean(DataSource.class)` ì˜ ì¡°ê±´ ë•Œë¬¸ì— ì›ë˜ì˜ Auto Configure ì— ì˜í•œ DataSource ì˜ì¡´ì„± ì£¼ì…ì„ ìš°íšŒí•˜ê²Œ ëœë‹¤. ì´ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.

{% highlight java %}
@Configuration
@Conditional(InMemoryDatabaseCondition.class)
public class InMemoryDataSourceConfiguration {

    private final DataSourceProperties dsp;

    @Autowired
    public InMemoryDataSourceConfiguration(DataSourceProperties dataSourceProperties) {
        this.dsp = dataSourceProperties;
    }

    @Bean
    public DataSource dataSource() {
        HikariDataSource ds = new HikariDataSource();
        ds.setJdbcUrl(dsp.getUrl());
        ds.setUsername(dsp.getUsername());
        ds.setPassword(dsp.getPassword());
        return ds;
    }
}
{% endhighlight %}

ì—¬ê¸°ì„œ DataSource thread ê°œìˆ˜ë“¤ì„ ì„œë²„ì˜ ì„±ëŠ¥ì— ë”°ë¼ ë‹¬ë¦¬ ì‚¬ìš©í•˜ì—¬ì„œ ì¡°ì •í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.



---

## âœ’ï¸ ìš©ì–´

###### 

---

## ğŸ”— ê´€ë ¨ ì¶œì²˜
- []()
