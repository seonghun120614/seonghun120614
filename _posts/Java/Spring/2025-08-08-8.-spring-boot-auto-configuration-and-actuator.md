---
layout: post
title:  8. Spring Boot Auto Configuration and Actuator
date:   2025-08-08 15:45:34 +0900
categories: Java Spring
---

<!--more-->

## ğŸª› í•œê³„ì 


## ğŸ“‚ ëª©ì°¨
- []()
- []()

---

## ğŸ“š ë³¸ë¬¸

ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ê°œë°œì— í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ìë™ìœ¼ë¡œ ì„¤ì •í•´ì£¼ëŠ” ê¸°ëŠ¥ì´ ìˆëŠ”ë° ì´ë¥¼ Auto Configuration ì´ë¼ê³  í•œë‹¤. ë§Œì•½ `spring-boot-starter-web` ì„ ì¶”ê°€í•œë‹¤ë©´, Spring BootëŠ” ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™ì— í•„ìš”í•œ ì›¹ ì„œë²„ê°€ í•„ìš”í•  ê²ƒì´ë¼ê³  ì¶”ë¡ í•˜ê³  ì•„íŒŒì¹˜ í†°ìº£(ê¸°ë³¸ê°’ì„) ì›¹ì„œë²„ë¥¼ ê¸°ë³¸ ì›¹ ì„œë²„ë¡œ ì¶”ê°€í•´ì¤€ë‹¤. í†°ìº£ ë§ê³ ë„ Jettyë¥¼ ì‚¬ìš©í•´ë„ ë¬´ê´€í•˜ë‹¤. ê·¸ë•ŒëŠ” dependenciesë¥¼ Jettyë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•´ì£¼ë©´ ëœë‹¤(`spring-boot-starter-jetty`).

í•˜ì§€ë§Œ ì´ê²Œ ëª¨ë“  ìƒí™©ì— í¸ë¦¬í•  ìˆ˜ëŠ” ì—†ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê°œë°œíŒ€1 ì—ì„œ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•´ì„œ ì—¬ëŸ¬ê°€ì§€ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ê³  ìˆëŠ”ë° spring bean ì„¤ì •ì´ ëª¨ë“  íŒ€(ê°œë°œíŒ€2, ê°œë°œíŒ€3)ì—ì„œ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©´ ì¤‘ë³µë˜ëŠ” bean ë“¤ì„ ì—¬ëŸ¬ ê°œ ìƒì„±í•˜ëŠ” ê²ƒì€ ë§¤ìš° ë¹„íš¨ìœ¨ì ì¼ ê²ƒì´ë‹¤. ë”°ë¼ì„œ **ê³µí†µ êµ¬ì„± ì„¤ì •** ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤.

### Common Context Configuration ì„¤ì •

`@Configuration` ì• ë„ˆí…Œì´ì…˜ì„ í†µí•´ ì´ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ì„¤ì •ìœ¼ë¡œ ë‹´ë‹¹í•˜ëŠ”ë°, ë”°ë¡œ `CommonApplicationContextConfiguration` ì´ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì´ í´ë˜ìŠ¤ë¥¼ í¬í•¨í•˜ëŠ” í”„ë¡œì íŠ¸ëŠ” ë©”ì´ë¸ì´ë‚˜ ê·¸ë ˆì´ë“¤ ì»´í¬ë„ŒíŠ¸ë¡œ ë°°í¬ë˜ê³  ê°œë°œ íŒ€ì—ì„œëŠ” ì´ í”„ë¡œì íŠ¸ë¥¼ ì˜ì¡´ ê´€ë¡œ ì¶”ê°€í•´ì„œ ì„¤ì • í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì„ í„°ì´ë‹¤(ì¤‘ë³µëœ ì„¤ì • ì‘ì—… ë§‰ê¸°).

{% highlight java %}
@Configuration
public class CommonApplicationContextConfiguration {
    @Bean
    public RelationalDataSourceConfiguration dataSourceConfiguration() {
        return new RelationalDataSourceConfiguration
    }
}
{% endhighlight %}

ìœ„ëŠ” `RelationalDataSourceConfiguration` ì˜ ë‹¤ë¥¸ ëª¨ë“  íŒ€ì—ì„œ ìì£¼ ì‚¬ìš©í•  ë²•í•œ ê·¸ëŸ° í´ë˜ìŠ¤ë“¤ì„ ë¹ˆìœ¼ë¡œ ì •ì˜í•˜ê³  ìˆë‹¤. ì´ë ‡ê²Œ ì •ì˜í•´ë‘ë©´ ë‹¤ë¥¸ íŒ€ì—ì„œ ì´ë¥¼ ì‚¬ìš©í•  ë•Œ ì„¤ì • íŒŒì¼ ë‚´ìš©ì„ ìˆ˜ì •í•˜ëŠ” ìˆ˜ê³ ë¥¼ ëœ ìˆ˜ ìˆë‹¤. ì´ì œ ì´ë¥¼ í•¨ì˜í•˜ëŠ” ë‹¤ë¥¸ Application Context(IoC ì»¨í…Œì´ë„ˆ)ë¥¼ ì •ì˜í•˜ì. ì˜ì—…íŒ€ì€ ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

{% highlight java %}
package com.example.study.config;

import org.springframework.context.annotation.*;

@Configuration
@Import(CommonApplicationContextConfiguration.class)
public class CommonBusinessApplicationContextConfiguration {
    // ì˜ì—…íŒ€ì˜ Common ApplicationContext
}
{% endhighlight %}

### Conditional ì„ í†µí•œ íŠ¹ì • Bean ì œì™¸í•˜ê³  Import í•˜ê¸°

ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ëŠ” ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì˜ ìƒì„±ì„ ì œì–´í•  ìˆ˜ ìˆë„ë¡ `@Bean`, `@Component`, `@Configuration` ì• ë„ˆí…Œì´ì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” `@Conditional` ì• ë„ˆí…Œì´ì…˜ì„ ì œê³µí•œë‹¤.

{% highlight java %}
@Configuration
public class CommonApplicationContextConfiguration {
    @Bean
    @Conditional(RelationalDatabaseCondition.class)
    public RelationalDataSourceConfiguration dataSourceConfiguration() {
        return new RelationalDataSourceConfiguration();
    }
}
{% endhighlight %}

Conditional ì„ ë¶™ì—¬ ì¡°ê±´ì„ ê±¸ ìˆ˜ ìˆê³ , ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” Contextë“¤ì—ë§Œ í•´ë‹¹ Beanì´ ë“¤ì–´ê°€ê²Œ ëœë‹¤. `RelationalDatabaseCondition` ì€ `Condition` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ì´ê³ , `boolean matches()` ì„ êµ¬í˜„í•˜ë„ë¡ í•œë‹¤.

{% highlight java %}
package com.example.study.config;

import org.springframework.context.annotation.*;
import org.springframework.core.type.*;

public class RelationalDatabaseCondition implements Condition {

    @Override
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
        return isMySqlDatabase();
    }

    private boolean isMySqlDatabase() {
        try {
            Class.forName("com.mysql.jdbc.Driver");
            return true;
        } catch (ClassNotFoundException e) {
            return false;
        }
    }
}
{% endhighlight %}

ìœ„ì—ì„œëŠ” `reflect` APIë¥¼ í™œìš©í•˜ì—¬ JVMì— jdbc.Driver ê°€ ì˜¬ë¼ê°€ ìˆëŠ”ì§€ë¥¼ ì‚´í”¼ëŠ” ë¡œì§ì´ë‹¤. ì•ˆì— ì–¼ë§ˆë“ ì§€ ë³µì¡í•œ ë¡œì§ì„ ì‚¬ìš©í•˜ì—¬ Application Context ë¥¼ ìœ ì—°í•˜ê²Œ í™œìš©í•  ìˆ˜ ìˆë‹¤.

### @Condition ë™ì‘ ë°©ì‹

ì• ë„ˆí…Œì´ì…˜ë§Œìœ¼ë¡œ ì¡°ê±´ë¶€ ë¹ˆ ìƒì„±ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ìŠ¤í”„ë§ì—ì„œëŠ” ë‹¤ì–‘í•œ ì¡°ê±´ì„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë‹¤ì–‘í•œ ê³ ìˆ˜ì¤€ì˜ ì• ë„ˆí…Œì´ì…˜ì„ ë”°ë¡œ ì œê³µí•œë‹¤. ëª‡ ê°œë§Œ ì™¸ìš°ì.

| ì• ë„ˆí…Œì´ì…˜ | ì˜ˆì‹œ | ì˜ˆì‹œ ì„¤ëª… |
|:===:|:===:|:===:|
| @ConditionalOnBean | @Conditional(DataSource.class) | ì„¤ì •ì—ì„œ DataSource ë¹ˆì´ ëª…ì‹œë¼ ìˆìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnClass | @ConditionalOnClass(DataSource.class) | í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— DataSource í´ë˜ìŠ¤ê°€ ìˆìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnProperty | @ConditionalOnClass("some.property") | some.property ê°€ ì •ì˜ë˜ì–´ ìˆìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnCloud | @ConditionalOnCloud(CloudPlatform.KUBERNETES) | CloudPlatform ì´ KUBERNETESë¡œ ì„¤ì •ë¼ìˆìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnJava | @ConditionalOnJava(JavaVersion.EIGHT) | Java ë²„ì „ì´ 8ì„ ì§€ì›í•˜ë©´ ë°˜í™˜ |
| @ConditionalOnMissingBean | @ConditionalOnMissingBean(DataSource.class) | DataSource ë¹ˆì´ ì„¤ì •ë¼ ìˆì§€ ì•Šìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnMissingClass | @ConditionalOnMissingClass(DataSource.class) | í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— DataSource ë¹ˆì´ ì„¤ì •ë¼ ìˆì§€ ì•Šìœ¼ë©´ true ë°˜í™˜ |
| @ConditionalOnNotWebApplication | @ConditionalOnNotWebApplication | ì›¹ ì–´í”Œì´ ì•„ë‹ˆë©´ true ë°˜í™˜ |
| @ConditionalOnSingleCandidate | @ConditionalOnSingleCandidate(DataSource.class) | DataSource ë¹ˆì´ í•˜ë‚˜ë§Œ ì •ì˜ë¼ ìˆìœ¼ë©´ true |

### spring.factories

ëª¨ë“  ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ëŠ” spring-boot-autoconfigure ì˜ ì˜ì¡´ê´€ê³„ë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤.

![spring-boot-autoconfigure-jar.png](/assets/img/spring-boot-autoconfigure-jar.png)

ì´ ëª¨ë“ˆì˜ JAR íŒŒì¼ì˜ META-INF í´ë”ë¥¼ íŒŒí—¤ì¹˜ë©´

{% highlight txt %}
# ApplicationContext Initializers
org.springframework.context.ApplicationContextInitializer=\
org.springframework.boot.autoconfigure.SharedMetadataReaderFactoryContextInitializer,\
org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener

# Application Listeners
org.springframework.context.ApplicationListener=\
org.springframework.boot.autoconfigure.BackgroundPreinitializer

# Environment Post Processors
org.springframework.boot.env.EnvironmentPostProcessor=\
org.springframework.boot.autoconfigure.integration.IntegrationPropertiesEnvironmentPostProcessor

# Auto Configuration Import Listeners
org.springframework.boot.autoconfigure.AutoConfigurationImportListener=\
org.springframework.boot.autoconfigure.condition.ConditionEvaluationReportAutoConfigurationImportListener

# Auto Configuration Import Filters
org.springframework.boot.autoconfigure.AutoConfigurationImportFilter=\
org.springframework.boot.autoconfigure.condition.OnBeanCondition,\
org.springframework.boot.autoconfigure.condition.OnClassCondition,\
org.springframework.boot.autoconfigure.condition.OnWebApplicationCondition

# Failure Analyzers
org.springframework.boot.diagnostics.FailureAnalyzer=\
org.springframework.boot.autoconfigure.data.redis.RedisUrlSyntaxFailureAnalyzer,\
org.springframework.boot.autoconfigure.diagnostics.analyzer.NoSuchBeanDefinitionFailureAnalyzer,\
org.springframework.boot.autoconfigure.jdbc.DataSourceBeanCreationFailureAnalyzer,\
org.springframework.boot.autoconfigure.jdbc.HikariDriverConfigurationFailureAnalyzer,\
org.springframework.boot.autoconfigure.jooq.NoDslContextBeanFailureAnalyzer,\
org.springframework.boot.autoconfigure.r2dbc.ConnectionFactoryBeanCreationFailureAnalyzer,\
org.springframework.boot.autoconfigure.r2dbc.MissingR2dbcPoolDependencyFailureAnalyzer,\
org.springframework.boot.autoconfigure.r2dbc.MultipleConnectionPoolConfigurationsFailureAnalyzer,\
org.springframework.boot.autoconfigure.r2dbc.NoConnectionFactoryBeanFailureAnalyzer,\
org.springframework.boot.autoconfigure.ssl.BundleContentNotWatchableFailureAnalyzer

# Template Availability Providers
org.springframework.boot.autoconfigure.template.TemplateAvailabilityProvider=\
org.springframework.boot.autoconfigure.freemarker.FreeMarkerTemplateAvailabilityProvider,\
org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAvailabilityProvider,\
org.springframework.boot.autoconfigure.mustache.MustacheTemplateAvailabilityProvider,\
org.springframework.boot.autoconfigure.thymeleaf.ThymeleafTemplateAvailabilityProvider,\
org.springframework.boot.autoconfigure.web.servlet.JspTemplateAvailabilityProvider

# DataSource Initializer Detectors
org.springframework.boot.sql.init.dependency.DatabaseInitializerDetector=\
org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializerDatabaseInitializerDetector

# Depends on Database Initialization Detectors
org.springframework.boot.sql.init.dependency.DependsOnDatabaseInitializationDetector=\
org.springframework.boot.autoconfigure.batch.JobRepositoryDependsOnDatabaseInitializationDetector,\ 
org.springframework.boot.autoconfigure.quartz.SchedulerDependsOnDatabaseInitializationDetector,\
org.springframework.boot.autoconfigure.session.JdbcIndexedSessionRepositoryDependsOnDatabaseInitializationDetector
{% endhighlight %}

ìœ„ì™€ ê°™ì€ properties ê°€ ë³´ì´ë©°, Auto Configure ë¡œ í‘œì‹œëœ ë¶€ë¶„ì´ ìŠ¤í”„ë§ ë¶€íŠ¸ ì»´í¬ë„ŒíŠ¸, ì„œë“œ íŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±ì— ëŒ€í•œ ìë™ êµ¬ì„± ì •ë³´ê°€ í¬í•¨ë¼ ìˆëŠ” ê³³ì´ë‹¤. ê°ê° valueë¡œ ë˜ì–´ ìˆëŠ” í´ë˜ìŠ¤ë“¤ì€ ì „ë¶€ `@Conditional` ì• ë„ˆí…Œì´ì…˜ì´ ë¶™ì–´ìˆëŠ” ì„¤ì •íŒŒì¼ì´ë‹¤.

ì´ë¥¼ í†µí•´ DataSource ê³µí†µ ì»¨í…ìŠ¤íŠ¸ ì„¤ì •ì„ í•´ë³´ì.

{% highlight java %}

{% endhighlight %}


---

## âœ’ï¸ ìš©ì–´

###### 

---

## ğŸ”— ê´€ë ¨ ì¶œì²˜
- []()
