<!DOCTYPE html>
<html lang="kor">

    <head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="icon" href="/seonghun120614/assets/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/seonghun120614/assets/css/style.css">
<title>Project. User Function MVP</title>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Project. User Function MVP | Seonghun’s Blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Project. User Function MVP" />
<meta name="author" content="Seonghun Park" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="v0.1" />
<meta property="og:description" content="v0.1" />
<link rel="canonical" href="https://seonghun120614.github.io/seonghun120614/computerscience/java/spring/2025/07/30/project.-user-function-mvp.html" />
<meta property="og:url" content="https://seonghun120614.github.io/seonghun120614/computerscience/java/spring/2025/07/30/project.-user-function-mvp.html" />
<meta property="og:site_name" content="Seonghun’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-07-30T06:19:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Project. User Function MVP" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Seonghun Park"},"dateModified":"2025-07-30T06:19:34+00:00","datePublished":"2025-07-30T06:19:34+00:00","description":"v0.1","headline":"Project. User Function MVP","mainEntityOfPage":{"@type":"WebPage","@id":"https://seonghun120614.github.io/seonghun120614/computerscience/java/spring/2025/07/30/project.-user-function-mvp.html"},"url":"https://seonghun120614.github.io/seonghun120614/computerscience/java/spring/2025/07/30/project.-user-function-mvp.html"}</script>
<!-- End Jekyll SEO tag -->


<script type="text/javascript" src="/seonghun120614/assets/js/darkmode.js"></script>

<!-- Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RQTWJRLWGD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RQTWJRLWGD');
</script></head><script>
        document.addEventListener("DOMContentLoaded", function () {
            const toggle = document.getElementById("dark-toggle");
        
            // 이미 실행한 적 있는지 확인
            const hasToggled = localStorage.getItem("darkModeInitialized");
        
            if (!hasToggled && toggle && toggle.checked) {
                toggleDarkMode();
                localStorage.setItem("darkModeInitialized", "true"); // 최초 실행 기록
            }
        });
    </script>

    <body>
        <div id="scroll-progress"></div>
        <main class="container">
            <section class="about">
                <div class="about-header condensed">
                    <div class="about-title">
                        <a href="/seonghun120614/">
                            
                            <img class="light"
                                src="/seonghun120614/assets/portfolio.png"
                                alt="Seonghun Park" />
                            <img class="dark"
                                src="/seonghun120614/assets/portfolio.png"
                                alt="Seonghun Park" />
                            
                        </a>
                        <h2 id="title">
                            <a href="/seonghun120614/">Seonghun Park</a>
                        </h2>
                    </div><p class="tagline">Developer.</p></div>
                
                <ul class="social about-footer condensed"><li>
                        <a
                            href="https://github.com/seonghun120614"
                            target="_blank"
                            rel="noopener"
                            aria-label="github">
                            <i class="icon-github-circled"></i>
                        </a>
                    </li><li>
                        <a
                            href="mailto:seonghun120614@gmail.com"
                            target="_blank" rel="noopener" aria-label="email">
                            <i class="icon-mail-alt"></i>
                        </a>
                    </li></ul><nav class="navigation about-footer condensed">
                    <ul>
                        
                        <li>
                            <a href="/seonghun120614/about">About Me</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/computerscience">Computer Science</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/math">Math</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/softwareengineering">Software Engineering</a>
                        </li>
                        
                    </ul>
                </nav><p class="about-footer condensed">&copy;
                    2025</p><div class="about-footer condensed">
                    <p>Dark Mode
                        <i class="icon-moon"></i>
                        <label class="switch" for="dark-toggle">
                            <input id="dark-toggle" type="checkbox"
                                class="dark-mode-toggle"
                                aria-label="Toggle dark mode">
                            <span class="slider round"
                                onclick="toggleDarkMode()"></span>
                        </label>
                    </p>
                </div>
            </section>
            <section class="content">
                <script>
window.MathJax = {
    tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
    renderActions: {
        addMenu: []
    }
    }
};
</script>

<script type="text/javascript"
    id="MathJax-script"
    async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script><div class="post-container">
    <a class="post-link" href="/seonghun120614/computerscience/java/spring/2025/07/30/project.-user-function-mvp.html">
        <h2 class="post-title">Project. User Function MVP</h2>
    </a>
    
    <div class="post-meta">
        <div class="post-date"><i class="icon-calendar"></i>Jul 30, 2025</div><ul class="post-categories"><li>ComputerScience</li><li>Java</li><li>Spring</li></ul></div>

    <div class="post">
        <!--more-->
<p>v0.1</p>

<h2 id="-목차">📂 목차</h2>

<ul>
  <li><a href="#핵심-기능-도출">핵심 기능 도출</a>
    <ul>
      <li><a href="#최소-기능-정의">최소 기능 정의</a></li>
      <li><a href="#user-flow-설계">User Flow 설계</a>
        <ul>
          <li><a href="#uf-registration">UF Registration</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#요구사항-정의">요구사항 정의(Requirement Specification)</a>
    <ul>
      <li><a href="#핵심-기능에-대한-요구-수집">핵심 기능에 대한 요구 수집</a>
        <ul>
          <li><a href="#rq-registration">RQ Registration</a></li>
        </ul>
      </li>
      <li><a href="#시나리오유스케이스-작성">시나리오/유스케이스 작성</a>
        <ul>
          <li><a href="#sc-registration">SC Registration</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#기획-협업">기획 협업(생략)</a></li>
  <li><a href="#기술-설계">기술 설계(Design Specification)</a>
    <ul>
      <li><a href="#api-스펙-초안-작성">API 스펙 초안 작성</a>
        <ul>
          <li><a href="#api-registration">API Registration</a></li>
        </ul>
      </li>
      <li>
        <p><a href="#db-테이블엔티티-구조-정의">DB 테이블/엔티티 구조 정의</a></p>
      </li>
      <li><a href="#서비스-계층의-로직-흐름-정리">서비스 계층의 로직 흐름 정리</a>
        <ul>
          <li><a href="#sd-registration">SD Registration</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#개발-sprint">개발 Sprint</a>
    <ul>
      <li><a href="#핵심-기능-우선순위-설정-및-분할">핵심 기능 우선순위 설정 및 분할</a></li>
      <li><a href="#tdd-작성">TDD 기반 소스코드 작성</a></li>
    </ul>
  </li>
  <li><a href="#sprint-review--retrospective">Sprint Review &amp; Retrospective</a>
    <ul>
      <li><a href="#v01">v0.1</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="-본문">📚 본문</h2>

<p>User 관련 기능을 RESTful 하게 구현하고 재사용하기 위해 User Component 혹은 패키지를 구현한다. 필요에 따라 서브 프로세스는 생략한다.</p>

<h3 id="핵심-기능-도출">핵심 기능 도출</h3>

<p>대부분의 서비스에 대한 User 관리 기능을 총체적으로 관리하는 컴포넌트를 개발하기 위해 핵심 기능을 도출한다.</p>

<h4 id="최소-기능-정의">최소 기능 정의</h4>

<p>서비스가 존재할 수 있는 가장 작은 단위를 다음 기능을 포함하는 서비스로 정의</p>

<ol>
  <li>회원가입 (Registration)</li>
</ol>

<ul>
  <li>목표: 새로운 사용자가 서비스에 계정을 생성하고 접속 가능</li>
  <li>핵심 기능:
    <ul>
      <li>사용자로부터 이메일 주소, 비밀번호, 사용자 이름을 입력</li>
      <li>이메일 주소의 <strong>유일성</strong> 및 <strong>유효성</strong>을 검증</li>
      <li>비밀번호는 보안을 위해 <strong>해싱하여 저장</strong></li>
      <li>성공적으로 계정이 생성되면 사용자에게 <strong>확인 응답</strong></li>
    </ul>
  </li>
</ul>

<!--
2. 로그인 (Login)
- 목표: 기존 사용자가 본인 인증을 통해 서비스에 접근하고, 보호된 리소스에 대한 접근 권한을 획득하는 것으로 정의
- 핵심 기능:
    - 사용자로부터 이메일 주소와 비밀번호를 입력
    - 입력된 비밀번호를 해싱된 저장된 비밀번호와 비교하여 일치 여부를 확인
    - 인증 성공 시, 이후 API 요청에 사용될 인증 토큰 (예: JWT - `Access Token`, `Refresh Token`)을 발급하여 반환
    - 인증 실패 시, 적절한 오류 메시지를 반환

3. 인증 (Authentication)
- 목표: 로그인한 사용자가 '누구인지' 즉, 사용자의 신원을 검증
- 핵심 기능:
    - 로그인 시 발급된 인증 토큰(예: `Access Token`)을 사용하여, 이후 모든 보호된 API 요청에서 사용자의 신원을 확인
    - 토큰의 유효성 (만료 여부, 변조 여부 등)을 검증하여 유효한 사용자만이 API를 호출 가능

4. 인가 (Authorization)
- 목표: 인증된 사용자가 '무엇을 할 수 있는지' 결정하고, 특정 리소스 또는 기능에 대한 접근 권한을 부여/제한
- 핵심 기능:
    - 인증된 사용자의 역할 또는 권한을 기반으로 특정 API 엔드포인트나 데이터에 대한 접근 허용 여부를 판단

5. 탈퇴 (Deactivation/Deletion)
- 목표: 사용자가 서비스에서 자신의 계정을 영구적으로 삭제 가능
- 핵심 기능:
    - 탈퇴를 요청한 사용자의 인증 토큰을 통해 신원을 확인
    - 사용자의 계정 정보 및 관련 데이터를 삭제 가능
    - 성공적으로 처리되면 사용자에게 확인 응답

-->

<h4 id="user-flow-설계">User Flow 설계</h4>

<h5 id="uf-registration">UF Registration</h5>

<pre><code class="language-mermaid">graph TD
    A[클라이언트] --&gt; B{POST /api/v1-beta/users/register};
    B --&gt; C[백엔드: 요청 수신];
    C --&gt; D{요청 바디 유효성 검증};
    D -- 실패 (400 Bad Request) --&gt; E[응답: 에러 메시지];
    D -- 성공 --&gt; F{이메일 중복 확인};
    F -- 중복 (409 Conflict) --&gt; E;
    F -- 고유함 --&gt; G[비밀번호 해싱];
    G --&gt; H[사용자 정보 DB 저장];
    H --&gt; I{DB 저장 성공?};
    I -- 실패 (500 Internal Server Error) --&gt; E;
    I -- 성공 --&gt; J[응답: 201 Created, 생성된 사용자 ID/Email];
    J --&gt; A;
    E --&gt; A;
</code></pre>

<div style="display: none;">
##### Login

```mermaid
graph TD
    A[클라이언트] --&gt; B{POST /api/v1/users/login};
    B --&gt; C[백엔드: 요청 수신];
    C --&gt; D{요청 바디 유효성 검증};
    D -- 실패 (400 Bad Request) --&gt; E[응답: 에러 메시지];
    D -- 성공 --&gt; F[DB에서 Email 기준 사용자 정보 조회];
    F --&gt; G{사용자 존재 여부 및 비밀번호 일치 확인};
    G -- 사용자 없음/비밀번호 불일치 (401 Unauthorized) --&gt; E;
    G -- 일치 --&gt; H[JWT Access Token &amp; Refresh Token 생성];
    H --&gt; I[응답: 200 OK, AccessToken, RefreshToken, 사용자 기본 정보];
    I --&gt; A;
    E --&gt; A;
```

##### Authentication &amp; Authorization

```mermaid
graph TD
    A[클라이언트] --&gt; B{GET /api/v1/users/me Authorization 헤더에 AccessToken 포함};
    B --&gt; C[백엔드: 요청 수신];
    C --&gt; D{Authorization 헤더를 통한 AccessToken 존재 여부 확인};
    D -- 없음 (401 Unauthorized) --&gt; E[응답: 에러 메시지];
    D -- 있음 --&gt; F{서명, 만료 시간을 통한 AccessToken 유효성 검증};
    F -- 유효하지 않음/만료 (401 Unauthorized) --&gt; E;
    F -- 유효함 --&gt; G[토큰에서 사용자 ID 추출];
    G --&gt; H[DB에서 ID 기준 사용자 정보 조회];
    H --&gt; I{사용자 존재 여부};
    I -- 없음 (404 Not Found) --&gt; E;
    I -- 있음 --&gt; J[Authorization를 통한 요청된 자원에 대한 사용자 권한 확인 인가];
    J -- 권한 없음 (403 Forbidden) --&gt; E;
    J -- 권한 있음 --&gt; K[사용자 정보 응답 데이터 구성];
    K --&gt; L[응답: 200 OK, 사용자 상세 정보];
    L --&gt; A;
    E --&gt; A;
```

##### Deletion

```mermaid
graph TD
    A[클라이언트] --&gt; B{DELETE /api/v1/users/me Authorization 헤더에 AccessToken 포함};
    B --&gt; C[백엔드: 요청 수신];
    C --&gt; D{AccessToken 유효성 검증 및 사용자 ID 추출};
    D -- 실패 (401 Unauthorized) --&gt; E[응답: 에러 메시지];
    D -- 성공 --&gt; F[DB에서 해당 사용자 정보 조회 및 삭제/비활성화];
    F --&gt; G{DB 처리 성공?};
    G -- 실패 (500 Internal Server Error) --&gt; E;
    G -- 성공 --&gt; H[연관된 세션/토큰 무효화];
    H --&gt; I[응답: 204 No Content 또는 200 OK];
    I --&gt; A;
    E --&gt; A;
```

</div>

<h3 id="요구사항-정의">요구사항 정의</h3>

<p>앞서 다뤘던 MVP 와 User Flow Chart 를 통한 기능에 대한 구체적인 요구사항을 수집한다. 개발자들이 기능을 구현할 때 참고할 수 있는 구체적인 설계 가이드라인이 되기에 상세히 작성할수록 좋다.</p>

<h4 id="핵심-기능에-대한-요구-수집">핵심 기능에 대한 요구 수집</h4>

<h5 id="rq-registration">RQ Registration</h5>
<p>새로운 사용자가 서비스에 계정을 생성</p>

<ul>
  <li>API 엔드포인트: <code class="language-plaintext highlighter-rouge">POST /api/v1/users/register</code></li>
  <li>요청 (Request Body): JSON 형식
    <ul>
      <li><code class="language-plaintext highlighter-rouge">email</code> (문자열, 필수): 사용자의 이메일 주소
        <ul>
          <li>제약사항: 유효한 이메일 형식 (예: <code class="language-plaintext highlighter-rouge">user@example.com</code>).</li>
          <li>제약사항: 시스템 내에서 고유해야 함</li>
          <li>길이 제한: 최대 255자</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">password</code> (문자열, 필수): 사용자가 설정할 비밀번호
        <ul>
          <li>제약사항: 최소 8자 이상, 대문자/소문자/숫자/특수문자 중 3가지 이상 포함</li>
          <li>길이 제한: 최소 8자, 최대 64자</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">username</code> (문자열, 필수): 사용자 이름 (닉네임)
        <ul>
          <li>제약사항: 중복 허용 (필요에 따라 고유성 제약 추가 가능)</li>
          <li>길이 제한: 최소 2자, 최대 30자</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>성공 응답 (<code class="language-plaintext highlighter-rouge">Response - 201 Created</code>): JSON 형식
    <ul>
      <li><code class="language-plaintext highlighter-rouge">id</code> (정수/UUID): 생성된 사용자의 고유 ID</li>
      <li><code class="language-plaintext highlighter-rouge">email</code> (문자열): 등록된 이메일 주소</li>
      <li><code class="language-plaintext highlighter-rouge">username</code> (문자열): 등록된 사용자 이름</li>
      <li><code class="language-plaintext highlighter-rouge">message</code> (문자열): “회원가입이 성공적으로 완료되었습니다.”</li>
    </ul>
  </li>
  <li>오류 응답 (Response): JSON 형식
    <ul>
      <li><code class="language-plaintext highlighter-rouge">status</code> (정수):
        <ul>
          <li><code class="language-plaintext highlighter-rouge">400 Bad Request</code> (유효성 검증 실패)</li>
          <li><code class="language-plaintext highlighter-rouge">409 Conflict</code> (이메일 중복)</li>
          <li><code class="language-plaintext highlighter-rouge">500 Internal Server Error</code> (서버 내부 오류)</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">code</code> (문자열): 특정 오류를 식별하는 내부 코드
        <ul>
          <li><code class="language-plaintext highlighter-rouge">INVALID_EMAIL_FORMAT</code></li>
          <li><code class="language-plaintext highlighter-rouge">PASSWORD_POLICY_VIOLATION</code></li>
          <li><code class="language-plaintext highlighter-rouge">EMAIL_ALREADY_EXISTS</code></li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">message</code> (문자열): 사용자에게 표시할 오류 메시지
        <ul>
          <li>“이메일 형식이 올바르지 않습니다.”</li>
          <li>“비밀번호는 최소 8자 이상, 64자 이하이며, 영문 대소문자, 숫자, 특수문자 중 3가지 이상을 포함해야 합니다.”</li>
          <li>“이름은 최소 2자 이상이며, 최대 30자 입니다.”</li>
          <li>“이미 등록된 이메일 주소입니다.”</li>
          <li>“서버 오류가 발생했습니다. 사용자 정보를 저장하는 데 실패했습니다. 잠시 후 다시 시도해 주세요.”</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>백엔드 처리 로직:
    <ul>
      <li>요청 데이터 유효성 검증</li>
      <li>이메일 중복 확인</li>
      <li>비밀번호 해싱 (예: bcrypt)</li>
      <li>사용자 정보를 데이터베이스에 저장</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>(선택 사항) 회원가입 시점에 기본 역할(Role) 부여 (예: USER)</p>
</blockquote>

<!--

##### Login
등록된 사용자가 인증 토큰을 발급받아 보호된 리소스에 접근 가능

- API 엔드포인트: `POST /api/v1/users/login`
- 요청 (Request Body): JSON 형식
    - `email` (문자열, 필수): 사용자의 이메일 주소
    - `password` (문자열, 필수): 사용자의 비밀번호

- 성공 응답 (`Response - 200 OK`): JSON 형식
    - `accessToken` (문자열): 보호된 API 호출에 사용될 JWT (JSON Web Token)
        - 유효 기간: 15분 ~ 1시간 (보안 정책에 따라 상이)
    
    - `refreshToken` (문자열, 선택 사항): Access Token 만료 시 갱신에 사용될 토큰 (MVP에서는 선택적으로 포함, 보안 강화 목적)
        - 유효 기간: 7일 ~ 30일.
    
    - `user` (객체):
        - `id` (정수/UUID): 사용자 고유 ID
        - `email` (문자열): 사용자 이메일
        - `username` (문자열): 사용자 이름

    - `message` (문자열):
        - "로그인 성공."

- 오류 응답 (Response): JSON 형식
    - `status` (정수):
        - `400 Bad Request` (필수 필드 누락)
        - `401 Unauthorized` (인증 실패)
    
    - `code` (문자열): 특정 오류를 식별하는 내부 코드
        - `INVALID_CREDENTIALS`
        - `USER_NOT_FOUND`

    - `message` (문자열): "이메일 또는 비밀번호가 올바르지 않습니다."

- 백엔드 처리 로직:
    - 요청 데이터 유효성 검증
    - 데이터베이스에서 이메일로 사용자 조회
    - 조회된 사용자의 해싱된 비밀번호와 입력된 비밀번호 비교
    - 비밀번호 일치 시, JWT `accessToken` 및 `refreshToken` (선택 사항) 생성
    - `refreshToken` 사용 시, 데이터베이스에 `refreshToken` 저장 (보안을 위해 해싱 또는 암호화하여)

##### Email Exists Check (`GET /api/v1/users/check`)

회원가입 과정에서 입력한 이메일이 이미 등록된 계정인지 확인하는 데 사용합니다.

- API 엔드포인트: `GET /api/v1/users/check?email=someone@example.com`

- 요청 파라미터:
    - `email` (문자열): 확인할 이메일 주소

- 성공 응답 (`200 OK`):
    - `exists` (boolean): 해당 이메일이 이미 존재하면 `true`, 존재하지 않으면 `false`

- 오류 응답 (`400 Bad Request` 등):
    - 이메일 형식이 올바르지 않거나 누락되었을 때 적절한 에러 메시지 반환

- 백엔드 처리 로직:
    - 이메일 유효성 검증
    - DB에서 이메일 기준 사용자 존재 여부 확인
    - 결과를 Boolean 형식으로 응답

##### Deletion

로그인된 사용자가 자신의 계정을 삭제 가능

- API 엔드포인트: `DELETE /api/v1/users/me`
- 요청 헤더 (Request Header):
    - Authorization: Bearer <AccessToken>

- 성공 응답 (Response - `204 No Content` 또는 `200 OK`):
    - `status` (정수): HTTP 상태 코드
        - `204 No Content` (권장): 성공적으로 처리되었으나 응답 본문이 없을 때
        - `200 OK` (선택 사항): 메시지 포함 시
    - `message` (문자열):
        - "계정이 성공적으로 탈퇴 처리되었습니다."

- 오류 응답 (Response): JSON 형식
    - `status` (정수):
        - `401 Unauthorized`
        - `404 Not Found`
        - `500 Internal Server Error`
    - `code` (문자열): 오류 코드
        - `UNAUTHORIZED_ACCESS`
        - `USER_NOT_FOUND`
    - `message` (문자열):
        - "인증 정보가 없습니다."
        - "사용자를 찾을 수 없습니다."

- 백엔드 처리 로직:
    - Authorization 헤더에서 Access Token 추출 및 유효성 검증
    - 유효한 토큰에서 사용자 ID 추출
    - 해당 사용자 ID의 데이터베이스 레코드를 실제 삭제하거나, `is_active`와 같은 플래그를 false로 설정하여 논리적으로 비활성화 (서비스 정책에 따라 결정)
    - 연관된 모든 유효한 Refresh Token 및 세션 정보를 무효화하여 해당 계정으로 더 이상 로그인할 수 없도록 합니다.

##### Authentication & Authorization

요청을 보내는 클라이언트(사용자)의 **신원(Authentication)**을 검증하여 '누구인지'를 확인합니다.

인증된 사용자가 요청된 리소스 또는 기능에 접근할 **권한(Authorization)**이 있는지 확인하여 '무엇을 할 수 있는지'를 결정합니다.

모든 인증 및 인가 단계를 성공적으로 통과하면, 요청된 원래 API의 비즈니스 로직이 계속해서 수행됩니다.

- API 엔드포인트: 이 기능 자체는 독립적인 엔드포인트가 아니며, `GET /api/v1/users/me`, `PUT /api/v1/users/me`, `DELETE /api/v1/users/me` 등 모든 보호된 API 요청에 적용되는 공통 로직입니다.

- 요청 헤더 (Request Header):
    - Authorization: Bearer <AccessToken> (클라이언트가 로그인 시 발급받은 유효한 Access Token을 이 헤더에 포함하여 전송해야 합니다.)

- 요청 (Request Body): (없음 - 인증/인가 자체는 요청 바디를 필요로 하지 않습니다.)

- 성공 응답(Response - `200 OK`): HTTP 상태 코드
    - `status` (정수):
        - `200 OK` (원래 API 요청의 성공 응답에 따라 결정됨. 인증/인가 로직 자체는 별도의 200 OK를 반환하지 않음)

- 오류 응답 (Response): JSON 형식

    - `status` (정수): HTTP 상태 코드
        - `401 Unauthorized` (Authorization 헤더가 없거나 토큰이 제공되지 않았을 때, 제공된 Access Token이 유효하지 않거나 변조되었을 때, Access Token의 유효 기간이 만료되었을 때)

        - `403 Forbidden` (AccessToken은 유효하고 사용자도 존재하지만, 해당 사용자가 요청된 특정 리소스나 작업에 대한 접근 권한이 없을 때 (예: 일반 사용자가 관리자만 접근 가능한 리소스에 접근하려 할 때))

        - `404 Not Found` (AccessToken은 유효하지만, 토큰에서 추출된 사용자 ID에 해당하는 사용자를 데이터베이스에서 찾을 수 없을 때 (예: 계정이 이미 삭제되었으나 만료되지 않은 토큰으로 요청했을 경우))
        
        - `500 Internal Server Error` (서버 내부에서 토큰 검증, 사용자 조회, 권한 확인 등 인증/인가 처리 중 예기치 않은 오류가 발생했을 때)

    - `code` (문자열): 특정 오류를 식별하는 내부 코드
        - `NO_TOKEN_PROVIDED`
        - `INVALID_TOKEN`
        - `EXPIRED_TOKEN`
        - `USER_NOT_FOUND`
        - `FORBIDDEN_ACCESS`
        - `AUTHENTICATION_FAILED` (일반적인 인증 실패)
        - `AUTHORIZATION_FAILED` (일반적인 인가 실패)

    - `message` (문자열): 사용자에게 표시할 명확한 오류 메시지
        - "인증 토큰이 제공되지 않았습니다."
        - "유효하지 않은 인증 토큰입니다."
        -"토큰이 만료되었습니다. 다시 로그인해주세요."
        - "요청하신 사용자를 찾을 수 없습니다."
        - "이 리소스에 접근할 권한이 없습니다."
        - "인증 처리 중 오류가 발생했습니다."

- 백엔드 처리 로직:
    - AccessToken 존재 및 형식 확인:
        - 수신된 HTTP 요청의 Authorization 헤더를 검사하여 Bearer <AccessToken> 형식을 따르는지 확인합니다.
        - Authorization 헤더가 없거나 형식이 올바르지 않으면 `401 Unauthorized` 응답을 반환합니다.
    - AccessToken 유효성 검증 (Authentication):
        - JWT 라이브러리 등을 사용하여 AccessToken의 **서명(Signature)**이 유효하고, 만료되지 않았으며(Expiration Time), 발급자(Issuer) 등 기타 클레임이 유효한지 검증합니다.
        - 검증 실패 시 `401 Unauthorized` 응답을 반환합니다.
    - 사용자 식별 및 존재 확인:
        - 유효한 AccessToken의 페이로드에서 사용자의 고유 ID를 추출합니다.
        - 추출된 사용자 ID를 사용하여 데이터베이스에서 해당 사용자가 실제로 활성화 상태로 존재하는지 조회합니다.
        - 사용자가 존재하지 않으면 `404 Not Found` 응답을 반환합니다.
    - 권한 확인 (Authorization):
        - 인증된 사용자의 역할(Role)이나 권한(Permission) 정보를 기반으로, 요청된 API 엔드포인트(`GET /api/v1/users/me`의 경우 본인 정보 조회)에 대한 접근 권한이 있는지 판단합니다.
        - 권한이 없는 경우 `403 Forbidden` 응답을 반환합니다.
    - 다음 로직으로 전달:
        - 모든 인증 및 인가 단계를 성공적으로 통과하면, 요청을 보낸 사용자의 ID 및 권한 정보를 다음 비즈니스 로직(예: 사용자 정보 조회, 수정, 탈퇴 등)으로 안전하게 전달하여 해당 로직이 정상적으로 수행되도록 합니다.

-->

<h4 id="시나리오유스케이스-작성">시나리오/유스케이스 작성</h4>

<p>작성하기 전 유스케이스 다이어그램</p>

<pre><code class="language-mermaid">graph LR
    Actor(사용자) --&gt; UC1(회원가입);
</code></pre>

<h5 id="sc-registration">SC Registration</h5>

<p><strong>공통 전처리</strong></p>
<ul>
  <li>요청 바디에서 <code class="language-plaintext highlighter-rouge">email</code>, <code class="language-plaintext highlighter-rouge">password</code>, <code class="language-plaintext highlighter-rouge">username</code>을 추출한다.</li>
  <li>각 필드에 대해 유효성 검증을 수행한다.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">email</code>: 문자열 여부 및 이메일 형식 검증</li>
      <li><code class="language-plaintext highlighter-rouge">password</code>: 길이 및 보안 정책(대소문자, 숫자, 특수문자 포함) 검증</li>
      <li><code class="language-plaintext highlighter-rouge">username</code>: 최소/최대 길이 확인</li>
    </ul>
  </li>
</ul>

<p><strong>성공 흐름</strong></p>
<ol>
  <li>이메일이 중복인지 확인한다.</li>
  <li>비밀번호를 해싱 처리한다.</li>
  <li>해싱된 비밀번호와 함께 사용자 정보를 DB에 저장한다.</li>
  <li>저장이 성공하면 다음 정보를 포함한 <code class="language-plaintext highlighter-rouge">201 Created</code> 응답을 반환한다.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">id</code>: 생성된 사용자 ID</li>
      <li><code class="language-plaintext highlighter-rouge">email</code>: 등록된 이메일 주소</li>
      <li><code class="language-plaintext highlighter-rouge">username</code>: 등록된 사용자명</li>
      <li><code class="language-plaintext highlighter-rouge">message</code>: “회원가입이 성공적으로 완료되었습니다.”</li>
    </ul>
  </li>
</ol>

<p><strong>실패 흐름 입력 무효</strong></p>
<ol>
  <li>검증에 실패한 경우 <code class="language-plaintext highlighter-rouge">400 Bad Request</code> 응답과 함께 적절한 오류 메시지를 반환한다.
    <ul>
      <li>“이메일 형식이 올바르지 않습니다.”</li>
      <li>“비밀번호는 최소 8자 이상, 64자 이하이며, 영문 대소문자, 숫자, 특수문자 중 3가지 이상을 포함해야 합니다.”</li>
      <li>“이름은 최소 2자 이상이며, 최대 30자 입니다.”</li>
    </ul>
  </li>
</ol>

<p><strong>실패 흐름 이메일 중복</strong></p>
<ol>
  <li>이메일이 중복인지 확인한다.</li>
  <li>이메일이 중복인 경우 <code class="language-plaintext highlighter-rouge">409 Conflict</code> 응답과 함께 적절한 오류 메시지를 반환한다.
    <ul>
      <li>“이미 등록된 이메일 주소입니다.”</li>
    </ul>
  </li>
</ol>

<p><strong>실패 흐름 DB 서버 통신 실패</strong></p>
<ol>
  <li>이메일이 중복인지 확인한다.</li>
  <li>비밀번호를 해싱 처리한다.</li>
  <li>해싱된 비밀번호와 함께 사용자 정보를 DB에 저장한다.</li>
  <li>DB에 반영되지 않은 경우 <code class="language-plaintext highlighter-rouge">500 Internal Server Error</code> 와 함께 적절한 오류 메시지를 반환한다.
    <ul>
      <li>“서버 오류가 발생했습니다. 사용자 정보를 저장하는 데 실패했습니다. 잠시 후 다시 시도해 주세요.”</li>
    </ul>
  </li>
</ol>

<h3 id="기술-설계">기술 설계</h3>

<h4 id="api-스펙-초안-작성">API 스펙 초안 작성</h4>

<h5 id="api-registration">API Registration</h5>

<p>새로운 사용자가 서비스에 가입하기 위해 필요한 정보를 제출하는 API입니다.</p>

<ul>
  <li>HTTP Method: <code class="language-plaintext highlighter-rouge">POST</code></li>
  <li>URL: <code class="language-plaintext highlighter-rouge">/api/v1-beta/users/register</code></li>
</ul>

<p><strong>요청 바디 (Request Body)</strong></p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">필드명</th>
      <th style="text-align: center">데이터 타입</th>
      <th style="text-align: left">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">email</code></td>
      <td style="text-align: center">string</td>
      <td style="text-align: left">사용자 이메일 주소</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">password</code></td>
      <td style="text-align: center">string</td>
      <td style="text-align: left">사용자 비밀번호</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">username</code></td>
      <td style="text-align: center">string</td>
      <td style="text-align: left">사용자 이름</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>요청 바디 예시</p>
</blockquote>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user@example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password123!"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"홍길동"</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p><strong>응답 (Response)</strong></p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">상태</th>
      <th style="text-align: center">코드</th>
      <th style="text-align: left">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">201</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">Created</code></td>
      <td style="text-align: left">회원가입이 성공적으로 완료되었을 때 반환하는 응답</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">400</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">Bad Request</code></td>
      <td style="text-align: left">요청 바디의 유효성 검증에 실패했을 때 반환하는 응답</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">409</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">Conflict</code></td>
      <td style="text-align: left">이메일이 이미 사용 중이어서 회원가입이 불가능할 때 반환하는 응답</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">500</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">Internal Server Error</code></td>
      <td style="text-align: left">서버 내부에서 예기치 않은 오류가 발생했을 때 반환하는 응답</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>응답 바디 예시 헤더는 생략:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid-1234-5678-90ab"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user@example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"홍길동"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"회원가입이 성공적으로 완료되었습니다."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"비밀번호는 최소 8자 이상, 64자 이하이며, 영문 대소문자, 숫자, 특수문자 중 3가지 이상을 포함해야 합니다."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"이미 등록된 이메일 주소입니다."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"서버 오류가 발생했습니다. 잠시 후 다시 시도해 주세요."</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<h4 id="db-테이블엔티티-구조-정의">DB 테이블/엔티티 구조 정의</h4>

<pre><code class="language-mermaid">erDiagram
    users {
        UUID id PK "사용자 고유 ID"
        VARCHAR email "이메일 주소"
        VARCHAR password "해싱된 비밀번호"
        VARCHAR username "사용자 이름"
    }
</code></pre>

<h4 id="서비스-계층의-로직-흐름-정리">서비스 계층의 로직 흐름 정리</h4>

<h5 id="sd-registration">SD Registration</h5>
<pre><code class="language-mermaid">sequenceDiagram
    participant User as 사용자
    participant Client as 클라이언트(웹/앱)
    participant APIServer as API 서버
    participant Service as 서비스 계층
    participant Database as 데이터베이스

    Title: 사용자 회원가입 시퀀스 다이어그램

    %% 성공 흐름
    User-&gt;&gt;Client: 회원가입 정보 입력
    Client-&gt;&gt;APIServer: 회원가입 요청&lt;br/&gt;(POST /api/v1-beta/users/register)

    APIServer-&gt;&gt;Service: 요청 처리 위임
    Service-&gt;&gt;Service: 1. 유효성 검증&lt;br/&gt;(email, password, username)
    Service-&gt;&gt;Database: 2. 이메일 중복 확인
    Database--&gt;&gt;Service: 중복 없음

    Service-&gt;&gt;Service: 3. 비밀번호 해싱
    Service-&gt;&gt;Database: 4. 사용자 정보 저장
    Database--&gt;&gt;Service: 저장 성공

    Service--&gt;&gt;APIServer: 201 Created 응답 반환
    APIServer--&gt;&gt;Client: 201 Created 응답
    Client--&gt;&gt;User: "회원가입 성공" 메시지 표시

    %% 입력 무효 실패 흐름
    alt 입력 무효
        User-&gt;&gt;Client: 잘못된 정보 입력
        Client-&gt;&gt;APIServer: 회원가입 요청&lt;br/&gt;(POST /api/v1-beta/users/register)
        APIServer-&gt;&gt;Service: 요청 처리 위임
        Service-&gt;&gt;Service: 1. 유효성 검증&lt;br/&gt;(실패)
        Service--&gt;&gt;APIServer: 400 Bad Request 반환
        APIServer--&gt;&gt;Client: 400 Bad Request 응답
        Client--&gt;&gt;User: "잘못된 입력입니다" 메시지 표시
    end

    %% 이메일 중복 실패 흐름
    alt 이메일 중복
        User-&gt;&gt;Client: 중복 이메일 입력
        Client-&gt;&gt;APIServer: 회원가입 요청&lt;br/&gt;(POST //api/v1-beta/users/register)
        APIServer-&gt;&gt;Service: 요청 처리 위임
        Service-&gt;&gt;Service: 1. 유효성 검증&lt;br/&gt;(성공)
        Service-&gt;&gt;Database: 2. 이메일 중복 확인
        Database--&gt;&gt;Service: 중복된 이메일 존재
        Service--&gt;&gt;APIServer: 409 Conflict 반환
        APIServer--&gt;&gt;Client: 409 Conflict 응답
        Client--&gt;&gt;User: "이미 등록된 이메일입니다" 메시지 표시
    end
</code></pre>

<h3 id="개발-sprint">개발 Sprint</h3>

<p>여기서는 구현하기 전 사용할 공통 라이브러리들을 전부 불러오고, 서버의 구동 profile 에 맞춰 configuration 들을 미리 작성해준다.</p>

<h4 id="핵심-기능-우선순위-설정-및-분할">핵심 기능 우선순위 설정 및 분할</h4>

<p>빈 class 파일들을 생성하고 Data Access, Presentation, Business Logic Layer 을 중점으로 작성해준다.</p>

<ol>
  <li>
    <p>엔드포인트(<code class="language-plaintext highlighter-rouge">UserController</code>) 구현 (<code class="language-plaintext highlighter-rouge">/api/v1-beta/users</code>)</p>
  </li>
  <li>
    <p>register(<code class="language-plaintext highlighter-rouge">POST /api/v1-beta/users/register</code>)</p>
    <ol>
      <li>User Entity 구현</li>
      <li>비즈니스 엔티티 유효성 검증을 위한 커스텀 인터페이스들 정의
        <ul>
          <li><code class="language-plaintext highlighter-rouge">@Password</code></li>
          <li><code class="language-plaintext highlighter-rouge">@Email</code> - <code class="language-plaintext highlighter-rouge">jakarta.validation.constraints</code> 참고</li>
        </ul>
      </li>
      <li>비즈니스 엔티티 유효성 검증을 위한 빈 밸리데이터 정의
        <ul>
          <li><code class="language-plaintext highlighter-rouge">PasswordRuleValidator</code> 클래스 구현</li>
        </ul>
      </li>
      <li>User JPA 변환 및 DAO 클래스(<code class="language-plaintext highlighter-rouge">UserRepository</code>) 구현
        <ul>
          <li>이메일 중복 검증을 위한 <code class="language-plaintext highlighter-rouge">existsByEmail</code> 함수 정의</li>
          <li>유저 데이터 저장하는 <code class="language-plaintext highlighter-rouge">createUser</code> 함수 정의</li>
        </ul>
      </li>
      <li>User 관련 최종 서비스를 제공하는 클래스(<code class="language-plaintext highlighter-rouge">UserService</code>) 구현
        <ul>
          <li><code class="language-plaintext highlighter-rouge">register</code> 함수 구현</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">UserController</code>의 <code class="language-plaintext highlighter-rouge">register</code> 함수 구현</li>
    </ol>
  </li>
</ol>

<pre><code class="language-mermaid">classDiagram
    direction LR

    subgraph Presentation_Layer
        class UserController {
            + register(String email, String password, String username) : ResponseEntity&lt;User&gt;
        }
    end

    subgraph Business_Logic_Layer
        class IUserService {
          &lt;&lt;interface&gt;&gt;
          ~ register(String email, String password, String username) : Optional&lt;User&gt;
        }
    end

    subgraph Data_Access_Layer
        class IUserRepository {
          &lt;&lt;interface&gt;&gt;
          ~ existsByEmail(email) : boolean
          ~ save(user) : User
        }
    end

    subgraph Domain_and_Validation
        class User {
          &lt;&lt;Entity&gt;&gt;
          - @Email String email
          - @Password String password
          - String username
        }
        class IPassword {
          &lt;&lt;interface&gt;&gt;
        }
        class PasswordRuleValidator {
          + @Override isValid(Object value, ConstraintValidatorContext context)
        }
        class ConstraintValidator {
          &lt;&lt;interface&gt;&gt;
          + isValid(value, context)
        }
    end


    UserController --|&gt; IUserService: use
    IUserService --|&gt; IUserRepository: use
    IUserRepository --|&gt; User: CRUD

    User ..|&gt; IPassword

    ConstraintValidator &lt;|.. PasswordRuleValidator: implements
    
    ConstraintValidator ..&gt; IPassword: generic type

</code></pre>

<h4 id="tdd-기반-소스코드-작성">TDD 기반 소스코드 작성</h4>

<p>위의 class diagram을 바탕으로 Test class 들을 작성해주어야 한다.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@DataJpaTest</span>
<span class="nd">@ActiveProfiles</span><span class="o">(</span><span class="s">"test"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">UserRepositoryTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">UserRepository</span> <span class="n">userRepository</span><span class="o">;</span>

    <span class="nd">@BeforeEach</span>
    <span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span>
                <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="s">"1@email.com"</span><span class="o">,</span> <span class="s">"name"</span><span class="o">,</span> <span class="s">"1234!@"</span><span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@AfterEach</span>
    <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">userRepository</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@ParameterizedTest</span>
    <span class="nd">@CsvSource</span><span class="o">({</span><span class="s">"1@gmail.com, name, 1234!@"</span><span class="o">})</span>
    <span class="kt">void</span> <span class="nf">givenTheData_whenCreatingSameUser_thenThrowsException</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>

        <span class="n">assertThrows</span><span class="o">(</span>
                <span class="nc">DataIntegrityViolationException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
                <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@ParameterizedTest</span>
    <span class="nd">@CsvSource</span><span class="o">({</span><span class="s">"user@email.com, user, 12329212@@!hdH"</span><span class="o">})</span>
    <span class="kt">void</span> <span class="nf">givenCreatedUser_whenExistingUser_thenExpectedResult</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">));</span>

        <span class="n">assertTrue</span><span class="o">(</span><span class="n">userRepository</span><span class="o">.</span><span class="na">existsByEmail</span><span class="o">(</span><span class="n">email</span><span class="o">));</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="n">userRepository</span><span class="o">.</span><span class="na">existsByEmail</span><span class="o">(</span><span class="s">"1@email.com"</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SpringBootTest</span>
<span class="nd">@ActiveProfiles</span><span class="o">(</span><span class="s">"test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">BCryptPasswordEncoder</span> <span class="no">PASSWORD_ENCODER</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BCryptPasswordEncoder</span><span class="o">();</span>

    <span class="c1">// AI 생성 테스트케이스</span>
    <span class="c1">// --- 테스트 데이터 제공 메서드 ---</span>
    <span class="c1">// @MethodSource 가 참조하는 정적 메서드입니다.</span>
    <span class="c1">// 각 Arguments 는 User 객체와 예상 결과를 담고 있습니다.</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Arguments</span><span class="o">&gt;</span> <span class="nf">wrongUserTestCases</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                <span class="c1">// 이메일 형식이 유효하지 않은 경우</span>
                <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"invalid_email.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"Valid-Password-123!"</span><span class="o">,</span>
                        <span class="s">"이메일 형식이 올바르지 않습니다."</span><span class="o">),</span>

                <span class="c1">// 사용자 이름이 너무 짧은 경우 (최소 2자)</span>
                <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"valid@email.com"</span><span class="o">,</span> <span class="s">"a"</span><span class="o">,</span> <span class="s">"Valid-Password-123!"</span><span class="o">,</span>
                        <span class="s">"이름은 최소 2자 이상이며, 최대 30자 입니다."</span><span class="o">),</span>

                <span class="c1">// 비밀번호가 너무 짧은 경우 (최소 8자)</span>
                <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"valid@email.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"short1!"</span><span class="o">,</span>
                        <span class="s">"비밀번호는 최소 8자 이상, 64자 이하이며, 영문 대소문자, 숫자, 특수문자 중 3가지 이상을 포함해야 합니다."</span><span class="o">),</span>

                <span class="c1">// 비밀번호가 복잡성 조건을 만족하지 못하는 경우 (3가지 이상 포함)</span>
                <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"valid@email.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"lowercaseonly"</span><span class="o">,</span>
                        <span class="s">"비밀번호는 최소 8자 이상, 64자 이하이며, 영문 대소문자, 숫자, 특수문자 중 3가지 이상을 포함해야 합니다."</span><span class="o">),</span> <span class="c1">// 소문자만</span>
                <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"valid@email.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"UPPERCASEONLY"</span><span class="o">,</span>
                        <span class="s">"비밀번호는 최소 8자 이상, 64자 이하이며, 영문 대소문자, 숫자, 특수문자 중 3가지 이상을 포함해야 합니다."</span><span class="o">),</span> <span class="c1">// 대문자만</span>
                <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"valid@email.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"1234567890"</span><span class="o">,</span>
                        <span class="s">"비밀번호는 최소 8자 이상, 64자 이하이며, 영문 대소문자, 숫자, 특수문자 중 3가지 이상을 포함해야 합니다."</span><span class="o">),</span> <span class="c1">// 숫자만</span>
                <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"valid@email.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"only!@#$"</span><span class="o">,</span>
                        <span class="s">"비밀번호는 최소 8자 이상, 64자 이하이며, 영문 대소문자, 숫자, 특수문자 중 3가지 이상을 포함해야 합니다."</span><span class="o">),</span> <span class="c1">// 특수문자만</span>
                <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"valid@email.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"Abcdefg1"</span><span class="o">,</span>
                        <span class="s">"비밀번호는 최소 8자 이상, 64자 이하이며, 영문 대소문자, 숫자, 특수문자 중 3가지 이상을 포함해야 합니다."</span><span class="o">),</span> <span class="c1">// 대문자, 소문자, 숫자 (3가지) -&gt; 통과해야 하지만, 예시를 위해 실패로 가정</span>
                <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"valid@email.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"Abcdefg!"</span><span class="o">,</span>
                        <span class="s">"비밀번호는 최소 8자 이상, 64자 이하이며, 영문 대소문자, 숫자, 특수문자 중 3가지 이상을 포함해야 합니다."</span><span class="o">)</span><span class="c1">// 대문자, 소문자, 특수문자 (3가지) -&gt; 통과해야 하지만, 예시를 위해 실패로 가정</span>
        <span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Arguments</span><span class="o">&gt;</span> <span class="nf">rightUserTestCases</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"valid@email.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"Abcdefg!"</span><span class="o">,</span>
                        <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="s">"valid@email.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="no">PASSWORD_ENCODER</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="s">"Abcdefg!"</span><span class="o">))),</span>

                        <span class="nc">Arguments</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"valid@gmail.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="s">"12341234"</span><span class="o">,</span>
                        <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="s">"valid@gmail.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="no">PASSWORD_ENCODER</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="s">"12341234"</span><span class="o">)))</span>
        <span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@ParameterizedTest</span>
    <span class="nd">@MethodSource</span><span class="o">(</span><span class="s">"wrongUserTestCases"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">givenWrongUser_whenRegister_thenExpectedResult</span><span class="o">(</span>
            <span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">,</span> <span class="nc">String</span> <span class="n">expected</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ValidationException</span> <span class="n">exception</span> <span class="o">=</span> <span class="n">assertThrows</span><span class="o">(</span>
                <span class="nc">ValidationException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
                <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">userService</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">)</span>
        <span class="o">);</span>

        <span class="n">assertTrue</span><span class="o">(</span><span class="s">"예상한 메시지가 아닙니다."</span><span class="o">,</span> <span class="n">expected</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">exception</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()));</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">givenSameUser_whenRegister_thenExpectedException</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="s">"email@email.com"</span><span class="o">,</span> <span class="s">"username"</span><span class="o">,</span> <span class="s">"Password123!"</span><span class="o">);</span>
        <span class="n">assertThrows</span><span class="o">(</span>
                <span class="nc">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
                <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">userService</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="s">"email@email.com"</span><span class="o">,</span> <span class="s">"hi"</span><span class="o">,</span> <span class="s">"Password123!"</span><span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@ParameterizedTest</span>
    <span class="nd">@MethodSource</span><span class="o">(</span><span class="s">"rightUserTestCases"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">givenValidUser_whenRegister_thenExpectedResult</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">,</span> <span class="nc">User</span> <span class="n">expected</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">email</span><span class="o">,</span> <span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="s">"등록 실패"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">isPresent</span><span class="o">());</span>

        <span class="nc">User</span> <span class="n">validUser</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="s">"이메일 불일치"</span><span class="o">,</span>  <span class="n">expected</span><span class="o">.</span><span class="na">getEmail</span><span class="o">(),</span> <span class="n">validUser</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="s">"이름 불일치"</span><span class="o">,</span>  <span class="n">expected</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span> <span class="n">validUser</span><span class="o">.</span><span class="na">getUsername</span><span class="o">());</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="s">"패스워드 불일치"</span><span class="o">,</span> <span class="no">PASSWORD_ENCODER</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">password</span><span class="o">,</span> <span class="n">validUser</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>컨트롤러 수준은 더 공부하고 작성</p>

<h3 id="sprint-review--retrospective">Sprint Review &amp; Retrospective</h3>

<h4 id="v01">v0.1</h4>


    </div><div id="disqus_thread" style="margin-top:25px"></div>
    <script>
    var disqus_config = function () {
        this.page.url = 'https://seonghun120614.github.io/seonghun120614/computerscience/java/spring/2025/07/30/project.-user-function-mvp.html';
        this.page.identifier = 'https://seonghun120614.github.io/seonghun120614/computerscience/java/spring/2025/07/30/project.-user-function-mvp.html';
    };
    (function () {
        var d = document, s = d.createElement('script');
        s.src = 'https://seonghun.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
  </script>
    <noscript>Please enable JavaScript to view the <a
            href="https://disqus.com/?ref_noscript" rel="nofollow">comments
            powered by Disqus.</a></noscript></div>
<script>
    mermaid.initialize({startOnLoad:true});
    window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
</script>
            </section>
            <footer class="condensed">
                <ul class="social about-footer condensed"><li>
                        <a
                            href="https://github.com/seonghun120614"
                            target="_blank"
                            rel="noopener"
                            aria-label="github">
                            <i class="icon-github-circled"></i>
                        </a>
                    </li><li>
                        <a
                            href="mailto:seonghun120614@gmail.com"
                            target="_blank" rel="noopener" aria-label="email">
                            <i class="icon-mail-alt"></i>
                        </a>
                    </li></ul><nav class="navigation about-footer condensed">
                    <ul>
                        
                        <li>
                            <a href="/seonghun120614/about">About Me</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/computerscience">Computer Science</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/math">Math</a>
                        </li>
                        
                        <li>
                            <a href="/seonghun120614/categories/softwareengineering">Software Engineering</a>
                        </li>
                        
                    </ul>
                </nav><p class="about-footer condensed">&copy;
                    2025</p><div class="about-footer condensed">
                    <p>Dark Mode
                        <i class="icon-moon"></i>
                        <label class="switch" for="dark-toggle">
                            <input id="dark-toggle" type="checkbox"
                                class="dark-mode-toggle"
                                aria-label="Toggle dark mode">
                            <span class="slider round"
                                onclick="toggleDarkMode()"></span>
                        </label>
                    </p>
                </div>
            </footer>
        </main>
        
        <script type="text/javascript" src="/seonghun120614/assets/js/darkmode.js"></script>
        
        <script src="/seonghun120614/assets/js/simple-jekyll-search.min.js"></script>
        <script src="/seonghun120614/assets/js/search.js"></script>
        
        <script>
            window.addEventListener('scroll', () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                document.getElementById('scroll-progress').style.width = scrollPercent + '%';
            });
        </script>
    </body>
</html>